!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){},{}],2:[function(t,e,i){cc._tmp=cc._tmp||{},cc._LogInfos=cc._LogInfos||{};var n=window;n.gl,n.WebGLRenderingContext,n.DeviceOrientationEvent,n.DeviceMotionEvent,n.AudioContext,n.AudioContext||n.webkitAudioContext,n.mozAudioContext,n=Object.prototype,n._super,n.ctor,n=null;var r;r="1.3.2",window.CocosEngine=cc.ENGINE_VERSION=r,cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys"),function(){function t(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;(isNaN(i)||i>2||i<0)&&(t[e.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===i&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===i&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}function e(t,i,n){if(s[i])return null;n=n||"";var r=[],o=t[i];if(!o)throw new Error("can not find module ["+i+"]");for(var a=cc.path,c=0,h=o.length;c<h;c++){var l=o[c];if(!s[l]){var u=a.extname(l);if(u)".js"===u.toLowerCase()&&r.push(a.join(n,l));else{var d=e(t,l,n);d&&(r=r.concat(d))}s[l]=1}}return r}function i(){cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),a&&a()}function n(t){var n=cc.game.CONFIG_KEY,r=t[n.engineDir],s=cc.loader;if(cc._Class)i();else{var o=cc.path.join(r,"moduleConfig.json");s.load(o,function(n,o){if(n)throw new Error(n);var a=t.modules||[],c=o.module,h=[];cc.sys.capabilities.opengl&&a.indexOf("base4webgl")<0?a.splice(0,0,"base4webgl"):a.indexOf("core")<0&&a.splice(0,0,"core");for(var l=0,u=a.length;l<u;l++){var d=e(c,a[l],r);d&&(h=h.concat(d))}s.load(h,function(t){if(t)throw new Error(JSON.stringify(t));i()})})}}function r(){window.removeEventListener("load",r,!1),n(cc.game.config)}var s={},o=!1,a=null;cc._engineLoaded=!1,cc.initEngine=function(e,i){if(o){var s=a;return void(a=function(){s&&s(),i&&i()})}a=i,!cc.game.config&&e?cc.game.config=e:cc.game.config||cc.game._loadConfig(),e=cc.game.config,t(e),document.body?n(e):window.addEventListener("load",r,!1),o=!0}}()},{"./cocos2d/core/platform/CCSys":135,"./cocos2d/core/utils":165}],3:[function(t,e,i){function n(t){if("object"!=typeof t)return t;try{return JSON.stringify(t)}catch(e){return""}}cc._LogInfos={ActionManager:{addAction:"cc.ActionManager.addAction(): action must be non-null",removeAction:"cocos2d: removeAction: Target not found",removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found"},configuration:{loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",loadConfigFile_2:"Please load the resource first : %s"},Director:{resume:"cocos2d: Director: Error in gettimeofday",setProjection:"cocos2d: Director: unrecognized projection",popToSceneStackLevel:"cocos2d: Director: unrecognized projection",popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",popScene:"running scene should not null",pushScene:"the scene should not null"},Array:{verifyType:"element type is wrong!"},deprecated:'"%s" is deprecated, please use "%s" instead.',Scheduler:{scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null"},Node:{getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",getRotation:"RotationX != RotationY. Don't know which one to return",getScale:"ScaleX != ScaleY. Don't know which one to return",addChild:"An Node can't be added as a child of itself.",addChild_2:"child already added. It can't be added again",addChild_3:"child must be non-null",removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",removeChildByTag:"argument tag is an invalid tag",removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",reumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",_arrayMakeObjectsPerformSelector:"Unknown callback function",reorderChild:"child must be non-null",runAction:"cc.Node.runAction(): action must be non-null",schedule:"callback function must be non-null",schedule_2:"interval must be positive",initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_requestDirtyFlag:"_ccsg.Node._requestDirtyFlag: failed to satisfy the request, key (%s) for flag have already been taken"},AtlasNode:{_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",_initWithTileFile:"",_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."},_checkEventListenerAvailable:{keyboard:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",touchOneByOne:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",touchAllAtOnce:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",acceleration:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil"},EventListener:{create:"Invalid parameter."},__getListenerID:"Don't call this method if the event is for touch.",LayerMultiplex:{initWithLayers:"parameters should not be ending with null in Javascript",switchTo:"Invalid index in MultiplexLayer switchTo message",switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",addLayer:"cc.Layer.addLayer(): layer should be non-null"},view:{setDesignResolutionSize:"Resolution not valid",setDesignResolutionSize_2:"should set resolutionPolicy"},inputManager:{handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s"},checkGLErrorDebug:"WebGL error %s",spriteFrameAnimationCache:{_addAnimationsWithDictionary:"cocos2d: cc.SpriteFrameAnimationCache: No animations were found in provided dictionary.",_addAnimationsWithDictionary_2:"cc.SpriteFrameAnimationCache. Invalid animation format",addAnimations:"cc.SpriteFrameAnimationCache.addAnimations(): File could not be found",_parseVersion1:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion1_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",_parseVersion1_3:"cocos2d: cc.SpriteFrameAnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",_parseVersion1_4:"cocos2d: cc.SpriteFrameAnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",_parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",_parseVersion2_2:"cocos2d: cc.SpriteFrameAnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",addAnimations_2:"cc.SpriteFrameAnimationCache.addAnimations(): Invalid texture file name"},Sprite:{reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",_updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",initWithSpriteFrameName1:" is null, please check.",initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",addChild_3:"cc.Sprite.addChild(): child should be non-null",setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",setSpriteFrame:"Invalid spriteFrameName",setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null"},SpriteBatchNode:{addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",addChild_2:"cc.Sprite.addChild(): child should be non-null",setSpriteFrame:"Invalid spriteFrameName",setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null"},spriteFrameCache:{_getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",_checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",_getFrameConfig_2:"Please load the resource first : %s",addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",addSpriteFrames_3:"Argument must be non-nil"},TextureAtlas:{initWithFile:"cocos2d: Could not open file: %s",insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex"},textureCache:{addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",addPVRImage:"addPVRImage does not support on HTML5",addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",invalidKey:"TextureCache: url should be non-null"},Texture2D:{initWithETCFile:"initWithETCFile does not support on HTML5",initWithPVRFile:"initWithPVRFile does not support on HTML5",initWithPVRTCData:"initWithPVRTCData does not support on HTML5",addImage:"cc.Texture.addImage(): path should be non-null",initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",initWithString:"initWithString isn't supported on cocos2d-html5",initWithETCFile_2:"initWithETCFile does not support on HTML5",initWithPVRFile_2:"initWithPVRFile does not support on HTML5",initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",_initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",addImage_2:"cc.Texture.addImage(): path should be non-null",initWithData:"NSInternalInconsistencyException"},MissingFile:"Missing file: %s",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager:{addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",removeListeners:"Invalid listener type!",setPriority:"Can't set fixed priority with scene graph based listener.",addListener_2:"Invalid parameters.",addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",addListener_4:"The listener has been registered, please don't register it again.",addListener_5:"Unsupported listener target.",_forceAddEventListener:"Invalid scene graph priority!",_updateListeners:"If program goes here, there should be event in dispatch.",_updateListeners_2:"_inDispatch should be 1 here."}},cc._logToWebPage=function(t){if(cc._canvas){var e=cc._logList,i=document;if(!e){var n=i.createElement("Div"),r=n.style;n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),r.zIndex="99999",r.position="absolute",r.top="0",r.left="0",e=cc._logList=i.createElement("textarea");var s=e.style;e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderRightWidth="0px",s.borderLeftWidth="0px",s.borderTopWidth="0px",s.borderTopStyle="none",s.borderRightStyle="none",s.borderLeftStyle="none",s.padding="0px",s.margin=0}e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight}};var r=t("./cocos2d/core/value-types/CCEnum");cc.DebugMode=r({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6});cc.log||console.log;cc._initDebugSetting=function(t){if(cc.log=cc.warn=cc.error=cc._throw=cc.assert=function(){},t!==cc.DebugMode.NONE){var e;t>cc.DebugMode.ERROR?(e=cc._logToWebPage.bind(cc),cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(cc,arguments))},cc.assert=function(t,i){"use strict";if(!t&&i){for(var r=2;r<arguments.length;r++)i=i.replace(/(%s)|(%d)/,n(arguments[r]));e("Assert: "+i)}},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(cc,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){e(cc.js.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,n(arguments[i]));throw new Error(e)}},t!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)})),cc._throw=function(t){var e=t.stack;e?cc.error(e):cc.error(t)}}}},{"./cocos2d/core/value-types/CCEnum":172}],4:[function(t,e,n){(function(n,r,s,o){function a(t){var e,i,n,r,s,o,a=1;for(g[0]=t;a;)if(a--,n=g[a],g[a]=null,n&&(e=n._children,e&&e.length>0))for(r=n._renderCmd,s=0,o=e.length;s<o;++s)i=e[s],g[a]=i,a++,i._renderCmd.transform(r)}function c(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)c(i[n],e)}function h(t){if(t.length%4!==0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],n=0;n<e;n++){var r=4*n;i[n]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return i}function l(t){if(n.sys.os===n.sys.OS_IOS&&9===n.sys.osMainVersion){var e=t.convertToWorldSpace(n.p(0,0)),i=n.visibleRect.height,r=n.visibleRect.width,s=.5;r>i&&(s=.7),setTimeout(function(){if(window.scrollY<nt&&e.y<i*s){var t=i*s-e.y-window.scrollY;t<35&&(t=35),t>320&&(t=320),window.scrollTo(0,t)}},rt)}}function u(t){return t.charAt(0).toUpperCase()+t.slice(1)}function d(t,e,i,r,s){if(s+=r,!(s<=1)){e*=.5;for(var o,a=s-1,c=r;c<s;c++){o=2*c;var h,l=n.p(t[2*c],t[2*c+1]);if(0===c)h=n.pPerp(n.pNormalize(n.pSub(l,n.p(t[2*(c+1)],t[2*(c+1)+1]))));else if(c===a)h=n.pPerp(n.pNormalize(n.pSub(n.p(t[2*(c-1)],t[2*(c-1)+1]),l)));else{var u=n.p(t[2*(c-1)],t[2*(c-1)+1]),d=n.p(t[2*(c+1)],t[2*(c+1)+1]),f=n.pNormalize(n.pSub(d,l)),p=n.pNormalize(n.pSub(u,l)),g=Math.acos(n.pDot(f,p));h=g<n.degreesToRadians(70)?n.pPerp(n.pNormalize(n.pMidpoint(f,p))):g<n.degreesToRadians(170)?n.pNormalize(n.pMidpoint(f,p)):n.pPerp(n.pNormalize(n.pSub(d,u)))}h=n.pMult(h,e),i[2*o]=l.x+h.x,i[2*o+1]=l.y+h.y,i[2*(o+1)]=l.x-h.x,i[2*(o+1)+1]=l.y-h.y}for(r=0===r?0:r-1,c=r;c<a;c++){o=2*c;var m=o+2,v=n.v2(i[2*o],i[2*o+1]),y=n.v2(i[2*(o+1)],i[2*(o+1)+1]),T=n.v2(i[2*m],i[2*m+1]),C=n.v2(i[2*(m+1)],i[2*(m+1)+1]),b=_(v.x,v.y,C.x,C.y,y.x,y.y,T.x,T.y),x=!b.isSuccess;x||(b.value<0||b.value>1)&&(x=!0),x&&(i[2*m]=C.x,i[2*m+1]=C.y,i[2*(m+1)]=T.x,i[2*(m+1)+1]=T.y)}}}function _(t,e,i,n,r,s,o,a){var c,h,l,u;if(t===i&&e===n||r===o&&s===a)return{isSuccess:!1,value:0};if(i-=t,n-=e,r-=t,s-=e,o-=t,a-=e,c=Math.sqrt(i*i+n*n),h=i/c,l=n/c,u=r*h+s*l,s=s*h-r*l,r=u,u=o*h+a*l,a=a*h-o*l,o=u,s===a)return{isSuccess:!1,value:0};var d=(o+(r-o)*a/(a-s))/c;return{isSuccess:!0,value:d}}n._tmp.PrototypeCCNode=function(){var t=_ccsg.Node.prototype;n.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),n.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),n.defineGetterSetter(t,"width",t._getWidth,t._setWidth),n.defineGetterSetter(t,"height",t._getHeight,t._setHeight),n.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),n.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),n.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),n.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),n.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),n.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),n.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),n.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),n.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),n.defineGetterSetter(t,"scale",t.getScale,t.setScale),n.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),n.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),n.defineGetterSetter(t,"children",t.getChildren),n.defineGetterSetter(t,"childrenCount",t.getChildrenCount),n.defineGetterSetter(t,"parent",t.getParent,t.setParent),n.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),n.defineGetterSetter(t,"running",t.isRunning),n.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.setIgnoreAnchorPointForPosition),n.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),n.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),n.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),n.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),n.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),n.defineGetterSetter(t,"color",t.getColor,t.setColor),n.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},n.s_globalOrderOfArrival=1,_ccsg.Node=n.Class({name:"ccsg.Node",properties:{_localZOrder:0,_globalZOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:n.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:n.p(0,0),_contentSize:n.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:n.macro.NODE_TAG_INVALID,_showNode:!1,_name:"",_realOpacity:255,_realColor:n.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1},ctor:function(){arguments[0];this.__instanceId=n.ClassManager.getNewInstanceId(),this._running=!1,this._reorderChildDirty=!1,this._shaderProgram=null,this._arrivalOrder=0,this._additionalTransformDirty=!1,this._isTransitionFinished=!1;var t=n.director;this._actionManager=t.getActionManager(),this._scheduler=t.getScheduler(),this._additionalTransform=n.affineTransformMakeIdentity(),this._initRendererCmd()},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(t&&0!==t.length){var i,r,s=t.length,o=_ccsg.Node._stateCallbackType;switch(e){case o.onEnter:for(i=0;i<s;i++)r=t[i],r&&r.onEnter();break;case o.onExit:for(i=0;i<s;i++)r=t[i],r&&r.onExit();break;case o.onEnterTransitionDidFinish:for(i=0;i<s;i++)r=t[i],r&&r.onEnterTransitionDidFinish();break;case o.cleanup:for(i=0;i<s;i++)r=t[i],r&&r.cleanup();break;case o.updateTransform:for(i=0;i<s;i++)r=t[i],r&&r.updateTransform();break;case o.onExitTransitionDidStart:for(i=0;i<s;i++)r=t[i],r&&r.onExitTransitionDidStart();break;case o.sortAllChildren:for(i=0;i<s;i++)r=t[i],r&&r.sortAllChildren();break;default:n.assert(0,n._LogInfos.Node._arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),n.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return n.log(n._LogInfos.Node.getZOrder),this.getLocalZOrder()},setZOrder:function(t){n.log(n._LogInfos.Node.setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,n.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&n.log(n._LogInfos.Node.getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&n.log(n._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return n.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),n.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return n.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return n.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t;var e=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(e.transformDirty|e.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},setIgnoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},updateOrderOfArrival:function(){this._arrivalOrder=++n.s_globalOrderOfArrival},getActionManager:function(){return this._actionManager||(this._actionManager=n.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=n.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return n.log(n._LogInfos.Node.boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=n.rect(0,0,this._contentSize.width,this._contentSize.height);return n._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),n.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return n.log("Invalid name"),null;for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var r,s=!1;"undefined"==typeof i?(i=void 0,r=t._name):n.js.isString(i)?(r=i,i=void 0):n.js.isNumber(i)&&(s=!0,r=""),n.assert(t,n._LogInfos.Node.addChild_3),n.assert(null===t._parent,"child already added. It can't be added again"),this._addChildHelper(t,e,i,r,s)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.updateOrderOfArrival(),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){n.log(n._LogInfos.Node.removeFromParentAndCleanup),
this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e),n.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===n.macro.NODE_TAG_INVALID&&n.log(n._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):n.log(n._LogInfos.Node.removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var r=e[i];r&&(this._running&&(r.onExitTransitionDidStart(),r.onExit()),t&&r.cleanup(),r.parent=null,r._renderCmd.detachFromParent())}this._children.length=0,n.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),n.js.array.remove(this._children,t)},_insertChild:function(t,e){n.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){n.assert(t,n._LogInfos.Node.reorderChild),n.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.updateOrderOfArrival(),t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i._arrivalOrder<n[e]._arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.onExit)},runAction:function(t){return n.assert(t,n._LogInfos.Node.runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){return t===n.Action.TAG_INVALID?void n.log(n._LogInfos.Node.stopActionByTag):void this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===n.Action.TAG_INVALID?(n.log(n._LogInfos.Node.getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,r,s){var o=arguments.length;"function"==typeof t?1===o?(e=0,i=n.macro.REPEAT_FOREVER,r=0,s=this.__instanceId):2===o?"number"==typeof e?(i=n.macro.REPEAT_FOREVER,r=0,s=this.__instanceId):(s=e,e=0,i=n.macro.REPEAT_FOREVER,r=0):3===o?("string"==typeof i?(s=i,i=n.macro.REPEAT_FOREVER):s=this.__instanceId,r=0):4===o&&(s=this.__instanceId):1===o?(e=0,i=n.macro.REPEAT_FOREVER,r=0):2===o&&(i=n.macro.REPEAT_FOREVER,r=0),n.assert(t,n._LogInfos.Node.schedule),n.assert(e>=0,n._LogInfos.Node.schedule_2),e=e||0,i=null==i?n.macro.REPEAT_FOREVER:i,r=r||0,this.scheduler.schedule(t,this,e,i,r,!this._running,s)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){n.log(n._LogInfos.Node.resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),n.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){n.log(n._LogInfos.Node.pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),n.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){return void 0===t?this._additionalTransformDirty=!1:(this._additionalTransform=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),void(this._additionalTransformDirty=!0))},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=n.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return n.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return n.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||n.v2(0,0),n.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return n.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||n.v2(0,0);var e=n.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return n.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=n.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,_ccsg.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},r=this._parent;null!=r&&r!=t;r=r.getParent())n.affineTransformConcatIn(i,r.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=n.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(n._rectApplyAffineTransformIn(t,e),!this._children)return t;for(var i=this._children,r=0;r<i.length;r++){var s=i[r];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(e);o&&(t=n.rectUnion(t,o))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=n.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():n.affineTransformConcat(this.getNodeToParentTransform(),t);if(n._rectApplyAffineTransformIn(e,i),!this._children)return e;for(var r=this._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(i);a&&(e=n.rectUnion(e,a))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return n.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=n.renderer.getRenderCmd(this)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=function(t){return n._Class.extend.call(_ccsg.Node,t)},_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},n.assert("function"==typeof n._tmp.PrototypeCCNode,n._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),n._tmp.PrototypeCCNode(),delete n._tmp.PrototypeCCNode,n.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)}};var f=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:9};n.js.get(f,"all",function(){var t=f.COUNT;return(1<<t)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){n.assert(!f[t],n._LogInfos.Node._requestDirtyFlag,t);var e=f.COUNT,i=1<<e;return f[t]=i,f.COUNT++,i};var p=Math.PI/180,g=new Array(50);_ccsg.Node.RenderCmd=function(t){this._dirtyFlag=1,n.renderer.pushDirtyNode(this),this._node=t,this._needDraw=!1,this._anchorPointInPoints=new n.Vec2(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=n.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return n.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return n.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(f.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(f.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&f.transformDirty&&(this._inverse=n.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(f.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&n.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){var i=this._node,n=t?t._worldTransform:null,r=this._transform,s=this._worldTransform,o=i._rotationX||i._rotationY,c=i._skewX||i._skewY,h=i._scaleX,l=i._scaleY,u=this._anchorPointInPoints.x,d=this._anchorPointInPoints.y,_=1,f=0,g=0,m=1;if(o||c){if(r.tx=i._position.x,r.ty=i._position.y,o){var v=i._rotationX*p;if(g=Math.sin(v),m=Math.cos(v),i._rotationY===i._rotationX)_=m,f=-g;else{var y=i._rotationY*p;_=Math.cos(y),f=-Math.sin(y)}}if(r.a=_*=h,r.b=f*=h,r.c=g*=l,r.d=m*=l,c){var T=Math.tan(i._skewX*p),C=Math.tan(i._skewY*p);T===1/0&&(T=99999999),C===1/0&&(C=99999999),r.a=_+g*C,r.b=f+m*C,r.c=g+_*T,r.d=m+f*T}(u||d)&&(r.tx-=r.a*u+r.c*d,r.ty-=r.b*u+r.d*d,i._ignoreAnchorPointForPosition&&(r.tx+=u,r.ty+=d)),n?(s.a=r.a*n.a+r.b*n.c,s.b=r.a*n.b+r.b*n.d,s.c=r.c*n.a+r.d*n.c,s.d=r.c*n.b+r.d*n.d,s.tx=n.a*r.tx+n.c*r.ty+n.tx,s.ty=n.d*r.ty+n.ty+n.b*r.tx):(s.a=r.a,s.b=r.b,s.c=r.c,s.d=r.d,s.tx=r.tx,s.ty=r.ty)}else r.a=h,r.b=0,r.c=0,r.d=l,r.tx=i._position.x,r.ty=i._position.y,(u||d)&&(r.tx-=r.a*u,r.ty-=r.d*d,i._ignoreAnchorPointForPosition&&(r.tx+=u,r.ty+=d)),n?(s.a=r.a*n.a+r.b*n.c,s.b=r.a*n.b+r.b*n.d,s.c=r.c*n.a+r.d*n.c,s.d=r.c*n.b+r.d*n.d,s.tx=r.tx*n.a+r.ty*n.c+n.tx,s.ty=r.tx*n.b+r.ty*n.d+n.ty):(s.a=r.a,s.b=r.b,s.c=r.c,s.d=r.d,s.tx=r.tx,s.ty=r.ty);this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),e&&a(i),this._cacheDirty=!0},getNodeToParentTransform:function(){return this._dirtyFlag&f.transformDirty&&this.transform(),this._transform},_propagateFlagsDown:function(t){var e=this._dirtyFlag,i=t?t._node:null;i&&i._cascadeColorEnabled&&t._dirtyFlag&f.colorDirty&&(e|=f.colorDirty),i&&i._cascadeOpacityEnabled&&t._dirtyFlag&f.opacityDirty&&(e|=f.opacityDirty),t&&t._dirtyFlag&f.transformDirty&&(e|=f.transformDirty),this._dirtyFlag=e},visit:function(t){var e=this._node,i=n.renderer;t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),e._visible&&(isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t),this.visitChildren())},_updateDisplayColor:function(t){var e,i,r,s,o=this._node,a=this._displayedColor,c=o._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=c.r,a.g=c.g,a.b=c.b;var h=new n.Color(255,255,255,255);for(r=o._children,e=0,i=r.length;e<i;e++)s=r[e],s&&s._renderCmd&&s._renderCmd._updateDisplayColor(h);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var l=o._parent;t=l&&l._cascadeColorEnabled?l.getDisplayedColor():n.Color.WHITE}if(a.r=0|c.r*t.r/255,a.g=0|c.g*t.g/255,a.b=0|c.b*t.b/255,o._cascadeColorEnabled)for(r=o._children,e=0,i=r.length;e<i;e++)s=r[e],s&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor())}this._dirtyFlag&=~f.colorDirty},_updateDisplayOpacity:function(t){var e,i,n,r,s=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!s._cascadeOpacityEnabled){for(this._displayedOpacity=s._realOpacity,n=s._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var o=s._parent;t=255,o&&o._cascadeOpacityEnabled&&(t=o.getDisplayedOpacity())}if(this._displayedOpacity=s._realOpacity*t/255,s._cascadeOpacityEnabled)for(n=s._children,e=0,i=n.length;e<i;e++)r=n[e],r&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag&=~f.opacityDirty},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,r=e._realColor;if(void 0===t){var s=e._parent;t=s&&s._cascadeColorEnabled?s.getDisplayedColor():n.Color.WHITE}i.r=0|r.r*t.r/255,i.g=0|r.g*t.g/255,i.b=0|r.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,e=t&f.colorDirty,i=t&f.opacityDirty;t&f.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~f.contentDirty),e&&this._updateDisplayColor(),i&&this._updateDisplayOpacity(),(e||i)&&this._updateColor(),t&f.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~f.transformDirty)},_syncStatus:function(t){var e=this._dirtyFlag,i=e&f.colorDirty,n=e&f.opacityDirty;i&&this._syncDisplayColor(),n&&this._syncDisplayOpacity(),(i||n)&&this._updateColor(),e&f.transformDirty&&this.transform(t)},visitChildren:function(){var t,e,i=n.renderer,r=this._node,s=r._children,o=s.length;if(o>0){for(r.sortAllChildren(),t=0;t<o&&(e=s[t],e._localZOrder<0);t++)e._renderCmd.visit(this);for(i.pushRenderCommand(this);t<o;t++)s[t]._renderCmd.visit(this)}else i.pushRenderCommand(this);this._dirtyFlag=0}},_ccsg.Node.RenderCmd.prototype.originVisit=_ccsg.Node.RenderCmd.prototype.visit,_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.CanvasRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new n.Region,this._oldRegion=new n.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var m=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);m.constructor=_ccsg.Node.CanvasRenderCmd,m._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var v=new n.Rect;m.getLocalBB=function(){var t=this._node;return v.x=v.y=0,v.width=t._getWidth(),v.height=t._getHeight(),v},m._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},m.setDirtyFlag=function(t,e){_ccsg.Node.RenderCmd.prototype.setDirtyFlag.call(this,t,e),this._setCacheDirty(e),this._cachedParent&&this._cachedParent.setDirtyFlag(t,!0)},m._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var t=this._cachedParent;t&&t!==this&&t._setNodeDirtyForCache&&t._setNodeDirtyForCache()}},m._setCachedParent=function(t){if(this._cachedParent!==t){this._cachedParent=t;for(var e=this._node._children,i=0,n=e.length;i<n;i++)e[i]._renderCmd._setCachedParent(t)}},m.detachFromParent=function(){this._cachedParent=null;for(var t,e=this._node._children,i=0,n=e.length;i<n;i++)t=e[i],t&&t._renderCmd&&t._renderCmd.detachFromParent()},m.setShaderProgram=function(t){},m.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===n.macro.SRC_ALPHA&&t.dst===n.macro.ONE||t.src===n.macro.ONE&&t.dst===n.macro.ONE?"lighter":t.src===n.macro.ZERO&&t.dst===n.macro.SRC_ALPHA?"destination-in":t.src===n.macro.ZERO&&t.dst===n.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"},_ccsg.Node.WebGLRenderCmd=function(t){_ccsg.Node.RenderCmd.call(this,t),this._shaderProgram=null};var m=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);m.constructor=_ccsg.Node.WebGLRenderCmd,m._updateColor=function(){},m.setShaderProgram=function(t){this._shaderProgram=t},m.getShaderProgram=function(){return this._shaderProgram},_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(n.director.getWinSize())}}),n.LoaderScene=_ccsg.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",_onProjectionChange:null,cb:null,target:null,init:function(){var t=this,e=160,i=200,r=t._bgLayer=new n.LayerColor(n.color(32,32,32,255));t.addChild(r,0);var s=24,o=-i/2+100;if(n._loaderImage){var a=new Image;a.src=n._loaderImage,e=a.width,i=a.height,t._initStage(a,n.visibleRect.center),s=14,o=-i/2-10}var c=t._label=new n.LabelTTF("Loading... 0%","Arial",s);return c.setPosition(n.pAdd(n.visibleRect.center,n.p(0,o))),c.setColor(n.color(180,180,180)),r.addChild(this._label,10),!0},_initStage:function(t,e){var i=this,r=i._texture2d=new n.Texture2D;r.initWithElement(t),r.handleLoadedTexture();var s=i._logo=new _ccsg.Sprite(r);s.x=e.x,s.y=e.y,i._bgLayer.addChild(s,10)},onEnter:function(){var t=this;_ccsg.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3),this._onProjectionChange=function(){t._updateTransform()},n.director.on(n.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange)},onExit:function(){n.director.off(n.Director.EVENT_PROJECTION_CHANGED,this._onProjectionChange),_ccsg.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,e,i){n.js.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=i},_startLoading:function(){var t=this;t.unschedule(t._startLoading);var e=t.resources;n.loader.load(e,function(e,i){var n=e/i*100|0;n=Math.min(n,100),t._label.setString("Loading... "+n+"%")},function(e,i){t.cb&&t.cb.call(t.target,e,i)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)}}),n.LoaderScene.preload=function(t,e,i){var r=n;return r.loaderScene||(r.loaderScene=new n.LoaderScene,r.loaderScene.init()),r.loaderScene.initWithResources(t,e,i),n.director.runScene(r.loaderScene),r.loaderScene},n.Layer=_ccsg.Node.extend({_className:"Layer",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(n.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(n.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.Layer.CanvasRenderCmd(this):new n.Layer.WebGLRenderCmd(this)}}),n.LayerColor=n.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){n.Layer.prototype.ctor.call(this),this._blendFunc=new n.BlendFunc(n.macro.SRC_ALPHA,n.macro.ONE_MINUS_SRC_ALPHA),n.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){n._renderType!==n.game.RENDER_TYPE_CANVAS&&(this.shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_POSITION_COLOR));var r=n.director.getWinSize();t=t||n.color(0,0,0,255),e=void 0===e?r.width:e,i=void 0===i?r.height:i;var s=this._realColor;return s.r=t.r,s.g=t.g,s.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty),n.LayerColor.prototype.setContentSize.call(this,e,i),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.LayerColor.CanvasRenderCmd(this):new n.LayerColor.WebGLRenderCmd(this)}}),function(){var t=n.LayerColor.prototype;n.defineGetterSetter(t,"width",t._getWidth,t._setWidth),n.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),n.LayerGradient=n.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,r){n.LayerColor.prototype.ctor.call(this),this._endColor=n.color(0,0,0,255),this._alongVector=n.p(0,-1),this._startOpacity=255,this._endOpacity=255,r&&r instanceof Array?(this._colorStops=r,r.splice(0,0,{p:0,color:t||n.Color.BLACK}),r.push({p:1,color:e||n.Color.BLACK})):this._colorStops=[{p:0,color:t||n.Color.BLACK},{p:1,color:e||n.Color.BLACK}],n.LayerGradient.prototype.init.call(this,t,e,i,r)},init:function(t,e,i,r){t=t||n.color(0,0,0,255),e=e||n.color(0,0,0,255),i=i||n.p(0,-1);var s=this,o=s._endColor;return s._startOpacity=t.a,o.r=e.r,o.g=e.g,o.b=e.b,s._endOpacity=e.a,s._alongVector=i,s._compressedInterpolation=!0,n.LayerColor.prototype.init.call(s,n.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){n.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){n.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){n.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return n.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var i=e[0].color;i.r=t.r,i.g=t.g,i.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var i=this._colorStops;if(i&&i.length>0){var n=i[i.length-1].color;n.r=t.r,n.g=t.g,n.b=t.b}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},getEndColor:function(){return n.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getVector:function(){return n.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty|_ccsg.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.LayerGradient.CanvasRenderCmd(this):new n.LayerGradient.WebGLRenderCmd(this)}}),function(){var t=n.LayerGradient.prototype;t.startColor,n.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,n.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,n.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,n.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,n.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,n.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),n.LayerMultiplex=n.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){n.Layer.prototype.ctor.call(this),t instanceof Array?n.LayerMultiplex.prototype.initWithLayers.call(this,t):n.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return t.length>0&&null==t[t.length-1]&&n.log(n._LogInfos.LayerMultiplex.initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){return t>=this._layers.length?void n.log(n._LogInfos.LayerMultiplex.switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,void this.addChild(this._layers[t]))},switchToAndReleaseMe:function(t){return t>=this._layers.length?void n.log(n._LogInfos.LayerMultiplex.switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,void this.addChild(this._layers[t]))},addLayer:function(t){return t?void this._layers.push(t):void n.log(n._LogInfos.LayerMultiplex.addLayer)}}),function(){n.Layer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._isBaked=!1,this._bakeSprite=null,this._updateCache=2};var t=n.Layer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);t.constructor=n.Layer.CanvasRenderCmd,t._setCacheDirty=function(t){if(t&&0===this._updateCache&&(this._updateCache=2),this._cacheDirty===!1){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}},t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~t.orderDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~e.orderDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){var i=this._worldTransform,n=i.a,r=i.b,s=i.c,o=i.d;_ccsg.Node.CanvasRenderCmd.prototype.transform.call(this,t,e),i.a===n&&i.b===r&&i.c===s&&i.d===o||0!==this._updateCache||(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,this._isBaked=this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new n.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2);for(var t=this._node._children,e=0,i=t.length;e<i;e++)t[e]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var t=this._node,e=t._children,i=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var r=this._getBoundingBoxForBake();r.width=0|r.width+.5,r.height=0|r.height+.5;var s=i.getCacheContext(),o=s.getContext();if(i.setPosition(r.x,r.y),this._updateCache>0){i.resetCanvasSize(r.width,r.height),s.setOffset(0-r.x,o.canvas.height-r.height+r.y),t.sortAllChildren(),n.renderer._turnToCacheMode(this.__instanceId);for(var a=0,c=e.length;a<c;a++)e[a].visit(this);n.renderer._renderingToCacheCanvas(s,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit(t);var e=this._node,i=e._children,r=i.length;this._propagateFlagsDown(t),e._visible&&0!==r&&(this._syncStatus(t),n.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._bakeForAddChild=function(t){t._parent===this._node&&this._isBaked&&t._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var t=null,e=this._node;if(!e._children||0===e._children.length)return n.rect(0,0,10,10);for(var i=e.getNodeToWorldTransform(),r=e._children,s=0,o=r.length;s<o;s++){var a=r[s];if(a&&a._visible)if(t){var c=a._getBoundingBoxToCurrentNode(i);
c&&(t=n.rectUnion(t,c))}else t=a._getBoundingBoxToCurrentNode(i)}return t}}(),function(){n.LayerColor.CanvasRenderCmd=function(t){n.Layer.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new n.CustomRenderCmd(this,this._bakeRendering)};var t=n.LayerColor.CanvasRenderCmd.prototype=Object.create(n.Layer.CanvasRenderCmd.prototype);t.constructor=n.LayerColor.CanvasRenderCmd,t.unbake=function(){n.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._displayedColor,c=this._displayedOpacity/255,h=o._contentSize.width,l=o._contentSize.height;0!==c&&(r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(c),r.setFillStyle("rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+", 1)"),r.setTransform(this._worldTransform,e,i),s.fillRect(0,0,h,-l),n.g_NumberOfDraws++)},t.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var t,e=this._node,i=this._bakeSprite,r=e._children,s=r.length;this.transform(this.getParentRenderCmd(),!0);var o=this._getBoundingBoxForBake();o.width=0|o.width+.5,o.height=0|o.height+.5;var a=i.getCacheContext(),c=a.getContext();if(i.setPosition(o.x,o.y),this._updateCache>0){c.fillStyle=a._currentFillStyle,i.resetCanvasSize(o.width,o.height),a.setOffset(0-o.x,c.canvas.height-o.height+o.y);var h;if(n.renderer._turnToCacheMode(this.__instanceId),s>0){for(e.sortAllChildren(),t=0;t<s&&(h=r[t],h._localZOrder<0);t++)h._renderCmd.visit(this);for(n.renderer.pushRenderCommand(this);t<s;t++)r[t]._renderCmd.visit(this)}else n.renderer.pushRenderCommand(this);n.renderer._renderingToCacheCanvas(a,this.__instanceId),i.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(t){if(!this._isBaked)return void this.originVisit();var e=this._node;this._propagateFlagsDown(t),e._visible&&(this._syncStatus(t),n.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._getBoundingBoxForBake=function(){var t=this._node,e=n.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();if(e=n.rectApplyAffineTransform(e,t.getNodeToWorldTransform()),!t._children||0===t._children.length)return e;for(var r=t._children,s=0;s<r.length;s++){var o=r[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(i);e=n.rectUnion(e,a)}}return e}}(),function(){n.LayerGradient.CanvasRenderCmd=function(t){n.LayerColor.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._startPoint=n.p(0,0),this._endPoint=n.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=n.LayerGradient.CanvasRenderCmd.prototype=Object.create(n.LayerColor.CanvasRenderCmd.prototype);t.constructor=n.LayerGradient.CanvasRenderCmd,t.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._displayedOpacity/255;if(0!==a){var c=o._contentSize.width,h=o._contentSize.height;r.setCompositeOperation(this._blendFuncStr),r.setGlobalAlpha(a);var l=s.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(o._colorStops)for(var u=0;u<o._colorStops.length;u++){var d=o._colorStops[u];l.addColorStop(d.p,this._colorStopsStr[u])}else l.addColorStop(0,this._startStopStr),l.addColorStop(1,this._endStopStr);r.setFillStyle(l),r.setTransform(this._worldTransform,e,i),s.fillRect(0,0,c,-h),n.g_NumberOfDraws++}},t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._dirtyFlag&=~t.gradientDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._dirtyFlag&=~e.gradientDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t._updateColor=function(){var t=this._node,e=t._contentSize,i=.5*e.width,r=.5*e.height,s=n.pAngleSigned(n.p(0,-1),t._alongVector),o=n.pRotateByAngle(n.p(0,-1),n.p(0,0),s),a=Math.min(Math.abs(1/o.x),Math.abs(1/o.y));this._startPoint.x=i*(-o.x*a)+i,this._startPoint.y=r*(o.y*a)-r,this._endPoint.x=i*(o.x*a)+i,this._endPoint.y=r*(-o.y*a)-r;var c=this._displayedColor,h=t._endColor,l=t._startOpacity/255,u=t._endOpacity/255;if(this._startStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+l.toFixed(4)+")",this._endStopStr="rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+u.toFixed(4)+")",t._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var d=0;d<t._colorStops.length;d++){var _=t._colorStops[d].color,f=null==_.a?1:_.a/255;this._colorStopsStr.push("rgba("+Math.round(_.r)+","+Math.round(_.g)+","+Math.round(_.b)+","+f.toFixed(4)+")")}}}}(),function(){n.Layer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t)};var t=n.Layer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);t.constructor=n.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),function(){n.LayerColor.WebGLRenderCmd=function(t){n.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new n.math.Matrix4,this._matrix.identity();var e=this;e._squareVerticesAB=new ArrayBuffer(48),e._squareColorsAB=new ArrayBuffer(16);var i=e._squareVerticesAB,r=e._squareColorsAB,s=n.Vertex3F.BYTES_PER_ELEMENT,o=n.Color.BYTES_PER_ELEMENT;e._squareVertices=[new n.Vertex3F(0,0,0,i,0),new n.Vertex3F(0,0,0,i,s),new n.Vertex3F(0,0,0,i,2*s),new n.Vertex3F(0,0,0,i,3*s)],e._squareColors=[n.color(0,0,0,255,r,0),n.color(0,0,0,255,r,o),n.color(0,0,0,255,r,2*o),n.color(0,0,0,255,r,3*o)],e._verticesFloat32Buffer=n._renderContext.createBuffer(),e._colorsUint8Buffer=n._renderContext.createBuffer(),this._shaderProgram=n.shaderCache.programForKey(n.SHADER_POSITION_COLOR)};var t=n.LayerColor.WebGLRenderCmd.prototype=Object.create(n.Layer.WebGLRenderCmd.prototype);t.constructor=n.LayerColor.WebGLRenderCmd,t.rendering=function(t){var e=t||n._renderContext,i=this._node,r=this._worldTransform,s=this._matrix.mat;s[0]=r.a,s[4]=r.c,s[12]=r.tx,s[1]=r.b,s[5]=r.d,s[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_COLOR),n.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(n.macro.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(n.macro.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length)},t.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._contentSize.width,r=i._contentSize.height,s=this._squareVertices;s[1].x=n,s[2].y=r,s[3].x=n,s[3].y=r,s[0].z=s[1].z=s[2].z=s[3].z=i._vertexZ,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;n<4;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.DYNAMIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),function(){n.LayerGradient.WebGLRenderCmd=function(t){n.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new n.Rect,this._clippingRectDirty=!1};var t=n.LayerGradient.WebGLRenderCmd.prototype=Object.create(n.LayerColor.WebGLRenderCmd.prototype);t.constructor=n.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._updateVertex(),this._dirtyFlag&=~t.gradientDirty),_ccsg.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag&=~e.gradientDirty),_ccsg.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){this.originTransform(t,e),this._updateVertex()},t._updateVertex=function(){var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){this._clippingRectDirty=!0;var i,r=e.length,s=2*r,o=t._contentSize,a=this._squareVertices;if(a.length<s){this._squareVerticesAB=new ArrayBuffer(12*s),a.length=0;var c=this._squareVerticesAB,h=n.Vertex3F.BYTES_PER_ELEMENT;for(i=0;i<s;i++)a.push(new n.Vertex3F(0,0,0,c,h*i))}var l=Math.PI+n.pAngleSigned(n.p(0,-1),t._alongVector),u=n.p(o.width/2,o.height/2),d=Math.round(n.radiansToDegrees(l)),_=n.affineTransformMake(1,0,0,1,u.x,u.y);_=n.affineTransformRotate(_,l);var f,p;d<90?(f=n.p(-u.x,u.y),p=n.p(u.x,u.y)):d<180?(f=n.p(u.x,u.y),p=n.p(u.x,-u.y)):d<270?(f=n.p(u.x,-u.y),p=n.p(-u.x,-u.y)):(f=n.p(-u.x,-u.y),p=n.p(-u.x,u.y));var g=Math.sin(l),m=Math.cos(l),v=Math.abs((f.x*m-f.y*g)/u.x),y=Math.abs((p.x*g+p.y*m)/u.y);for(_=n.affineTransformScale(_,v,y),i=0;i<r;i++){var T=e[i],C=T.p*o.height,b=n.pointApplyAffineTransform(-u.x,C-u.y,_);a[2*i].x=b.x,a[2*i].y=b.y,a[2*i].z=t._vertexZ;var x=n.pointApplyAffineTransform(o.width-u.x,C-u.y,_);a[2*i+1].x=x.x,a[2*i+1].y=x.y,a[2*i+1].z=t._vertexZ}this._bindLayerVerticesBufferData()}},t._updateColor=function(){var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){var r=e.length,s=this._squareColors,o=2*r;if(s.length<o){this._squareColorsAB=new ArrayBuffer(4*o),s.length=0;var a=this._squareColorsAB,c=n.Color.BYTES_PER_ELEMENT;for(i=0;i<o;i++)s.push(n.color(0,0,0,255,a,c*i))}var h=this._displayedOpacity/255;for(i=0;i<r;i++){var l=e[i].color,u=s[2*i],d=s[2*i+1];u.r=l.r,u.g=l.g,u.b=l.b,u.a=l.a*h,d.r=l.r,d.g=l.g,d.b=l.b,d.a=l.a*h}this._bindLayerColorsBufferData()}},t.rendering=function(t){var e=t||n._renderContext,i=this._node,r=this._getClippingRect();e.enable(e.SCISSOR_TEST),n.view.setScissorInPoints(r.x,r.y,r.width,r.height);var s=this._worldTransform,o=this._matrix.mat;o[0]=s.a,o[4]=s.c,o[12]=s.tx,o[1]=s.b,o[5]=s.d,o[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_COLOR),n.gl.blendFunc(i._blendFunc.src,i._blendFunc.dst),e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.vertexAttribPointer(n.macro.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.vertexAttribPointer(n.macro.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._squareVertices.length),e.disable(e.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var t=this._node,e=n.rect(0,0,t._contentSize.width,t._contentSize.height),i=t.getNodeToWorldTransform();this._clipRect=n._rectApplyAffineTransformIn(e,i)}return this._clipRect}}(),n.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=n.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=n.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},gatherGPUInfo:function(){if(n._renderType!==n.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=n._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),r=0;r<i.length;r++)this._GlExtensions+=i[r]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,n.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=n.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);n.assert(e,n._LogInfos.configuration.loadConfigFile_2,t);var i=e.data;if(!i)return void n.log(n._LogInfos.configuration.loadConfigFile,t);for(var r in i)this._valueDict[r]=i[r]}},n.DrawingPrimitiveCanvas=n._Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=n.view.getScaleX(),r=n.view.getScaleY(),s=n.p(t.x*i,t.y*r),o=this._renderContext.getContext();o.beginPath(),o.arc(s.x,-s.y,e*i,0,2*Math.PI,!1),o.closePath(),o.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1);var r=this._renderContext.getContext(),s=n.view.getScaleX(),o=n.view.getScaleY();r.beginPath();for(var a=0,c=t.length;a<c;a++)r.arc(t[a].x*s,-t[a].y*o,i*s,0,2*Math.PI,!1);r.closePath(),r.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext(),r=n.view.getScaleX(),s=n.view.getScaleY();i.beginPath(),i.moveTo(t.x*r,-t.y*s),i.lineTo(e.x*r,-e.y*s),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(n.p(t.x,t.y),n.p(e.x,t.y)),this.drawLine(n.p(e.x,t.y),n.p(e.x,e.y)),this.drawLine(n.p(e.x,e.y),n.p(t.x,e.y)),this.drawLine(n.p(t.x,e.y),n.p(t.x,t.y))},drawSolidRect:function(t,e,i){var r=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];this.drawSolidPoly(r,4,i)},drawPoly:function(t,e,i,r){if(r=r||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var s=t[0],o=this._renderContext.getContext(),a=n.view.getScaleX(),c=n.view.getScaleY();o.beginPath(),o.moveTo(s.x*a,-s.y*c);for(var h=1,l=t.length;h<l;h++)o.lineTo(t[h].x*a,-t[h].y*c);i&&o.closePath(),r?o.fill():o.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,r,s){s=s||!1;var o=this._renderContext.getContext(),a=n.view.getScaleX(),c=n.view.getScaleY();o.beginPath();var h=i-2*Math.PI;o.arc(0|t.x*a,0|-(t.y*c),e*a,-i,-h,!1),s&&o.lineTo(0|t.x*a,0|-(t.y*c)),o.stroke()},drawQuadBezier:function(t,e,i,r){var s=this._cacheArray;s.length=0;for(var o=0,a=0;a<r;a++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,h=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;s.push(n.p(c,h)),o+=1/r}s.push(n.p(i.x,i.y)),this.drawPoly(s,r+1,!1,!1)},drawCubicBezier:function(t,e,i,r,s){var o=this._cacheArray;o.length=0;for(var a=0,c=0;c<s;c++){var h=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*r.x,l=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*r.y;o.push(n.p(h,l)),a+=1/s}o.push(n.p(r.x,r.y)),this.drawPoly(o,s+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){n._renderContext.setStrokeStyle("rgba(255,255,255,1)");var r=this._cacheArray;r.length=0;for(var s,o,a=1/t.length,c=0;c<i+1;c++){var h=c/i;1===h?(s=t.length-1,o=1):(s=0|h/a,o=(h-a*s)/a);var l=n.cardinalSplineAt(n.getControlPointAt(t,s-1),n.getControlPointAt(t,s-0),n.getControlPointAt(t,s+1),n.getControlPointAt(t,s+2),e,o);r.push(l)}this.drawPoly(r,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var s=arguments.length,o=this._renderContext.getContext();switch(s){case 2:var a=t.height;o.drawImage(t,e.x,-(e.y+a));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,i){var r=t||this._renderContext,s=r.getContext();e*=n.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);r.setFillStyle(o+",1)");var a=e/10;s.beginPath(),s.moveTo(-e,e),s.lineTo(0,a),s.lineTo(e,e),s.lineTo(a,0),s.lineTo(e,-e),s.lineTo(0,-a),s.lineTo(-e,-e),s.lineTo(-a,0),s.lineTo(-e,e),s.closePath(),s.fill();var c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var h=0,l=n.macro.PI2;s.arc(0,0,e-a,h,l,!1),s.closePath(),s.fill()},drawColorBall:function(t,e,i){var r=t||this._renderContext,s=r.getContext();e*=n.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),a=e/10,c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(.6,o+", 0.4)"),c.addColorStop(1,o+", 0.0)"),r.setFillStyle(c),s.beginPath();var h=0,l=n.macro.PI2;s.arc(0,0,e,h,l,!1),s.closePath(),s.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*n.view.getScaleX()}});var y=n.macro;n.DrawingPrimitiveWebGL=n._Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(null==t&&(t=n._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;t._initialized||(t._shader=n.shaderCache.programForKey(y.SHADER_POSITION_UCOLOR),t._shader._addUniformLocation(t._colorLocation),t._shader._addUniformLocation(t._pointSizeLocation),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),n.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW),i.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,t.length),i.deleteBuffer(r),n.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(r),n.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(n.p(t.x,t.y),n.p(e.x,t.y)),this.drawLine(n.p(e.x,t.y),n.p(e.x,e.y)),this.drawLine(n.p(e.x,e.y),n.p(t.x,e.y)),this.drawLine(n.p(t.x,e.y),n.p(t.x,t.y))},drawSolidRect:function(t,e,i){var r=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];this.drawSolidPoly(r,4,i)},drawPoly:function(t,e,i){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),i?r.drawArrays(r.LINE_LOOP,0,t.length):r.drawArrays(r.LINE_STRIP,0,t.length),r.deleteBuffer(s),n.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a);var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,t.length),r.deleteBuffer(s),n.incrementGLDraws(1)},drawCircle:function(t,e,i,r,s){this.lazy_init();var o=1;s&&o++;var a=2*Math.PI/r,c=new Float32Array(2*(r+2));if(c){for(var h=0;h<=r;h++){var l=h*a,u=e*Math.cos(l+i)+t.x,d=e*Math.sin(l+i)+t.y;c[2*h]=u,c[2*h+1]=d}c[2*(r+1)]=t.x,c[2*(r+1)+1]=t.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),_.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var f=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,f),_.bufferData(_.ARRAY_BUFFER,c,_.STATIC_DRAW),_.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,r+o),_.deleteBuffer(f),n.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,r){this.lazy_init();for(var s=new Float32Array(2*(r+1)),o=0,a=0;a<r;a++)s[2*a]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,s[2*a+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/r;s[2*r]=i.x,s[2*r+1]=i.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,r+1),c.deleteBuffer(h),n.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,r,s){this.lazy_init();for(var o=new Float32Array(2*(s+1)),a=0,c=0;c<s;c++)o[2*c]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*r.x,o[2*c+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*r.y,a+=1/s;o[2*s]=r.x,o[2*s+1]=r.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,l),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW),h.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,s+1),h.deleteBuffer(l),n.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var r,s,o=new Float32Array(2*(i+1)),a=1/t.length,c=0;c<i+1;c++){var h=c/i;1===h?(r=t.length-1,s=1):(r=0|h/a,s=(h-a*r)/a);var l=n.cardinalSplineAt(n.getControlPointAt(t,r-1),n.getControlPointAt(t,r),n.getControlPointAt(t,r+1),n.getControlPointAt(t,r+2),e,s);o[2*c]=l.x,o[2*c+1]=l.y}var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),u.enableVertexAttribArray(y.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,d),u.bufferData(u.ARRAY_BUFFER,o,u.STATIC_DRAW),u.vertexAttribPointer(y.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,i+1),u.deleteBuffer(d),n.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}}),n._tmp.PrototypeSprite=function(){var t=_ccsg.Sprite.prototype;n.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),n.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),n.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,n.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,n.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,n.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,n.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,n.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,n.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,n.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,n.defineGetterSetter(t,"quad",t.getQuad)};var T=t("../cocos2d/core/event/event-target");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){var r=this;_ccsg.Node.prototype.ctor.call(r),T.call(r),r._shouldBeHidden=!1,r._offsetPosition=n.p(0,0),r._unflippedOffsetPositionFromCenter=n.p(0,0),r._blendFunc={src:n.macro.BLEND_SRC,dst:n.macro.BLEND_DST},r._rect=n.rect(0,0,0,0),r._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return n.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return n.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){n.assert(t,n._LogInfos.Sprite.initWithSpriteFrame),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var e=n._renderType!==n.game.RENDER_TYPE_CANVAS&&t._rotated,i=this.initWithTexture(t.getTexture(),t.getRect(),e);return this.setSpriteFrame(t),i},initWithSpriteFrameName:function(t){n.assert(t,n._LogInfos.Sprite.initWithSpriteFrameName);var e=n.spriteFrameCache.getSpriteFrame(t);return n.assert(e,t+n._LogInfos.Sprite.initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;_ccsg.Node.prototype.sortAllChildren.call(this),this._batchNode&&this._arrayMakeObjectsPerformSelector(t,_ccsg.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,e){return n.assert(t,n._LogInfos.Sprite.reorderChild_2),this._children.indexOf(t)===-1?void n.log(n._LogInfos.Sprite.reorderChild):void(e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),_ccsg.Node.prototype.reorderChild.call(this,t,e)))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),_ccsg.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;n<r;n++)i.removeSpriteFromAtlas(e[n]);_ccsg.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},setIgnoreAnchorPointForPosition:function(t){return this._batchNode?void n.log(n._LogInfos.Sprite.setIgnoreAnchorPointForPosition):void _ccsg.Node.prototype.setIgnoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){n.assert(t,n._LogInfos.Sprite.setDisplayFrameWithAnimationName_3);var i=n.spriteFrameAnimationCache.getAnimation(t);if(!i)return void n.log(n._LogInfos.Sprite.setDisplayFrameWithAnimationName);var r=i.getFrames()[e];return r?void this.setSpriteFrame(r.getSpriteFrame()):void n.log(n._LogInfos.Sprite.setDisplayFrameWithAnimationName_2)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(void 0===t)_ccsg.Sprite.prototype.init.call(this);else if(n.js.isString(t))if("#"===t[0]){var r=t.substr(1,t.length-1),s=n.spriteFrameCache.getSpriteFrame(r);s?this.initWithSpriteFrame(s):n.log("%s does not exist",t)}else _ccsg.Sprite.prototype.init.call(this,t,e);else if("object"==typeof t)if(t instanceof n.Texture2D)this.initWithTexture(t,e,i);else if(t instanceof n.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){
var o=new n.Texture2D;o.initWithElement(t),o.handleLoadedTexture(),this.initWithTexture(o)}},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return arguments.length>0?t.initWithFile(arguments[0],arguments[1]):(_ccsg.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=n.macro.BLEND_SRC,t._blendFunc.dst=n.macro.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,t.setTextureRect(n.rect(0,0,0,0),!1,n.size(0,0)),!0)},initWithFile:function(t,e){n.assert(t,n._LogInfos.Sprite.initWithFile);var i=n.textureCache.getTextureForKey(t);if(i){if(!e){var r=i.getContentSize();e=n.rect(0,0,r.width,r.height)}return this.initWithTexture(i,e)}return i=n.textureCache.addImage(t),this.initWithTexture(i,e||n.rect(0,0,i._contentSize.width,i._contentSize.height))},initWithTexture:function(t,e,i,r){var s=this;if(n.assert(0!==arguments.length,n._LogInfos.SpriteBatchNode.initWithTexture),i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,r),!_ccsg.Node.prototype.init.call(s))return!1;s._batchNode=null,s._recursiveDirty=!1,s.dirty=!1,s._opacityModifyRGB=!0,s._blendFunc.src=n.macro.BLEND_SRC,s._blendFunc.dst=n.macro.BLEND_DST,s._flippedX=s._flippedY=!1,s.setAnchorPoint(.5,.5),s._offsetPosition.x=0,s._offsetPosition.y=0,s._hasChildren=!1;var o=t.isLoaded();return s._textureLoaded=o,o?(e||(e=n.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),s.setTexture(t),s.setTextureRect(e,i),s.setBatchNode(null),this.emit("load"),!0):(s._rectRotated=i,e&&(s._rect.x=e.x,s._rect.y=e.y,s._rect.width=e.width,s._rect.height=e.height),s.texture&&s.texture.off("load",s._renderCmd._textureLoadedCallback,s._renderCmd),t.once("load",s._renderCmd._textureLoadedCallback,s._renderCmd),s.setTexture(t),!0)},setTextureRect:function(t,e,i,n){var r=this;r._rectRotated=e||!1,r.setContentSize(i||t),r.setVertexRect(t),r._renderCmd._setTextureCoords(t,n);var s=r._unflippedOffsetPositionFromCenter.x,o=r._unflippedOffsetPositionFromCenter.y;r._flippedX&&(s=-s),r._flippedY&&(o=-o);var a=r._rect;r._offsetPosition.x=s+(r._contentSize.width-a.width)/2,r._offsetPosition.y=o+(r._contentSize.height-a.height)/2},addChild:function(t,e,i){n.assert(t,n._LogInfos.SpriteBatchNode.addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(_ccsg.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this;n.js.isString(t)&&(t=n.spriteFrameCache.getSpriteFrame(t),n.assert(t,n._LogInfos.Sprite.setSpriteFrame)),this.setNodeDirty(!0);var i=t.getOffset();e._unflippedOffsetPositionFromCenter.x=i.x,e._unflippedOffsetPositionFromCenter.y=i.y;var r=t.getTexture(),s=t.textureLoaded();s?(e._textureLoaded=!0,r!==e._texture&&(e._setTexture(r),e.setColor(e._realColor)),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(e._textureLoaded=!1,t.once("load",function(t){var i=t.currentTarget;e._textureLoaded=!0;var n=i.getTexture();n!==e._texture&&e._setTexture(n),e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),e.emit("load"),e.setColor(e._realColor)},e)),this._renderCmd._updateForSetSpriteFrame(r)},setDisplayFrame:function(t){n.log(n._LogInfos.Sprite.setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new n.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setBatchNode:function(t){var e=this;e._batchNode=t,e._batchNode?(e._transformToBatch=n.affineTransformIdentity(),e.textureAtlas=e._batchNode.getTextureAtlas()):(e.atlasIndex=_ccsg.Sprite.INDEX_NOT_INITIALIZED,e.textureAtlas=null,e._recursiveDirty=!1,e.dirty=!1)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=n.js.isString(t);e&&(t=n.textureCache.addImage(t)),t._textureLoaded?(this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(t),t.once("load",function(i){this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(t,e){this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var e=t._contentSize,i=n.rect(0,0,e.width,e.height);this.setTextureRect(i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),_ccsg.Sprite.INDEX_NOT_INITIALIZED=-1,n.js.addon(_ccsg.Sprite.prototype,T.prototype),n.assert("function"==typeof n._tmp.PrototypeSprite,n._LogInfos.MissingFile,"SpritesPropertyDefine.js"),n._tmp.PrototypeSprite(),delete n._tmp.PrototypeSprite;var C=_ccsg.Sprite.prototype;Object.defineProperty(C,"visible",{get:_ccsg.Node.prototype.isVisible,set:C.setVisible}),Object.defineProperty(C,"ignoreAnchor",{get:_ccsg.Node.prototype.isIgnoreAnchorPointForPosition,set:C.setIgnoreAnchorPointForPosition}),Object.defineProperty(C,"opacityModifyRGB",{get:C.isOpacityModifyRGB}),_ccsg.Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var m=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=_ccsg.Sprite.CanvasRenderCmd,m.setDirtyRecursively=function(t){},m._setTexture=function(t){var e=this._node;e._texture!==t&&(t?e._textureLoaded=t._textureLoaded:e._textureLoaded=!1,e._texture=t,this._updateColor())},m._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},m.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()===e._texture&&n.rectEqualToRect(t.getRect(),e._rect)},m.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},m._setBatchNodeForAddChild=function(t){return!0},m._handleTextureForRotatedTexture=function(t,e,i,r){if(i&&t.isLoaded()){var s=t.getHtmlElementObj();s=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(s,e,r);var o=new n.Texture2D;o.initWithElement(s),o.handleLoadedTexture(),t=o,e.x=e.y=0,this._node._rect=n.rect(0,0,e.width,e.height)}return t},m._checkTextureBoundary=function(t,e,i){if(t&&t.url){var r=e.x+e.width,s=e.y+e.height;r>t.width&&n.error(n._LogInfos.RectWidth,t.url),s>t.height&&n.error(n._LogInfos.RectHeight,t.url)}},m.rendering=function(t,e,i){var r=this._node,s=this._textureCoord,o=this._displayedOpacity/255,a=this._textureToRender||r._texture;if((!a||0!==s.width&&0!==s.height&&a._textureLoaded)&&0!==o){var c,h=t||n._renderContext,l=h.getContext(),u=r._offsetPosition.x,d=r._rect.height,_=r._rect.width,f=-r._offsetPosition.y-d;h.setTransform(this._worldTransform,e,i),h.setCompositeOperation(this._blendFuncStr),h.setGlobalAlpha(o),(r._flippedX||r._flippedY)&&h.save(),r._flippedX&&(u=-u-_,l.scale(-1,1)),r._flippedY&&(f=r._offsetPosition.y,l.scale(1,-1));var p,g,m,v,y,T,C,b;if(this._colorized?(p=0,g=0):(p=s.renderX,g=s.renderY),m=s.width,v=s.height,y=u,T=f,C=_,b=d,a&&a._htmlElementObj)c=a._htmlElementObj,""!==a._pattern?(h.setFillStyle(l.createPattern(c,a._pattern)),l.fillRect(y,T,C,b)):l.drawImage(c,p,g,m,v,y,T,C,b);else{var x=r._contentSize;if(s.validRect){var S=this._displayedColor;h.setFillStyle("rgba("+S.r+","+S.g+","+S.b+",1)"),l.fillRect(y,T,x.width,x.height)}}(r._flippedX||r._flippedY)&&h.restore(),n.g_NumberOfDraws++}},m._updateColor=function(){var t=this._node,e=t._texture,i=this._textureCoord,n=this._displayedColor;e&&(255!==n.r||255!==n.g||255!==n.b?(this._textureToRender=e._generateColorTexture(n.r,n.g,n.b,i),this._colorized=!0):e&&(this._textureToRender=e,this._colorized=!1))},m._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t._textureLoaded){var i=this._node.getColor();255===i.r&&255===i.g&&255===i.b||this._updateColor()}},m._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},m._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var r=(e._texture,e._rect);r?n._rectEqualToZero(r)&&(r.width=i.width,r.height=i.height):r=n.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(r,e._rectRotated);var s=this._displayedColor;255===s.r&&255===s.g&&255===s.b||this._updateColor(),e.setBatchNode(e._batchNode),e.emit("load")}},m._setTextureCoords=function(t){var e=this._textureCoord;e.renderX=e.x=0|t.x,e.renderY=e.y=0|t.y,e.width=0|t.width,e.height=0|t.height,e.validRect=!(0===e.width||0===e.height||e.x<0||e.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),i?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n};var y=n.macro;_ccsg.Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=n.shaderCache.programForKey(y.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var m=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=_ccsg.Sprite.WebGLRenderCmd,m.updateBlendFunc=function(t){},m.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},m.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)e=i[r],e instanceof _ccsg.Sprite&&e._renderCmd.setDirtyRecursively(t)},m._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof _ccsg.Sprite))return n.log(n._LogInfos.Sprite.addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&n.log(n._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},m._handleTextureForRotatedTexture=function(t){return t},m.isFrameDisplayed=function(t){var e=this._node;return n.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&n.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},m._updateForSetSpriteFrame=function(){},m._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},m._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var r=e._rect;r?n._rectEqualToZero(r)&&(r.width=i.width,r.height=i.height):r=n.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(r,e._rectRotated),e.setBatchNode(e._batchNode),e.emit("load"),n.renderer.childrenOrderDirty=!0}},m._setTextureCoords=function(t){var e=this._node,i=e._batchNode?e.textureAtlas.texture:e._texture,n=this._vertices;if(i){var r,s,o,a,c,h=i.pixelWidth,l=i.pixelHeight;e._rectRotated?(y.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(r=(2*t.x+1)/(2*h),s=r+(2*t.height-2)/(2*h),o=(2*t.y+1)/(2*l),a=o+(2*t.width-2)/(2*l)):(r=t.x/h,s=(t.x+t.height)/h,o=t.y/l,a=(t.y+t.width)/l),e._flippedX&&(c=o,o=a,a=c),e._flippedY&&(c=r,r=s,s=c),n[0].u=s,n[0].v=o,n[1].u=r,n[1].v=o,n[2].u=s,n[2].v=a,n[3].u=r,n[3].v=a):(y.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(r=(2*t.x+1)/(2*h),s=r+(2*t.width-2)/(2*h),o=(2*t.y+1)/(2*l),a=o+(2*t.height-2)/(2*l)):(r=t.x/h,s=(t.x+t.width)/h,o=t.y/l,a=(t.y+t.height)/l),e._flippedX&&(c=r,r=s,s=c),e._flippedY&&(c=o,o=a,a=c),n[0].u=r,n[0].v=o,n[1].u=r,n[1].v=a,n[2].u=s,n[2].v=o,n[3].u=s,n[3].v=a)}},m._setColorDirty=function(){},m._updateBlendFunc=function(){if(this._batchNode)return void n.log(n._LogInfos.Sprite__updateBlendFunc);var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=y.BLEND_SRC,t._blendFunc.dst=y.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=y.SRC_ALPHA,t._blendFunc.dst=y.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},m._setTexture=function(t){var e=this._node;if(e._batchNode){if(e._batchNode.texture!==t)return void n.log(n._LogInfos.Sprite_setTexture)}else e._texture!==t&&(e._textureLoaded=!!t&&t._textureLoaded,e._texture=t,this._updateBlendFunc(),e._textureLoaded&&(n.renderer.childrenOrderDirty=!0))},m._checkTextureBoundary=function(t,e,i){if(t&&t.url){var r,s;i?(r=e.x+e.height,s=e.y+e.width):(r=e.x+e.width,s=e.y+e.height),r>t.width&&n.error(n._LogInfos.RectWidth,t.url),s>t.height&&n.error(n._LogInfos.RectHeight,t.url)}},m.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._offsetPosition.x,r=n+i._rect.width,s=i._offsetPosition.y,o=s+i._rect.height,a=this._worldTransform,c=this._vertices;c[0].x=n*a.a+o*a.c+a.tx,c[0].y=n*a.b+o*a.d+a.ty,c[1].x=n*a.a+s*a.c+a.tx,c[1].y=n*a.b+s*a.d+a.ty,c[2].x=r*a.a+o*a.c+a.tx,c[2].y=r*a.b+o*a.d+a.ty,c[3].x=r*a.a+s*a.c+a.tx,c[3].y=r*a.b+s*a.d+a.ty},m.needDraw=function(){var t=this._node,e=t._texture;return this._needDraw&&e},m.uploadData=function(t,e,i){var n=this._node,r=n._texture;if(!(r&&r._textureLoaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return 0;var s=this._displayedOpacity,o=this._displayedColor.r,a=this._displayedColor.g,c=this._displayedColor.b;if(n._opacityModifyRGB){var h=s/255;o*=h,a*=h,c*=h}this._color[0]=s<<24|c<<16|a<<8|o;var l,u,d=n._vertexZ,_=this._vertices,f=_.length,p=i;for(l=0;l<f;++l)u=_[l],t[p]=u.x,t[p+1]=u.y,t[p+2]=d,e[p+3]=this._color[0],t[p+4]=u.u,t[p+5]=u.v,p+=6;return f},n.BakeSprite=_ccsg.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){_ccsg.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new n.CanvasContextWrapper(t.getContext("2d"));var e=new n.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var i=this._cacheCanvas,r=this._cacheContext,s=r._context.strokeStyle,o=r._context.fillStyle;void 0===e&&(e=t.height,t=t.width),i.width=t,i.height=e,s!==r._context.strokeStyle&&(r._context.strokeStyle=s),o!==r._context.fillStyle&&(r._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(n.rect(0,0,t,e),!1,null,!1)}}),n.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new n.BlendFunc(n.macro.BLEND_SRC,n.macro.BLEND_DST);var e;n.js.isString(t)?(e=n.textureCache.getTextureForKey(t),e||(e=n.textureCache.addImage(t))):t instanceof n.Texture2D&&(e=t),e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(t,e,i){return this.addChild(t,e,i),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,e){var i=n.textureCache.getTextureForKey(t);return i||(i=n.textureCache.addImage(t)),this.initWithTexture(i,e)},init:function(t,e){var i=n.textureCache.getTextureForKey(t);return i||(i=n.textureCache.addImage(t)),this.initWithTexture(i,e)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){return n.assert(t,n._LogInfos.SpriteBatchNode.updateQuadFromSprite_2),t instanceof _ccsg.Sprite?(t.dirty=!0,void t._renderCmd.transform(this._renderCmd,!0)):void n.log(n._LogInfos.SpriteBatchNode.updateQuadFromSprite)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}else t.addEventListener("load",function(){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setShaderProgram(t)},addChild:function(t,e,i){n.assert(void 0!==t,n._LogInfos.SpriteBatchNode.addChild_3),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof _ccsg.Sprite?t.texture===this._texture||(n.log(n._LogInfos.Sprite.addChild_5),!1):(n.log(n._LogInfos.Sprite.addChild_4),!1)}});var b=n.SpriteBatchNode.prototype;n.defineGetterSetter(b,"texture",b.getTexture,b.setTexture),n.defineGetterSetter(b,"shaderProgram",b.getShaderProgram,b.setShaderProgram);var x,S,E,A,O,T=t("../cocos2d/core/event/event-target"),w={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort())},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}return e?this._pool[e].pop():void 0}},R=n.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL,I=[],P={_rebuildQuads_base:function(t,e,i,n){var r,s,o,a,c=t._vertices,h=t._renderCmd._worldTransform;if(n)r=0,s=0,o=i.width,a=i.height;else{var l=e._originalSize,u=e._rect,d=e._offset,_=i.width/l.width,f=i.height/l.height,p=d.x+(l.width-u.width)/2,g=d.x-(l.width-u.width)/2,m=d.y+(l.height-u.height)/2,v=d.y-(l.height-u.height)/2;r=p*_,s=m*f,o=i.width+g*_,a=i.height+v*f}c.length<8&&(w.put(c),c=w.get(8)||new Float32Array(8),t._vertices=c),x?(c[0]=r*h.a+s*h.c+h.tx,c[1]=r*h.b+s*h.d+h.ty,c[2]=o*h.a+s*h.c+h.tx,c[3]=o*h.b+s*h.d+h.ty,c[4]=r*h.a+a*h.c+h.tx,c[5]=r*h.b+a*h.d+h.ty,c[6]=o*h.a+a*h.c+h.tx,c[7]=o*h.b+a*h.d+h.ty):(c[0]=r,c[1]=s,c[2]=o,c[3]=s,c[4]=r,c[5]=a,c[6]=o,c[7]=a),I[0]=0,I[1]=2,I[2]=4,I[3]=6,t._uvsDirty&&this._calculateUVs(t,e),t._vertCount=4},_calculateUVs:function(t,e){var i=t._uvs,n=e._texture._pixelWidth,r=e._texture._pixelHeight,s=e._rect;i.length<8&&(w.put(i),i=w.get(8)||new Float32Array(8),t._uvs=i);var o,a,c,h,l=R?.5:0;e._rotated?(o=(s.x+l)/n,a=(s.y+s.width-l)/r,c=(s.x+s.height-l)/n,h=(s.y+l)/r,i[0]=o,i[1]=h,i[2]=o,i[3]=a,i[4]=c,i[5]=h,i[6]=c,i[7]=a):(o=(s.x+l)/n,a=(s.y+s.height-l)/r,c=(s.x+s.width-l)/n,h=(s.y+l)/r,i[0]=o,i[1]=a,i[2]=c,i[3]=a,i[4]=o,i[5]=h,i[6]=c,i[7]=h)}},N={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t,e,i,n,r,s,o){var a,c,h,l,u,d,_=t._vertices,f=t._renderCmd._worldTransform,p=e._rect;a=n,h=r,c=p.width-a-h,l=s,d=o,u=p.height-l-d;var g=i,m=g.width-a-h,v=g.height-l-d,y=g.width/(a+h),T=g.height/(l+d);y=y>1?1:y,T=T>1?1:T,m=m<0?0:m,v=v<0?0:v;var C=this.x,b=this.y;C[0]=0,C[1]=a*y,C[2]=C[1]+m,C[3]=g.width,b[0]=0,b[1]=d*T,b[2]=b[1]+v,b[3]=g.height,_.length<32&&(w.put(_),_=w.get(32)||new Float32Array(32),t._vertices=_);var S,E,A=0;if(x)for(S=0;S<4;S++)for(E=0;E<4;E++)_[A]=C[E]*f.a+b[S]*f.c+f.tx,_[A+1]=C[E]*f.b+b[S]*f.d+f.ty,A+=2;else for(S=0;S<4;S++)for(E=0;E<4;E++)_[A]=C[E],_[A+1]=b[S],A+=2;I[0]=0,I[1]=6,I[2]=24,I[3]=30,t._uvsDirty&&this._calculateUVs(t,e,n,r,s,o)},_calculateUVs:function(t,e,i,n,r,s){var o,a,c,h,l,u,d=t._uvs,_=e._rect,f=e._texture._pixelWidth,p=e._texture._pixelHeight,g=e._rect;o=i,c=n,a=_.width-o-c,h=r,u=s,l=_.height-h-u,d.length<32&&(w.put(d),d=w.get(32)||new Float32Array(32),t._uvs=d);var m,v,y=this.x,T=this.y,C=R?.5:0,b=0;if(e._rotated)for(y[0]=(g.x+C)/f,y[1]=(u+g.x)/f,y[2]=(u+l+g.x)/f,y[3]=(g.x+g.height-C)/f,T[3]=(g.y+C)/p,T[2]=(o+g.y)/p,T[1]=(o+a+g.y)/p,T[0]=(g.y+g.width-C)/p,m=0;m<4;m++)for(v=0;v<4;v++)d[b]=y[m],d[b+1]=T[3-v],b+=2;else for(y[0]=(g.x+C)/f,y[1]=(o+g.x)/f,y[2]=(o+a+g.x)/f,y[3]=(g.x+g.width-C)/f,T[3]=(g.y+C)/p,T[2]=(h+g.y)/p,T[1]=(h+l+g.y)/p,T[0]=(g.y+g.height-C)/p,m=0;m<4;m++)for(v=0;v<4;v++)d[b]=y[v],d[b+1]=T[m],b+=2}},L={_rebuildQuads_base:function(t,e,i){var r,s,o,a,c=t._vertices,h=t._renderCmd._worldTransform,l=t._uvs,u=e._texture._pixelWidth,d=e._texture._pixelHeight,_=e._rect,f=R?.5:0;e._rotated?(r=(_.x+f)/u,o=(_.x+_.height-f)/u,s=(_.y+_.width-f)/d,a=(_.y+f)/d):(r=(_.x+f)/u,o=(_.x+_.width-f)/u,s=(_.y+_.height-f)/d,a=(_.y+f)/d);var p=_.width,g=_.height,m=i.width/p,v=i.height/g,y=Math.ceil(v),T=Math.ceil(m);y*T>16384&&n.error("too many tiles, only 16384 tiles will be show");var C=y*T*4*2;c.length<C&&(w.put(c),c=w.get(C)||new Float32Array(C),t._vertices=c),l.length<C&&(w.put(l),l=w.get(C)||new Float32Array(C),t._uvs=l);var b,S,E,A,O=0;t._vertCount=0;for(var P=0;P<y;++P)for(var N=0;N<T;++N)if(b=p*N,S=g*P,E=p*Math.min(N+1,m),A=g*Math.min(P+1,v),x?(c[O]=b*h.a+S*h.c+h.tx,c[O+1]=b*h.b+S*h.d+h.ty,c[O+2]=E*h.a+S*h.c+h.tx,c[O+3]=E*h.b+S*h.d+h.ty,c[O+4]=b*h.a+A*h.c+h.tx,c[O+5]=b*h.b+A*h.d+h.ty,c[O+6]=E*h.a+A*h.c+h.tx,c[O+7]=E*h.b+A*h.d+h.ty):(c[O]=b,c[O+1]=S,c[O+2]=E,c[O+3]=S,c[O+4]=b,c[O+5]=A,c[O+6]=E,c[O+7]=A),e._rotated?(l[O]=r,l[O+1]=a,l[O+2]=r,l[O+3]=A=a+(s-a)*Math.min(1,m-N),l[O+4]=E=r+(o-r)*Math.min(1,v-P),l[O+5]=a,l[O+6]=E,l[O+7]=A):(l[O]=r,l[O+1]=s,l[O+2]=E=r+(o-r)*Math.min(1,m-N),l[O+3]=s,l[O+4]=r,l[O+5]=A=s+(a-s)*Math.min(1,v-P),l[O+6]=E,l[O+7]=A),O+=8,t._vertCount+=4,O>C)return;I[0]=0,I[1]=8*T+2,I[2]=C-8*T+4,I[3]=C-2}},F={_rebuildQuads_base:function(t,e,i,r,s,o){var a,c,h,l,u,d=t._vertices,_=t._renderCmd._worldTransform,f=t._uvs,p=0,g=0,m=i.width,v=i.height,y=e._texture._pixelWidth,T=e._texture._pixelHeight,C=e._rect,b=R?.5:0;e._rotated?(c=(C.x+b)/y,h=(C.y+C.width-b)/T,l=(C.x+C.height-b)/y,u=(C.y+b)/T):(c=(C.x+b)/y,h=(C.y+C.height-b)/T,l=(C.x+C.width-b)/y,u=(C.y+b)/T),d.length<8&&(w.put(d),d=w.get(8)||new Float32Array(8),t._vertices=d),f.length<8&&(w.put(f),f=w.get(8)||new Float32Array(8),t._uvs=f);var S=new Array(8);e._rotated?(S[0]=S[2]=c,S[4]=S[6]=l,S[3]=S[7]=h,S[1]=S[5]=u):(S[0]=S[4]=c,S[2]=S[6]=l,S[1]=S[3]=h,S[5]=S[7]=u),s=s>1?1:s,s=s<0?0:s,o=o<0?0:o,a=s+o,a=a>1?1:a;var E,A;switch(r){case B.HORIZONTAL:E=p+(m-p)*s,A=p+(m-p)*a,p=E,m=A,f[0]=S[0]+(S[2]-S[0])*s,f[1]=S[1],f[2]=S[0]+(S[2]-S[0])*a,f[3]=S[3],f[4]=S[4]+(S[6]-S[4])*s,f[5]=S[5],f[6]=S[4]+(S[6]-S[4])*a,f[7]=S[7];break;case B.VERTICAL:E=g+(v-g)*s,A=g+(v-g)*a,g=E,v=A,f[0]=S[0],f[1]=S[1]+(S[5]-S[1])*s,f[2]=S[2],f[3]=S[3]+(S[7]-S[3])*s,f[4]=S[4],f[5]=S[1]+(S[5]-S[1])*a,f[6]=S[6],f[7]=S[3]+(S[7]-S[3])*a;break;default:n.error("Unrecognized fill type in bar fill")}x?(d[0]=p*_.a+g*_.c+_.tx,d[1]=p*_.b+g*_.d+_.ty,d[2]=m*_.a+g*_.c+_.tx,d[3]=m*_.b+g*_.d+_.ty,d[4]=p*_.a+v*_.c+_.tx,d[5]=p*_.b+v*_.d+_.ty,d[6]=m*_.a+v*_.c+_.tx,d[7]=m*_.b+v*_.d+_.ty):(d[0]=p,d[1]=g,d[2]=m,d[3]=g,d[4]=p,d[5]=v,d[6]=m,d[7]=v),t._vertCount=4,I[0]=0,I[1]=2,I[2]=4,I[3]=6}},D={_vertPos:[n.v2(0,0),n.v2(0,0),n.v2(0,0),n.v2(0,0)],_vertices:[n.v2(0,0),n.v2(0,0)],_uvs:[n.v2(0,0),n.v2(0,0)],_intersectPoint_1:[n.v2(0,0),n.v2(0,0),n.v2(0,0),n.v2(0,0)],_intersectPoint_2:[n.v2(0,0),n.v2(0,0),n.v2(0,0),n.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(t,e,i,r,s,o){for(var a=t._vertices,c=t._uvs,h=t._rawVerts,l=t._rawUvs,u=t._renderCmd._worldTransform;s>=1;)s-=1;for(;s<0;)s+=1;var d=r.x*i.width,_=r.y*i.height,f=n.v2(d,_);s*=2*Math.PI,o*=2*Math.PI;var p=s+o;this.outVerts=a,this.outUvs=c,this.rawVerts=h,this.rawUvs=l,this._calculateVertices(u,e,i),this._calculateUVs(e);var g=this._vertPos,m=this._vertices;g[0].x=g[3].x=m[0].x,g[1].x=g[2].x=m[1].x,g[0].y=g[1].y=m[0].y,g[2].y=g[3].y=m[1].y,f.x>m[1].x&&(f.x=m[1].x),f.x<m[0].x&&(f.x=m[0].x),f.y<m[0].y&&(f.y=m[0].y),f.y>m[1].y&&(f.y=m[1].y),h[0]=h[4]=this._vertices[0].x,h[2]=h[6]=this._vertices[1].x,h[1]=h[3]=this._vertices[0].y,h[5]=h[7]=this._vertices[1].y,e._rotated?(l[0]=l[2]=this._uvs[0].x,l[4]=l[6]=this._uvs[1].x,l[3]=l[7]=this._uvs[0].y,l[1]=l[5]=this._uvs[1].y):(l[0]=l[4]=this._uvs[0].x,l[2]=l[6]=this._uvs[1].x,l[1]=l[3]=this._uvs[0].y,l[5]=l[7]=this._uvs[1].y);var v=[null,null,null,null];f.x!==this._vertices[0].x&&(v[0]=[3,0]),f.x!==this._vertices[1].x&&(v[2]=[1,2]),f.y!==this._vertices[0].y&&(v[1]=[0,1]),f.y!==this._vertices[1].y&&(v[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,s,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,s+o,this._intersectPoint_2);var y=30;a.length<y&&(w.put(a),a=w.get(y)||new Float32Array(y),this.outVerts=t._vertices=a),c.length<y&&(w.put(c),c=w.get(y)||new Float32Array(y),this.outUvs=t._uvs=c);for(var T=0,C=0,b=0;b<4;++b){var x=v[b];if(null!==x)if(o>=2*Math.PI)this._generateTriangle(u,T,f,this._vertPos[x[0]],this._vertPos[x[1]]),T+=6,C+=3;else{var S=this._getVertAngle(f,this._vertPos[x[0]]),E=this._getVertAngle(f,this._vertPos[x[1]]);E<S&&(E+=2*Math.PI),S-=2*Math.PI,E-=2*Math.PI;for(var A=0;A<3;++A)S>=p||(S>=s?(E>=p?this._generateTriangle(u,T,f,this._vertPos[x[0]],this._intersectPoint_2[b]):this._generateTriangle(u,T,f,this._vertPos[x[0]],this._vertPos[x[1]]),T+=6,C+=3):E<=s||(E<=p?(this._generateTriangle(u,T,f,this._intersectPoint_1[b],this._vertPos[x[1]]),T+=6,C+=3):(this._generateTriangle(u,T,f,this._intersectPoint_1[b],this._intersectPoint_2[b]),T+=6,C+=3))),S+=2*Math.PI,E+=2*Math.PI}}t._vertCount=C,I[0]=0,I[1]=2,I[2]=4,I[3]=6},_generateTriangle:function(t,e,i,n,r){var s,o,a=this.rawVerts,c=this.rawUvs,h=this.outVerts,l=a[0],u=a[1],d=a[6],_=a[7];x?(h[e]=i.x*t.a+i.y*t.c+t.tx,h[e+1]=i.x*t.b+i.y*t.d+t.ty,h[e+2]=n.x*t.a+n.y*t.c+t.tx,h[e+3]=n.x*t.b+n.y*t.d+t.ty,h[e+4]=r.x*t.a+r.y*t.c+t.tx,h[e+5]=r.x*t.b+r.y*t.d+t.ty):(h[e]=i.x,h[e+1]=i.y,h[e+2]=n.x,h[e+3]=n.y,h[e+4]=r.x,h[e+5]=r.y),s=(i.x-l)/(d-l),o=(i.y-u)/(_-u),this._generateUV(s,o,c,e),s=(n.x-l)/(d-l),o=(n.y-u)/(_-u),this._generateUV(s,o,c,e+2),s=(r.x-l)/(d-l),o=(r.y-u)/(_-u),this._generateUV(s,o,c,e+4)},_generateUV:function(t,e,i,n){var r=this.outUvs,s=i[0]+(i[2]-i[0])*t,o=i[4]+(i[6]-i[4])*t,a=i[1]+(i[3]-i[1])*t,c=i[5]+(i[7]-i[5])*t;r[n]=s+(o-s)*e,r[n+1]=a+(c-a)*e},_isAngleIn:function(t,e,i){for(var n=2*Math.PI;t<e||t>=e+n;)t<e&&(t+=n),t>=e+n&&(t-=n);return t<=e+i},_getVertAngle:function(t,e){var i,n;if(i=e.x-t.x,n=e.y-t.y,0!==i||0!==n){if(0===i)return n>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(n/i);return i<0&&(r+=Math.PI),r}},_getInsectedPoints:function(t,e,i,n,r,s,o){var a,c,h=[null,null,null,null],l=Math.sin(s),u=Math.cos(s);if(0!==Math.cos(s)){if(a=l/u,(t-r.x)*u>0){var d=r.y+a*(t-r.x);o[0].x=t,o[0].y=d}if((e-r.x)*u>0){var _=r.y+a*(e-r.x);o[2].x=e,o[2].y=_}}if(0!==Math.sin(s)){if(c=u/l,(n-r.y)*l>0){var f=r.x+c*(n-r.y);o[3].x=f,o[3].y=n}if((i-r.y)*l>0){var p=r.x+c*(i-r.y);o[1].x=p,o[1].y=i}}return h},_calculateVertices:function(t,e,i){var n,r,s,o;n=0,s=0,r=i.width,o=i.height,this._vertices[0].x=n,this._vertices[0].y=s,this._vertices[1].x=r,this._vertices[1].y=o},_calculateUVs:function(t){var e,i,n,r,s=t._texture._pixelWidth,o=t._texture._pixelHeight,a=t._rect,c=R?.5:0;t._rotated?(e=(a.x+c)/s,i=(a.x+a.height-c)/s,n=(a.y+c)/o,r=(a.y+a.width-c)/o):(e=(a.x+c)/s,i=(a.x+a.width-c)/s,n=(a.y+c)/o,r=(a.y+a.height-c)/o),this._uvs[0].x=e,this._uvs[0].y=r,this._uvs[1].x=i,this._uvs[1].y=n}};n.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=n.BlendFunc._alphaNonPremultiplied(),this._fillCenter=n.v2(0,0),this.setAnchorPoint(n.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=w.get(8)||new Float32Array(8),this._uvs=w.get(8)||new Float32Array(8),"string"==typeof t){var e=n.spriteFrameCache.getSpriteFrame(t);e?this.initWithSpriteFrame(e):this.initWithTexture(t)}else t instanceof n.SpriteFrame?this.initWithSpriteFrame(t):t instanceof n.Texture2D&&this.initWithTexture(t);void 0===x&&(x=n._renderType===n.game.RENDER_TYPE_WEBGL,S=n.visibleRect.left,O=n.visibleRect.right,A=n.visibleRect.top,E=n.visibleRect.bottom)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var e=new n.SpriteFrame(t);this.setSpriteFrame(e)},setSpriteFrame:function(t){var e;if(e=t instanceof n.SpriteFrame?t:n.spriteFrameCache.getSpriteFrame(t)){this._spriteFrame=e,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var i=this,r=function(){n.sizeEqualToSize(i._contentSize,n.size(0,0))&&i.setContentSize(i._spriteFrame._rect),i._renderCmd._needDraw=!0,i._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};e.textureLoaded()?r():e.once("load",r,this)}},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src||n.macro.BLEND_SRC,this._blendFunc.dst=t.dst||n.macro.BLEND_DST):(this._blendFunc.src=t||n.macro.BLEND_SRC,this._blendFunc.dst=e||n.macro.BLEND_DST),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},enableTrimmedContentSize:function(t){this._isTrimmedContentSize!==t&&(this._isTrimmedContentSize=t,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){
return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){this._fillType!==t&&(this._fillType=t,this._renderingType===M.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(t,e){this._fillCenter=n.v2(t,e),this._renderingType===M.FILLED&&this._fillType===B.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionTiling=this._distortionTiling||n.v2(0,0),this._distortionTiling.x=t,this._distortionTiling.y=e},setDistortionOffset:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionOffset=this._distortionOffset||n.v2(0,0),this._distortionOffset.x=t,this._distortionOffset.y=e},getFillCenter:function(){return n.v2(this._fillCenter)},setFillStart:function(t){this._fillStart!==t&&(this._fillStart=t,this._renderingType===M.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(t){this._fillRange!==t&&(this._fillRange=t,this._renderingType===M.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(!this._spriteFrame||!this._spriteFrame._textureLoaded)return void(this._renderCmd._needDraw=!1);switch(this._isTriangle=!1,this._renderingType){case M.SIMPLE:P._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case M.SLICED:N._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;case M.TILED:L._rebuildQuads_base(this,this._spriteFrame,this._contentSize);break;case M.FILLED:var t=this._fillStart,e=this._fillRange;e<0&&(t+=e,e=-e),this._fillType!==B.RADIAL?(e=t+e,t=t>1?1:t,t=t<0?0:t,e=e>1?1:e,e=e<0?0:e,e-=t,F._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._fillType,t,e)):(this._isTriangle=!0,this._rawVerts||(this._rawVerts=w.get(8)||new Float32Array(8),this._rawUvs=w.get(8)||new Float32Array(8)),D._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._fillCenter,t,e));break;default:return this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,void n.error("Can not generate quad")}if(x){var i=this._isTriangle?this._rawVerts:this._vertices,r=i[I[0]],s=i[I[1]],o=i[I[2]],a=i[I[3]],c=i[I[0]+1],h=i[I[1]+1],l=i[I[2]+1],u=i[I[3]+1];(r-S.x&s-S.x&o-S.x&a-S.x)>>31||(O.x-r&O.x-s&O.x-o&O.x-a)>>31||(c-E.y&h-E.y&l-E.y&u-E.y)>>31||(A.y-c&A.y-h&A.y-l&A.y-u)>>31?this._renderCmd._needDraw=!1:this._renderCmd._needDraw=!0}else{var d=this._renderCmd._currentRegion,_=d._minX,f=d._maxX,p=d._minY,g=d._maxY;f<S.x||_>O.x||g<E.y||p>A.y?this._renderCmd._needDraw=!1:this._renderCmd._needDraw=!0}this._quadsDirty=!1,this._uvsDirty=!1},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.Scale9Sprite.CanvasRenderCmd(this):new n.Scale9Sprite.WebGLRenderCmd(this)}});var b=n.Scale9Sprite.prototype;n.js.addon(b,T.prototype),n.defineGetterSetter(b,"insetLeft",b.getInsetLeft,b.setInsetLeft),n.defineGetterSetter(b,"insetTop",b.getInsetTop,b.setInsetTop),n.defineGetterSetter(b,"insetRight",b.getInsetRight,b.setInsetRight),n.defineGetterSetter(b,"insetBottom",b.getInsetBottom,b.setInsetBottom),n.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var M=n.Scale9Sprite.RenderingType=n.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3}),B=n.Scale9Sprite.FillType=n.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2});n.Scale9Sprite.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=n.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var m=n.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=n.Scale9Sprite.CanvasRenderCmd,m.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},m._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},m.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},m.rendering=function(t,e,i){var r=this._node,s=this._displayedOpacity,o=s/255,a=null;if(r._spriteFrame&&(a=r._spriteFrame._texture),r.loaded()&&0!==s){if(null===this._textureToRender||this._originalTexture!==a){this._textureToRender=this._originalTexture=a,n.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture());var c=r.getDisplayedColor();!a||255===c.r&&255===c.g&&255===c.b||(this._textureToRender=this._textureToRender._generateColorTexture(c.r,c.g,c.b))}var h=t||n._renderContext,l=h.getContext();if(h.setTransform(this._worldTransform,e,i),h.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(r._blendFunc)),h.setGlobalAlpha(o),this._textureToRender){r._quadsDirty&&r._rebuildQuads();var u,d,_,f,p,g,m,v,y=this._textureToRender._pixelWidth,T=this._textureToRender._pixelHeight,C=this._textureToRender._htmlElementObj,b=r._vertices,x=r._uvs,S=0,E=0;if(r._isTriangle){var A=r._rawVerts,O=r._rawUvs;p=A[0],g=A[1],m=A[6]-p,v=A[7]-g,g=-g-v,u=O[4]*y,d=O[5]*T,_=(O[6]-O[0])*y,f=(O[1]-O[7])*T,h.save(),l.beginPath();var w=Math.floor(r._vertCount/3);for(S=0,E=0;S<w;S++)l.moveTo(b[E++],-b[E++]),l.lineTo(b[E++],-b[E++]),l.lineTo(b[E++],-b[E++]);l.clip(),""!==this._textureToRender._pattern?(h.setFillStyle(l.createPattern(C,this._textureToRender._pattern)),l.fillRect(p,g,m,v)):_>0&&f>0&&m>0&&v>0&&l.drawImage(C,u,d,_,f,p,g,m,v),h.restore(),n.g_NumberOfDraws+=w}else if(r._renderingType===n.Scale9Sprite.RenderingType.SLICED){for(var R=0;R<3;++R)for(var I=0;I<3;++I)E=8*R+2*I,p=b[E],g=b[E+1],m=b[E+10]-p,v=b[E+11]-g,g=-g-v,u=x[E]*y,d=x[E+11]*T,_=(x[E+10]-x[E])*y,f=(x[E+1]-x[E+11])*T,_>0&&f>0&&m>0&&v>0&&l.drawImage(C,u,d,_,f,p,g,m,v);n.g_NumberOfDraws+=9}else{var P=Math.floor(r._vertCount/4);for(S=0,E=0;S<P;S++)p=b[E],g=b[E+1],m=b[E+6]-p,v=b[E+7]-g,g=-g-v,u=x[E]*y,d=x[E+7]*T,_=(x[E+6]-x[E])*y,f=(x[E+1]-x[E+7])*T,""!==this._textureToRender._pattern?(h.setFillStyle(l.createPattern(C,this._textureToRender._pattern)),l.fillRect(p,g,m,v)):_>0&&f>0&&m>0&&v>0&&l.drawImage(C,u,d,_,f,p,g,m,v),E+=8;n.g_NumberOfDraws+=P}}}};n.gl;n.Scale9Sprite.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=n.renderer.VertexType.QUAD,this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var k=n.Scale9Sprite,m=k.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=k.WebGLRenderCmd,m._uploadSliced=function(t,e,i,n,r,s,o){for(var a,c=0;c<3;++c)for(var h=0;h<3;++h)a=8*c+2*h,r[o]=t[a],r[o+1]=t[a+1],r[o+2]=n,s[o+3]=i[0],r[o+4]=e[a],r[o+5]=e[a+1],o+=6,r[o]=t[a+2],r[o+1]=t[a+3],r[o+2]=n,s[o+3]=i[0],r[o+4]=e[a+2],r[o+5]=e[a+3],o+=6,r[o]=t[a+8],r[o+1]=t[a+9],r[o+2]=n,s[o+3]=i[0],r[o+4]=e[a+8],r[o+5]=e[a+9],o+=6,r[o]=t[a+10],r[o+1]=t[a+11],r[o+2]=n,s[o+3]=i[0],r[o+4]=e[a+10],r[o+5]=e[a+11],o+=6;return 36},m.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},m.uploadData=function(t,e,i){var r=this._node;if(0===this._displayedOpacity)return 0;r._quadsDirty&&r._rebuildQuads(),r._distortionOffset&&this._shaderProgram===k.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.setUniformLocationWith2f(k.WebGLRenderCmd._distortionOffset,r._distortionOffset.x,r._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(k.WebGLRenderCmd._distortionTiling,r._distortionTiling.x,r._distortionTiling.y),n.renderer._breakBatch());var s=this._displayedOpacity,o=this._displayedColor.r,a=this._displayedColor.g,c=this._displayedColor.b;if(r._opacityModifyRGB){var h=s/255;o*=h,a*=h,c*=h}this._color[0]=s<<24|c<<16|a<<8|o;var l=r._vertexZ,u=r._vertices,d=r._uvs,_=k.RenderingType,f=i,p=0;switch(r._renderingType){case _.SIMPLE:case _.TILED:case _.FILLED:p=this._node._vertCount;for(var g=0,m=0;g<p;g++,m+=2)t[f]=u[m],t[f+1]=u[m+1],t[f+2]=l,e[f+3]=this._color[0],t[f+4]=d[m],t[f+5]=d[m+1],f+=6;break;case _.SLICED:p=this._uploadSliced(u,d,this._color,l,t,e,f)}return r._renderingType===_.FILLED&&r._fillType===k.FillType.RADIAL?this.vertexType=n.renderer.VertexType.TRIANGLE:this.vertexType=n.renderer.VertexType.QUAD,p},m.setState=function(t){t===k.state.NORMAL?this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===k.state.GRAY?this._shaderProgram=n.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===k.state.DISTORTION&&(this._shaderProgram=n.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},k.WebGLRenderCmd._grayShaderProgram=null,k.WebGLRenderCmd._getGrayShaderProgram=function(){var t=k.WebGLRenderCmd._grayShaderProgram;return t?t:(t=new n.GLProgram,t.initWithVertexShaderByteArray(n.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(n.macro.ATTRIBUTE_NAME_POSITION,n.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(n.macro.ATTRIBUTE_NAME_COLOR,n.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(n.macro.ATTRIBUTE_NAME_TEX_COORD,n.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),k.WebGLRenderCmd._grayShaderProgram=t,t)},k.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w = c.w ; \n}",k.WebGLRenderCmd._distortionProgram=null,k.WebGLRenderCmd._getDistortionProgram=function(){var t=k.WebGLRenderCmd._distortionProgram;return t?t:(t=new n.GLProgram,t.initWithVertexShaderByteArray(n.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,z.fShader),t.addAttribute(n.macro.ATTRIBUTE_NAME_POSITION,n.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(n.macro.ATTRIBUTE_NAME_COLOR,n.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(n.macro.ATTRIBUTE_NAME_TEX_COORD,n.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),k.WebGLRenderCmd._distortionProgram=t,k.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),k.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var z={shaderKey:"cc.Sprite.Shader.Distortion",fShader:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform vec2 u_offset; \nuniform vec2 u_offset_tiling; \nconst float PI = 3.14159265359;\nvoid main() \n{ \nfloat halfPI = 0.5 * PI;\nfloat maxFactor = sin(halfPI);\nvec2 uv = v_texCoord;\nvec2 xy = 2.0 * uv.xy - 1.0;\nfloat d = length(xy);\nif (d < (2.0-maxFactor)) {\nd = length(xy * maxFactor);\nfloat z = sqrt(1.0 - d * d);\n float r = atan(d, z) / PI;\nfloat phi = atan(xy.y, xy.x);\nuv.x = r * cos(phi) + 0.5;\nuv.y = r * sin(phi) + 0.5;\n} else {\ndiscard;\n}\nuv = uv * u_offset_tiling + u_offset;\nuv = fract(uv); \ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);\n}"},V=function(){this._status="unloaded",this._observers=[]};V.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach(function(t){t()})},V.prototype.isLoaded=function(){return"loaded"===this._status},V.prototype.addHandler=function(t){this._observers.indexOf(t)===-1&&this._observers.push(t)};var W={_fontCache:{},loadTTF:function(t,e){var i=n.sys.browserType!==n.sys.BROWSER_TYPE_BAIDU&&n.sys.browserType!==n.sys.BROWSER_TYPE_BAIDU_APP&&n.sys.browserType!==n.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&i?this._loadWithFontFace(t,e):this._loadWithCSS(t,e)},_loadWithFontFace:function(t,e){var i=this._getFontFamily(t),n=this._fontCache[i];if(n)n.isLoaded()||n.addHandler(e);else{var r=new FontFace(i,"url('"+t+"')");document.fonts.add(r),n=new V,n.addHandler(e),this._fontCache[i]=n,r.loaded.then(function(){n.onLoaded()})}},_loadWithCSS:function(t,e){var i=this._getFontFamily(t),n=this._fontCache[i];if(n)n.isLoaded()||n.addHandler(e);else{var r=document,s=document.createElement("style");s.type="text/css",r.body.appendChild(s);var o="";o+=isNaN(i-0)?"@font-face { font-family:"+i+"; src:":"@font-face { font-family:'"+i+"'; src:",o+="url('"+t+"');",s.textContent=o+"}";var a=document.createElement("div"),c=a.style;c.fontFamily=i,a.innerHTML=".",c.position="absolute",c.left="-100px",c.top="-100px",r.body.appendChild(a),n=new V,n.addHandler(e),this._fontCache[i]=n,s.onload=function(){setTimeout(function(){n.onLoaded()},100)}}},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(e===-1)return t;var i,n=t.lastIndexOf("/");return i=n===-1?t.substring(0,e)+"_LABEL":t.substring(n+1,e)+"_LABEL"}},U={label_wordRex:/([a-zA-Z0-9--]+|\S)/,label_symbolRex:/^[!,.:;}\]%\?>]/,label_lastWordRex:/([a-zA-Z0-9--]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9--]+$/,label_firsrEnglish:/^[a-zA-Z0-9--]/,label_wrapinspection:!0,isUnicodeCJK:function(t){var e=/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,i=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,n=/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/;return e.test(t)||i.test(t)||n.test(t)},isUnicodeSpace:function(t){return t=t.charCodeAt(0),t>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},fragmentText:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var s=t;e>i&&s.length>1;){for(var o=s.length*(i/e)|0,a=s.substr(o),c=e-n(a),h=a,l=0,u=0,d=10;c>i&&u++<d;)o*=i/c,o=0|o,a=s.substr(o),c=e-n(a);for(u=0;c<i&&u++<d;){if(a){var _=this.label_wordRex.exec(a);l=_?_[0].length:1,h=a}o+=l,a=s.substr(o),c=e-n(a)}o-=l,0===o&&(o=1,h=h.substr(1));var f,p=s.substr(0,o);this.label_wrapinspection&&this.label_symbolRex.test(h||a)&&(f=this.label_lastWordRex.exec(p),o-=f?f[0].length:0,0===o&&(o=1),h=s.substr(o),p=s.substr(0,o)),this.label_firsrEnglish.test(h)&&(f=this.label_lastEnglish.exec(p),f&&p!==f[0]&&(o-=f[0].length,h=s.substr(o),p=s.substr(0,o))),p.trim().length>0&&r.push(p),s=h||a,e=n(s)}return s.length>0&&r.push(s),r}};n.TextUtils=e.exports=U,n.CustomFontLoader=e.exports=W;var T=t("../cocos2d/core/event/event-target");n.fontFamilyCache={};var G=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};n.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},n.FontAtlas.prototype={constructor:n.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var i=new G;n.js.mixin(i,this._letterDefinitions[e]),t[e]=i}return t},assignLetterDefinitions:function(t){for(var e in this._letterDefinitions){var i=t[e],r=this._letterDefinitions[e];n.js.mixin(r,i)}},scaleFontLetterDefinition:function(t){for(var e in this._letterDefinitions){var i=this._letterDefinitions[e];i._width*=t,i._height*=t,i._offsetX*=t,i._offsetY*=t,i._xAdvance*=t}},getLetterDefinitionForChar:function(t){var e,i=this._letterDefinitions.hasOwnProperty(t.charCodeAt(0));return e=i?this._letterDefinitions[t.charCodeAt(0)]:null}};var X=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._atlasIndex=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:n.TextAlignment.LEFT,_vAlign:n.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_drawFontsize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:n.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_outlined:!1,_outlineColor:null,_outlineWidth:1,_className:"Label",_margin:0,_isBold:!1,_isItalic:!1,_isUnderline:!1,ctor:function(t,e,i){T.call(this),e=e||"",this._fontHandle=e,"string"!=typeof t&&(t=""+t),this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(n.p(.5,.5)),_ccsg.Node.prototype.setContentSize.call(this,n.size(128,128)),this._blendFunc=n.BlendFunc._alphaNonPremultiplied(),this.setFontFileOrFamily(e,i),this.setString(this._string)},_resetBMFont:function(){this._imageOffset=n.p(0,0),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._bmfontScale=1,this._additionalKerning=0,this._horizontalKernings=[],this._lineBreakWithoutSpaces=!1,this._reusedRect=n.rect(0,0,0,0),this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},setHorizontalAlign:function(t){this._hAlign!==t&&(this._hAlign=t,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){this._vAlign!==t&&(this._vAlign=t,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(t){"string"!=typeof t&&(t=""+t),this._string!==t&&(this._string=t,this._notifyLabelSkinDirty())},setMargin:function(t){this._margin!==t&&(this._margin=t,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){this._isWrapText!==t&&this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE&&(this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},enableItalics:function(t){this._isItalic=t,t?this.setSkewX(12):this.setSkewX(0)},enableBold:function(t){this._isBold!==t&&(this._isBold=t,this._notifyLabelSkinDirty())},enableUnderline:function(t){this._isUnderline!==t&&(this._isUnderline=t,this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._drawFontsize=t,this._notifyLabelSkinDirty())},getFontSize:function(){return this._fontSize},isOutlined:function(){return this._outlined},setOutlined:function(t){this._outlined!==t&&(this._outlined=!!t,this._notifyLabelSkinDirty())},getOutlineColor:function(){return this._outlineColor},setOutlineColor:function(t){this._outlineColor!==t&&(this._outlineColor=n.color(t),this._notifyLabelSkinDirty())},setOutlineWidth:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._notifyLabelSkinDirty())},getOutlineWidth:function(){return this._outlineWidth},_updateWrapText:function(t){t===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(this._isWrapText=!0),t===_ccsg.Label.Overflow.NONE&&(this._isWrapText=!1)},_setOverflowBMFont:function(){this._labelType===_ccsg.Label.Type.BMFont&&(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._setDimensions(this._labelDimensions.width,0),this._overFlow===_ccsg.Label.Overflow.NONE&&this._setDimensions(0,0),this._rescaleWithOriginalFontSize())},setOverflow:function(t){this._overFlow!==t&&(this._overFlow=t,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(t){this._spacingX!==t&&(this._spacingX=t)},setLineHeight:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces!==t&&(this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},getBMFontLineHeight:function(){if(this._fontAtlas)return this._fontAtlas._lineHeight},setFontFileOrFamily:function(t,e){t=t||"Arial";var i=n.path.extname(t);return this._resetBMFont(),i?(".ttf"===i?(this._labelType=_ccsg.Label.Type.TTF,this._blendFunc=n.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._fontHandle=this._loadTTFFont(t)):".fnt"===i&&(this._labelType=_ccsg.Label.Type.BMFont,this._blendFunc=n.BlendFunc._alphaNonPremultiplied(),this._renderCmd._needDraw=!1,this._initBMFontWithString(this._string,t,e)),void this._notifyLabelSkinDirty()):(this._fontHandle=t,this._labelType=_ccsg.Label.Type.SystemFont,this._blendFunc=n.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._notifyLabelSkinDirty(),void this.emit("load"))},_loadTTFFont:function(t){var e=this,i=n.CustomFontLoader._getFontFamily(t),r=function(){e._notifyLabelSkinDirty(),e.emit("load")};return n.CustomFontLoader.loadTTF(t,r),i},setContentSize:function(t,e){this._overFlow!==_ccsg.Label.Overflow.NONE&&this._setDimensions(t,e)},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_setupBMFontOverflowMetrics:function(t,e){this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(e=0),this._overFlow===_ccsg.Label.Overflow.NONE&&(t=0,e=0),this._labelWidth=t,this._labelHeight=e,this._labelDimensions.width=t,this._labelDimensions.height=e,this._maxLineWidth=t},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._contentSize,e=t.width,i=t.height;this._setupBMFontOverflowMetrics(e,i),this._updateContent(),this.setColor(this.color)}else this._labelType!==_ccsg.Label.Type.TTF&&this._labelType!==_ccsg.Label.Type.SystemFont||this._renderCmd._bakeLabel()},_notifyLabelSkinDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty|_ccsg.Node._dirtyFlags.contentDirty)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new _ccsg.Label.WebGLRenderCmd(this):new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){var t=this._renderCmd._dirtyFlag;return t&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){var t=this._renderCmd._dirtyFlag;return t&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){var t=this._renderCmd._dirtyFlag;return t&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getHeight.call(this)}}),n.BMFontHelper={_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK){var e=this.getFontSize();e>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this))}if(!this._updateQuads()){t=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,e){var i=this._linesWidth[e],n=t>this._contentSize.width||t<0;return this._isWrapText?i>this._contentSize.width&&n:n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var e=0;e<this._string.length;++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char];this._reusedRect.height=i._height,this._reusedRect.width=i._width,this._reusedRect.x=i._u,this._reusedRect.y=i._v;var r=this._lettersInfo[e]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(r>this._tailoredTopY){var s=r-this._tailoredTopY;this._reusedRect.y+=s,this._reusedRect.height-=s,r-=s}r-i._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=r<this._tailoredBottomY?0:r-this._tailoredBottomY)}var o=this._lettersInfo[e]._lineIndex,a=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale+this._linesOffsetX[o];if(this._labelWidth>0&&this._isHorizontalClamped(a,o))if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK){if(this._contentSize.width>i._width){t=!1;break}this._reusedRect.width=0}if(this._reusedRect.height>0&&this._reusedRect.width>0){var c=this.getChildByTag(e),h=this._spriteBatchNode._texture;c||(c=new _ccsg.Sprite,c.initWithTexture(h),c.setAnchorPoint(n.p(0,1))),c.setTextureRect(this._reusedRect,!1,this._reusedRect.size);var l=this._lettersInfo[e]._positionX+this._linesOffsetX[this._lettersInfo[e]._lineIndex];c.setPosition(l,r);var u=this._spriteBatchNode.getChildrenCount();this._lettersInfo[e]._atlasIndex=u,this._updateLetterSpriteScale(c),this._spriteBatchNode.addChild(c)}}return t},_updateLetterSpriteScale:function(t){this._labelType===_ccsg.Label.Type.BMFont&&this._fontSize>0&&t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,e){if(t>=this._lettersInfo.length){var i=new X;this._lettersInfo.push(i)}this._lettersInfo[t]._char=e,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,e,i,n){if(i>=this._lettersInfo.length){var r=new X;this._lettersInfo.push(r)}e=e.charCodeAt(0),this._lettersInfo[i]._lineIndex=n,this._lettersInfo[i]._char=e,this._lettersInfo[i]._valid=this._fontAtlas._letterDefinitions[e]._validDefinition,this._lettersInfo[i]._positionX=t.x,this._lettersInfo[i]._positionY=t.y},_setDimensions:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e,r=this.getContentSize();_ccsg.Node.prototype.setContentSize.call(this,t,e),n===r.height&&i===r.width||(this._setupBMFontOverflowMetrics(i,n),this._drawFontsize>0&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(t){var e=this.getStringLength(),i=0,r=0,s=0,o=0,a=0,c=this._lineSpacing,h=0,l=0,u=null,d=n.p(0,0);this._updateBMFontScale();for(var _=0;_<e;){var f=this._string.charAt(_);if("\n"!==f){for(var p=t(this._string,_,e),g=h,m=l,v=a,y=r,T=!1,C=0;C<p;++C){var b=_+C;if(f=this._string.charAt(b),"\r"!==f)if(u=this._fontAtlas.getLetterDefinitionForChar(f)){var x=y+u._offsetX*this._bmfontScale;if(this._isWrapText&&this._maxLineWidth>0&&r>0&&x+u._width*this._bmfontScale>this._maxLineWidth&&!n.TextUtils.isUnicodeSpace(f)){this._linesWidth.push(a),a=0,i++,r=0,s-=this._lineHeight*this._bmfontScale+c,T=!0;break}d.x=x,d.y=s-u._offsetY*this._bmfontScale,this._recordLetterInfo(d,f,b,i),b+1<this._horizontalKernings.length&&b<e-1&&(y+=this._horizontalKernings[b+1]),y+=u._xAdvance*this._bmfontScale+this._additionalKerning,v=d.x+u._width*this._bmfontScale,g<d.y&&(g=d.y),m>d.y-u._height*this._bmfontScale&&(m=d.y-u._height*this._bmfontScale)}else this._recordPlaceholderInfo(b,f),console.log("Can't find letter definition in font file for letter:"+f);else this._recordPlaceholderInfo(b,f)}T||(r=y,a=v,h<g&&(h=g),l>m&&(l=m),o<a&&(o=a),_+=p)}else this._linesWidth.push(a),a=0,i++,r=0,s-=this._lineHeight*this._bmfontScale+c,this._recordPlaceholderInfo(_,f),_++}this._linesWidth.push(a),this._numberOfLines=i+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,this._numberOfLines>1&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var S=n.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(S.width=parseFloat(o.toFixed(2))),this._labelHeight<=0&&(S.height=parseFloat(this._textDesiredHeight.toFixed(2))),_ccsg.Node.prototype.setContentSize.call(this,S),this._tailoredTopY=S.height,this._tailoredBottomY=0,h>0&&(this._tailoredTopY=S.height+h),l<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+l),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height},_isHorizontalClamp:function(){for(var t=!1,e=0;e<this.getStringLength();++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char],n=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale,r=this._lettersInfo[e]._lineIndex;if(this._labelWidth>0)if(this._isWrapText){var s=this._linesWidth[r];if(s>this._contentSize.width&&(n>this._contentSize.width||n<0)){t=!0;break}}else if(n>this._contentSize.width){t=!0;break}}return t},_shrinkLabelToContentSize:function(t){for(var e=this.getFontSize(),i=0,n=this._fontAtlas.cloneLetterDefinition(),r=this._lineHeight,s=!0;t();){++i;var o=e-i;if(s=!1,o<=0)break;var a=o/e;this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(a),this._lineHeight=r*a,this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset()}this._lineHeight=r,this._fontAtlas.assignLetterDefinitions(n),s||e-i>=0&&this._scaleFontSizeDown(e-i)},_scaleFontSizeDown:function(t){var e=!0;this._labelType===_ccsg.Label.Type.BMFont&&(t||(t=.1,e=!1),this._fontSize=t,e&&this._updateContent())},_updateContent:function(){this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),this._alignText())},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case n.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case n.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case n.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case n.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case n.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case n.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(){return 1},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(n.TextUtils.isUnicodeCJK(r)||"\n"===r||n.TextUtils.isUnicodeSpace(r))return 1;for(var s,o,a=1,c=0,h=e+1;h<i&&(r=t.charAt(h),s=this._fontAtlas.getLetterDefinitionForChar(r),s);++h){if(o=c+s._offsetX*this._bmfontScale,o+s._width*this._bmfontScale>this._maxLineWidth&&!n.TextUtils.isUnicodeSpace(r)&&this._maxLineWidth>0&&a>=2)return a-1;if(c+=s._xAdvance*this._bmfontScale+this._additionalKerning,"\n"===r||n.TextUtils.isUnicodeSpace(r)||n.TextUtils.isUnicodeCJK(r))break;a++}return a},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/t}else this._bmfontScale=1},_initBMFontWithString:function(t,e,i){var r=this;return r._config?(n.log("_ccsg.Label._initBMFontWithString(): re-init is no longer supported"),!1):(this._string=t,void this._setBMFontFile(e,i))},_createSpriteBatchNode:function(t){this._spriteBatchNode=new n.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new n.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var t=this._config,e=t.fontDefDictionary;for(var i in e){var r=new G,s=e[i].rect;r._offsetX=e[i].xOffset,
r._offsetY=e[i].yOffset,r._width=s.width,r._height=s.height,r._u=s.x+this._imageOffset.x,r._v=s.y+this._imageOffset.y,r._textureID=0,r._validDefinition=!0,r._xAdvance=e[i].xAdvance,this._fontAtlas.addLetterDefinitions(i,r)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();this._drawFontsize-t>=1&&this._overFlow===_ccsg.Label.Overflow.SHRINK&&(this._labelType===_ccsg.Label.Type.BMFont?this._scaleFontSizeDown(this._drawFontsize):this._fontSize=this._drawFontsize)},_computeHorizontalKerningForText:function(){for(var t=this.getStringLength(),e=this._config.kerningDict,i=-1,n=0;n<t;++n){var r=this._string.charCodeAt(n),s=e[i<<16|65535&r]||0;n<t-1?this._horizontalKernings[n]=s:this._horizontalKernings[n]=0,i=r}},_setBMFontFile:function(t,e){if(t){this._fontHandle=t;var i=this;this._labelType===_ccsg.Label.Type.BMFont&&(this._resetBMFont(),n.loader.load(this._fontHandle,function(t,r){t&&n.log("_ccsg.Label._initBMFontWithString(): Impossible to create font. Please check file"),i._config=r,i._createFontChars();var s=n.textureCache.addImage(e||i._config.atlasName),o=s.isLoaded();i._textureLoaded=o,o?i._spriteBatchNode||(i._createSpriteBatchNode(s),i.emit("load")):s.once("load",function(){var t=this;t._spriteBatchNode||t._createSpriteBatchNode(s),t._textureLoaded=!0,t.emit("load")},i)}))}}};var b=_ccsg.Label.prototype;n.js.addon(b,T.prototype),n.js.mixin(b,n.BMFontHelper),_ccsg.Label.Type=n.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=n.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var Y=_ccsg.Label.prototype;Object.defineProperty(Y,"width",{get:Y._getWidth,set:_ccsg.Node.prototype._setWidth}),Object.defineProperty(Y,"height",{get:Y._getHeight,set:_ccsg.Node.prototype._setHeight}),function(){_ccsg.Label.TTFLabelBaker=function(){};var t=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),e&f.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~f.contentDirty),(i||n||e&t.textDirty)&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._rebuildLabelSkin()),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~t.transformDirty)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),(r||s||this._dirtyFlag&e.textDirty)&&this._rebuildLabelSkin(),this._dirtyFlag&e.transformDirty&&this.transform(t)},t._getLineHeight=function(){var t=this._node.getLineHeight(),e=this._node;t=0===t?e._fontSize:t*e._fontSize/this._drawFontsize;var i=0|t;return i},t._constructFontDesc=function(){var t=this._node,e=t._fontSize.toString()+"px ",i=0===t._fontHandle.length?"serif":t._fontHandle;return e+=i,t._isBold&&(e="bold "+e),e},t._measureText=function(t){return function(e){return t.measureText(e).width}},t._calculateLabelFont=function(){var t=this._node,e=t._string.split("\n");t._fontSize=t._drawFontsize;var i=this._constructFontDesc();this._labelContext.font=i;var r=this._calculateParagraphLength(e,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===t._overFlow){this._splitedStrings=e;var s=0,o=0,a=0;if(t._isWrapText){var c=this._canvasSize.width-2*this._getMargin(),h=this._canvasSize.height-2*this._getMargin();if(c<0||h<0)return i=this._constructFontDesc(),this._labelContext.font=i,i;o=h+1,a=c+1;for(var l=this._drawFontsize+1,u="",d=!0,_=0|l;o>h||a>c;){if(d?l=_/2|0:(l=_-1,_=l),l<=0){n.log("Label font size can't be shirnked less than 0!");break}for(t._fontSize=l,i=this._constructFontDesc(),this._labelContext.font=i,this._splitedStrings=[],o=0,s=0;s<e.length;++s){var f=0,p=this._labelContext.measureText(e[s]).width;for(u=n.TextUtils.fragmentText(e[s],p,c,this._measureText(this._labelContext));f<u.length;){var g=this._labelContext.measureText(u[f]).width;a=g,o+=this._getLineHeight(),++f}this._splitedStrings=this._splitedStrings.concat(u)}d&&(o>h?_=0|l:(d=!1,o=h+1))}}else{for(o=e.length*this._getLineHeight(),s=0;s<e.length;++s)a<r[s]&&(a=r[s]);var m=(this._canvasSize.width-2*this._getMargin())/a,v=this._canvasSize.height/o;t._fontSize=this._drawFontsize*Math.min(1,m,v)|0,i=this._constructFontDesc(),this._labelContext.font=i}}return i},t._getMargin=function(){return this._node&&this._node._margin||0},t._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=e.measureText(t[n]);i.push(r.width)}return i},t._calculateCanvasSize=function(){var t=this._node,e=t._contentSize.width,i=t._contentSize.height;return e<=0&&(e=1),i<=0&&(i=1),n.size(e,i)},t._calculateSplitedStrings=function(){var t,e=this._node,i=e._string.split("\n");if(e._isWrapText){this._splitedStrings=[];var r=this._canvasSize.width-2*this._getMargin();for(t=0;t<i.length;++t){var s=this._labelContext.measureText(i[t]).width,o=n.TextUtils.fragmentText(i[t],s,r,this._measureText(this._labelContext));this._splitedStrings=this._splitedStrings.concat(o)}}else this._splitedStrings=i},t._updateLabelDimensions=function(){var t,e=this._node,i=e._string.split("\n"),n=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===e._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===e._overFlow){this._splitedStrings=i;var r=0,s=0;for(t=0;t<i.length;++t){var o=n.measureText(i[t]).width;r=r>o?r:o}s=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=parseFloat(r.toFixed(2))+2*this._getMargin(),this._canvasSize.height=parseFloat(s.toFixed(2)),e._isItalic&&(this._canvasSize.width+=e._drawFontsize*Math.tan(.20943951)),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},t._calculateFillTextStartPosition=function(){var t,e,i=this._node,r=this._getLineHeight(),s=this._splitedStrings.length;return t=n.TextAlignment.RIGHT===i._hAlign?this._canvasSize.width-this._getMargin():n.TextAlignment.CENTER===i._hAlign?this._canvasSize.width/2:0+this._getMargin(),e=n.VerticalTextAlignment.TOP===i._vAlign?0:n.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-r*(s-1)/2:this._canvasSize.height-r*(s-1),n.p(t,e)},t._calculateTextBaseline=function(){var t,e,i=this._node;t=n.TextAlignment.RIGHT===i._hAlign?"right":n.TextAlignment.CENTER===i._hAlign?"center":"left",this._labelContext.textAlign=t,e=n.VerticalTextAlignment.TOP===i._vAlign?"top":n.VerticalTextAlignment.CENTER===i._vAlign?"middle":"bottom",this._labelContext.textBaseline=e},t._bakeLabel=function(){var t=this._node;this._drawFontsize=t._drawFontsize,this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},t._calculateUnderlineStartPosition=function(){var t,e,i=this._node,r=this._getLineHeight(),s=this._splitedStrings.length;return t=0+this._getMargin(),e=n.VerticalTextAlignment.TOP===i._vAlign?i._fontSize:n.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-r*(s-1)/2+i._fontSize/2:this._canvasSize.height-r*(s-1),n.p(t,e)},t._updateTexture=function(){this._labelContext.clearRect(0,0,this._labelCanvas.width,this._labelCanvas.height),this._labelContext.font=this._fontDesc;var t=this._calculateFillTextStartPosition(),e=this._getLineHeight();this._labelContext.lineJoin="round";var i=this._displayedColor;this._labelContext.fillStyle="rgb("+i.r+","+i.g+","+i.b+")";for(var r,s=0;s<this._splitedStrings.length;++s){if(this._node.isOutlined()){var o=this._node.getOutlineColor()||n.color(255,255,255,255);this._labelContext.globalCompositeOperation="source-over",this._labelContext.strokeStyle="rgb("+o.r+","+o.g+","+o.b+")",this._labelContext.lineWidth=2*this._node.getOutlineWidth(),this._labelContext.strokeText(this._splitedStrings[s],t.x,t.y+s*e)}this._labelContext.fillText(this._splitedStrings[s],t.x,t.y+s*e),this._node._isUnderline&&(r=this._calculateUnderlineStartPosition(),this._labelContext.save(),this._labelContext.beginPath(),this._labelContext.lineWidth=this._node._fontSize/8,this._labelContext.strokeStyle="rgb("+i.r+","+i.g+","+i.b+")",this._labelContext.moveTo(r.x,r.y+s*e-1),this._labelContext.lineTo(r.x+this._labelCanvas.width,r.y+s*e-1),this._labelContext.stroke(),this._labelContext.restore())}this._texture._textureLoaded=!1,this._texture.handleLoadedTexture(!0)},t._rebuildLabelSkin=function(){this._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty;var t=this._node;t._updateLabel()}}(),function(){_ccsg.Label.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._texture=new n.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._texture.initWithElement(this._labelCanvas),this._splitedStrings=null};var t=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.js.mixin(t,_ccsg.Label.TTFLabelBaker.prototype),t.constructor=_ccsg.Label.CanvasRenderCmd,t.transform=function(t,e){this.originTransform(t,e);var i=this._currentRegion,r=i._minX,s=i._maxX,o=i._minY,a=i._maxY,c=n.visibleRect,h=c.left.x,l=c.right.x,u=c.top.y,d=c.bottom.y;s<h||r>l||a<d||o>u?this._needDraw=!1:this._needDraw=!0},t.rendering=function(t,e,i){var r=this._node;if(r._labelType===_ccsg.Label.Type.TTF||r._labelType===_ccsg.Label.Type.SystemFont){var s=this._displayedOpacity,o=s/255;if(0===s)return;var a=t||n._renderContext,c=a.getContext();if(a.setTransform(this._worldTransform,e,i),a.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(r._blendFunc)),a.setGlobalAlpha(o),this._texture){var h,l,u,d,_,f,p,g;_=0,f=-this._node._contentSize.height,p=this._node._contentSize.width,g=this._node._contentSize.height;var m=this._texture.getPixelWidth(),v=this._texture.getPixelHeight();h=0,l=0,u=m,d=v;var y=this._texture._htmlElementObj;""!==this._texture._pattern?(a.setFillStyle(c.createPattern(y,this._texture._pattern)),c.fillRect(_,f,p,g)):0!==u&&0!==d&&0!==p&&0!==g&&c.drawImage(y,h,l,u,d,_,f,p,g)}n.g_NumberOfDraws=n.g_NumberOfDraws+1}}}(),_ccsg.Label.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._texture=new n.Texture2D,this._labelCanvas=document.createElement("canvas"),this._texture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._splitedStrings=null,this._drawFontsize=0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:1},{x:0,y:0,u:1,v:0},{x:0,y:0,u:1,v:1}],this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var m=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.js.mixin(m,_ccsg.Label.TTFLabelBaker.prototype),m.constructor=_ccsg.Label.WebGLRenderCmd,m._updateDisplayOpacity=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,t),this._rebuildLabelSkin()},m.transform=function(t,e){this.originTransform(t,e);var i=this._node,r=0,s=this._labelCanvas.width,o=0,a=this._labelCanvas.height,c=this._worldTransform,h=this._vertices;if(h[0].x=r*c.a+a*c.c+c.tx,h[0].y=r*c.b+a*c.d+c.ty,h[1].x=r*c.a+o*c.c+c.tx,h[1].y=r*c.b+o*c.d+c.ty,h[2].x=s*c.a+a*c.c+c.tx,h[2].y=s*c.b+a*c.d+c.ty,h[3].x=s*c.a+o*c.c+c.tx,h[3].y=s*c.b+o*c.d+c.ty,i._string&&(i._labelType===_ccsg.Label.Type.TTF||i._labelType===_ccsg.Label.Type.SystemFont)){var l=n.visibleRect,u=l.left.x,d=l.right.x,_=l.top.y,f=l.bottom.y;(h[0].x-u&h[1].x-u&h[2].x-u&h[3].x-u)>>31||(d-h[0].x&d-h[1].x&d-h[2].x&d-h[3].x)>>31||(h[0].y-f&h[1].y-f&h[2].y-f&h[3].y-f)>>31||(_-h[0].y&_-h[1].y&_-h[2].y&_-h[3].y)>>31?this._needDraw=!1:this._needDraw=!0}},m.uploadData=function(t,e,i){var n=this._node;if(!n._string||n._labelType!==_ccsg.Label.Type.TTF&&n._labelType!==_ccsg.Label.Type.SystemFont)return 0;var r=this._displayedOpacity;this._color[0]=r<<24|r<<16|r<<8|r;var s,o,a=n._vertexZ,c=this._vertices,h=c.length,l=i;for(s=0;s<h;++s)o=c[s],t[l]=o.x,t[l+1]=o.y,t[l+2]=a,e[l+3]=this._color[0],t[l+4]=o.u,t[l+5]=o.v,l+=6;return h};var H=function(t){return{u:t.x,v:t.y}};n.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return n.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),n.DrawNode.TYPE_DOT=0,n.DrawNode.TYPE_SEGMENT=1,n.DrawNode.TYPE_POLY=2,n.game.once(n.game.EVENT_RENDERER_INITED,function(){n._renderType===n.game.RENDER_TYPE_CANVAS?(n._DrawNodeElement=function(t,e,i,n,r,s,o,a,c){var h=this;h.type=t,h.verts=e||null,h.fillColor=i||null,h.lineWidth=n||0,h.lineColor=r||null,h.lineCap=s||"butt",h.isClosePolygon=o||!1,h.isFill=a||!1,h.isStroke=c||!1},n.js.mixin(n.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=n.color(255,255,255,255),t._blendFunc=this._blendFunc=new n.BlendFunc(n.macro.SRC_ALPHA,n.macro.ONE_MINUS_SRC_ALPHA),this.init()},drawRect:function(t,e,i,r,s){r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)],a=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);a.verts=o,a.lineWidth=r,a.lineColor=s,a.isClosePolygon=!0,a.isStroke=!0,a.lineCap="butt",a.fillColor=i,i&&(null==i.a&&(i.a=255),a.isFill=!0),this._buffer.push(a)},drawCircle:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=2*Math.PI/r,h=[],l=0;l<=r;l++){var u=l*c,d=e*Math.cos(u+i)+t.x,_=e*Math.sin(u+i)+t.y;h.push(n.p(d,_))}s&&h.push(n.p(t.x,t.y));var f=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);f.verts=h,f.lineWidth=o,f.lineColor=a,f.isClosePolygon=!0,f.isStroke=!0,this._buffer.push(f)},drawQuadBezier:function(t,e,i,r,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;a.push(n.p(l,u)),c+=1/r}a.push(n.p(i.x,i.y));var d=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);d.verts=a,d.lineWidth=s,d.lineColor=o,d.isStroke=!0,d.lineCap="round",this._buffer.push(d)},drawCubicBezier:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;l<s;l++){var u=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*e.x+3*(1-h)*h*h*i.x+h*h*h*r.x,d=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*e.y+3*(1-h)*h*h*i.y+h*h*h*r.y;c.push(n.p(u,d)),h+=1/s}c.push(n.p(r.x,r.y));var _=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=o,_.lineColor=a,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,r,s){r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;l<i+1;l++){var u=l/i;1===u?(o=t.length-1,a=1):(o=0|u/h,a=(u-h*o)/h);var d=n.cardinalSplineAt(n.getControlPointAt(t,o-1),n.getControlPointAt(t,o-0),n.getControlPointAt(t,o+1),n.getControlPointAt(t,o+2),e,a);c.push(d)}var _=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);_.verts=c,_.lineWidth=r,_.lineColor=s,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var r=new n._DrawNodeElement(n.DrawNode.TYPE_DOT);r.verts=[t],r.lineWidth=e,r.fillColor=i,this._buffer.push(r)},drawDots:function(t,e,i){if(t&&0!=t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,r){i=i||this._lineWidth,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var s=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);s.verts=[t,e],s.lineWidth=2*i,s.lineColor=r,s.isStroke=!0,s.lineCap="round",this._buffer.push(s)},drawPoly_:function(t,e,i,r,s){i=null==i?this._lineWidth:i,r=r||this.getDrawColor(),null==r.a&&(r.a=255);var o=new n._DrawNodeElement(n.DrawNode.TYPE_POLY);o.verts=t,o.fillColor=e,o.lineWidth=i,o.lineColor=r,o.isClosePolygon=!s,o.isStroke=!0,o.lineCap="round",e&&(o.isFill=!0),this._buffer.push(o)},drawPoly:function(t,e,i,r,s){for(var o=[],a=0;a<t.length;a++)o.push(n.p(t[a].x,t[a].y));return this.drawPoly_(o,e,i,r,s)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new n.DrawNode.CanvasRenderCmd(this)}})):n._renderType===n.game.RENDER_TYPE_WEBGL&&n.js.mixin(n.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new n.BlendFunc(n.macro.SRC_ALPHA,n.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=n.color(255,255,255,255),this.init()},init:function(){return!!_ccsg.Node.prototype.init.call(this)&&(this.shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=n._renderContext.createBuffer(),this._dirty=!0,!0)},drawRect:function(t,e,i,r,s){r=null==r?this._lineWidth:r,s=s||this.getDrawColor(),null==s.a&&(s.a=255);var o=[t,n.p(e.x,t.y),e,n.p(t.x,e.y)];null==i?this._drawSegments(o,r,s,!0):this.drawPoly(o,i,r,s)},drawCircle:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);var c,h,l=2*Math.PI/r,u=[];for(c=0;c<=r;c++){var d=c*l,_=e*Math.cos(d+i)+t.x,f=e*Math.sin(d+i)+t.y;u.push(n.p(_,f))}for(s&&u.push(n.p(t.x,t.y)),o*=.5,c=0,h=u.length;c<h-1;c++)this.drawSegment(u[c],u[c+1],o,a)},drawQuadBezier:function(t,e,i,r,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),null==o.a&&(o.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*i.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*i.y;a.push(n.p(l,u)),c+=1/r}a.push(n.p(i.x,i.y)),this._drawSegments(a,s,o,!1)},drawCubicBezier:function(t,e,i,r,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),null==a.a&&(a.a=255);for(var c=[],h=0,l=0;l<s;l++){var u=Math.pow(1-h,3)*t.x+3*Math.pow(1-h,2)*h*e.x+3*(1-h)*h*h*i.x+h*h*h*r.x,d=Math.pow(1-h,3)*t.y+3*Math.pow(1-h,2)*h*e.y+3*(1-h)*h*h*i.y+h*h*h*r.y;c.push(n.p(u,d)),h+=1/s}c.push(n.p(r.x,r.y)),this._drawSegments(c,o,a,!1)},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,r,s){r=r||this._lineWidth,s=s||this.getDrawColor(),null==s.a&&(s.a=255);for(var o,a,c=[],h=1/t.length,l=0;l<i+1;l++){var u=l/i;1===u?(o=t.length-1,a=1):(o=0|u/h,a=(u-h*o)/h);var d=n.cardinalSplineAt(n.getControlPointAt(t,o-1),n.getControlPointAt(t,o-0),n.getControlPointAt(t,o+1),n.getControlPointAt(t,o+2),e,a);c.push(d)}r*=.5;for(var _=0,f=c.length;_<f-1;_++)this.drawSegment(c[_],c[_+1],r,s)},_render:function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=n.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),n.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this,i=e._buffer;if(i.length+t>e._bufferCapacity){var r=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(e._bufferCapacity+=Math.max(e._bufferCapacity,t),null==i||0===i.length)e._buffer=[],e._trianglesArrayBuffer=new ArrayBuffer(r*e._bufferCapacity),e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer);else{for(var s=[],o=new ArrayBuffer(r*e._bufferCapacity),a=0;a<i.length;a++)s[a]=new n.V2F_C4B_T2F_Triangle(i[a].a,i[a].b,i[a].c,o,a*r);e._trianglesReader=new Uint8Array(o),e._trianglesArrayBuffer=o,e._buffer=s}}},drawDot:function(t,e,i){i=i||this.getDrawColor(),null==i.a&&(i.a=255);var r={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},s={vertices:{x:t.x-e,y:t.y-e},colors:r,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-e,y:t.y+e},colors:r,texCoords:{u:-1,v:1}},a={vertices:{x:t.x+e,y:t.y+e},colors:r,texCoords:{u:1,v:1}},c={vertices:{x:t.x+e,y:t.y-e},colors:r,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new n.V2F_C4B_T2F_Triangle(s,o,a,this._trianglesArrayBuffer,this._buffer.length*n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new n.V2F_C4B_T2F_Triangle(s,a,c,this._trianglesArrayBuffer,this._buffer.length*n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this.getDrawColor(),null==i.a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},drawSegment:function(t,e,i,r){r=r||this.getDrawColor(),null==r.a&&(r.a=255),i=i||.5*this._lineWidth;var s=18;this._ensureCapacity(s);var o={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},a=n.v2(t),c=n.v2(e),h=n.pNormalize(n.pPerp(n.pSub(c,a))),l=n.pPerp(h),u=n.pMult(h,i),d=n.pMult(l,i),_=n.pSub(c,n.pAdd(u,d)),f=n.pAdd(c,n.pSub(u,d)),p=n.pSub(c,u),g=n.pAdd(c,u),m=n.pSub(a,u),v=n.pAdd(a,u),y=n.pSub(a,n.pSub(u,d)),T=n.pAdd(a,n.pAdd(u,d)),C=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,b=this._trianglesArrayBuffer,x=this._buffer;x.push(new n.V2F_C4B_T2F_Triangle({vertices:_,colors:o,texCoords:H(n.pNeg(n.pAdd(h,l)))},{vertices:f,colors:o,texCoords:H(n.pSub(h,l))},{vertices:p,colors:o,texCoords:H(n.pNeg(h))},b,x.length*C)),x.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:H(h)},{vertices:f,colors:o,texCoords:H(n.pSub(h,l))},{vertices:p,colors:o,texCoords:H(n.pNeg(h))},b,x.length*C)),x.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:H(h)},{vertices:m,colors:o,texCoords:H(n.pNeg(h))},{vertices:p,colors:o,texCoords:H(n.pNeg(h))},b,x.length*C)),x.push(new n.V2F_C4B_T2F_Triangle({vertices:g,colors:o,texCoords:H(h)},{vertices:m,colors:o,texCoords:H(n.pNeg(h))},{vertices:v,colors:o,texCoords:H(h)},b,x.length*C)),x.push(new n.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:H(n.pSub(l,h))},{vertices:m,colors:o,texCoords:H(n.pNeg(h))},{vertices:v,colors:o,texCoords:H(h)},b,x.length*C)),x.push(new n.V2F_C4B_T2F_Triangle({vertices:y,colors:o,texCoords:H(n.pSub(l,h))},{vertices:T,colors:o,texCoords:H(n.pAdd(h,l))},{vertices:v,colors:o,texCoords:H(h)},b,x.length*C)),this._dirty=!0},drawPoly:function(t,e,i,r,s){if(null==e)return void this._drawSegments(t,i,r,!s);null==e.a&&(e.a=255),null==r.a&&(r.a=255),i=null==i?this._lineWidth:i,i*=.5;var o,a,c,h,l={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},u={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},d=[],_=t.length;for(o=0;o<_;o++){a=n.v2(t[(o-1+_)%_]),c=n.v2(t[o]),h=n.v2(t[(o+1)%_]);var f=n.pNormalize(n.pPerp(n.pSub(c,a))),p=n.pNormalize(n.pPerp(n.pSub(h,c))),g=n.pMult(n.pAdd(f,p),1/(n.pDot(f,p)+1));d[o]={offset:g,n:p}}var m=i>0,v=3*_-2,y=3*v;this._ensureCapacity(y);var T=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,b=this._buffer,x=0==m?.5:0;for(o=0;o<_-2;o++)a=n.pSub(n.v2(t[0]),n.pMult(d[0].offset,x)),c=n.pSub(n.v2(t[o+1]),n.pMult(d[o+1].offset,x)),h=n.pSub(n.v2(t[o+2]),n.pMult(d[o+2].offset,x)),b.push(new n.V2F_C4B_T2F_Triangle({vertices:a,colors:l,texCoords:H(n.v2())},{vertices:c,colors:l,texCoords:H(n.v2())},{vertices:h,colors:l,texCoords:H(n.v2())},C,b.length*T));for(o=0;o<_;o++){var S=(o+1)%_;a=n.v2(t[o]),c=n.v2(t[S]);var E=d[o].n,A=d[o].offset,O=d[S].offset,w=m?n.pSub(a,n.pMult(A,i)):n.pSub(a,n.pMult(A,.5)),R=m?n.pSub(c,n.pMult(O,i)):n.pSub(c,n.pMult(O,.5)),I=m?n.pAdd(a,n.pMult(A,i)):n.pAdd(a,n.pMult(A,.5)),P=m?n.pAdd(c,n.pMult(O,i)):n.pAdd(c,n.pMult(O,.5));m?(b.push(new n.V2F_C4B_T2F_Triangle({vertices:w,colors:u,texCoords:H(n.pNeg(E))},{vertices:R,colors:u,texCoords:H(n.pNeg(E))},{vertices:P,colors:u,texCoords:H(E)},C,b.length*T)),b.push(new n.V2F_C4B_T2F_Triangle({vertices:w,colors:u,texCoords:H(n.pNeg(E))},{vertices:I,colors:u,texCoords:H(E)},{vertices:P,colors:u,texCoords:H(E)},C,b.length*T))):(b.push(new n.V2F_C4B_T2F_Triangle({vertices:w,colors:l,texCoords:H(n.v2())},{vertices:R,colors:l,texCoords:H(n.v2())},{vertices:P,colors:l,texCoords:H(E)},C,b.length*T)),b.push(new n.V2F_C4B_T2F_Triangle({vertices:w,colors:l,texCoords:H(n.v2())},{vertices:I,colors:l,texCoords:H(E)},{vertices:P,colors:l,texCoords:H(E)},C,b.length*T)))}d=null,this._dirty=!0},_drawSegments:function(t,e,i,r){if(e=null==e?this._lineWidth:e,i=i||this._drawColor,null==i.a&&(i.a=255),e*=.5,!(e<=0)){var s,o,a,c,h={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},l=[],u=t.length;for(s=0;s<u;s++){o=n.v2(t[(s-1+u)%u]),a=n.v2(t[s]),c=n.v2(t[(s+1)%u]);var d=n.pNormalize(n.pPerp(n.pSub(a,o))),_=n.pNormalize(n.pPerp(n.pSub(c,a))),f=n.pMult(n.pAdd(d,_),1/(n.pDot(d,_)+1));l[s]={offset:f,n:_}}var p=3*u-2,g=3*p;this._ensureCapacity(g);var m=n.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,v=this._trianglesArrayBuffer,y=this._buffer,T=r?u:u-1;for(s=0;s<T;s++){var C=(s+1)%u;o=n.v2(t[s]),a=n.v2(t[C]);var b=l[s].n,x=l[s].offset,S=l[C].offset,E=n.pSub(o,n.pMult(x,e)),A=n.pSub(a,n.pMult(S,e)),O=n.pAdd(o,n.pMult(x,e)),w=n.pAdd(a,n.pMult(S,e));y.push(new n.V2F_C4B_T2F_Triangle({vertices:E,colors:h,texCoords:H(n.pNeg(b))},{vertices:A,colors:h,texCoords:H(n.pNeg(b))},{vertices:w,colors:h,texCoords:H(b)},v,y.length*m)),y.push(new n.V2F_C4B_T2F_Triangle({vertices:E,colors:h,texCoords:H(n.pNeg(b))},{vertices:O,colors:h,texCoords:H(b)},{vertices:w,colors:h,texCoords:H(b)},v,y.length*m))}l=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new n.DrawNode.WebGLRenderCmd(this)}})}),n.DrawNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},n.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype),n.DrawNode.CanvasRenderCmd.prototype.constructor=n.DrawNode.CanvasRenderCmd,n.js.mixin(n.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,i){var r=t||n._renderContext,s=(r.getContext(),this._node),o=s._displayedOpacity/255;if(0!==o){r.setTransform(this._worldTransform,e,i),r.setGlobalAlpha(o),this._blendFunc&&this._blendFunc.src===n.macro.SRC_ALPHA&&this._blendFunc.dst===n.macro.ONE&&r.setCompositeOperation("lighter");for(var a=this._buffer,c=0,h=a.length;c<h;c++){var l=a[c];switch(l.type){case n.DrawNode.TYPE_DOT:this._drawDot(r,l,e,i);break;case n.DrawNode.TYPE_SEGMENT:this._drawSegment(r,l,e,i);break;case n.DrawNode.TYPE_POLY:this._drawPoly(r,l,e,i)}}}},_drawDot:function(t,e,i,n){var r=e.fillColor,s=e.verts[0],o=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.beginPath(),a.arc(s.x,-s.y,o,0,2*Math.PI,!1),a.closePath(),a.fill()},_drawSegment:function(t,e,i,n){var r=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,h=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),h.lineWidth=a*i,h.beginPath(),h.lineCap=c,h.moveTo(s.x,-s.y),h.lineTo(o.x,-o.y),h.stroke()},_drawPoly:function(t,e,i,n){var r=e.verts,s=e.lineCap;if(null!=r){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,h=e.isClosePolygon,l=e.isFill,u=e.isStroke,d=t.getContext(),_=r[0];d.lineCap=s,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),a&&(d.lineWidth=a*i),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),d.beginPath(),d.moveTo(_.x,-_.y);for(var f=1,p=r.length;f<p;f++)d.lineTo(r[f].x,-r[f].y);h&&d.closePath(),l&&d.fill(),u&&d.stroke()}}}),n.DrawNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new n.math.Matrix4,this._matrix.identity()},n.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),n.DrawNode.WebGLRenderCmd.prototype.constructor=n.DrawNode.WebGLRenderCmd,n.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._buffer.length>0){var i=this._worldTransform,r=this._matrix.mat;r[0]=i.a,r[4]=i.c,r[12]=i.tx,r[1]=i.b,r[5]=i.d,r[13]=i.ty,n.gl.blendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render()}},n.ClippingNode=_ccsg.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),_ccsg.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ClippingNode.CanvasRenderCmd(this):new n.ClippingNode.WebGLRenderCmd(this)}}),n.ClippingNode.stencilBits=-1;var b=n.ClippingNode.prototype;n.defineGetterSetter(b,"stencil",b.getStencil,b.setStencil),b.stencil,n.ClippingNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._rendererClipCmd=new n.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new n.CustomRenderCmd(this,this._restoreCmdCallback)};var m=n.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=n.ClippingNode.CanvasRenderCmd,m.initStencilBits=function(){},m.setStencil=function(t){null!=t&&(this._node._stencil=t,t instanceof n.DrawNode||n.error("only cc.DrawNode is accepted as stencil"))},m._restoreCmdCallback=function(t){var e=t||n._renderContext;e.restore()},m._drawStencilCommand=function(t,e,i){var r=t||n._renderContext,s=r.getContext();r.save(),s.beginPath(),r.setTransform(this._worldTransform,e,i);for(var o=this._node._stencil._buffer,a=0;a<o.length;++a){var c=o[a].verts;if(!(c.length<3)){s.moveTo(c[0].x,-c[0].y);for(var h=1;h<c.length;++h)s.lineTo(c[h].x,-c[h].y)}}s.clip()},m.visit=function(t){var e=this._node;if(this._propagateFlagsDown(t),e._visible){t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),this._node._stencil&&n.renderer.pushRenderCommand(this._rendererClipCmd);var i,r=e._children,s=r.length;if(s>0)for(e.sortAllChildren(),i=0;i<s;i++)r[i]._renderCmd.visit(this);this._node._stencil&&n.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0;
}},n.ClippingNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._beforeVisitCmd=new n.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new n.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new n.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilEnabled=null,this._mask_layer_le=null};var m=n.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=n.ClippingNode.WebGLRenderCmd,n.ClippingNode.WebGLRenderCmd._init_once=null,n.ClippingNode.WebGLRenderCmd._visit_once=null,n.ClippingNode.WebGLRenderCmd._layer=-1,m.initStencilBits=function(){n.ClippingNode.WebGLRenderCmd._init_once=!0,n.ClippingNode.WebGLRenderCmd._init_once&&(n.ClippingNode.stencilBits=n._renderContext.getParameter(n._renderContext.STENCIL_BITS),n.ClippingNode.stencilBits<=0&&n.log("Stencil buffer is not enabled."),n.ClippingNode.WebGLRenderCmd._init_once=!1)},m.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},m.visit=function(t){var e=this._node;if(this._propagateFlagsDown(t),e._visible){if(e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1),n.ClippingNode.stencilBits<1)return void this.originVisit(t);if(!e._stencil||!e._stencil.visible)return void(e.inverted&&this.originVisit(t));if(n.ClippingNode.WebGLRenderCmd._layer+1===n.ClippingNode.stencilBits)return n.ClippingNode.WebGLRenderCmd._visit_once=!0,n.ClippingNode.WebGLRenderCmd._visit_once&&(n.log("Nesting more than "+n.ClippingNode.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),n.ClippingNode.WebGLRenderCmd._visit_once=!1),void this.originVisit(t);n.renderer.pushRenderCommand(this._beforeVisitCmd);var i=n.current_stack;i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,e._stencil._renderCmd.visit(this),n.renderer.pushRenderCommand(this._afterDrawStencilCmd);var r=e._children;if(r&&r.length>0){var s=r.length;e.sortAllChildren();for(var o=0;o<s;o++)r[o]._renderCmd.visit(this)}n.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,i.top=i.stack.pop()}},m.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},m._onBeforeVisit=function(t){var e=t||n._renderContext,i=this._node;n.ClippingNode.WebGLRenderCmd._layer++;var r=1<<n.ClippingNode.WebGLRenderCmd._layer,s=r-1;if(this._mask_layer_le=r|s,this._currentStencilEnabled=e.isEnabled(e.STENCIL_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.depthMask(!1),e.stencilFunc(e.NEVER,r,r),e.stencilOp(e.REPLACE,e.KEEP,e.KEEP),e.stencilMask(r),e.clear(e.STENCIL_BUFFER_BIT),i.alphaThreshold<1){var o=n.shaderCache.programForKey(n.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);n.gl.useProgram(o.getProgram()),o.setUniformLocationWith1f(n.UNIFORM_ALPHA_TEST_VALUE_S,i.alphaThreshold),o.setUniformLocationWithMatrix4fv(n.UNIFORM_MVMATRIX_S,n.renderer.mat4Identity.mat),c(i._stencil,o)}},m._onAfterDrawStencil=function(t){var e=t||n._renderContext;e.depthMask(!0),e.stencilFunc(this._node.inverted?e.NOTEQUAL:e.EQUAL,this._mask_layer_le,this._mask_layer_le),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},m._onAfterVisit=function(t){var e=t||n._renderContext;if(n.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled){var i=1<<n.ClippingNode.WebGLRenderCmd._layer,r=i-1,s=i|r;e.stencilMask(i),e.stencilFunc(e.EQUAL,s,s)}else e.disable(e.STENCIL_TEST)};var Q=t("../cocos2d/particle/CCPNGReader"),q=t("../cocos2d/particle/CCTIFFReader");n.Particle=function(t,e,i,r,s,o,a,c,h,l,u,d){this.pos=t?t:n.p(0,0),this.startPos=e?e:n.p(0,0),this.color=i?i:{r:0,g:0,b:0,a:255},this.deltaColor=r?r:{r:0,g:0,b:0,a:255},this.size=s||0,this.deltaSize=o||0,this.rotation=a||0,this.deltaRotation=c||0,this.timeToLive=h||0,this.atlasIndex=l||0,this.modeA=u?u:new n.Particle.ModeA,this.modeB=d?d:new n.Particle.ModeB,this.isChangeColor=!1,this.drawPos=n.p(0,0)},n.Particle.ModeA=function(t,e,i){this.dir=t?t:n.p(0,0),this.radialAccel=e||0,this.tangentialAccel=i||0},n.Particle.ModeB=function(t,e,i,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=i||0,this.deltaRadius=n||0},n.Particle.TemporaryPoints=[n.p(),n.p(),n.p(),n.p()],_ccsg.ParticleSystem=_ccsg.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:n.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(_ccsg.Node.prototype.ctor.call(this),this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.modeA=new _ccsg.ParticleSystem.ModeA,this.modeB=new _ccsg.ParticleSystem.ModeB,this._blendFunc={src:n.macro.BLEND_SRC,dst:n.macro.BLEND_DST},this._particles=[],this._sourcePosition=n.p(0,0),this._posVar=n.p(0,0),this._startColor=n.color(255,255,255,255),this._startColorVar=n.color(255,255,255,255),this._endColor=n.color(255,255,255,255),this._endColorVar=n.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=n.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||n.js.isNumber(t)){var e=t||100;this.setDrawMode(_ccsg.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(e)}else n.js.isString(t)?this.initWithFile(t):"object"==typeof t&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.ParticleSystem.CanvasRenderCmd(this):new _ccsg.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){var t=this.modeA.gravity;return n.p(t.x,t.y)},setGravity:function(t){this.modeA.gravity=t},getSpeed:function(){return this.modeA.speed},setSpeed:function(t){this.modeA.speed=t},getSpeedVar:function(){return this.modeA.speedVar},setSpeedVar:function(t){this.modeA.speedVar=t},getTangentialAccel:function(){return this.modeA.tangentialAccel},setTangentialAccel:function(t){this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.modeA.radialAccel},setRadialAccel:function(t){this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.modeA.rotationIsDir},setRotationIsDir:function(t){this.modeA.rotationIsDir=t},getStartRadius:function(){return this.modeB.startRadius},setStartRadius:function(t){this.modeB.startRadius=t},getStartRadiusVar:function(){return this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.modeB.startRadiusVar=t},getEndRadius:function(){return this.modeB.endRadius},setEndRadius:function(t){this.modeB.endRadius=t},getEndRadiusVar:function(){return this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,_ccsg.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return n.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=n.color(t)},getStartColorVar:function(){return n.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=n.color(t)},getEndColor:function(){return n.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=n.color(t)},getEndColorVar:function(){return n.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=n.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,n.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.once("load",function(e){this._textureLoaded=!0,this.setTextureWithRect(t,n.rect(0,0,t.width,t.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):this._blendFunc.src===t&&this._blendFunc.dst===e||(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===n.macro.SRC_ALPHA&&this._blendFunc.dst===n.macro.ONE||this._blendFunc.src===n.macro.ONE&&this._blendFunc.dst===n.macro.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=n.macro.SRC_ALPHA,e.dst=n.macro.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var e=n.loader.getRes(t);return e?this.initWithDictionary(e,""):(n.log("_ccsg.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return n.rect(0,0,n._canvas.width,n._canvas.height)},initWithDictionary:function(t,e){var i=!1,r=null,s=this._valueForKey,o=parseInt(s("maxParticles",t));if(this.initWithTotalParticles(o)){this.angle=parseFloat(s("angle",t)),this.angleVar=parseFloat(s("angleVariance",t)),this.duration=parseFloat(s("duration",t)),this._blendFunc.src=parseInt(s("blendFuncSource",t)),this._blendFunc.dst=parseInt(s("blendFuncDestination",t));var a=this._startColor;a.r=255*parseFloat(s("startColorRed",t)),a.g=255*parseFloat(s("startColorGreen",t)),a.b=255*parseFloat(s("startColorBlue",t)),a.a=255*parseFloat(s("startColorAlpha",t));var c=this._startColorVar;c.r=255*parseFloat(s("startColorVarianceRed",t)),c.g=255*parseFloat(s("startColorVarianceGreen",t)),c.b=255*parseFloat(s("startColorVarianceBlue",t)),c.a=255*parseFloat(s("startColorVarianceAlpha",t));var h=this._endColor;h.r=255*parseFloat(s("finishColorRed",t)),h.g=255*parseFloat(s("finishColorGreen",t)),h.b=255*parseFloat(s("finishColorBlue",t)),h.a=255*parseFloat(s("finishColorAlpha",t));var l=this._endColorVar;if(l.r=255*parseFloat(s("finishColorVarianceRed",t)),l.g=255*parseFloat(s("finishColorVarianceGreen",t)),l.b=255*parseFloat(s("finishColorVarianceBlue",t)),l.a=255*parseFloat(s("finishColorVarianceAlpha",t)),this.startSize=parseFloat(s("startParticleSize",t)),this.startSizeVar=parseFloat(s("startParticleSizeVariance",t)),this.endSize=parseFloat(s("finishParticleSize",t)),this.endSizeVar=parseFloat(s("finishParticleSizeVariance",t)),this.setPosition(parseFloat(s("sourcePositionx",t)),parseFloat(s("sourcePositiony",t))),this._posVar.x=parseFloat(s("sourcePositionVariancex",t)),this._posVar.y=parseFloat(s("sourcePositionVariancey",t)),this.startSpin=parseFloat(s("rotationStart",t)),this.startSpinVar=parseFloat(s("rotationStartVariance",t)),this.endSpin=parseFloat(s("rotationEnd",t)),this.endSpinVar=parseFloat(s("rotationEndVariance",t)),this.emitterMode=parseInt(s("emitterType",t)),this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var u=this.modeA;u.gravity.x=parseFloat(s("gravityx",t)),u.gravity.y=parseFloat(s("gravityy",t)),u.speed=parseFloat(s("speed",t)),u.speedVar=parseFloat(s("speedVariance",t));var d=s("radialAcceleration",t);u.radialAccel=d?parseFloat(d):0,d=s("radialAccelVariance",t),u.radialAccelVar=d?parseFloat(d):0,d=s("tangentialAcceleration",t),u.tangentialAccel=d?parseFloat(d):0,d=s("tangentialAccelVariance",t),u.tangentialAccelVar=d?parseFloat(d):0;var _=s("rotationIsDir",t).toLowerCase();u.rotationIsDir=null!=_&&("true"===_||"1"===_)}else{if(this.emitterMode!==_ccsg.ParticleSystem.Mode.RADIUS)return n.log("_ccsg.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;var f=this.modeB;f.startRadius=parseFloat(s("maxRadius",t)),f.startRadiusVar=parseFloat(s("maxRadiusVariance",t)),f.endRadius=parseFloat(s("minRadius",t)),f.endRadiusVar=0,f.rotatePerSecond=parseFloat(s("rotatePerSecond",t)),f.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",t))}if(this.life=parseFloat(s("particleLifespan",t)),this.lifeVar=parseFloat(s("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode){this._opacityModifyRGB=!1;var p=s("textureFileName",t),g=n.path.changeBasename(this._plistFile,p),m=n.textureCache.getTextureForKey(g);if(m)this.setTexture(m);else{var v=s("textureImageData",t);if(v&&0!==v.length){if(r=n.Codec.unzipBase64AsArray(v,1),!r)return n.log("_ccsg.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var y=n.getImageFormatByData(r);if(y!==n.ImageFormat.TIFF&&y!==n.ImageFormat.PNG)return n.log("_ccsg.ParticleSystem: unknown image format with Data"),!1;var T=document.createElement("canvas");if(y===n.ImageFormat.PNG){var C=new Q(r);C.render(T)}else q.parseTIFF(r,T);n.textureCache.cacheImage(g,T);var b=n.textureCache.getTextureForKey(g);b||n.log("_ccsg.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(b)}else{if(m=n.textureCache.addImage(g),!m)return!1;this.setTexture(m)}}}i=!0}return i},initWithTotalParticles:function(t){this._totalParticles=t;var e,i=this._particles;for(i.length=0,e=0;e<t;e++)i[e]=new n.Particle;if(!i)return n.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(e=0;e<this._totalParticles;e++)i[e].atlasIndex=e;return this._isActive=!0,this._blendFunc.src=n.macro.BLEND_SRC,this._blendFunc.dst=n.macro.BLEND_DST,this.positionType=_ccsg.ParticleSystem.Type.FREE,this.emitterMode=_ccsg.ParticleSystem.Mode.GRAVITY,this.autoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e=n.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*e(),t.pos.y=this._sourcePosition.y+this._posVar.y*e();var i,r,s=this._startColor,o=this._startColorVar,a=this._endColor,c=this._endColorVar;i={r:n.clampf(s.r+o.r*e(),0,255),g:n.clampf(s.g+o.g*e(),0,255),b:n.clampf(s.b+o.b*e(),0,255),a:n.clampf(s.a+o.a*e(),0,255)},r={r:n.clampf(a.r+c.r*e(),0,255),g:n.clampf(a.g+c.g*e(),0,255),b:n.clampf(a.b+c.b*e(),0,255),a:n.clampf(a.a+c.a*e(),0,255)},t.color=i;var h=t.deltaColor,l=t.timeToLive;h.r=(r.r-i.r)/l,h.g=(r.g-i.g)/l,h.b=(r.b-i.b)/l,h.a=(r.a-i.a)/l;var u=this.startSize+this.startSizeVar*e();if(u=Math.max(0,u),t.size=u,this.endSize===_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var d=this.endSize+this.endSizeVar*e();d=Math.max(0,d),t.deltaSize=(d-u)/l}var _=this.startSpin+this.startSpinVar*e(),f=this.endSpin+this.endSpinVar*e();t.rotation=_,t.deltaRotation=(f-_)/l,this.positionType===_ccsg.ParticleSystem.Type.FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y);var p=n.degreesToRadians(this.angle+this.angleVar*e());if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var g=this.modeA,m=t.modeA,v=g.speed+g.speedVar*e();m.dir.x=Math.cos(p),m.dir.y=Math.sin(p),n.pMultIn(m.dir,v),m.radialAccel=g.radialAccel+g.radialAccelVar*e(),m.tangentialAccel=g.tangentialAccel+g.tangentialAccelVar*e(),g.rotationIsDir&&(t.rotation=-n.radiansToDegrees(n.pToAngle(m.dir)))}else{var y=this.modeB,T=t.modeB,C=y.startRadius+y.startRadiusVar*e(),b=y.endRadius+y.endRadiusVar*e();T.radius=C,T.deltaRadius=y.endRadius===_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(b-C)/l,T.angle=p,T.degreesPerSecond=n.degreesToRadians(y.rotatePerSecond+y.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty),this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,this.duration!==-1&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var i=n.Particle.TemporaryPoints[0];if(this.positionType===_ccsg.ParticleSystem.Type.FREE?n.pIn(i,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===_ccsg.ParticleSystem.Type.RELATIVE&&(i.x=this._position.x,i.y=this._position.y),this._visible){for(var r=n.Particle.TemporaryPoints[1],s=n.Particle.TemporaryPoints[2],o=n.Particle.TemporaryPoints[3],a=this._particles;this._particleIdx<this.particleCount;){n.pZeroIn(r),n.pZeroIn(s),n.pZeroIn(o);var c=a[this._particleIdx];if(c.timeToLive-=t,c.timeToLive>0){if(this.emitterMode===_ccsg.ParticleSystem.Mode.GRAVITY){var h=o,l=r,u=s;c.pos.x||c.pos.y?(n.pIn(l,c.pos),n.pNormalizeIn(l)):n.pZeroIn(l),n.pIn(u,l),n.pMultIn(l,c.modeA.radialAccel);var d=u.x;u.x=-u.y,u.y=d,n.pMultIn(u,c.modeA.tangentialAccel),n.pIn(h,l),n.pAddIn(h,u),n.pAddIn(h,this.modeA.gravity),n.pMultIn(h,t),n.pAddIn(c.modeA.dir,h),n.pIn(h,c.modeA.dir),n.pMultIn(h,t),n.pAddIn(c.pos,h)}else{var _=c.modeB;_.angle+=_.degreesPerSecond*t,_.radius+=_.deltaRadius*t,c.pos.x=-Math.cos(_.angle)*_.radius,c.pos.y=-Math.sin(_.angle)*_.radius}this._renderCmd._updateDeltaColor(c,t),c.size+=c.deltaSize*t,c.size=Math.max(0,c.size),c.rotation+=c.deltaRotation*t;var f=r;if(this.positionType===_ccsg.ParticleSystem.Type.FREE||this.positionType===_ccsg.ParticleSystem.Type.RELATIVE){var p=s;n.pIn(p,i),n.pSubIn(p,c.startPos),n.pIn(f,c.pos),n.pSubIn(f,p)}else n.pIn(f,c.pos);this._batchNode&&(f.x+=this._position.x,f.y+=this._position.y),this._renderCmd.updateParticlePosition(c,f),++this._particleIdx}else{var g=c.atlasIndex;if(this._particleIdx!==this.particleCount-1){var m=a[this._particleIdx];a[this._particleIdx]=a[this.particleCount-1],a[this.particleCount-1]=m}if(this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+g),a[this.particleCount-1].atlasIndex=g),--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish)return this.unscheduleUpdate(),this._parent.removeChild(this,!0),void(this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB())}}this._renderCmd.updateLocalBB&&this._renderCmd.updateLocalBB(),this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var i=e[t];return null!=i?i:""}return""},_updateBlendFunc:function(){if(this._batchNode)return void n.log("Can't change blending functions when the particle is being batched");var t=this._texture;if(t&&t instanceof n.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===n.macro.BLEND_SRC&&e.dst===n.macro.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=n.macro.SRC_ALPHA,e.dst=n.macro.ONE_MINUS_SRC_ALPHA))}},clone:function(){var t=new _ccsg.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(n.p(this.x,this.y)),t.setPosVar(n.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===_ccsg.ParticleSystem.Mode.GRAVITY){var i=this.getGravity();t.setGravity(n.p(i.x,i.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else this.getEmitterMode()===_ccsg.ParticleSystem.Mode.RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar()));if(t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var r=this.getTexture();if(r){var s=r.getContentSize();t.setTextureWithRect(r,n.rect(0,0,s.width,s.height))}}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffset();0===e.x&&0===e.y||n.log("_ccsg.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");var i=t.getTexture(),r=this._texture;r!==i&&this.setTexture(i)}},setTextureWithRect:function(t,e){var i=this._texture;i!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var b=_ccsg.ParticleSystem.prototype;b.opacityModifyRGB,n.defineGetterSetter(b,"opacityModifyRGB",b.isOpacityModifyRGB,b.setOpacityModifyRGB),b.batchNode,n.defineGetterSetter(b,"batchNode",b.getBatchNode,b.setBatchNode),b.drawMode,n.defineGetterSetter(b,"drawMode",b.getDrawMode,b.setDrawMode),b.shapeType,n.defineGetterSetter(b,"shapeType",b.getShapeType,b.setShapeType),b.active,n.defineGetterSetter(b,"active",b.isActive),b.sourcePos,n.defineGetterSetter(b,"sourcePos",b.getSourcePosition,b.setSourcePosition),b.posVar,n.defineGetterSetter(b,"posVar",b.getPosVar,b.setPosVar),b.gravity,n.defineGetterSetter(b,"gravity",b.getGravity,b.setGravity),b.speed,n.defineGetterSetter(b,"speed",b.getSpeed,b.setSpeed),b.speedVar,n.defineGetterSetter(b,"speedVar",b.getSpeedVar,b.setSpeedVar),b.tangentialAccel,n.defineGetterSetter(b,"tangentialAccel",b.getTangentialAccel,b.setTangentialAccel),b.tangentialAccelVar,n.defineGetterSetter(b,"tangentialAccelVar",b.getTangentialAccelVar,b.setTangentialAccelVar),b.radialAccel,n.defineGetterSetter(b,"radialAccel",b.getRadialAccel,b.setRadialAccel),b.radialAccelVar,n.defineGetterSetter(b,"radialAccelVar",b.getRadialAccelVar,b.setRadialAccelVar),b.rotationIsDir,n.defineGetterSetter(b,"rotationIsDir",b.getRotationIsDir,b.setRotationIsDir),b.startRadius,n.defineGetterSetter(b,"startRadius",b.getStartRadius,b.setStartRadius),b.startRadiusVar,n.defineGetterSetter(b,"startRadiusVar",b.getStartRadiusVar,b.setStartRadiusVar),b.endRadius,n.defineGetterSetter(b,"endRadius",b.getEndRadius,b.setEndRadius),b.endRadiusVar,n.defineGetterSetter(b,"endRadiusVar",b.getEndRadiusVar,b.setEndRadiusVar),b.rotatePerS,n.defineGetterSetter(b,"rotatePerS",b.getRotatePerSecond,b.setRotatePerSecond),b.rotatePerSVar,n.defineGetterSetter(b,"rotatePerSVar",b.getRotatePerSecondVar,b.setRotatePerSecondVar),b.startColor,n.defineGetterSetter(b,"startColor",b.getStartColor,b.setStartColor),b.startColorVar,n.defineGetterSetter(b,"startColorVar",b.getStartColorVar,b.setStartColorVar),b.endColor,n.defineGetterSetter(b,"endColor",b.getEndColor,b.setEndColor),b.endColorVar,n.defineGetterSetter(b,"endColorVar",b.getEndColorVar,b.setEndColorVar),b.totalParticles,n.defineGetterSetter(b,"totalParticles",b.getTotalParticles,b.setTotalParticles),b.texture,n.defineGetterSetter(b,"texture",b.getTexture,b.setTexture),_ccsg.ParticleSystem.ModeA=function(t,e,i,r,s,o,a,c){this.gravity=t?t:n.p(0,0),this.speed=e||0,this.speedVar=i||0,this.tangentialAccel=r||0,this.tangentialAccelVar=s||0,this.radialAccel=o||0,this.radialAccelVar=a||0,this.rotationIsDir=c||!1},_ccsg.ParticleSystem.ModeB=function(t,e,i,n,r,s){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=i||0,this.endRadiusVar=n||0,this.rotatePerSecond=r||0,this.rotatePerSecondVar=s||0},_ccsg.ParticleSystem.SHAPE_MODE=0,_ccsg.ParticleSystem.TEXTURE_MODE=1,_ccsg.ParticleSystem.STAR_SHAPE=0,_ccsg.ParticleSystem.BALL_SHAPE=1,_ccsg.ParticleSystem.DURATION_INFINITY=-1,_ccsg.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1,_ccsg.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1,_ccsg.ParticleSystem.Mode=n.Enum({GRAVITY:0,RADIUS:1}),_ccsg.ParticleSystem.Type=n.Enum({FREE:0,RELATIVE:1,GROUPED:2});var Z=_ccsg.ParticleSystem.prototype;Object.defineProperty(Z,"visible",{get:_ccsg.Node.prototype.isVisible,set:Z.setVisible}),Object.defineProperty(Z,"ignoreAnchor",{get:_ccsg.Node.prototype.isIgnoreAnchorPointForPosition,set:Z.ignoreAnchorPointForPosition}),Object.defineProperty(Z,"opacityModifyRGB",{get:Z.isOpacityModifyRGB}),_ccsg.ParticleSystem.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._drawMode=_ccsg.ParticleSystem.TEXTURE_MODE,this._shapeType=_ccsg.ParticleSystem.BALL_SHAPE,this._pointRect=n.rect(0,0,0,0),this._localRegion=new n.Region,this._tintCache=document.createElement("canvas")};var m=_ccsg.ParticleSystem.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=_ccsg.ParticleSystem.CanvasRenderCmd,m.getDrawMode=function(){return this._drawMode},m.setDrawMode=function(t){this._drawMode=t},m.getShapeType=function(){return this._shapeType},m.setShapeType=function(t){this._shapeType=t},m.setBatchNode=function(t){this._batchNode!==t&&(this._node._batchNode=t)},m.updateQuadWithParticle=function(t,e){},m.updateParticlePosition=function(t,e){n.pIn(t.drawPos,e)};var K=new n.Region,v=new n.Rect;m.updateLocalBB=function(){var t=this._localRegion,e=this._node._particles;t.setEmpty();for(var i=e.length-1;i>=0;--i){var n=e[i],r=n.drawPos,s=1.415*n.size;K.setTo(r.x-s,r.y-s,r.x+s,r.y+s),t.union(K)}v.x=t._minX,v.y=t._minY,v.width=t._maxX-t._minX,v.height=t._maxY-t._minY},m.getLocalBB=function(){return v},m.updateStatus=function(){_ccsg.Node.CanvasRenderCmd.prototype.updateStatus.call(this),this._updateCurrentRegions(),this._regionFlag=_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~_ccsg.Node._dirtyFlags.contentDirty},m.rendering=function(t,e,i){var r=t||n._renderContext,s=r.getContext(),o=this._node,a=this._pointRect;r.setTransform(this._worldTransform,e,i),r.save(),o.isBlendAdditive()?s.globalCompositeOperation="lighter":s.globalCompositeOperation="source-over";var c,h,l,u,d=this._node.particleCount,_=this._node._particles;if(o.drawMode!==_ccsg.ParticleSystem.SHAPE_MODE&&o._texture){if(!o._texture._textureLoaded)return void r.restore();var f=o._texture.getHtmlElementObj();if(!f.width||!f.height)return void r.restore();var p=f;for(c=0;c<d;c++)if(h=_[c],l=0|.5*h.size,u=h.color.a/255,0!==u){s.globalAlpha=u,s.save(),s.translate(0|h.drawPos.x,-(0|h.drawPos.y));var g=4*Math.floor(h.size/4),m=a.width,v=a.height;s.scale(Math.max(1/m*g,1e-6),Math.max(1/v*g,1e-6)),h.rotation&&s.rotate(n.degreesToRadians(h.rotation)),p=h.isChangeColor?this._changeTextureColor(o._texture,h.color,this._pointRect):f,s.drawImage(p,-(0|m/2),-(0|v/2)),s.restore()}}else{var y=n._drawingUtil;for(c=0;c<d;c++)h=_[c],l=0|.5*h.size,u=h.color.a/255,0!==u&&(s.globalAlpha=u,s.save(),s.translate(0|h.drawPos.x,-(0|h.drawPos.y)),o.shapeType===_ccsg.ParticleSystem.STAR_SHAPE?(h.rotation&&s.rotate(n.degreesToRadians(h.rotation)),y.drawStar(r,l,h.color)):y.drawColorBall(r,l,h.color),s.restore())}r.restore(),
n.g_NumberOfDraws++},m._changeTextureColor=function(t,e,i){var n=this._tintCache,r=t.getContentSize();return n.width=r.width,n.height=r.height,t._generateColorTexture(e.r,e.g,e.b,i,n)},m.initTexCoordsWithRect=function(t){this._pointRect=t},m.setTotalParticles=function(t){this._node._totalParticles=t<200?t:200},m.addParticle=function(){var t,e=this._node,i=e._particles;return e.particleCount<i.length?t=i[e.particleCount]:(t=new n.Particle,i.push(t)),t},m._setupVBO=function(){},m._allocMemory=function(){return!0},m.postStep=function(){},m._setBlendAdditive=function(){var t=this._node._blendFunc;t.src=n.macro.BLEND_SRC,t.dst=n.macro.BLEND_DST},m._initWithTotalParticles=function(t){},m._updateDeltaColor=function(t,e){this._node._dontTint||(t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0)},_ccsg.ParticleSystem.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new n.math.Matrix4,this._matrix.identity(),this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var m=_ccsg.ParticleSystem.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=_ccsg.ParticleSystem.WebGLRenderCmd,m.getDrawMode=function(){},m.setDrawMode=function(t){},m.getShapeType=function(){},m.setShapeType=function(t){},m.setBatchNode=function(t){var e=this._node;if(e._batchNode!==t){var i=e._batchNode;if(e._batchNode=t,t)for(var r=e._particles,s=0;s<e._totalParticles;s++)r[s].atlasIndex=s;t?i||(e._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,e.atlasIndex),n._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(e._totalParticles),e.setTexture(i.getTexture()),this._setupVBO())}},m.initIndices=function(t){for(var e=this._indices,i=0,n=t;i<n;++i){var r=6*i,s=4*i;e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+5]=s+1,e[r+4]=s+2,e[r+3]=s+3}},m.isDifferentTexture=function(t,e){return t===e},m.updateParticlePosition=function(t,e){this.updateQuadWithParticle(t,e)},m.updateQuadWithParticle=function(t,e){var i=null,r=this._node;if(r._batchNode){var s=r._batchNode.textureAtlas.quads;i=s[r.atlasIndex+t.atlasIndex],r._batchNode.textureAtlas.dirty=!0}else i=this._quads[r._particleIdx];var o,a,c,h;r._opacityModifyRGB?(o=0|t.color.r*t.color.a/255,a=0|t.color.g*t.color.a/255,c=0|t.color.b*t.color.a/255):(o=0|t.color.r,a=0|t.color.g,c=0|t.color.b),h=0|t.color.a;var l=i.bl.colors,u=i.br.colors,d=i.tl.colors,_=i.tr.colors;l.r=u.r=d.r=_.r=o,l.g=u.g=d.g=_.g=a,l.b=u.b=d.b=_.b=c,l.a=u.a=d.a=_.a=h;var f=t.size/2;if(t.rotation){var p=-f,g=-f,m=f,v=f,y=e.x,T=e.y,C=-n.degreesToRadians(t.rotation),b=Math.cos(C),x=Math.sin(C),S=p*b-g*x+y,E=p*x+g*b+T,A=m*b-g*x+y,O=m*x+g*b+T,w=m*b-v*x+y,R=m*x+v*b+T,I=p*b-v*x+y,P=p*x+v*b+T;i.bl.vertices.x=S,i.bl.vertices.y=E,i.br.vertices.x=A,i.br.vertices.y=O,i.tl.vertices.x=I,i.tl.vertices.y=P,i.tr.vertices.x=w,i.tr.vertices.y=R}else i.bl.vertices.x=e.x-f,i.bl.vertices.y=e.y-f,i.br.vertices.x=e.x+f,i.br.vertices.y=e.y-f,i.tl.vertices.x=e.x-f,i.tl.vertices.y=e.y+f,i.tr.vertices.x=e.x+f,i.tr.vertices.y=e.y+f},m.rendering=function(t){var e=this._node;if(e._texture){var i=t||n._renderContext,r=this._worldTransform,s=this._matrix.mat;s[0]=r.a,s[4]=r.c,s[12]=r.tx,s[1]=r.b,s[5]=r.d,s[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),n.gl.bindTexture2DN(0,e._texture),n.gl.blendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),i.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_POSITION),i.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_COLOR),i.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_TEX_COORDS),i.bindBuffer(i.ARRAY_BUFFER,this._buffersVBO[0]),i.vertexAttribPointer(n.macro.VERTEX_ATTRIB_POSITION,3,i.FLOAT,!1,24,0),i.vertexAttribPointer(n.macro.VERTEX_ATTRIB_COLOR,4,i.UNSIGNED_BYTE,!0,24,12),i.vertexAttribPointer(n.macro.VERTEX_ATTRIB_TEX_COORDS,2,i.FLOAT,!1,24,16),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),i.drawElements(i.TRIANGLES,6*e._particleIdx,i.UNSIGNED_SHORT,0)}},m.initTexCoordsWithRect=function(t){var e=this._node,i=e.texture,r=t.width,s=t.height;i&&(r=i.getPixelWidth(),s=i.getPixelHeight());var o,a,c,h;n.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(2*t.x+1)/(2*r),a=(2*t.y+1)/(2*s),c=o+(2*t.width-2)/(2*r),h=a+(2*t.height-2)/(2*s)):(o=t.x/r,a=t.y/s,c=o+t.width/r,h=a+t.height/s);var l=h;h=a,a=l;var u,d=0,_=0;e._batchNode?(u=e._batchNode.textureAtlas.quads,d=e.atlasIndex,_=e.atlasIndex+e._totalParticles):(u=this._quads,d=0,_=e._totalParticles);for(var f=d;f<_;f++){u[f]||(u[f]=n.V3F_C4B_T2F_QuadZero());var p=u[f];p.bl.texCoords.u=o,p.bl.texCoords.v=a,p.br.texCoords.u=c,p.br.texCoords.v=a,p.tl.texCoords.u=o,p.tl.texCoords.v=h,p.tr.texCoords.u=c,p.tr.texCoords.v=h}},m.setTotalParticles=function(t){var e=this._node;if(t>e._allocatedParticles){var i=n.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*t);var r=new ArrayBuffer(t*i),s=e._particles;s.length=0;var o=this._quads;o.length=0;for(var a=0;a<t;a++)s[a]=new n.Particle,o[a]=new n.V3F_C4B_T2F_Quad(null,null,null,null,r,a*i);if(e._allocatedParticles=t,e._totalParticles=t,e._batchNode)for(var c=0;c<t;c++)s[c].atlasIndex=c;this._quadsArrayBuffer=r,this.initIndices(t),this._setupVBO(),e._texture&&this.initTexCoordsWithRect(n.rect(0,0,e._texture.width,e._texture.height))}else e._totalParticles=t;e.resetSystem()},m.addParticle=function(){var t=this._node,e=t._particles;return e[t.particleCount]},m._setupVBO=function(){var t=n._renderContext;this._buffersVBO[0]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),this._buffersVBO[1]=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},m._allocMemory=function(){var t=this._node;if(t._batchNode)return n.log("_ccsg.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var e=n.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=t._totalParticles,r=this._quads;r.length=0,this._indices=new Uint16Array(6*i);for(var s=new ArrayBuffer(e*i),o=0;o<i;o++)r[o]=new n.V3F_C4B_T2F_Quad(null,null,null,null,s,o*e);return r&&this._indices?(this._quadsArrayBuffer=s,!0):(n.log("cocos2d: Particle system: not enough memory"),!1)},m.postStep=function(){var t=n._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.bufferSubData(t.ARRAY_BUFFER,0,this._quadsArrayBuffer)},m._setBlendAdditive=function(){var t=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=n.macro.SRC_ALPHA,t.dst=n.macro.ONE_MINUS_SRC_ALPHA):(t.src=n.macro.BLEND_SRC,t.dst=n.macro.BLEND_DST)},m._initWithTotalParticles=function(t){return!!this._allocMemory()&&(this.initIndices(t),this._setupVBO(),void(this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_POSITION_TEXTURECOLOR)))},m._updateDeltaColor=function(t,e){t.color.r+=t.deltaColor.r*e,t.color.g+=t.deltaColor.g*e,t.color.b+=t.deltaColor.b*e,t.color.a+=t.deltaColor.a*e,t.isChangeColor=!0},n.ParticleBatchNode=_ccsg.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._blendFunc={src:n.macro.BLEND_SRC,dst:n.macro.BLEND_DST},n.js.isString(t)?this.init(t,e):t instanceof n.Texture2D&&this.initWithTexture(t,e)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.ParticleBatchNode.CanvasRenderCmd(this):new n.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){return this.textureAtlas=new n.TextureAtlas,this.textureAtlas.initWithTexture(t,e),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,e){var i=n.textureCache.addImage(t);return this.initWithTexture(i,e)},init:function(t,e){var i=n.textureCache.addImage(t);return this.initWithTexture(i,e)},addChild:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports _ccsg.ParticleSystem as children");if(e=null==e?t.zIndex:e,i=null==i?t.tag:i,t.getTexture()!==this.textureAtlas.texture)throw new Error("_ccsg.ParticleSystem.addChild() : the child is not using the same texture id");var r=t.getBlendFunc();if(0===this._children.length)this.setBlendFunc(r);else if(r.src!==this._blendFunc.src||r.dst!==this._blendFunc.dst)return void n.log("_ccsg.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");var s=this._addChildHelper(t,e,i),o=0;if(0!==s){var a=this._children[s-1];o=a.getAtlasIndex()+a.getTotalParticles()}else o=0;this.insertChild(t,o),t.setBatchNode(this)},insertChild:function(t,e){var i=t.getTotalParticles(),n=this.textureAtlas,r=n.totalQuads;t.setAtlasIndex(e),r+i>n.getCapacity()&&(this._increaseAtlasCapacityTo(r+i),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-i,i)),t.getAtlasIndex()+i!==r&&n.moveQuadsFromIndex(e,e+i),n.increaseTotalQuadsWith(i),this._updateAllAtlasIndexes()},removeChild:function(t,e){if(null!=t){if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports _ccsg.ParticleSystem as children");if(this._children.indexOf(t)===-1)return void n.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");_ccsg.Node.prototype.removeChild.call(this,t,e);var i=this.textureAtlas;i.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),i.fillWithEmptyQuadsFromIndex(i.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}},reorderChild:function(t,e){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof _ccsg.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(this._children.indexOf(t)===-1)return void n.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");if(e!==t.zIndex){if(this._children.length>1){var i=this._getCurrentIndex(t,e);if(i.oldIndex!==i.newIndex){this._children.splice(i.oldIndex,1),this._children.splice(i.newIndex,0,t);var r=t.getAtlasIndex();this._updateAllAtlasIndexes();for(var s=0,o=this._children,a=0;a<o.length;a++){var c=o[a];if(c===t){s=t.getAtlasIndex();break}}this.textureAtlas.moveQuadsFromIndex(r,t.getTotalParticles(),s),t.updateWithNoTime()}}t._setLocalZOrder(e)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,i=0;i<e.length;i++)e[i].setBatchNode(null);_ccsg.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){var e=this.textureAtlas.quads[t];e.br.vertices.x=e.br.vertices.y=e.tr.vertices.x=e.tr.vertices.y=e.tl.vertices.x=e.tl.vertices.y=e.bl.vertices.x=e.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&e.src===n.macro.BLEND_SRC&&e.dst===n.macro.BLEND_DST&&(e.src=n.macro.SRC_ALPHA,e.dst=n.macro.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=e)},getBlendFunc:function(){return new n.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,i=0;i<e.length;i++){var n=e[i];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){n.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),this.textureAtlas.resizeCapacity(t)||n.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,i=e.length,n=0;n<i;n++)if(e[n].zIndex>t)return n;return i},_getCurrentIndex:function(t,e){for(var i=!1,n=!1,r=0,s=0,o=0,a=this._children,c=a.length,h=0;h<c;h++){var l=a[h];if(l.zIndex>e&&!n&&(r=h,n=!0,i&&n))break;if(t===l&&(s=h,i=!0,n||(o=-1),i&&n))break}return n||(r=c),r+=o,{newIndex:r,oldIndex:s}},_addChildHelper:function(t,e,i){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return n.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var r=this._searchNewPositionInChildrenForZ(e);return this._children.splice(r,0,t),t.tag=i,t._setLocalZOrder(e),t.parent=this,this._running&&(t.onEnter(),t.onEnterTransitionDidFinish()),r},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=n.macro.SRC_ALPHA,this._blendFunc.dst=n.macro.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var b=n.ParticleBatchNode.prototype;b.texture,n.defineGetterSetter(b,"texture",b.getTexture,b.setTexture),n.ParticleBatchNode.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!1};var m=n.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=n.ParticleBatchNode.CanvasRenderCmd,m._initWithTexture=function(){},n.ParticleBatchNode.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new n.math.Matrix4,this._matrix.identity()};var m=n.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=n.ParticleBatchNode.WebGLRenderCmd,m.rendering=function(t){var e=this._node;if(0!==e.textureAtlas.totalQuads){var i=this._worldTransform,r=this._matrix.mat;r[0]=i.a,r[4]=i.c,r[12]=i.tx,r[1]=i.b,r[5]=i.d,r[13]=i.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),n.gl.blendFuncForParticle(e._blendFunc.src,e._blendFunc.dst),e.textureAtlas.drawQuads()}},m._initWithTexture=function(){this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_POSITION_TEXTURECOLOR)},m.visit=function(t){var e=this._node;e._visible&&(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),n.renderer.pushRenderCommand(this),this._dirtyFlag=0)},_ccsg.TMXTiledMap=_ccsg.Node.extend({properties:null,mapOrientation:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._mapSize=n.size(0,0),this._tileSize=n.size(0,0),void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getMapSize:function(){return n.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return n.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){for(var t=[],e=this._children,i=0,n=e.length;i<n;i++){var r=e[i];r&&r instanceof _ccsg.TMXObjectGroup&&t.push(r)}return t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||0===t.length)return!1;this.width=0,this.height=0;var e=new n.TMXMapInfo(t);if(!e)return!1;var i=e.getTilesets();return i&&0!==i.length||n.log("_ccsg.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename."),this._buildWithMapInfo(e),!0},initWithXML:function(t,e){this.width=0,this.height=0;var i=new n.TMXMapInfo(t,e),r=i.getTilesets();return r&&0!==r.length||n.log("_ccsg.TMXTiledMap.initWithXML(): Map not found. Please check the filename."),this._buildWithMapInfo(i),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.properties=t.properties,this._tileProperties=t.getTileProperties();for(var e=this._children,i=e.length,r=i-1;r>=0;r--){var s=e[r];s&&(s instanceof _ccsg.TMXLayer||s instanceof _ccsg.TMXObjectGroup)&&this.removeChild(s)}var o=0,a=t.getAllChildren();if(a&&a.length>0)for(var c=0,h=a.length;c<h;c++){var l,u=a[c];u instanceof n.TMXLayerInfo&&u.visible&&(l=this._parseLayer(u,t),this.addChild(l,o,o),this.width=Math.max(this.width,l.width),this.height=Math.max(this.height,l.height),o++),u instanceof n.TMXObjectGroupInfo&&(l=new _ccsg.TMXObjectGroup(u,t),this.addChild(l,o,o),o++)}},allLayers:function(){for(var t=[],e=this._children,i=0,n=e.length;i<n;i++){var r=e[i];r&&r instanceof _ccsg.TMXLayer&&t.push(r)}return t},getLayer:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var e=this._children,i=0;i<e.length;i++){var n=e[i];if(n&&n instanceof _ccsg.TMXLayer&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||0===t.length)throw new Error("_ccsg.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");for(var e=this._children,i=0;i<e.length;i++){var n=e[i];if(n&&n instanceof _ccsg.TMXObjectGroup&&n.groupName===t)return n}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){return n.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead."),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var i=this._tilesetForLayer(t,e),n=new _ccsg.TMXLayer(i,t,e);return t.ownTiles=!1,n},_tilesetForLayer:function(t,e){var i=t._layerSize,r=e.getTilesets();if(r)for(var s=r.length-1;s>=0;s--){var o=r[s];if(o)for(var a=0;a<i.height;a++)for(var c=0;c<i.width;c++){var h=c+i.width*a,l=t._tiles[h];if(0!==l&&(l&n.TiledMap.TileFlag.FLIPPED_MASK)>>>0>=o.firstGid)return o}}return n.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles"),null}});var b=_ccsg.TMXTiledMap.prototype;b.mapWidth,n.defineGetterSetter(b,"mapWidth",b._getMapWidth,b._setMapWidth),b.mapHeight,n.defineGetterSetter(b,"mapHeight",b._getMapHeight,b._setMapHeight),b.tileWidth,n.defineGetterSetter(b,"tileWidth",b._getTileWidth,b._setTileWidth),b.tileHeight,n.defineGetterSetter(b,"tileHeight",b._getTileHeight,b._setTileHeight),n.TMXLayerInfo=n._Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties={},this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=n.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}}),n.TMXObjectGroupInfo=n._Class.extend({properties:null,name:"",_objects:null,visible:null,_color:null,_opacity:null,offset:null,_draworder:"",ctor:function(){this.properties={},this.name="",this._objects=[],this.visible=!0,this._opacity=0,this._color=new n.Color(255,255,255,255),this.offset=n.p(0,0),this._draworder="topdown"},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}}),n.TMXTilesetInfo=n._Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,tileOffset:null,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=n.size(0,0),this.tileOffset=n.p(0,0),this.imageSize=n.size(0,0)},rectForGID:function(t,e){var i=e||n.rect(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height,t&=n.TiledMap.TileFlag.FLIPPED_MASK,t-=parseInt(this.firstGid,10);var r=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);return i.x=parseInt(t%r*(this._tileSize.width+this.spacing)+this.margin,10),i.y=parseInt(parseInt(t/r,10)*(this._tileSize.height+this.spacing)+this.margin,10),i}}),n.TMXMapInfo=n.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_allChildren:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_staggerAxis:null,_staggerIndex:null,_hexSideLength:0,ctor:function(t,e){n.SAXParser.prototype.ctor.apply(this),this._mapSize=n.size(0,0),this._tileSize=n.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this._allChildren=[],this.properties=[],this._tileProperties={},void 0!==e?this.initWithXML(t,e):void 0!==t&&this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getStaggerAxis:function(){return this._staggerAxis},setStaggerAxis:function(t){this._staggerAxis=t},getStaggerIndex:function(){return this._staggerIndex},setStaggerIndex:function(t){this._staggerIndex=t},getHexSideLength:function(){return this._hexSideLength},setHexSideLength:function(t){this._hexSideLength=t},getMapSize:function(){return n.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return n.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._allChildren.push(t),this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._allChildren.push(t),this._objectGroups.push(t)},getAllChildren:function(){return this._allChildren},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,e){return this._internalInit(null,e),this.parseXMLString(t)},parseXMLFile:function(t,e,i){e=e||!1;var r=e?t:n.loader.getRes(t);if(!r)throw new Error("Please load the resource first : "+t);var s,o,a=this._parseXML(r),c=a.documentElement,h=c.getAttribute("version"),l=c.getAttribute("orientation"),u=c.getAttribute("staggeraxis"),d=c.getAttribute("staggerindex"),_=c.getAttribute("hexsidelength");if("map"===c.nodeName){"1.0"!==h&&null!==h&&n.log("cocos2d: TMXFormat: Unsupported TMX version:"+h),"orthogonal"===l?this.orientation=n.TiledMap.Orientation.ORTHO:"isometric"===l?this.orientation=n.TiledMap.Orientation.ISO:"hexagonal"===l?this.orientation=n.TiledMap.Orientation.HEX:null!==l&&n.log("cocos2d: TMXFomat: Unsupported orientation:"+l),"x"===u?this.setStaggerAxis(n.TiledMap.StaggerAxis.STAGGERAXIS_X):"y"===u&&this.setStaggerAxis(n.TiledMap.StaggerAxis.STAGGERAXIS_Y),"odd"===d?this.setStaggerIndex(n.TiledMap.StaggerIndex.STAGGERINDEX_ODD):"even"===d&&this.setStaggerIndex(n.TiledMap.StaggerIndex.STAGGERINDEX_EVEN),_&&this.setHexSideLength(parseFloat(_));var f=n.size(0,0);f.width=parseFloat(c.getAttribute("width")),f.height=parseFloat(c.getAttribute("height")),this.setMapSize(f),f=n.size(0,0),f.width=parseFloat(c.getAttribute("tilewidth")),f.height=parseFloat(c.getAttribute("tileheight")),this.setTileSize(f);var p=c.querySelectorAll("map > properties >  property");if(p){var g={};for(s=0;s<p.length;s++)g[p[s].getAttribute("name")]=p[s].getAttribute("value");this.properties=g}}var m=c.getElementsByTagName("tileset");for("map"!==c.nodeName&&(m=[],m.push(c)),s=0;s<m.length;s++){var v=m[s],y=v.getAttribute("source");if(y){var T=parseInt(v.getAttribute("firstgid")),C=e?n.path.join(this._resources,y):n.path.changeBasename(t,y);this.parseXMLFile(C,!1,T)}else{var b=new n.TMXTilesetInfo;b.name=v.getAttribute("name")||"",i?b.firstGid=i:b.firstGid=parseInt(v.getAttribute("firstgid"))||0,b.spacing=parseInt(v.getAttribute("spacing"))||0,b.margin=parseInt(v.getAttribute("margin"))||0;var x=n.size(0,0);x.width=parseFloat(v.getAttribute("tilewidth")),x.height=parseFloat(v.getAttribute("tileheight")),b._tileSize=x;var S=v.getElementsByTagName("image")[0],E=S.getAttribute("source"),A=-1;if(this.tmxFileName&&(A=this.tmxFileName.lastIndexOf("/")),A!==-1){var O=this.tmxFileName.substr(0,A+1);b.sourceImage=O+E}else b.sourceImage=this._resources+(this._resources?"/":"")+E;this.setTilesets(b);var w=v.getElementsByTagName("tileoffset")[0];if(w){var R=parseFloat(w.getAttribute("x")),I=parseFloat(w.getAttribute("y"));b.tileOffset=n.p(R,I)}var P=v.getElementsByTagName("tile");if(P)for(var N=0;N<P.length;N++){var L=P[N];this.parentGID=parseInt(b.firstGid)+parseInt(L.getAttribute("id")||0);var F=L.querySelectorAll("properties > property");if(F){var D={};for(o=0;o<F.length;o++){var M=F[o].getAttribute("name");D[M]=F[o].getAttribute("value")}this._tileProperties[this.parentGID]=D}}}}var B=c.childNodes;for(s=0;s<B.length;s++){var k=B[s];if(!this._shouldIgnoreNode(k)){if("layer"===k.nodeName){var z=this._parseLayer(k);this.setLayers(z)}if("objectgroup"===k.nodeName){var V=this._parseObjectGroup(k);this.setObjectGroups(V)}}}return c},_shouldIgnoreNode:function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},_parseLayer:function(t){var e=t.getElementsByTagName("data")[0],i=new n.TMXLayerInfo;i.name=t.getAttribute("name");var r=n.size(0,0);r.width=parseFloat(t.getAttribute("width")),r.height=parseFloat(t.getAttribute("height")),i._layerSize=r;var s=t.getAttribute("visible");i.visible=!("0"==s);var o=t.getAttribute("opacity")||1;o?i._opacity=parseInt(255*parseFloat(o)):i._opacity=255,i.offset=n.p(parseFloat(t.getAttribute("x"))||0,parseFloat(t.getAttribute("y"))||0);var a="";for(y=0;y<e.childNodes.length;y++)a+=e.childNodes[y].nodeValue;a=a.trim();var c=e.getAttribute("compression"),l=e.getAttribute("encoding");if(c&&"gzip"!==c&&"zlib"!==c)return n.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;var u;switch(c){case"gzip":u=n.Codec.unzipBase64AsArray(a,4);break;case"zlib":var d=new Zlib.Inflate(n.Codec.Base64.decodeAsArray(a,1));u=h(d.decompress());break;case null:case"":if("base64"===l)u=n.Codec.Base64.decodeAsArray(a,4);else if("csv"===l){u=[];for(var _=a.split(","),f=0;f<_.length;f++)u.push(parseInt(_[f]))}else{var p=e.getElementsByTagName("tile");u=[];for(var g=0;g<p.length;g++)u.push(parseInt(p[g].getAttribute("gid")))}break;default:this.layerAttrs===n.TMXLayerInfo.ATTRIB_NONE&&n.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}u&&(i._tiles=new Uint32Array(u));var m=t.querySelectorAll("properties > property");if(m){for(var v={},y=0;y<m.length;y++)v[m[y].getAttribute("name")]=m[y].getAttribute("value");i.properties=v}return i},_parseObjectGroup:function(t){var e=new n.TMXObjectGroupInfo;e.name=t.getAttribute("name")||"",e.offset=n.p(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var i=t.getAttribute("opacity")||1;i?e._opacity=parseInt(255*parseFloat(i)):e._opacity=255;var r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);var s=t.getAttribute("color");s&&(e._color=n.hexToColor(s));var o=t.getAttribute("draworder");o&&(e._draworder=o);var a=t.querySelectorAll("objectgroup > properties > property");if(a){var c={};for(j=0;j<a.length;j++)c[a[j].getAttribute("name")]=a[j].getAttribute("value");e.setProperties(c)}var h=t.querySelectorAll("object"),l=n.director.getContentScaleFactor();if(h)for(j=0;j<h.length;j++){var u=h[j],d={};d.id=u.getAttribute("id")||0,d.name=u.getAttribute("name")||"",d.width=parseFloat(u.getAttribute("width"))||0,d.height=parseFloat(u.getAttribute("height"))||0,d.x=(u.getAttribute("x")||0)/l,d.y=(u.getAttribute("y")||0)/l,d.rotation=parseFloat(u.getAttribute("rotation"))||0;var _=u.querySelectorAll("properties > property");if(_)for(var f=0;f<_.length;f++)d[_[f].getAttribute("name")]=_[f].getAttribute("value");var p=u.getAttribute("visible");d.visible=!(p&&0===parseInt(p));var g=u.getAttribute("gid");g&&(d.gid=parseInt(g),d.type=n.TiledMap.TMXObjectType.IMAGE);var m=u.querySelectorAll("ellipse");m&&m.length>0&&(d.type=n.TiledMap.TMXObjectType.ELLIPSE);var v=u.querySelectorAll("polygon");if(v&&v.length>0){d.type=n.TiledMap.TMXObjectType.POLYGON;var y=v[0].getAttribute("points");y&&(d.points=this._parsePointsString(y))}var T=u.querySelectorAll("polyline");if(T&&T.length>0){d.type=n.TiledMap.TMXObjectType.POLYLINE;var C=T[0].getAttribute("points");C&&(d.polylinePoints=this._parsePointsString(C))}d.type||(d.type=n.TiledMap.TMXObjectType.RECT),e._objects.push(d)}return e},_parsePointsString:function(t){if(!t)return null;for(var e=[],i=t.split(" "),n=0;n<i.length;n++){var r=i[n].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,e){this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,e&&(this._resources=e),this._objectGroups.length=0,this._allChildren.length=0,this.properties.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=n.TMXLayerInfo.ATTRIB_NONE,this.parentElement=n.TiledMap.NONE}});var b=n.TMXMapInfo.prototype;b.mapWidth,n.defineGetterSetter(b,"mapWidth",b._getMapWidth,b._setMapWidth),b.mapHeight,n.defineGetterSetter(b,"mapHeight",b._getMapHeight,b._setMapHeight),b.tileWidth,n.defineGetterSetter(b,"tileWidth",b._getTileWidth,b._setTileWidth),b.tileHeight,n.defineGetterSetter(b,"tileHeight",b._getTileHeight,b._setTileHeight),n.TMXMapInfo.create=function(t,e){return new n.TMXMapInfo(t,e)},n.TMXLayerInfo.ATTRIB_NONE=1,n.TMXLayerInfo.ATTRIB_BASE64=2,n.TMXLayerInfo.ATTRIB_GZIP=4,n.TMXLayerInfo.ATTRIB_ZLIB=8,_ccsg.TMXObjectGroup=_ccsg.Node.extend({properties:null,groupName:"",_positionOffset:null,_mapInfo:null,_objects:[],ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._initGroup(t,e)},_initGroup:function(t,e){this.groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this.properties=t.getProperties();var i=e._mapSize,r=e._tileSize;if(e.orientation===n.TiledMap.Orientation.HEX){var s=0,o=0;e.getStaggerAxis()===n.TiledMap.StaggerAxis.STAGGERAXIS_X?(o=r.height*(i.height+.5),s=(r.width+e.getHexSideLength())*Math.floor(i.width/2)+r.width*(i.width%2)):(s=r.width*(i.width+.5),o=(r.height+e.getHexSideLength())*Math.floor(i.height/2)+r.height*(i.height%2)),this.setContentSize(s,o)}else this.setContentSize(i.width*r.width,i.height*r.height);
this.setAnchorPoint(n.p(0,0)),this.setPosition(this._positionOffset.x,-this._positionOffset.y),this.setVisible(t.visible);var a=[];t._objects instanceof Array&&(a=t._objects),this._objects=[];for(var c=0,h=a.length;c<h;c++){var l=a[c],u=new _ccsg.TMXObject;u.initWithInfo(l,e,this.getContentSize(),t._color),this._objects.push(u),u.sgNode&&(u.sgNode.setOpacity(t._opacity),this.addChild(u.sgNode,c,c))}},getPositionOffset:function(){return n.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},getGroupName:function(){return this.groupName},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){for(var e=0,i=this._objects.length;e<i;e++){var n=this._objects[e];if(n&&n.getObjectName()===t)return n}return null},getObjects:function(){return this._objects}}),_ccsg.TMXObject=n.Class({properties:{sgNode:null,offset:n.p(0,0),gid:0,name:"",type:null,id:0,objectVisible:!0,objectSize:n.size(0,0),objectRotation:0,_properties:null,_groupSize:n.size(0,0)},initWithInfo:function(t,e,i,r){this.setProperties(t),this.setObjectName(t.name),this.id=t.id,this.gid=t.gid,this.type=t.type,this.offset=n.p(t.x,t.y),this.objectSize=n.size(t.width,t.height),this.objectVisible=t.visible,this.objectRotation=t.rotation,this._groupSize=i,this.type===n.TiledMap.TMXObjectType.IMAGE?this.sgNode=new _ccsg.TMXObjectImage(this,e):this.sgNode=new _ccsg.TMXObjectShape(this,e,r)},getObjectName:function(){return this.name},getProperty:function(t){return this._properties[t]},getProperties:function(){return this._properties},setObjectName:function(t){this.name=t},setProperties:function(t){this._properties=t}}),_ccsg.TMXObjectImage=_ccsg.Sprite.extend({_container:null,ctor:function(t,e){_ccsg.Sprite.prototype.ctor.call(this),this._container=t,this.initWithMapInfo(e)},initWithMapInfo:function(t){if(!this._container.gid)return!1;for(var e,i=t.getTilesets(),r=i.length-1;r>=0;r--){var s=i[r];if((this._container.gid&n.TiledMap.TileFlag.FLIPPED_MASK)>>>0>=s.firstGid){e=s;break}}if(!e)return!1;this.setVisible(this._container.objectVisible);var o=n.textureCache.addImage(n.path._normalize(s.sourceImage));return this._initWithTileset(o,e),this._initPosWithMapInfo(t),this.setRotation(this._container.objectRotation),(this._container.gid&n.TiledMap.TileFlag.HORIZONTAL)>>>0&&this.setFlippedX(!0),(this._container.gid&n.TiledMap.TileFlag.VERTICAL)>>>0&&this.setFlippedY(!0),!0},_initWithTileset:function(t,e){if(!t.isLoaded())return void t.once("load",function(){this._initWithTileset(t,e)},this);e.imageSize.width=t.width,e.imageSize.height=t.height;var i=e.rectForGID(this._container.gid);this.initWithTexture(t,i),this.setScaleX(this._container.objectSize.width/i.size.width),this.setScaleY(this._container.objectSize.height/i.size.height)},_initPosWithMapInfo:function(t){var e=t.getOrientation();switch(e){case n.TiledMap.Orientation.ORTHO:case n.TiledMap.Orientation.HEX:this.setAnchorPoint(n.p(0,0)),this.setPosition(this._container.offset.x,this._container._groupSize.height-this._container.offset.y);break;case n.TiledMap.Orientation.ISO:this.setAnchorPoint(n.p(.5,0));var i=n.p(this._container.offset.x/t._tileSize.height,this._container.offset.y/t._tileSize.height),r=n.p(t._tileSize.width/2*(t._mapSize.width+i.x-i.y),t._tileSize.height/2*(2*t._mapSize.height-i.x-i.y));this.setPosition(r)}}}),_ccsg.TMXObjectShape=n.DrawNode.extend({_container:null,_color:n.Color.WHITE,_mapOrientation:0,_mapInfo:null,ctor:function(t,e,i){n.DrawNode.prototype.ctor.call(this),this.setLineWidth(1),this._container=t,this._color=i,this._mapInfo=e,this._mapOrientation=e.getOrientation(),this._initShape()},_initShape:function(){var t;if(n.TiledMap.Orientation.ISO!==this._mapOrientation){var e=n.p(0,this._container._groupSize.height);t=n.p(e.x+this._container.offset.x,e.y-this._container.offset.y)}else t=this._getPosByOffset(n.p(0,0));switch(this.setPosition(t),this.setRotation(this._container.objectRotation),this._container.type){case n.TiledMap.TMXObjectType.RECT:this._drawRect();break;case n.TiledMap.TMXObjectType.ELLIPSE:this._drawEllipse();break;case n.TiledMap.TMXObjectType.POLYGON:this._drawPoly(t,!0);break;case n.TiledMap.TMXObjectType.POLYLINE:this._drawPoly(t,!1)}this.setVisible(this._container.objectVisible)},_getPosByOffset:function(t){var e=this._mapInfo.getMapSize(),i=this._mapInfo.getTileSize(),r=n.p((this._container.offset.x+t.x)/i.width*2,(this._container.offset.y+t.y)/i.height);return n.p(i.width/2*(e.width+r.x-r.y),i.height/2*(2*e.height-r.x-r.y))},_drawRect:function(){if(n.TiledMap.Orientation.ISO!==this._mapOrientation){var t=this._container.objectSize;t.equals(n.Size.ZERO)?(t=n.size(20,20),this.setAnchorPoint(n.p(.5,.5))):this.setAnchorPoint(n.p(0,1));var e=n.p(0,0),i=n.p(t.width,t.height);this.drawRect(e,i,null,this.getLineWidth(),this._color),this.setContentSize(t)}else{if(this._container.objectSize.equals(n.Size.ZERO))return;var r=this._getPosByOffset(n.p(0,0)),s=this._getPosByOffset(n.p(this._container.objectSize.width,0)),o=this._getPosByOffset(n.p(this._container.objectSize.width,this._container.objectSize.height)),a=this._getPosByOffset(n.p(0,this._container.objectSize.height)),c=s.x-a.x,h=r.y-o.y;this.setContentSize(n.size(c,h)),this.setAnchorPoint(n.p((r.x-a.x)/c,1));var l=n.p(a.x,o.y);r.subSelf(l),s.subSelf(l),o.subSelf(l),a.subSelf(l),this._container.objectSize.width>0&&(this.drawSegment(r,s,this.getLineWidth(),this._color),this.drawSegment(o,a,this.getLineWidth(),this._color)),this._container.objectSize.height>0&&(this.drawSegment(r,a,this.getLineWidth(),this._color),this.drawSegment(o,s,this.getLineWidth(),this._color))}},_drawEllipse:function(){var t=1,e=1,i=0,r=n.p(0,0),s=null;if(n.TiledMap.Orientation.ISO!==this._mapOrientation){var o=this._container.objectSize;o.equals(n.Size.ZERO)?(o=n.size(20,20),this.setAnchorPoint(n.p(.5,.5))):this.setAnchorPoint(n.p(0,1)),r=n.p(o.width/2,o.height/2),o.width>o.height?(t=o.width/o.height,i=o.height/2):(e=o.height/o.width,i=o.width/2),s=this,this.setContentSize(o)}else{if(this._container.objectSize.equals(n.Size.ZERO))return;var a=this._getPosByOffset(n.p(0,0)),c=this._getPosByOffset(n.p(this._container.objectSize.width,0)),h=this._getPosByOffset(n.p(this._container.objectSize.width,this._container.objectSize.height)),l=this._getPosByOffset(n.p(0,this._container.objectSize.height)),u=c.x-l.x,d=a.y-h.y;this.setContentSize(n.size(u,d)),this.setAnchorPoint(n.p((a.x-l.x)/u,1));var _=n.p(l.x,h.y);a.subSelf(_),c.subSelf(_),h.subSelf(_),l.subSelf(_),this._container.objectSize.width>0&&(this.drawSegment(a,c,this.getLineWidth(),this._color),this.drawSegment(h,l,this.getLineWidth(),this._color)),this._container.objectSize.height>0&&(this.drawSegment(a,l,this.getLineWidth(),this._color),this.drawSegment(h,c,this.getLineWidth(),this._color)),r=this._getPosByOffset(n.p(this._container.objectSize.width/2,this._container.objectSize.height/2)),r.subSelf(_),s=new n.DrawNode,s.setLineWidth(this.getLineWidth()),s.setContentSize(n.size(u,d)),s.setAnchorPoint(n.p(.5,.5)),s.setPosition(r),this.addChild(s),this._container.objectSize.width>this._container.objectSize.height?(t=this._container.objectSize.width/this._container.objectSize.height,i=this._container.objectSize.height/2):(e=this._container.objectSize.height/this._container.objectSize.width,i=this._container.objectSize.width/2);var f=this._mapInfo.getTileSize(),p=Math.atan(f.width/f.height);i/=Math.sin(p),s.setRotationX(n.radiansToDegrees(p)),s.setRotationY(90-n.radiansToDegrees(p))}s.drawCircle(r,i,0,50,!1,this.getLineWidth(),this._color),s.setScaleX(t),s.setScaleY(e)},_drawPoly:function(t,e){var i,r=this._container.getProperties();i=e?r.points:r.polylinePoints;for(var s=[],o=0,a=0,c=0,h=0,l=0,u=i.length;l<u;l++){var d=i[l];s.push(n.p(d.x,d.y)),o=Math.min(o,d.x),a=Math.min(a,d.y),c=Math.max(c,d.x),h=Math.max(h,d.y)}var _=0,f=0;if(n.TiledMap.Orientation.ISO!==this._mapOrientation){_=c-o,f=h-a,this.setAnchorPoint(n.p(-o/_,h/f));for(var p=0;p<s.length;p++)s[p]=n.p(s[p].x-o,-s[p].y+h)}else{var g=this._getPosByOffset(n.p(o,h)),m=this._getPosByOffset(n.p(c,a)),v=this._getPosByOffset(n.p(0,0));_=m.x-g.x,f=m.y-g.y,this.setAnchorPoint(n.p((v.x-g.x)/_,(v.y-g.y)/f));for(var y=0;y<s.length;y++){var T=this._getPosByOffset(s[y]);s[y]=n.p(T.x-g.x,T.y-g.y)}}this.setContentSize(n.size(_,f)),this.drawPoly(s,null,this.getLineWidth(),this._color,!e)}}),_ccsg.TMXLayer=_ccsg.Node.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_texture:null,_textures:null,_texGrids:null,_spriteTiles:null,_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_staggerAxis:null,_staggerIndex:null,_hexSideLength:0,_className:"TMXLayer",ctor:function(t,e,i){n.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=n.size(0,0),this._mapTileSize=n.size(0,0),this._spriteTiles={},this._staggerAxis=n.TiledMap.StaggerAxis.STAGGERAXIS_Y,this._staggerIndex=n.TiledMap.StaggerIndex.STAGGERINDEX_EVEN,void 0!==i&&this.initWithTilesetInfo(t,e,i)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.TMXLayer.CanvasRenderCmd(this):new _ccsg.TMXLayer.WebGLRenderCmd(this)},_fillTextureGrids:function(t,e){var i=this._textures[e];if(!i.isLoaded())return void i.once("load",function(){this._fillTextureGrids(t,e)},this);t.imageSize.width&&t.imageSize.height||(t.imageSize.width=i.width,t.imageSize.height=i.height);for(var r=t._tileSize.width,s=t._tileSize.height,o=i._contentSize.width,a=i._contentSize.height,c=t.spacing,h=t.margin,l=Math.floor((o-2*h+c)/(r+c)),u=Math.floor((a-2*h+c)/(s+c)),d=u*l,_=t.firstGid,f=t.firstGid+d,p=this._texGrids,g=null,m=!!p[_],v=n.macro.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;_<f&&(m&&!p[_]&&(m=!1),m||!p[_]);++_)g={texId:e,x:0,y:0,width:r,height:s,t:0,l:0,r:0,b:0},t.rectForGID(_,g),g.x+=v,g.y+=v,g.width-=2*v,g.height-=2*v,g.t=g.y/a,g.l=g.x/o,g.r=(g.x+g.width)/o,g.b=(g.y+g.height)/a,p[_]=g},initWithTilesetInfo:function(t,e,i){var r=e._layerSize;this.layerName=e.name,this.tiles=e._tiles,this.properties=e.properties,this._layerSize=r,this._minGID=e._minGID,this._maxGID=e._maxGID,this._opacity=e._opacity,this._staggerAxis=i.getStaggerAxis(),this._staggerIndex=i.getStaggerIndex(),this._hexSideLength=i.getHexSideLength(),this.tileset=t,this.layerOrientation=i.orientation,this._mapTileSize=i.getTileSize();var s=i._tilesets;if(s){var o,a,c,h=s.length;for(this._textures=new Array(h),this._texGrids=[],o=0;o<h;++o)a=s[o],c=n.textureCache.addImage(a.sourceImage),this._textures[o]=c,this._fillTextureGrids(a,o),a===t&&(this._texture=c)}var l=this._calculateLayerOffset(e.offset);if(this.setPosition(l),this._parseInternalProperties(),this.layerOrientation===n.TiledMap.Orientation.HEX){var u=0,d=0;this._staggerAxis===n.TiledMap.StaggerAxis.STAGGERAXIS_X?(d=i._tileSize.height*(this._layerSize.height+.5),u=(i._tileSize.width+this._hexSideLength)*Math.floor(this._layerSize.width/2)+i._tileSize.width*(this._layerSize.width%2)):(u=i._tileSize.width*(this._layerSize.width+.5),d=(i._tileSize.height+this._hexSideLength)*Math.floor(this._layerSize.height/2)+i._tileSize.height*(this._layerSize.height%2)),this.setContentSize(u,d)}else this.setContentSize(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height);return this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0},getLayerSize:function(){return n.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return n.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileSet:function(){return this.tileset},setTileSet:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},getProperty:function(t){return this.properties[t]},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},releaseMap:function(){this._spriteTiles={}},getTileAt:function(t,e){if(void 0===t)throw new Error("_ccsg.TMXLayer.getTileAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),i>=this._layerSize.width||e>=this._layerSize.height||i<0||e<0)throw new Error("_ccsg.TMXLayer.getTileAt(): invalid position");if(!this.tiles)return n.log("_ccsg.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var r=null,s=this.getTileGIDAt(i,e);if(0===s)return r;var o=Math.floor(i)+Math.floor(e)*this._layerSize.width;if(r=this._spriteTiles[o],!r){var a=this._texGrids[s],c=this._textures[a.texId];r=new _ccsg.Sprite(c,a),r.setPosition(this.getPositionAt(i,e));var h=this._vertexZForPos(i,e);r.setVertexZ(h),r.setAnchorPoint(0,0),r.setOpacity(this._opacity),this.addChild(r,h,o)}return r},getTileGIDAt:function(t,e){if(void 0===t)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): pos should be non-null");var i=t;if(void 0===e&&(i=t.x,e=t.y),i>=this._layerSize.width||e>=this._layerSize.height||i<0||e<0)throw new Error("_ccsg.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles)return n.log("_ccsg.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null;var r=Math.floor(i)+Math.floor(e)*this._layerSize.width,s=this.tiles[r];return(s&n.TiledMap.TileFlag.FLIPPED_MASK)>>>0},setTileGID:function(t,e,i,r){if(void 0===e)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var s;if(void 0===r&&e instanceof n.Vec2?(s=e,r=i):s=n.p(e,i),s.x=Math.floor(s.x),s.y=Math.floor(s.y),s.x>=this._layerSize.width||s.y>=this._layerSize.height||s.x<0||s.y<0)throw new Error("_ccsg.TMXLayer.setTileGID(): invalid position");if(!this.tiles)return void n.log("_ccsg.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released");if(0!==t&&t<this.tileset.firstGid)return void n.log("_ccsg.TMXLayer.setTileGID(): invalid gid:"+t);r=r||0;var o=this.getTileFlagsAt(s),a=this.getTileGIDAt(s);if(a!==t||o!==r){var c=(t|r)>>>0;if(0===t)this.removeTileAt(s);else if(0===a)this._updateTileForGID(c,s);else{var h=s.x+s.y*this._layerSize.width,l=this.getChildByTag(h);if(l){var u=this._texGrids[t],d=this._textures[u.texId];l.setTexture(d),l.setTextureRect(u,!1),null!=r&&this._setupTileSprite(l,s,c),this.tiles[h]=c}else this._updateTileForGID(c,s)}}},addChild:function(t,e,i){_ccsg.Node.prototype.addChild.call(this,t,e,i),void 0!==i&&(this._spriteTiles[i]=t,t._vertexZ=this._vertexZ+n.renderer.assignedZStep*i/this.tiles.length)},removeChild:function(t,e){this._spriteTiles[t.tag]&&(this._spriteTiles[t.tag]=null),_ccsg.Node.prototype.removeChild.call(this,t,e)},getTileFlagsAt:function(t,e){if(!t)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles)return n.log("_ccsg.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null;var i=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width,r=this.tiles[i];return(r&n.TiledMap.TileFlag.FLIPPED_ALL)>>>0},removeTileAt:function(t,e){if(!t)throw new Error("_ccsg.TMXLayer.removeTileAt(): pos should be non-null");if(void 0!==e&&(t=n.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("_ccsg.TMXLayer.removeTileAt(): invalid position");if(!this.tiles)return void n.log("_ccsg.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");var i=this.getTileGIDAt(t);if(0!==i){var r=Math.floor(t.x)+Math.floor(t.y)*this._layerSize.width;this.tiles[r]=0;var s=this._spriteTiles[r];s&&this.removeChild(s,!0)}},getPositionAt:function(t,e){void 0!==e&&(t=n.p(t,e)),t.x=Math.floor(t.x),t.y=Math.floor(t.y);var i=n.p(0,0);switch(this.layerOrientation){case n.TiledMap.Orientation.ORTHO:i=this._positionForOrthoAt(t);break;case n.TiledMap.Orientation.ISO:i=this._positionForIsoAt(t);break;case n.TiledMap.Orientation.HEX:i=this._positionForHexAt(t)}return i},_positionForIsoAt:function(t){return n.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-t.x-t.y-2))},_positionForOrthoAt:function(t){return n.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var e=n.p(0,0),i=this.tileset.tileOffset,r=this._staggerIndex===n.TiledMap.StaggerIndex.STAGGERINDEX_ODD?1:-1;switch(this._staggerAxis){case n.TiledMap.StaggerAxis.STAGGERAXIS_Y:var s=0;t.y%2===1&&(s=this._mapTileSize.width/2*r),e=n.p(t.x*this._mapTileSize.width+s+i.x,(this._layerSize.height-t.y-1)*(this._mapTileSize.height-(this._mapTileSize.height-this._hexSideLength)/2)-i.y);break;case n.TiledMap.StaggerAxis.STAGGERAXIS_X:var o=0;t.x%2===1&&(o=this._mapTileSize.height/2*-r),e=n.p(t.x*(this._mapTileSize.width-(this._mapTileSize.width-this._hexSideLength)/2)+i.x,(this._layerSize.height-t.y-1)*this._mapTileSize.height+o-i.y)}return e},_calculateLayerOffset:function(t){var e=n.p(0,0);switch(this.layerOrientation){case n.TiledMap.Orientation.ORTHO:e=n.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case n.TiledMap.Orientation.ISO:e=n.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case n.TiledMap.Orientation.HEX:if(this._staggerAxis===n.TiledMap.StaggerAxis.STAGGERAXIS_Y){var i=this._staggerIndex===n.TiledMap.StaggerIndex.STAGGERINDEX_EVEN?this._mapTileSize.width/2:0;e=n.p(t.x*this._mapTileSize.width+i,-t.y*(this._mapTileSize.height-(this._mapTileSize.width-this._hexSideLength)/2))}else if(this._staggerAxis===n.TiledMap.StaggerAxis.STAGGERAXIS_X){var r=this._staggerIndex===n.TiledMap.StaggerIndex.STAGGERINDEX_ODD?this._mapTileSize.height/2:0;e=n.p(t.x*(this._mapTileSize.width-(this._mapTileSize.width-this._hexSideLength)/2),-t.y*this._mapTileSize.height+r)}}return e},_updateTileForGID:function(t,e){if(this._texGrids[t]){var i=0|e.x+e.y*this._layerSize.width;i<this.tiles.length&&(this.tiles[i]=t)}},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if("automatic"===t){this._useAutomaticVertexZ=!0;var e=this.getProperty("cc_alpha_func"),i=0;e&&(i=parseFloat(e)),n._renderType===n.game.RENDER_TYPE_WEBGL&&(this.shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(n.UNIFORM_ALPHA_TEST_VALUE_S,i))}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,e,i){var r=this.getPositionAt(e);if(t.setPosition(r),t.setVertexZ(this._vertexZForPos(e)),t.setAnchorPoint(0,0),t.setOpacity(this._opacity),t.setFlippedX(!1),t.setFlippedY(!1),t.setRotation(0),(i&n.TiledMap.TileFlag.DIAGONAL)>>>0){t.setAnchorPoint(.5,.5),t.setPosition(r.x+t.width/2,r.y+t.height/2);var s=(i&(n.TiledMap.TileFlag.HORIZONTAL|n.TiledMap.TileFlag.VERTICAL)>>>0)>>>0;s===n.TiledMap.TileFlag.HORIZONTAL?t.setRotation(90):s===n.TiledMap.TileFlag.VERTICAL?t.setRotation(270):s===(n.TiledMap.TileFlag.VERTICAL|n.TiledMap.TileFlag.HORIZONTAL)>>>0?(t.setRotation(90),t.setFlippedX(!0)):(t.setRotation(270),t.setFlippedX(!0))}else(i&n.TiledMap.TileFlag.HORIZONTAL)>>>0&&t.setFlippedX(!0),(i&n.TiledMap.TileFlag.VERTICAL)>>>0&&t.setFlippedY(!0)},_vertexZForPos:function(t,e){void 0===e&&(e=t.y,t=t.x);var i=0,r=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case n.TiledMap.Orientation.ISO:r=this._layerSize.width+this._layerSize.height,i=-(r-(t+e));break;case n.TiledMap.Orientation.ORTHO:i=-(this._layerSize.height-e);break;case n.TiledMap.Orientation.HEX:n.log("TMX Hexa zOrder not supported");break;default:n.log("TMX invalid value")}else i=this._vertexZvalue;return i}});var J=null,$=null,tt=null,et=null,it=null;_ccsg.TMXLayer.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,J||(J=n.TiledMap.Orientation,$=n.TiledMap.TileFlag,tt=$.FLIPPED_MASK,et=n.TiledMap.StaggerAxis,it=n.TiledMap.StaggerIndex)};var m=_ccsg.TMXLayer.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=_ccsg.TMXLayer.CanvasRenderCmd,m.visit=function(t){var e=this._node,i=n.renderer;if(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),e._visible){isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t);var r,s,o=e._children,a=e._spriteTiles,c=o.length;if(c>0){for(e.sortAllChildren(),s=0;s<c&&(r=o[s],r._localZOrder<0);s++)r._renderCmd.visit(this);for(i.pushRenderCommand(this);s<c;s++)r=o[s],0===r._localZOrder&&a[r.tag]?(isNaN(r._customZ)&&(r._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),r._renderCmd.updateStatus()):r._renderCmd.visit(this)}else i.pushRenderCommand(this);this._dirtyFlag=0}},m.rendering=function(t,e,i){var r=this._node,s=r._rotationX||r._rotationY,o=r.layerOrientation,a=r.tiles,c=r._opacity/255;if(a&&!(c<=0)){var h=r._mapTileSize.width,l=r._mapTileSize.height,u=r.tileset._tileSize.width/n.director._contentScaleFactor,d=r.tileset._tileSize.height/n.director._contentScaleFactor,_=u-h,f=d-l,p=n.winSize.width,g=n.winSize.height,m=r._layerSize.height,v=r._layerSize.width,y=r._texGrids,T=r._spriteTiles,C=this._worldTransform,b=r._position.x,x=r._position.y,S=C.a,E=C.b,A=C.c,O=C.d,w=b*S+x*A+C.tx,R=b*E+x*O+C.ty,I=t||n._renderContext,P=I.getContext(),N=0,L=0,F=v,D=m;s||o!==J.ORTHO||(N=Math.floor(-(w-_*S)/(h*S)),L=Math.floor((R-f*O+l*m*O-g)/(l*O)),F=Math.ceil((p-w+_*S)/(h*S)),D=m-Math.floor(-(R+f*O)/(l*O)),N<0&&(N=0),L<0&&(L=0),F>v&&(F=v),D>m&&(D=m));var M,B,k,z,V,W,U,G,X,j,Y,H,Q,q,Z,K,nt=L*v,rt=u,st=d,ot=u*S,at=d*O,ct=!1,ht=!1;z=nt+N;for(M in T)if(M<z&&T[M])G=T[M]._renderCmd,0===T[M]._localZOrder&&G.rendering&&T[M]._visible&&G.rendering(t,e,i);else if(M>=z)break;I.setTransform(C,e,i),I.setGlobalAlpha(c);var lt,ut,dt,_t,ft;if(o===J.HEX){var pt=r._staggerIndex,gt=r._hexSideLength;lt=r._staggerAxis,ut=r.tileset.tileOffset,dt=pt===it.STAGGERINDEX_ODD?1:-1,_t=lt===et.STAGGERAXIS_X?(h-gt)/2:0,ft=lt===et.STAGGERAXIS_Y?(l-gt)/2:0}for(B=L;B<D;++B){for(k=N;k<F;++k)if(z=nt+k,T[z])G=T[z]._renderCmd,0===T[z]._localZOrder&&G.rendering&&T[z]._visible&&(G.rendering(t,e,i),I.setTransform(C,e,i),I.setGlobalAlpha(c));else if(V=r.tiles[z],W=y[(V&tt)>>>0],W&&(U=r._textures[W.texId],U&&U._htmlElementObj)){switch(o){case J.ORTHO:j=k*h,Y=-(m-B-1)*l;break;case J.ISO:j=h/2*(v+k-B-1),Y=-l/2*(2*m-k-B-2);break;case J.HEX:var mt=lt===et.STAGGERAXIS_Y&&B%2===1?h/2*dt:0;j=k*(h-_t)+mt+ut.x;var vt=lt===et.STAGGERAXIS_X&&k%2===1?l/2*-dt:0;Y=-(m-B-1)*(l-ft)-vt+ut.y}if(H=j+u,X=Y-d,!s&&o===J.ISO){if(Z=-R+Y*O,Z<-g-at){k+=Math.floor(2*(-g-Z)/at)-1;continue}if(K=w+H*S,K<-ot){k+=Math.floor(2*-K/ot)-1;continue}if(q=w+j*S,Q=-R+X*O,q>p||Q>0){k=F;continue}}V>$.DIAGONAL&&(ct=(V&$.HORIZONTAL)>>>0,ht=(V&$.VERTICAL)>>>0),ct&&(j=-H,P.scale(-1,1)),ht&&(X=-Y,P.scale(1,-1)),P.drawImage(U._htmlElementObj,W.x,W.y,W.width,W.height,j,X,rt,st),ct&&P.scale(-1,1),ht&&P.scale(1,-1),n.g_NumberOfDraws++}nt+=v}for(M in T)M>z&&T[M]&&(G=T[M]._renderCmd,0===T[M]._localZOrder&&G.rendering&&T[M]._visible&&G.rendering(t,e,i))}};var J=null,$=null,tt=null,et=null,it=null;_ccsg.TMXLayer.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._color=new Uint32Array(1),this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);var e=90*Math.PI/180;this._sin90=Math.sin(e),this._cos90=Math.cos(e),e=3*e,this._sin270=Math.sin(e),this._cos270=Math.cos(e),J||(J=n.TiledMap.Orientation,$=n.TiledMap.TileFlag,tt=$.FLIPPED_MASK,et=n.TiledMap.StaggerAxis,it=n.TiledMap.StaggerIndex)};var m=_ccsg.TMXLayer.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=_ccsg.TMXLayer.WebGLRenderCmd,m.uploadData=function(t,e,i){var r=this._node,s=r._rotationX||r._rotationY,o=r.layerOrientation,a=r.tiles;if(!a)return 0;var c=r._mapTileSize.width,h=r._mapTileSize.height,l=r.tileset._tileSize.width/n.director._contentScaleFactor,u=r.tileset._tileSize.height/n.director._contentScaleFactor,d=l-c,_=u-h,f=n.winSize.width,p=n.winSize.height,g=r._layerSize.height,m=r._layerSize.width,v=r._texGrids,y=r._spriteTiles,T=this._worldTransform,C=T.a,b=T.b,x=T.c,S=T.d,E=T.tx,A=T.ty,O=r._position.x,w=r._position.y,R=O*C+w*x+E,I=O*b+w*S+A,P=r._opacity,N=this._displayedColor.r,L=this._displayedColor.g,F=this._displayedColor.b;if(r._opacityModifyRGB){var D=P/255;N*=D,L*=D,F*=D}this._color[0]=P<<24|F<<16|L<<8|N;var M=0,B=0,k=m,z=g;s||o!==J.ORTHO||(M=Math.floor(-(R-d*C)/(c*C)),B=Math.floor((I-_*S+h*g*S-p)/(h*S)),k=Math.ceil((f-R+d*C)/(c*C)),z=g-Math.floor(-(I+_*S)/(h*S)),M<0&&(M=0),B<0&&(B=0),k>m&&(k=m),z>g&&(z=g));var V,W,U,G,X,j,Y,H,Q,q,Z,K,nt,rt,st,ot,at,ct,ht,lt=i,ut=B*m,dt=l*C,_t=u*S,ft=C,pt=b,gt=x,mt=S,vt=E,yt=A,Tt=!1,Ct=!1,bt=!1,xt=this._vertices;if(o===J.HEX){var St=r._staggerIndex,Et=r._hexSideLength;st=r._staggerAxis,ot=r.tileset.tileOffset,ht=St===it.STAGGERINDEX_ODD?1:-1,at=st===et.STAGGERAXIS_X?(c-Et)/2:0,ct=st===et.STAGGERAXIS_Y?(h-Et)/2:0}for(V=B;V<z;++V){for(W=M;W<k;++W)if(lt+24>t.length&&(n.renderer._increaseBatchingSize((lt-i)/6,n.renderer.VertexType.QUAD),n.renderer._batchRendering(),i=0,lt=0),U=ut+W,!y[U]&&(G=r.tiles[U],X=v[(G&tt)>>>0])){switch(o){case J.ORTHO:H=W*c,Q=(g-V-1)*h,U=r._vertexZ+n.renderer.assignedZStep*U/a.length;break;case J.ISO:H=c/2*(m+W-V-1),Q=h/2*(2*g-W-V-2),U=r._vertexZ+n.renderer.assignedZStep*(r.height-Q)/r.height;break;case J.HEX:var At=st===et.STAGGERAXIS_Y&&V%2===1?c/2*ht:0;H=W*(c-at)+At+ot.x;var Ot=st===et.STAGGERAXIS_X&&W%2===1?h/2*-ht:0;Q=(g-V-1)*(h-ct)+Ot-ot.y,U=r._vertexZ+n.renderer.assignedZStep*(r.height-Q)/r.height}if(q=H+l,Y=Q+u,!s&&o===J.ISO){if(nt=I+Q*S,nt>p+_t){W+=Math.floor(2*(nt-p)/_t)-1;continue}if(rt=R+q*C,rt<-dt){W+=Math.floor(2*-rt/dt)-1;continue}if(K=R+H*C,Z=I+Y*S,K>f||Z<0){W=k;continue}}for(G>$.DIAGONAL&&(Tt=!0,Ct=(G&$.HORIZONTAL)>>>0,bt=(G&$.VERTICAL)>>>0),xt[0].x=H*ft+Y*gt+vt,xt[0].y=H*pt+Y*mt+yt,xt[1].x=H*ft+Q*gt+vt,xt[1].y=H*pt+Q*mt+yt,xt[2].x=q*ft+Y*gt+vt,xt[2].y=q*pt+Y*mt+yt,xt[3].x=q*ft+Q*gt+vt,xt[3].y=q*pt+Q*mt+yt,j=0;j<4;++j){switch(t[lt]=xt[j].x,t[lt+1]=xt[j].y,t[lt+2]=U,e[lt+3]=this._color[0],j){case 0:t[lt+4]=Ct?X.r:X.l,t[lt+5]=bt?X.b:X.t;break;case 1:t[lt+4]=Ct?X.r:X.l,t[lt+5]=bt?X.t:X.b;break;case 2:t[lt+4]=Ct?X.l:X.r,t[lt+5]=bt?X.b:X.t;break;case 3:t[lt+4]=Ct?X.l:X.r,t[lt+5]=bt?X.t:X.b}lt+=6}Tt&&(ft=C,pt=b,gt=x,mt=S,vt=E,yt=A,Ct=!1,bt=!1,Tt=!1)}ut+=m}return(lt-i)/6};var nt=40,rt=400,st=2,ot=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},at=n.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4}),ct=n.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),ht=n.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});n.EditBoxDelegate=n._Class.extend({editBoxEditingDidBegan:function(t){},editBoxEditingDidEnded:function(t){},editBoxTextChanged:function(t,e){},editBoxEditingReturn:function(t){}}),_ccsg.EditBox=_ccsg.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:ct.ANY,_editBoxInputFlag:ht.DEFAULT,_keyboardReturnType:at.DEFAULT,_maxLength:50,_text:"",_textColor:null,_placeholderText:"",_alwaysOnTop:!1,_placeholderFontName:"",_placeholderFontSize:14,_placeholderColor:null,__fullscreen:!1,__autoResize:!1,_className:"EditBox",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._textColor=n.Color.WHITE,this._placeholderColor=n.Color.GRAY,this.initWithSizeAndBackgroundSprite(t,e),this._renderCmd._createLabels()},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new _ccsg.EditBox.CanvasRenderCmd(this):new _ccsg.EditBox.WebGLRenderCmd(this)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._updateEditBoxSize(t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||this._renderCmd.createNativeControl()},setTabIndex:function(t){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=t)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(n.warn("The dom control is not created!"),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(n.warn("The dom control is not created!"),!1)},stayOnTop:function(t){this._alwaysOnTop!==t&&(this._alwaysOnTop=t,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd._removeDomInputControl()},_onTouchBegan:function(t){var e=t.getLocation(),i=n.rect(0,0,this._contentSize.width,this._contentSize.height),r=n.rectContainsPoint(i,this.convertToNodeSpace(e));return!!r||(this._renderCmd.hidden(),!1)},_onTouchEnded:function(){this._renderCmd.show()},_updateBackgroundSpriteSize:function(t,e){this._backgroundSprite&&this._backgroundSprite.setContentSize(t,e)},_updateEditBoxSize:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e;this._updateBackgroundSpriteSize(i,n),this._renderCmd.updateSize(i,n)},setLineHeight:function(t){this._renderCmd.setLineHeight(t)},setFont:function(t,e){this._renderCmd.setFont(t,e)},_setFont:function(t){this._renderCmd._setFont(t)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(t){this._renderCmd.setFontName(t)},setFontSize:function(t){this._renderCmd.setFontSize(t)},setString:function(t){t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._text=t,this._renderCmd.setString(t)},setFontColor:function(t){this._textColor=t,this._renderCmd.setFontColor(t)},setMaxLength:function(t){isNaN(t)||(t<0&&(t=65535),this._maxLength=t,this._renderCmd.setMaxLength(t))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){null!==t&&(this._renderCmd.setPlaceHolder(t),this._placeholderText=t)},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(t){var e=n.LabelTTF._fontStyleRE.exec(t);e&&(this._placeholderFontName=e[2],this._placeholderFontSize=parseInt(e[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._renderCmd.setPlaceholderFontColor(t)},setInputFlag:function(t){this._editBoxInputFlag=t,this._renderCmd.setInputFlag(t)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(t,e){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=e,_ccsg.Node.prototype.setContentSize.call(this,t),
this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(n.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(t.width,t.height)),this.x=0,this.y=0,!0},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){if(this._editBoxInputMode!==t){var e=this.getString();this._editBoxInputMode=t,this._renderCmd.setInputMode(t),this._renderCmd.transform(),this.setString(e),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(t){this._keyboardReturnType=t},initWithBackgroundColor:function(t,e){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=n.colorToHex(e)}});var b=_ccsg.EditBox.prototype;n.defineGetterSetter(b,"font",null,b._setFont),n.defineGetterSetter(b,"fontName",null,b.setFontName),n.defineGetterSetter(b,"fontSize",null,b.setFontSize),n.defineGetterSetter(b,"fontColor",null,b.setFontColor),n.defineGetterSetter(b,"string",b.getString,b.setString),n.defineGetterSetter(b,"maxLength",b.getMaxLength,b.setMaxLength),n.defineGetterSetter(b,"placeholder",b.getPlaceHolder,b.setPlaceHolder),n.defineGetterSetter(b,"placeholderFont",null,b._setPlaceholderFont),n.defineGetterSetter(b,"placeholderFontName",null,b.setPlaceholderFontName),n.defineGetterSetter(b,"placeholderFontSize",null,b.setPlaceholderFontSize),n.defineGetterSetter(b,"placeholderFontColor",null,b.setPlaceholderFontColor),n.defineGetterSetter(b,"inputFlag",null,b.setInputFlag),n.defineGetterSetter(b,"delegate",null,b.setDelegate),n.defineGetterSetter(b,"inputMode",null,b.setInputMode),n.defineGetterSetter(b,"returnType",null,b.setReturnType),b=null,_ccsg.EditBox.InputMode=ct,_ccsg.EditBox.InputFlag=ht,_ccsg.EditBox.KeyboardReturnType=at,function(t){t._polyfill={zoomInvalid:!1},n.sys.OS_ANDROID!==n.sys.os||n.sys.browserType!==n.sys.BROWSER_TYPE_SOUGOU&&n.sys.browserType!==n.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0)}(_ccsg.EditBox),function(t){var e=function(){},i=e.prototype=Object.create(Object.prototype);i.updateMatrix=function(){if(this._edTxt){var e=this._node,i=n.view._scaleX,r=n.view._scaleY,s=n.view._devicePixelRatio,o=this._worldTransform;i/=s,r/=s;var a=n.game.container,c=o.a*i,h=o.b,l=o.c,u=o.d*r,d=a&&a.style.paddingLeft&&parseInt(a.style.paddingLeft),_=a&&a.style.paddingBottom&&parseInt(a.style.paddingBottom),f=o.tx*i+d,p=o.ty*r+_;t.zoomInvalid&&(this.updateSize(e._contentSize.width*c,e._contentSize.height*u),c=1,u=1);var g="matrix("+c+","+-h+","+-l+","+u+","+f+","+-p+")";this._edTxt.style.transform=g,this._edTxt.style["-webkit-transform"]=g,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},i.updateVisibility=function(){if(this._edTxt){var t=this._node,e=this._edTxt;if(t.visible)e.style.visibility="visible",n.game.container.appendChild(e);else{e.style.visibility="hidden";var i=!1;i="contains"in n.game.container?n.game.container.contains(e):n.game.container.compareDocumentPosition(e)%16,i&&n.game.container.removeChild(e)}}},i.stayOnTop=function(t){t?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._updateLabelString())},i._createDomInput=function(){this._removeDomInputControl();var t=this,e=this._edTxt=document.createElement("input");return e.type="text",e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,e.style.outline="medium",e.style.padding="0",e.style.textTransform="uppercase",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left=st+"px",e.style.className="cocosEditBox",e.addEventListener("input",function(){var e=t._editBox;this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength)),e._delegate&&e._delegate.editBoxTextChanged&&e._text.toLowerCase()!==this.value.toLowerCase()&&(e._text=this.value,t._updateEditBoxContentStyle(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("keypress",function(e){var i=t._editBox;e.keyCode===n.KEY.enter&&(e.stopPropagation(),e.preventDefault(),""===this.value&&(this.style.fontSize=i._placeholderFontSize+"px",this.style.color=n.colorToHex(i._placeholderColor)),i._text=this.value,t._updateEditBoxContentStyle(),t.hidden(),i._delegate&&i._delegate.editBoxEditingReturn&&i._delegate.editBoxEditingReturn(i),n._canvas.focus())}),e.addEventListener("focus",function(){var e=t._editBox;this.style.fontSize=t._edFontSize+"px",this.style.color=n.colorToHex(e._textColor),t._hiddenLabels(),n.view.isAutoFullScreenEnabled()?(t.__fullscreen=!0,n.view.enableAutoFullScreen(!1),n.screen.exitFullScreen()):t.__fullscreen=!1,t.__autoResize=n.view.__resizeWithBrowserSize,n.view.resizeWithBrowserSize(!1),l(e),e._delegate&&e._delegate.editBoxEditingDidBegan&&e._delegate.editBoxEditingDidBegan(e)}),e.addEventListener("blur",function(){var e=t._editBox;e._text=this.value,t._updateEditBoxContentStyle(),t.__fullscreen&&n.view.enableAutoFullScreen(!0),t.__autoResize&&n.view.resizeWithBrowserSize(!0),window.scrollY=0,e._delegate&&e._delegate.editBoxEditingDidEnded&&e._delegate.editBoxEditingDidEnded(e),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=n.colorToHex(e._placeholderColor)),t.hidden()}),e},i._createDomTextArea=function(){this._removeDomInputControl();var t=this,e=this._edTxt=document.createElement("textarea");return e.type="text",e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,e.style.outline="medium",e.style.padding="0",e.style.resize="none",e.style.textTransform="uppercase",e.style.overflow_y="scroll",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left=st+"px",e.style.className="cocosEditBox",e.addEventListener("input",function(){this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength));var e=t._editBox;e._delegate&&e._delegate.editBoxTextChanged&&e._text.toLowerCase()!==this.value.toLowerCase()&&(e._text=this.value,t._updateEditBoxContentStyle(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("focus",function(){var e=t._editBox;t._hiddenLabels(),this.style.fontSize=t._edFontSize+"px",this.style.color=n.colorToHex(e._textColor),n.view.isAutoFullScreenEnabled()?(t.__fullscreen=!0,n.view.enableAutoFullScreen(!1),n.screen.exitFullScreen()):t.__fullscreen=!1,t.__autoResize=n.view.__resizeWithBrowserSize,n.view.resizeWithBrowserSize(!1),l(e),e._delegate&&e._delegate.editBoxEditingDidBegan&&e._delegate.editBoxEditingDidBegan(e)}),e.addEventListener("keypress",function(e){var i=t._editBox;e.keyCode===n.KEY.enter&&(e.stopPropagation(),i._delegate&&i._delegate.editBoxEditingReturn&&i._delegate.editBoxEditingReturn(i))}),e.addEventListener("blur",function(){var e=t._editBox;e._text=this.value,t._updateEditBoxContentStyle(),window.scrollY=0,t.__fullscreen&&n.view.enableAutoFullScreen(!0),t.__autoResize&&n.view.resizeWithBrowserSize(!0),e._delegate&&e._delegate.editBoxEditingDidEnded&&e._delegate.editBoxEditingDidEnded(e),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=n.colorToHex(e._placeholderColor)),t.hidden()}),e},i._createLabels=function(){var t=this._editBox.getContentSize();this._textLabel||(this._textLabel=new _ccsg.Label,this._textLabel.setVisible(!1),this._textLabel.setAnchorPoint(n.p(0,1)),this._textLabel.setOverflow(_ccsg.Label.Overflow.CLAMP),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=new _ccsg.Label,this._placeholderLabel.setAnchorPoint(n.p(0,1)),this._placeholderLabel.setColor(n.Color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(t)},i._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},i._updateLabelPosition=function(t){if(this._textLabel&&this._placeholderLabel){var e=n.size(t.width-st,t.height);this._textLabel.setContentSize(e),this._placeholderLabel.setLineHeight(t.height);var i=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===ct.ANY?(this._textLabel.setPosition(st,t.height),this._placeholderLabel.setPosition(st,t.height),this._placeholderLabel.setVerticalAlign(n.VerticalTextAlignment.TOP),this._textLabel.setVerticalAlign(n.VerticalTextAlignment.TOP),this._textLabel.enableWrapText(!0)):(this._textLabel.enableWrapText(!1),this._textLabel.setPosition(st,t.height),this._placeholderLabel.setPosition(st,(t.height+i.height)/2),this._placeholderLabel.setVerticalAlign(n.VerticalTextAlignment.CENTER),this._textLabel.setVerticalAlign(n.VerticalTextAlignment.CENTER))}},i.setLineHeight=function(t){this._textLabel&&this._textLabel.setLineHeight(t)},i._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},i._updateEditBoxContentStyle=function(){var t=this._editBox._editBoxInputFlag;t===ht.INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():t===ht.INITIAL_CAPS_WORD?this._editBox._text=ot(this._editBox._text):t===ht.INITIAL_CAPS_SENTENCE&&(this._editBox._text=u(this._editBox._text))},i._updateLabelString=function(){if(this._updateInputType(),this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),"password"===this._edTxt.type){for(var t="",e=this._editBox._text.length,i=0;i<e;++i)t+="";this._textLabel&&this._textLabel.setString(t)}else this._updateEditBoxContentStyle(),this._textLabel&&this._textLabel.setString(this._editBox._text)},i._showLabels=function(){this._hiddenLabels(),""===this._edTxt.value?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._updateLabelString()},i.show=function(){this._editBox._alwaysOnTop||"none"===this._edTxt.style.display&&(this._edTxt.style.display="",this._edTxt.focus()),this._hiddenLabels()},i.hidden=function(){this._editBox._alwaysOnTop||(this._edTxt.style.display="none"),this._showLabels()},i._setFont=function(t){var e=n.LabelTTF._fontStyleRE.exec(t),i=e[2],r=parseInt(e[1]);e&&this.setFont(i,r)},i.setFont=function(t,e){this._edFontName=t||this._edFontName,this._edFontSize=e||this._edFontSize,this._updateDOMFontStyle()},i.setFontName=function(t){this._edFontName=t||this._edFontName,this._updateDOMFontStyle()},i.setFontSize=function(t){this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},i.setFontColor=function(t){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=n.colorToHex(t)),this._textLabel&&this._textLabel.setColor(t))},i.setPlaceHolder=function(t){this._placeholderLabel.setString(t)},i.setMaxLength=function(t){this._edTxt&&(this._edTxt.maxLength=t)},i._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontFileOrFamily(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},i.setPlaceholderFontColor=function(t){this._placeholderLabel.setColor(t)},i._updateInputType=function(){this._editBox._keyboardReturnType===at.SEARCH&&(this._edTxt.type="search");var t=this._editBox._editBoxInputMode;t===ct.EMAIL_ADDR?this._edTxt.type="email":t===ct.NUMERIC||t===ct.DECIMAL?this._edTxt.type="number":t===ct.PHONE_NUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):t===ct.URL?this._edTxt.type="url":this._edTxt.type="text",this._editBox._editBoxInputFlag===ht.PASSWORD&&(this._edTxt.type="password")},i.setInputFlag=function(t){this._edTxt&&(this._updateInputType(),this._edTxt.style.textTransform="none",t===ht.INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":t===ht.INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelString())},i.setInputMode=function(t){this._removeDomInputControl(),t===ct.ANY?this._createDomTextArea():this._createDomInput(),this._addDomInputControl(),this._updateInputType();var e=this._node.getContentSize();this.updateSize(e.width,e.height)},i.setString=function(t){this._edTxt&&null!==t&&(this._edTxt.value=t,""===t?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor),this._placeholderLabel.setVisible(!0)),this._textLabel&&this._textLabel.setVisible(!1)):(this._edTxt.style.color=n.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._updateLabelString()))},i._updateDOMFontStyle=function(){this._edTxt&&(""!==this._edTxt.value&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontFileOrFamily(this._edFontName)))},i.updateSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px",this._updateLabelPosition(n.size(t,e)))},i.createNativeControl=function(){this._createDomTextArea(),this._addDomInputControl()},i._addDomInputControl=function(){n.game.container.appendChild(this._edTxt)},i._removeDomInputControl=function(){var t=this._edTxt;if(t){var e=!1;e="contains"in n.game.container?n.game.container.contains(t):n.game.container.compareDocumentPosition(t)%16,e&&n.game.container.removeChild(t)}this._edTxt=null},i.initializeRenderCmd=function(t){this._editBox=t,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null},_ccsg.EditBox.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this.initializeRenderCmd(t)};var r=_ccsg.EditBox.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.js.mixin(r,i),r.constructor=_ccsg.EditBox.CanvasRenderCmd,r.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},_ccsg.EditBox.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this.initializeRenderCmd(t)};var s=_ccsg.EditBox.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.js.mixin(s,i),s.constructor=_ccsg.EditBox.WebGLRenderCmd,s.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()}}(_ccsg.EditBox._polyfill),_ccsg.VideoPlayer=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._EventList={}},_createRenderCmd:function(){return new _ccsg.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){this._renderCmd.play()},pause:function(){this._renderCmd.pause()},_resume:function(){this._renderCmd.play()},stop:function(){this._renderCmd.stop()},seekTo:function(t){this._renderCmd.seekTo(t)},isPlaying:function(){return this._renderCmd.isPlaying()},duration:function(){return this._renderCmd.duration()},currentTime:function(){return this._renderCmd.currentTime()},createDomElementIfNeeded:function(){this._renderCmd._video||this._renderCmd.createDom()},setKeepAspectRatioEnabled:function(){n.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!0},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?n.screen.requestFullScreen(e):n.screen.exitFullScreen(e))},isFullScreenEnabled:function(){n.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[_ccsg.VideoPlayer.EventType.PLAYING];t.call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd.updateSize(t,e)},cleanup:function(){this._super(),this._renderCmd.removeDom()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this);var t=_ccsg.VideoPlayer.elements;t.indexOf(this)===-1&&t.push(this)},onExit:function(){_ccsg.Node.prototype.onExit.call(this);var t=_ccsg.VideoPlayer.elements,e=t.indexOf(this);e!==-1&&t.splice(e,1)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.VideoPlayer.elements=[],_ccsg.VideoPlayer.pauseElements=[],n.eventManager.addCustomListener(n.game.EVENT_HIDE,function(){for(var t,e=_ccsg.VideoPlayer.elements,i=0;i<e.length;i++)t=e[i],e[i]._playing&&(t.pause(),_ccsg.VideoPlayer.pauseElements.push(t))}),n.game.on(n.game.EVENT_SHOW,function(){for(var t=_ccsg.VideoPlayer.pauseElements,e=t.pop();e;)e.play(),e=t.pop()}),_ccsg.VideoPlayer.EventType={PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},function(){var e=document.createElement("video");e.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),e.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),e.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm")}(),n.sys.browserType===n.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0),n.sys.OS_ANDROID!==n.sys.os||n.sys.browserType!==n.sys.BROWSER_TYPE_SOUGOU&&n.sys.browserType!==n.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0);var e=document.createElement("style");e.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(e)}(_ccsg.VideoPlayer),function(t){_ccsg.VideoPlayer.RenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._video=null,this._url="",this._played=!1,this._playing=!1,this._ignorePause=!1};var e=_ccsg.VideoPlayer.RenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.constructor=_ccsg.VideoPlayer.RenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},e.updateMatrix=function(){if(this._video){var e=this._node,i=n.view._scaleX,r=n.view._scaleY,s=n.view._devicePixelRatio,o=this._worldTransform;i/=s,r/=s;var a=n.game.container,c=o.a*i,h=o.b,l=o.c,u=o.d*r,d=a&&a.style.paddingLeft&&parseInt(a.style.paddingLeft),_=a&&a.style.paddingBottom&&parseInt(a.style.paddingBottom),f=o.tx*i+d,p=o.ty*r+_;t.zoomInvalid&&(this.updateSize(e._contentSize.width*c,e._contentSize.height*u),c=1,u=1);var g="matrix("+c+","+-h+","+-l+","+u+","+f+","+-p+")";this._video.style.transform=g,this._video.style["-webkit-transform"]=g,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px"}},e.updateURL=function(e){var i,r,s,o=this._node;if(this._url!=e){this._url=e,n.loader.resPath&&!/^http/.test(e)&&(e=n.path.join(n.loader.resPath,e)),this.removeDom(),this.createDom(),this.bindEvent(),r=this._video;var a=function(){1!=this._loaded&&(this._loaded=!0,o.setContentSize(o._contentSize.width,o._contentSize.height),r.currentTime=0,o._dispatchEvent(_ccsg.VideoPlayer.EventType.READY_TO_PLAY),this.updateVisibility(),this.updateMatrix())}.bind(this);r.oncanplay=a,r.style.visibility="hidden",this._loaded=!1,this._played=!1,this._playing=!1,i=document.createElement("source"),i.src=e,r.appendChild(i),s=n.path.extname(e);for(var c=0;c<t.canPlayType.length;c++)s!==t.canPlayType[c]&&(i=document.createElement("source"),i.src=e.replace(s,t.canPlayType[c]),r.appendChild(i))}},e.bindEvent=function(){var t=this._node,e=this._video,i=this;e.onloadedmetadata=function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.META_LOADED)},e.addEventListener("ended",function(){i._video===e&&(this._playing=!1,t._dispatchEvent(_ccsg.VideoPlayer.EventType.COMPLETED))}.bind(this)),e.addEventListener("play",function(){i._video===e&&t._dispatchEvent(_ccsg.VideoPlayer.EventType.PLAYING)}),e.addEventListener("pause",function(){i._ignorePause||i._video!==e||t._dispatchEvent(_ccsg.VideoPlayer.EventType.PAUSED)}),e.addEventListener("click",function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.CLICKED)})},e.updateVisibility=function(){var t=this._node;if(this._video){var e=this._video;if(t.visible)e.style.visibility="visible",n.game.container.appendChild(e);else if(e.style.visibility="hidden",e.pause(),this._playing=!1,e){var i=!1;i="contains"in n.game.container?n.game.container.contains(e):n.game.container.compareDocumentPosition(e)%16,i&&n.game.container.removeChild(e)}}},e.createDom=function(){var t=document.createElement("video");t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo",t.setAttribute("preload",!0),this._video=t,n.game.container.appendChild(t)},e.removeDom=function(){var t=this._video;if(t){var e=!1;e="contains"in n.game.container?n.game.container.contains(t):n.game.container.compareDocumentPosition(t)%16,e&&n.game.container.removeChild(t)}this._video=null,this._url=""},e.updateSize=function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px")},e.play=function(){var t=this._video;t&&this._node.isVisible()&&(this._played=!0,this._playing||(_ccsg.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){t.play(),self._playing=!0},20):(t.play(),this._playing=!0)))},e.pause=function(){var t=this._video;this._playing&&(this._playing=!1,t&&t.pause())},e.stop=function(){var t=this._video;if(t&&this._node.isVisible()){this._ignorePause=!0,t.pause();var e=this._node;setTimeout(function(){e._dispatchEvent(_ccsg.VideoPlayer.EventType.STOPPED),this._ignorePause=!1}.bind(this),0),t.currentTime=0,this._playing=!1}},e.seekTo=function(e){var i=this._video;if(i){if(this._loaded)i.currentTime=e;else{var n=function(){i.currentTime=e,i.removeEventListener(t.event,n)};i.addEventListener(t.event,n)}_ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){i.play()},20)}},e.isPlaying=function(){var t=this._video;return _ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){t.play()},20),this._playing},e.duration=function(){var t=this._video,e=-1;return t?(e=t.duration,e<=0&&n.log("Video player's duration is not ready to get now!"),e):e},e.currentTime=function(){var t=this._video;return t?t.currentTime:-1}}(_ccsg.VideoPlayer._polyfill),_ccsg.WebView=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this.setContentSize(n.size(300,200)),this._EventList={}},createDomElementIfNeeded:function(){this._renderCmd._div||this._renderCmd.createNativeControl()},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,i,n){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(_ccsg.WebView.EventType.LOADING)},stopLoading:function(){n.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.location.reload()}},canGoBack:function(){return n.log("Web does not support query history"),!0},canGoForward:function(){return n.log("Web does not support query history"),!0},goBack:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return n.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.back.call(e)}}catch(i){n.log(i)}},goForward:function(){try{if(_ccsg.WebView._polyfill.closeHistory)return n.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.history.forward.call(e)}}catch(i){n.log(i)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){var i=e.contentWindow;try{i.eval(t),this._dispatchEvent(_ccsg.WebView.EventType.JS_EVALUATED)}catch(n){console.error(n)}}},setScalesPageToFit:function(){n.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new _ccsg.WebView.RenderCmd(this)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd.updateSize(t,e)},cleanup:function(){this._super(),this._renderCmd.removeDom()},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.WebView.EventType={LOADING:0,LOADED:1,ERROR:2,JS_EVALUATED:3},function(){var t=_ccsg.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};n.sys.os===n.sys.OS_IOS&&(t.enableDiv=!0),n.sys.isMobile?n.sys.browserType===n.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):n.sys.browserType===n.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)}(),function(t){var e;e=n._renderType===n.game.RENDER_TYPE_CANVAS?_ccsg.Node.CanvasRenderCmd:_ccsg.Node.WebGLRenderCmd,_ccsg.WebView.RenderCmd=function(t){e.call(this,t),this._parent=null,this._div=null,this._iframe=null,this._listener=null};var i=_ccsg.WebView.RenderCmd.prototype=Object.create(e.prototype);i.constructor=_ccsg.WebView.RenderCmd,i.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},i.updateStatus=function(){t.devicePixelRatio=n.view.isRetinaEnabled();var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag;i&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(),this._dirtyFlag=this._dirtyFlag&_ccsg.Node._dirtyFlags.transformDirty^this._dirtyFlag)},i.initEvent=function(){var t=this._node;this._iframe.addEventListener("load",function(){t._dispatchEvent(_ccsg.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){t._dispatchEvent(_ccsg.WebView.EventType.ERROR)})},i.resize=function(t){t=t||n.view;var e=this._node,i=n.eventManager;if(e._parent&&e._visible)this.updateMatrix();else{var r=i._listenersMap[n.game.EVENT_RESIZE].getFixedPriorityListeners();i._removeListenerInVector(r,this._listener),this._listener=null}},i.updateMatrix=function(){if(this._div){var t=(this._node,n.view._scaleX),e=n.view._scaleY,i=n.view._devicePixelRatio,r=this._worldTransform;t/=i,e/=i;var s=n.game.container,o=r.a*t,a=r.b,c=r.c,h=r.d*e,l=s&&s.style.paddingLeft&&parseInt(s.style.paddingLeft),u=s&&s.style.paddingBottom&&parseInt(s.style.paddingBottom),d=r.tx*t+l,_=r.ty*e+u,f="matrix("+o+","+-a+","+-c+","+h+","+d+","+-_+")";this._div.style.transform=f,this._div.style["-webkit-transform"]=f,this._div.style["transform-origin"]="0px 100% 0px",this._div.style["-webkit-transform-origin"]="0px 100% 0px"}},i.initStyle=function(){if(this._div){var t=this._div;t.style.position="absolute",t.style.bottom="0px",t.style.left="0px"}},i.updateURL=function(t){var e=this._iframe;e.src=t;var i=this,n=function(){i._loaded=!0,i.updateVisibility(),e.removeEventListener("load",n)};e.addEventListener("load",n)},i.updateSize=function(t,e){var i=this._div;i&&(i.style.width=t+"px",i.style.height=e+"px")},i.createDom=function(){t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._div.style.background="#FFF";var e=this._node._contentSize;this._div.style.height=e.height+"px",this._div.style.width=e.width+"px",this._div.style.overflow="scroll",this._div.style.border="none",n.game.container.appendChild(this._div)},i.createNativeControl=function(){this.createDom(),this.initStyle(),this.initEvent()},i.removeDom=function(){var t=this._div;if(t){var e=!1;e="contains"in n.game.container?n.game.container.contains(t):n.game.container.compareDocumentPosition(t)%16,e&&n.game.container.removeChild(t)}this._div=null},i.updateVisibility=function(){var t=this._node;if(this._div){var e=this._div;if(t.visible)e.style.visibility="visible",n.game.container.appendChild(e);else if(e.style.visibility="hidden",e){var i=!1;i="contains"in n.game.container?n.game.container.contains(e):n.game.container.compareDocumentPosition(e)%16,i&&n.game.container.removeChild(e)}}}}(_ccsg.WebView._polyfill),_ccsg.MotionStreak=_ccsg.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,e,i,r,s){_ccsg.Node.prototype.ctor.call(this),this._positionR=n.p(0,0),this._blendFunc=new n.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.fastMode=!1,this.startingPositionInitialized=!1,this.texture=null,this._stroke=0,this._fadeDelta=0,this._minSeg=0,this._maxPoints=0,this._nuPoints=0,this._previousNuPoints=0,this._pointVertexes=null,this._pointState=null,this._vertices=null,this._colorPointer=null,this._texCoords=null,this._verticesBuffer=null,this._colorPointerBuffer=null,this._texCoordsBuffer=null,void 0!==s&&this.initWithFade(t,e,i,r,s)},initWithFade:function(t,e,i,r,s){return n.js.isString(s)&&(s=n.textureCache.addImage(s)),this.anchorX=0,this.anchorY=0,this.ignoreAnchor=!0,this.startingPositionInitialized=!1,this.fastMode=!0,this._stroke=i,this.setMinSeg(e),this.setFadeTime(t),this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.setTexture(s),this.color=r,this.scheduleUpdate(),!0},getTexture:function(){return this.texture},setTexture:function(t){this.texture!==t&&(this.texture=t)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:(this._blendFunc.src=t,this._blendFunc.dst=e)},getOpacity:function(){return n.log("cc.MotionStreak.getOpacity has not been supported."),0},setOpacity:function(t){n.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},getFadeTime:function(){return 1/this._fadeDelta},setFadeTime:function(t){this._fadeDelta=1/t;var e=(0|60*t)+2;this._maxPoints=e,this._nuPoints=0,this._pointState=new Float32Array(e),this._pointVertexes=new Float32Array(2*e),this._vertices=new Float32Array(4*e),this._texCoords=new Float32Array(4*e),this._colorPointer=new Uint8Array(8*e),this._verticesBuffer=gl.createBuffer(),this._texCoordsBuffer=gl.createBuffer(),this._colorPointerBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW)},getMinSeg:function(){return this._minSeg},setMinSeg:function(t){this._minSeg=t===-1?this._stroke/5:t,this._minSeg*=this._minSeg},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},tintWithColor:function(t){this.color=t;for(var e=this._colorPointer,i=0,n=2*this._nuPoints;i<n;i++)e[4*i]=t.r,e[4*i+1]=t.g,e[4*i+2]=t.b},reset:function(){this._nuPoints=0},setPosition:function(t,e){this.startingPositionInitialized=!0,void 0===e?(this._positionR.x=t.x,this._positionR.y=t.y):(this._positionR.x=t,this._positionR.y=e)},getPositionX:function(){return this._positionR.x},setPositionX:function(t){
this._positionR.x=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},update:function(t){if(this.startingPositionInitialized){t*=this._fadeDelta;var e,i,r,s,o=0,a=this._nuPoints,c=this._pointState,h=this._pointVertexes,l=this._vertices,u=this._colorPointer;for(r=0;r<a;r++)if(c[r]-=t,c[r]<=0)o++;else{e=r-o,o>0?(c[e]=c[r],h[2*e]=h[2*r],h[2*e+1]=h[2*r+1],s=2*r,i=2*e,l[2*i]=l[2*s],l[2*i+1]=l[2*s+1],l[2*(i+1)]=l[2*(s+1)],l[2*(i+1)+1]=l[2*(s+1)+1],s*=4,i*=4,u[i+0]=u[s+0],u[i+1]=u[s+1],u[i+2]=u[s+2],u[i+4]=u[s+4],u[i+5]=u[s+5],u[i+6]=u[s+6]):i=8*e;var _=255*c[e];u[i+3]=_,u[i+7]=_}a-=o;var f=!0;if(a>=this._maxPoints)f=!1;else if(a>0){var p=n.p(h[2*(a-1)],h[2*(a-1)+1]),g=n.pDistanceSQ(p,this._positionR)<this._minSeg,m=n.p(h[2*(a-2)],h[2*(a-2)+1]),v=1!==a&&n.pDistanceSQ(m,this._positionR)<2*this._minSeg;(g||v)&&(f=!1)}if(f){h[2*a]=this._positionR.x,h[2*a+1]=this._positionR.y,c[a]=1;var y=8*a,T=this.getDisplayedColor();u[y]=T.r,u[y+1]=T.g,u[y+2]=T.b,u[y+4]=T.r,u[y+5]=T.g,u[y+6]=T.b,u[y+3]=255,u[y+7]=255,a>0&&this.fastMode&&(a>1?d(h,this._stroke,this._vertices,a,1):d(h,this._stroke,this._vertices,0,2)),a++}if(this.fastMode||d(h,this._stroke,this._vertices,0,a),a&&this._previousNuPoints!==a){var C=1/a,b=this._texCoords;for(r=0;r<a;r++)b[4*r]=0,b[4*r+1]=C*r,b[2*(2*r+1)]=1,b[2*(2*r+1)+1]=C*r;this._previousNuPoints=a}this._nuPoints=a}},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_WEBGL?new _ccsg.MotionStreak.WebGLRenderCmd(this):null}});var lt=_ccsg.MotionStreak.prototype;Object.defineProperty(lt,"x",{get:lt.getPositionX,set:lt.setPositionX}),Object.defineProperty(lt,"y",{get:lt.getPositionY,set:lt.setPositionY}),_ccsg.MotionStreak.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new n.math.Matrix4,this._matrix.identity(),this._shaderProgram=n.shaderCache.programForKey(n.macro.SHADER_POSITION_TEXTURECOLOR)},_ccsg.MotionStreak.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),_ccsg.MotionStreak.WebGLRenderCmd.prototype.constructor=_ccsg.Sprite.WebGLRenderCmd,_ccsg.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(!(e._nuPoints<=1)&&e.texture&&e.texture.isLoaded()){t=t||n._renderContext,this._updateDisplayColor();var i=this._worldTransform,r=this._matrix.mat;r[0]=i.a,r[4]=i.c,r[12]=i.tx,r[1]=i.b,r[5]=i.d,r[13]=i.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),n.gl.blendFunc(e._blendFunc.src,e._blendFunc.dst),n.gl.bindTexture2DN(0,e.texture),t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(n.macro.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,e._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,e._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._texCoordsBuffer),t.bufferData(t.ARRAY_BUFFER,e._texCoords,t.DYNAMIC_DRAW),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._colorPointerBuffer),t.bufferData(t.ARRAY_BUFFER,e._colorPointer,t.DYNAMIC_DRAW),t.vertexAttribPointer(n.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,2*e._nuPoints),n.g_NumberOfDraws++}},n.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,r){_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=n.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new n.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||n.Texture2D.PIXEL_FORMAT_RGBA8888,r=r||0,this.initWithWidthAndHeight(t,e,i,r)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return n._renderType===n.game.RENDER_TYPE_CANVAS?new n.RenderTexture.CanvasRenderCmd(this):new n.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){n.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,r,s,o){var a=n._renderContext;s=s||a.COLOR_BUFFER_BIT,o=o||a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,r,s,o,a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,s,o){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,s,o)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){n.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return n.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var b=n.RenderTexture.prototype;b.clearColorVal,n.defineGetterSetter(b,"clearColorVal",b.getClearColor,b.setClearColor),n.RenderTexture.create=function(t,e,i,r){return new n.RenderTexture(t,e,i,r)},n.RenderTexture.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new n.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var m=n.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);m.constructor=n.RenderTexture.CanvasRenderCmd,m.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},m.clearStencil=function(t){},m.setVirtualViewport=function(t,e,i){},m.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},m.initWithWidthAndHeight=function(t,e,i,r){var s=this._node,o=this._cacheCanvas;o.width=0|t,o.height=0|e;var a=new n.Texture2D;a.initWithElement(o),a.handleLoadedTexture();var c=s.sprite=new _ccsg.Sprite(a);return c.setBlendFunc(n.macro.ONE,n.macro.ONE_MINUS_SRC_ALPHA),s.autoDraw=!1,s.addChild(c),!0},m.begin=function(){},m._beginWithClear=function(t,e,i,n,r,s,o){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n;var a=this._cacheContext.getContext(),c=this._cacheCanvas;a.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),a.clearRect(0,0,c.width,c.height),a.fillRect(0,0,c.width,c.height)},m.end=function(){var t=this._node;n.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId)},m.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},m.clearDepth=function(t){n.log("clearDepth isn't supported on Cocos2d-Html5")},m.visit=function(t){var e=this._node;this._syncStatus(t),e.sprite.visit(this),this._dirtyFlag=0};var ut=t("../cocos2d/core/utils/misc");n.RenderTexture.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new n.Rect,this._fullRect=new n.Rect,this._fullViewport=new n.Rect};var m=n.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);m.constructor=n.RenderTexture.WebGLRenderCmd,m.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},m.needDraw=function(){return this._needDraw&&this._node.autoDraw},m.rendering=function(t){var e=t||n._renderContext,i=this._node;if(i.autoDraw){i.begin();var r=i.clearFlags;if(r){var s=[0,0,0,0],o=0,a=0;r&e.COLOR_BUFFER_BIT&&(s=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(i._clearColor.r/255,i._clearColor.g/255,i._clearColor.b/255,i._clearColor.a/255)),r&e.DEPTH_BUFFER_BIT&&(o=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(i.clearDepthVal)),r&e.STENCIL_BUFFER_BIT&&(a=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(i.clearStencilVal)),e.clear(r),r&e.COLOR_BUFFER_BIT&&e.clearColor(s[0],s[1],s[2],s[3]),r&e.DEPTH_BUFFER_BIT&&e.clearDepth(o),r&e.STENCIL_BUFFER_BIT&&e.clearStencil(a)}i.sortAllChildren();for(var c=i._children,h=0;h<c.length;h++){var l=c[h];l!==i.sprite&&l._renderCmd.visit(i.sprite._renderCmd)}i.end()}},m.clearStencil=function(t){var e=n._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},m.cleanup=function(){this._node;this._textureCopy=null;var t=n._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},m.updateClearColor=function(t){},m.initWithWidthAndHeight=function(t,e,i,r){var s=this._node;i===n.Texture2D.PIXEL_FORMAT_A8&&n.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o=n._renderContext;this._fullRect=new n.Rect(0,0,t,e),this._fullViewport=new n.Rect(0,0,t,e),t=0|t,e=0|e,this._oldFBO=o.getParameter(o.FRAMEBUFFER_BINDING);var a,c;n.configuration.supportsNPOT()?(a=t,c=e):(a=ut.NextPOT(t),c=ut.NextPOT(e));for(var h=a*c*4,l=new Uint8Array(h),u=0;u<a*c*4;u++)l[u]=0;this._pixelFormat=i;var d=s._texture=new n.Texture2D;if(!s._texture)return!1;d.initWithData(l,s._pixelFormat,a,c,n.size(t,e));var _=o.getParameter(o.RENDERBUFFER_BINDING);if(n.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new n.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(l,s._pixelFormat,a,c,n.size(t,e))}this._fBO=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this._fBO),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,d._webTextureObj,0),0!==r&&(this._depthRenderBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,r,a,c),r===o.DEPTH_STENCIL?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):r===o.STENCIL_INDEX||r===o.STENCIL_INDEX8?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):r===o.DEPTH_COMPONENT16&&o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer)),o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&n.log("Could not attach texture to the framebuffer"),d.setAliasTexParameters();var f=s.sprite=new _ccsg.Sprite(d);return f.scaleY=-1,f.setBlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.bindRenderbuffer(o.RENDERBUFFER,_),o.bindFramebuffer(o.FRAMEBUFFER,this._oldFBO),s.autoDraw=!1,s.addChild(f),!0},m.begin=function(){var t=this._node;n.math.glMatrixMode(n.math.KM_GL_PROJECTION),n.math.glPushMatrix(),n.math.glMatrixMode(n.math.KM_GL_MODELVIEW),n.math.glPushMatrix();var e=n._renderContext,i=n.director;i.setProjection(i.getProjection());var r=t._texture.getContentSizeInPixels(),s=n.director.getWinSizeInPixels(),o=s.width/r.width,a=s.height/r.height,c=n.math.Matrix4.createOrthographicProjection(-1/o,1/o,-1/a,1/a,-1,1);n.math.glMultMatrix(c);var h=new n.Rect(0,0,0,0);h.width=this._fullViewport.width,h.height=this._fullViewport.height;var l=h.width/this._fullRect.width,u=h.height/this._fullRect.height;h.x=(this._fullRect.x-this._rtTextureRect.x)*l,h.y=(this._fullRect.y-this._rtTextureRect.y)*u,e.viewport(h.x,h.y,h.width,h.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),n.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},m._beginWithClear=function(t,e,i,r,s,o,a){t/=255,e/=255,i/=255,r/=255;var c=n._renderContext,h=[0,0,0,0],l=0,u=0;a&c.COLOR_BUFFER_BIT&&(h=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(t,e,i,r)),a&c.DEPTH_BUFFER_BIT&&(l=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(s)),a&c.STENCIL_BUFFER_BIT&&(u=c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(o)),c.clear(a),a&c.COLOR_BUFFER_BIT&&c.clearColor(h[0],h[1],h[2],h[3]),a&c.DEPTH_BUFFER_BIT&&c.clearDepth(l),a&c.STENCIL_BUFFER_BIT&&c.clearStencil(u)},m.end=function(){var t=this._node;n.renderer._renderingToBuffer(t.__instanceId);var e=n._renderContext,i=n.director;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),i.setViewport(),n.math.glMatrixMode(n.math.KM_GL_PROJECTION),n.math.glPopMatrix(),n.math.glMatrixMode(n.math.KM_GL_MODELVIEW),n.math.glPopMatrix()},m.clearRect=function(t,e,i,n){},m.clearDepth=function(t){var e=this._node;e.begin();var i=n._renderContext,r=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(r),e.end()},m.visit=function(t){var e=this._node;e._visible&&(n.kmGLPushMatrix(),this._syncStatus(t),n.renderer.pushRenderCommand(this),e.sprite.visit(this),this._dirtyFlag=0,n.math.glPopMatrix())}}).call(window,cc,ccui,ccs,cp)},{"../cocos2d/core/event/event-target":98,"../cocos2d/core/utils/misc":166,"../cocos2d/particle/CCPNGReader":196,"../cocos2d/particle/CCTIFFReader":199}],5:[function(t,e,i){cc.Action=cc._Class.extend({ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,i=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var i=this;e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!cc._rectEqualToZero(e),i._boundaryFullyCovered=!1;var n=cc.director.getWinSize();return i._fullScreenSize=cc.p(n.width,n.height),i._halfScreenSize=cc.pMult(i._fullScreenSize,.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0)),!0},step:function(t){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),n=cc.pSub(e,i),r=this.target.parent.convertToNodeSpaceAR(cc.pAdd(n,this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(r.x,this.leftBoundary,this.rightBoundary),cc.clampf(r.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(r.x,r.y)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}},{}],6:[function(t,e,i){function n(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(cc.p(t[i].x,t[i].y));return e}function r(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e}cc.cardinalSplineAt=function(t,e,i,n,r,s){var o=s*s,a=o*s,c=(1-r)/2,h=c*(-a+2*o-s),l=c*(-a+o)+(2*a-3*o+1),u=c*(a-2*o+s)+(-2*a+3*o),d=c*(a-o),_=t.x*h+e.x*l+i.x*u+n.x*d,f=t.y*h+e.y*l+i.y*u+n.y*d;return cc.p(_,f)},cc.getControlPointAt=function(t,e){var i=Math.min(t.length-1,Math.max(e,0));return t[i]},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw new Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,r(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i,n=this._points;if(1===t)e=n.length-1,i=1;else{var r=this._deltaT;e=0|t/r,i=(t-r*e)/r}var s=cc.cardinalSplineAt(cc.getControlPointAt(n,e-1),cc.getControlPointAt(n,e-0),cc.getControlPointAt(n,e+1),cc.getControlPointAt(n,e+2),this._tension,i);if(cc.macro.ENABLE_STACKABLE_ACTIONS){var o,a;if(o=this.target.getPositionX()-this._previousPosition.x,a=this.target.getPositionY()-this._previousPosition.y,0!==o||0!==a){var c=this._accumulatedDiff;o=c.x+o,a=c.y+a,c.x=o,c.y=a,s.x+=o,s.y+=a}}this.updatePosition(s)},reverse:function(){var t=n(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],r=1;r<e.length;++r)t=e[r],e[r]=cc.pSub(t,i),i=t;var s=n(e);i=s[s.length-1],s.pop(),i.x=-i.x,i.y=-i.y,s.unshift(i);for(var r=1;r<s.length;++r)t=s[r],t.x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,s[r]=t,i=t;return cc.cardinalSplineBy(this._duration,s,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,n=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=n,this.target.setPosition(i,n)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,r(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,r(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,r(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)}},{}],7:[function(t,e,i){cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0)},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=e,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){t*=2,t<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.easeInOut=function(t){return{_rate:t,easing:function(t){return t*=2,t<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialOutObj={easing:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t*=2,t=t<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2,t<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;t-=1,e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t=2*t,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=t<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t=2*t,i||(i=this._period=.3*1.5);var n=i/4;t-=1,e=t<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){
return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0;t<.5?(t=2*t,e=.5*(1-this.bounceTime(1-t))):e=.5*this.bounceTime(2*t-1)+.5,this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc._easeBounceInOutObj={easing:function(t){var e;return t<.5?(t=2*t,e=.5*(1-cc._bounceTime(1-t))):e=.5*cc._bounceTime(2*t-1)+.5,e},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){var e=1.70158;t=0===t||1===t?t:t*t*((e+1)*t-e),this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackInObj={easing:function(t){var e=1.70158;return 0===t||1===t?t:t*t*((e+1)*t-e)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){var e=1.70158;t-=1,this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackOutObj={easing:function(t){var e=1.70158;return t-=1,t*t*((e+1)*t+e)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){var e=2.5949095;t=2*t,t<1?this._inner.update(t*t*((e+1)*t-e)/2):(t-=2,this._inner.update(t*t*((e+1)*t+e)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc._easeBackInOutObj={easing:function(t){var e=2.5949095;return t=2*t,t<1?t*t*((e+1)*t-e)/2:(t-=2,t*t*((e+1)*t+e)/2+1)},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){var e=t;return t*=2,t<1?e=t*t*.5:(--t,e=-.5*(t*(t-2)-1)),e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t=2*t,t<1?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t=2*t,t<1?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t=2*t,t<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t=2*t,t<1?.5*t*t*t:(t-=2,.5*(t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut}},{}],8:[function(t,e,i){cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!0}},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!1}},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!n.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX((!this._flippedX))},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY((!this._flippedY))},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}},{}],9:[function(t,e,i){cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return t<=0?(cc.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(cc.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration+e._duration;return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){this._last!==-1&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i,n=0,r=this._split,s=this._actions,o=this._last;t=this._computeEaseTime(t),t<r?(e=0!==r?t/r:1,0===n&&1===o&&(s[1].update(0),s[1].stop())):(n=1,e=1===r?1:(t-r)/(1-r),o===-1&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),o||(s[0].update(1),s[0].stop())),i=s[n],o===n&&i.isDone()||(o!==n&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i,n,r,s;e&&e.length>0;)for(n=Array.prototype.shift.call(e),s=n._timesForRepeat||1,n._repeatMethod=!1,n._timesForRepeat=1,r=0,i||(i=n,r=1),r;r<s;r++)i=cc.Sequence._actionOneTwo(i,n);return i},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;t>=1&&this._total<n&&(e.update(1),this._total++),this._actionInstant||(this._total===n?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(i>=0&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),i>=0){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;e.length>0&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=e||0,this._dstAngleY=void 0!==i?i:this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;i>180&&(i-=360),i<-180&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;n>180&&(n-=360),n<-180&&(n+=360),this._diffAngleY=n},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=e||0,this._angleY=void 0!==i?i:this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,(-this._angleX),(-this._angleY));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,n=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),s=this.target.getPositionY(),o=this._previousPosition;n.x=n.x+r-o.x,n.y=n.y+s-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)}else this.target.setPosition(n.x+e,n.y+i)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,(-this._skewX),(-this._skewY));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),
t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var n=this._delta.x*t,r=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX(),o=this.target.getPositionY(),a=this._previousPosition;r.x=r.x+s-a.x,r.y=r.y+o-a.y,n+=r.x,i+=r.y,a.x=n,a.y=i,this.target.setPosition(n,i)}else this.target.setPosition(r.x+n,r.y+i)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=0,n=e[0].x,r=e[1].x,s=e[2].x,o=0,a=e[0].y,c=e[1].y,h=e[2].y,l=cc.bezierAt(i,n,r,s,t),u=cc.bezierAt(o,a,c,h,t),d=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var _=this.target.getPositionX(),f=this.target.getPositionY(),p=this._previousPosition;d.x=d.x+_-p.x,d.y=d.y+f-p.y,l+=d.x,u+=d.y,p.x=l,p.y=u,this.target.setPosition(l,u)}else this.target.setPosition(d.x+l,d.y+u)}},reverse:function(){var t=this._config,e=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],i=new cc.BezierBy(this._duration,e);return this._cloneDecoration(i),this._reverseEaseList(i),i}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,n=this._config;n[0]=cc.pSub(i[0],e),n[1]=cc.pSub(i[1],e),n[2]=cc.pSub(i[2],e)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.opacity=i>e/2?255:0}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(n=e.b,i=e.g,e=e.r),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,(-this._deltaR),(-this._deltaG),(-this._deltaB));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes;i.length=0;var n=0,r=e/t.getTotalDelayUnits(),s=t.getFrames();cc.js.array.verifyType(s,cc.AnimationFrame);for(var o=0;o<s.length;o++){var a=s[o],c=n*r/e;n+=a.getDelayUnits(),i.push(c)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){if(t=this._computeEaseTime(t),t<1){t*=this._animation.getLoops();var e=0|t;e>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1}for(var i=this._animation.getFrames(),n=i.length,r=this._splitTimes,s=this._nextFrame;s<n&&r[s]<=t;s++)_currFrameIndex=s,this.target.setSpriteFrame(i[_currFrameIndex].getSpriteFrame()),this._nextFrame=s+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.js.array.verifyType(e,cc.AnimationFrame),e.length>0)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}var s=new cc.SpriteFrameAnimation(i,t.getDelayPerUnit(),t.getLoops());s.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var o=new cc.Animate(s);return this._cloneDecoration(o),this._reverseEaseList(o),o},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}},{}],10:[function(t,e,i){t("./CCAction.js"),t("./CCActionInterval.js"),t("./CCActionInstant.js"),t("./CCActionEase.js"),t("./CCActionCatmullRom.js")},{"./CCAction.js":5,"./CCActionCatmullRom.js":6,"./CCActionEase.js":7,"./CCActionInstant.js":8,"./CCActionInterval.js":9}],11:[function(t,e,i){function n(t,e){a.call(this,t),this.animation=e}function r(t){var e=t.split(".");return e.shift(),e.length>0?e:null}function s(t,e){function i(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function n(t,n,s){var a,u=t instanceof cc.Node&&"position"===n,d=[];a=u?new h:new c,a.target=t;var _,f,p=n.indexOf("."),g=p!==-1;g?(_=n.slice(0,p),f=t[_]):_=n,a.prop=_,a.subProps=r(n);for(var m=0,v=s.length;m<v;m++){var y=s[m],T=y.frame/e.duration;if(a.ratios.push(T),u){var C=y.motionPath;C&&!i(C)&&(cc.error("motion path of target ["+t.name+"] in prop ["+n+"] frame ["+m+"] is not valid"),C=null),d.push(C)}var b=y.value;a.values.push(b);var x=y.curve;if(x){if("string"==typeof x){a.types.push(x);continue}if(Array.isArray(x)){x[0]===x[1]&&x[2]===x[3]?a.types.push(c.Linear):a.types.push(c.Bezier(x));continue}}a.types.push(c.Linear)}return u&&l(d,a,o.duration,o.sample),a}function s(t,e){var i=e.props,r=e.comps;if(i)for(var s in i){var o=i[s],c=n(t,s,o);a.push(c)}if(r)for(var h in r){var l=t.getComponent(h);if(l){var u=r[h];for(var s in u){var o=u[s],c=n(l,s,o);a.push(c)}}}}var o=e.clip,a=e.curves;a.length=0,e.duration=o.duration,e.speed=o.speed,e.wrapMode=o.wrapMode,e.frameRate=o.sample,(e.wrapMode&_.Loop)===_.Loop?e.repeatCount=1/0:e.repeatCount=1;var p=o.curveData,g=p.paths;s(t,p);for(var m in g){var v=cc.find(m,t);if(v){var y=g[m];s(v,y)}}var T=o.events;if(T)for(var C,b=0,x=T.length;b<x;b++){C||(C=new u,C.target=t,a.push(C));var S,E=T[b],A=E.frame/e.duration,O=f(C.ratios,A);O>=0?S=C.events[O]:(S=new d,C.ratios.push(A),C.events.push(S)),S.add(E.func,E.params)}}var o=cc.js,a=t("./animators").Animator,c=t("./animation-curves").DynamicAnimCurve,h=t("./animation-curves").SampledAnimCurve,l=t("./motion-path-helper").sampleMotionPaths,u=t("./animation-curves").EventAnimCurve,d=t("./animation-curves").EventInfo,_=t("./types").WrapModeMask,f=t("./binary-search");o.extend(n,a);var p=n.prototype;p.playState=function(t,e){t.clip&&(t.curveLoaded||s(this.target,t),this.addAnimation(t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},p.addAnimation=function(t){a.prototype.addAnimation.call(this,t);for(var e=this.animation._listeners,i=0,n=e.length;i<n;i++){var r=e[i];t.on(r[0],r[1],r[2],r[3])}},p.removeAnimation=function(t){a.prototype.removeAnimation.call(this,t),t.animator=null},p.sample=function(){for(var t=this.playingAnims,e=0;e<t.length;e++)t[e].sample()},p.stopState=function(t){t&&t.stop()},p.pauseState=function(t){t&&t.pause()},p.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},p.setStateTime=function(t,e){if(2===arguments.length)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this.playingAnims,n=0,r=i.length;n<r;n++)i[n].setTime(e),i[n].sample()}},p.onStop=function(){for(var t=this.playingAnims,e=t.length-1;e>=0;e--)t[e].stop();a.prototype.onStop.call(this)},p.onPause=function(){for(var t=this.playingAnims,e=0,i=t.length;e<i;e++)t[e].pause()},p.onResume=function(){for(var t=this.playingAnims,e=0,i=t.length;e<i;e++)t[e].resume()},p._reloadClip=function(t){s(this.target,t)},e.exports=n},{"./animation-curves":13,"./animators":16,"./binary-search":18,"./motion-path-helper":21,"./types":23}],12:[function(t,e,i){var n=cc.Class({name:"cc.AnimationClip","extends":cc.Asset,properties:{_duration:{"default":0,type:"Float"},duration:{get:function(){return this._duration}},sample:{"default":60},speed:{"default":1},wrapMode:{"default":cc.WrapMode.Normal},curveData:{"default":{},visible:!1},events:{"default":[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.error("sprite frames must be an Array."),null;var i=new n;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var r=[],s=1/i.sample,o=0,a=t.length;o<a;o++)r[o]={frame:o*s,value:t[o]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:r}}},i}}});cc.AnimationClip=e.exports=n},{}],13:[function(t,e,i){function n(t,e){if("string"==typeof e){var i=cc.Easing[e];i?t=i(t):cc.error("Can't find easing type ["+e+"]")}else Array.isArray(e)&&(t=r(e,t));return t}var r=t("./bezier").bezierByTime,s=t("./binary-search"),o=t("./types").WrapModeMask,a=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:function(){}}),c=cc.Class({name:"cc.DynamicAnimCurve","extends":a,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_calcValue:function(t,e){var i,n=this.values,r=n[t-1],s=n[t];return i="number"==typeof r?r+(s-r)*e:r&&r.lerp?r.lerp(s,e):r},_applyValue:function(t,e,i){t[e]=i},_findFrameIndex:s,sample:function(t,e,i){var r=this.values,s=this.ratios,o=s.length;if(0!==o){var a,c=this._findFrameIndex(s,e);if(c<0)if(c=~c,c<=0)a=r[0];else if(c>=o)a=r[o-1];else{var h=s[c-1],l=s[c],u=this.types[c-1],d=(e-h)/(l-h);d=n(d,u),a=this._calcValue(c,d)}else a=r[c];var _=this.subProps;if(_){for(var f=this.target[this.prop],p=f,g=0;g<_.length-1;g++){var m=_[g];if(!p)return;p=p[m]}var v=_[_.length-1];if(!p)return;this._applyValue(p,v,a),a=f}this._applyValue(this.target,this.prop,a)}}});c.Linear=null,c.Bezier=function(t){return t};var h=cc.Class({name:"cc.SampledAnimCurve","extends":c,_findFrameIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];if(e>r)return i;e=(e-n)/(r-n);var s=1/i,o=e/s,a=0|o,c=1e-6;return o-a<c?a:~(a+1)}}),l=function(){this.events=[]};l.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var u=cc.Class({name:"cc.EventAnimCurve","extends":a,properties:{target:null,ratios:[],events:[],_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)===0&&(t-=1),0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time),a=r.direction,c=s(this.ratios,r.ratio);c<0&&(c=~c-1,a<0&&(c+=1)),this._ignoreIndex!==c&&(this._ignoreIndex=NaN);var h=this._lastWrappedInfo;if(r.frameIndex=c,this._lastWrappedInfo=r,!h)return void this._fireEvent(c);var l=h.frameIndex,u=i.wrapMode,d=this._wrapIterations(r.iterations),_=this._wrapIterations(h.iterations),f=_!==-1&&d!==_;if(l===c&&f&&1===n)this._fireEvent(0);else if(l!==c||f){a=h.direction;do{if(l!==c){if(a===-1&&0===l&&c>0?((u&o.PingPong)===o.PingPong?a*=-1:l=n,_++):1===a&&l===n-1&&c<n-1&&((u&o.PingPong)===o.PingPong?a*=-1:l=-1,_++),l===c)break;if(_>d)break}l+=a,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[l])}while(l!==c&&l>-1&&l<n)}},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t))for(var e=this.events[t],i=e.events,n=this.target._components,r=0;r<i.length;r++)for(var s=i[r],o=s.func,a=0;a<n.length;a++){var c=n[a],h=c[o];h&&h.apply(c,s.params)}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var i=e.getWrappedInfo(t),n=i.direction,r=s(this.ratios,i.ratio);r<0&&(r=~r-1,n<0&&(r+=1),this._ignoreIndex=r)}});e.exports={AnimCurve:a,DynamicAnimCurve:c,SampledAnimCurve:h,EventAnimCurve:u,EventInfo:l,computeRatioByType:n}},{"./bezier":17,"./binary-search":18,"./types":23}],14:[function(t,e,i){var n=(cc.js,cc.Class({ctor:function(){this.animators=[],this.__instanceId=cc.ClassManager.getNewInstanceId(),this._updating=!1,this._removeList=[],this._delayEvents=[]},update:function(t){this._updating=!0;var e,i,n=this.animators;for(e=0,i=n.length;e<i;e++){var r=n[e];r._isPlaying&&!r._isPaused&&r.update(t)}this._updating=!1;var s=this._removeList;for(e=0,i=s.length;e<i;e++)this.removeAnimator(s[e]);s.length=0;var o=this._delayEvents;for(e=0,i=o.length;e<i;e++){var a=o[e];a.target[a.func].apply(a.target,a.args)}o.length=0},destruct:function(){},addAnimator:function(t){var e=this.animators.indexOf(t);e===-1&&this.animators.push(t),e=this._removeList.indexOf(t),e!==-1&&this._removeList.splice(e,1)},removeAnimator:function(t){var e=this.animators.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;i.indexOf(t)===-1&&i.push(t)}else this.animators.splice(e,1);else cc.error("animator not added or already removed")},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}}));cc.AnimationManager=e.exports=n},{}],15:[function(t,e,i){function n(t,e){s.call(this,null,null,{duration:t.length}),this._emit=this.emit,this.emit=function(){cc.director.getAnimationManager().pushDelayEvent(this,"_emit",arguments)},this._clip=t,this._name=e||t.name}var r=cc.js,s=t("./types").AnimationNode;r.extend(n,s);var o=n.prototype;r.get(o,"clip",function(){return this._clip}),r.get(o,"name",function(){return this._name}),r.obsolete(o,"AnimationState.length","duration"),r.getset(o,"curveLoaded",function(){return this.curves.length>0},function(){this.curves.length=0}),o.onPlay=function(){this.setTime(0),s.prototype.onPlay.call(this)},o.onStop=function(){s.prototype.onStop.call(this),this.animator&&this.animator.removeAnimation(this)},o.setTime=function(t){this.time=t||0;var e=this;this.curves.forEach(function(i){i.onTimeChangedManually(t,e)})},cc.AnimationState=e.exports=n},{"./types":23}],16:[function(t,e,i){function n(t){this.target=t,this.playingAnims=[],this._updating=!1,this._removeList=[]}function r(t){n.call(this,t)}function s(t){for(var e=0,i=0,n=t.length,r=0;r<n;r++){var s=t[r],o=s.ratio;if(0===r&&"number"!=typeof o?s.computedRatio=o=0:r===n-1&&"number"!=typeof o&&(s.computedRatio=o=1),"number"==typeof o){if(e+1<r)for(var a=r-e,c=(o-i)/a,h=e+1;h<r;h++)i+=c,t[h].computedRatio=i;e=r,i=o}}}function o(t,e,i){for(var n,r=0;r<t.length;r++)if(n=t[r],n.target===e&&n.prop===i)return n;return null}function a(t,e,i,n,r){var s=o(t,e,i);s||(s=new u,t.push(s),s.target=e,s.prop=i),s.values.push(n),s.ratios.push(r)}var c=cc.js,h=t("./playable"),l=t("./types").AnimationNode,u=t("./animation-curves").DynamicAnimCurve;c.extend(n,h);var d=n.prototype;d.update=function(t){this._updating=!0;var e,i,n=this.playingAnims,r=0;for(e=0,i=n.length;e<i;e++){var s=n[e];s._isPlaying&&!s._isPaused&&(s.update(t),s._isPlaying||r++)}this._updating=!1,(0===n.length||r>=n.length)&&this.stop();var o=this._removeList;for(e=0,i=o.length;e<i;e++)this.removeAnimation(o[e]);o.length=0},d.onPlay=function(){cc.director.getAnimationManager().addAnimator(this)},d.onStop=function(){cc.director.getAnimationManager().removeAnimator(this)},d.addAnimation=function(t){var e=this.playingAnims.indexOf(t);e===-1&&this.playingAnims.push(t),e=this._removeList.indexOf(t),e!==-1&&this._removeList.splice(e,1)},d.removeAnimation=function(t){var e=this.playingAnims.indexOf(t);if(e>=0)if(this._updating){var i=this._removeList;i.indexOf(t)===-1&&i.push(t)}else this.playingAnims.splice(e,1);else cc.error("animation not added or already removed")},c.extend(r,n);var _=r.prototype;_.animate=function(t,e){if(!t)return cc.error("[animate] keyFrames must be non-nil"),null;s(t);var i=this._doAnimate(t,e);return this.play(),i},_._doAnimate=function(t,e){var i=new l(this,null,e);i.play();for(var n=i.curves,r=-1,s=0;s<t.length;s++){var o=t[s],c=o.ratio;if("number"!=typeof c&&(c=o.computedRatio),c<0)cc.error("[animate] ratio should >= 0!");else if(c<r)cc.error("[animate] ratio should in the order of smallest to largest!");else{r=c;for(var h in o){var u=o[h];if("props"===h)for(var d in u)a(n,this.target,d,u[d],c);else if("comps"===h)for(var _ in u){var f=this.target.getComponent(_),p=u[_];for(var d in p)a(n,f,d,p[d],c)}}}}return this.playingAnims.push(i),i},e.exports={Animator:n,EntityAnimator:r}},{"./animation-curves":13,"./playable":22,"./types":23}],17:[function(t,e,i){function n(t,e,i,n,r){var s=1-r;return t*s*s*s+3*e*s*s*r+3*i*s*r*r+n*r*r*r}function r(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function s(t,e){var i,n,s,o,l,_=e-0,f=e-t[0],p=e-t[2],g=e-1,m=3*_,v=3*f,y=3*p,T=-_+v-y+g,C=1/T,b=1/3,x=(m-6*f+y)*C,S=x*b,E=(-m+v)*C,A=_*C,O=(3*E-x*x)*b,w=O*b,R=(2*x*x*x-9*x*E+27*A)/27,I=R/2,P=I*I+w*w*w;if(P<0){var N=-O*b,L=N*N*N,F=d(L),D=-R/(2*F),M=D<-1?-1:D>1?1:D,B=c(M),k=r(F),z=2*k;return s=z*a(B*b)-S,o=z*a((B+u)*b)-S,l=z*a((B+2*u)*b)-S,0<=s&&s<=1?0<=o&&o<=1?0<=l&&l<=1?h(s,o,l):h(s,o):0<=l&&l<=1?h(s,l):s:0<=o&&o<=1?0<=l&&l<=1?h(o,l):o:l}if(0===P)return i=I<0?r(-I):-r(I),s=2*i-S,o=-i-S,0<=s&&s<=1?0<=o&&o<=1?h(s,o):s:o;var V=d(P);return i=r(-I+V),n=r(I+V),s=i-n-S}function o(t,e){var i=s(t,e),n=0,r=t[1],o=t[3],a=1,c=1-i;return n*c*c*c+3*r*i*c*c+3*o*i*i*c+a*i*i*i}var a=Math.cos,c=Math.acos,h=Math.max,l=Math.PI,u=2*l,d=Math.sqrt;e.exports={bezier:n,bezierByTime:o}},{}],18:[function(t,e,i){function n(t,e){for(var i=0,n=t.length-1;i<=n;){var s=i+n>>1;if(Math.abs(t[s]-e)<r)return s;t[s]>e?n=s-1:i=s+1}return~i}var r=1e-6;e.exports=n},{}],19:[function(t,e,i){function n(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var r={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)))},elasticOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1)},elasticInOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)):i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};r.quadOutIn=n(r.quadIn,r.quadOut),r.cubicOutIn=n(r.cubicIn,r.cubicOut),r.quartOutIn=n(r.quartIn,r.quartOut),r.quintOutIn=n(r.quintIn,r.quintOut),r.sineOutIn=n(r.sineIn,r.sineOut),r.expoOutIn=n(r.expoIn,r.expoOut),r.circOutIn=n(r.circIn,r.circOut),r.backOutIn=n(r.backIn,r.backOut),r.backOutIn=n(r.backIn,r.backOut),r.bounceIn=function(t){return 1-r.bounceOut(1-t)},r.bounceInOut=function(t){return t<.5?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5},r.bounceOutIn=n(r.bounceIn,r.bounceOut),cc.Easing=e.exports=r},{}],20:[function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animators"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":11,"./animation-clip":12,"./animation-curves":13,"./animation-manager":14,"./animation-state":15,"./animators":16,"./bezier":17,"./easing":19,"./motion-path-helper":21,"./types":23}],21:[function(t,e,i){function n(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function r(){this.start=l(),this.end=l(),this.startCtrlPoint=l(),this.endCtrlPoint=l()}function s(t,e,i,r){function s(t){return t instanceof cc.Vec2?{"in":t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{"in":l(t[2],t[3]),pos:l(t[0],t[1]),out:l(t[4],t[5])}:{"in":cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function c(t,e,i){f.push(t),p.push(e),g.push(i)}var u=e.values;if(0!==t.length&&0!==u.length){if(u=u.map(function(t){return l(t[0],t[1])}),1===u.length)return void(e.values=u);for(var d=e.types,_=e.ratios,f=e.values=[],p=e.types=[],g=e.ratios=[],m=0,v=1e-6,y=o.Linear,T=0,C=t.length;T<C-1;T++){var b,x=t[T],S=_[T],E=_[T+1],A=E-S,O=u[T],w=u[T+1],R=d[T],I=[],P=m/A,N=1/(A*i*r);if(x&&x.length>0){var L=[];L.push(s(O));for(var F=0,D=x.length;F<D;F++){var M=s(x[F]);L.push(M)}L.push(s(w));var B=new n(L);B.computeBeziers();for(var k=B.progresses;1-P>v;){b=P,b=a(b,R);var z,V,W,U;if(b<0)V=B.beziers[0],U=(0-b)*V.getLength(),W=V.start.sub(V.endCtrlPoint).normalize(),z=V.start.add(W.mul(U));else if(b>1)V=B.beziers[B.beziers.length-1],U=(b-1)*V.getLength(),W=V.end.sub(V.startCtrlPoint).normalize(),z=V.end.add(W.mul(U));else{var G=h(k,b);G<0&&(G=~G),b-=G>0?k[G-1]:0,b/=B.ratios[G],z=B.beziers[G].getPointAt(b);
}I.push(z),P+=N}}else for(;1-P>v;)b=P,b=a(b,R),I.push(O.lerp(w,b)),P+=N;y="constant"===R?R:o.Linear;for(var F=0,D=I.length;F<D;F++){var X=S+m+N*F*A;c(I[F],y,X)}m=Math.abs(P-1)>v?(P-1)*A:0}_[_.length-1]!==g[g.length-1]&&c(u[u.length-1],y,_[_.length-1])}}var o=t("./animation-curves").DynamicAnimCurve,a=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,h=t("./binary-search"),l=cc.v2;n.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t,e=1;e<this.points.length;e++){var i=this.points[e-1],n=this.points[e];t=new r,t.start=i.pos,t.startCtrlPoint=i.out,t.end=n.pos,t.endCtrlPoint=n["in"],this.beziers.push(t),this.length+=t.getLength()}for(var s=0,e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=s+=this.ratios[e];return this.beziers},r.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},r.prototype.getPoint=function(t){var e=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new l(e,i)},r.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},r.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s+=cc.pDistance(e,r),n.push(s),r=e;return this.cacheArcLengths=n,n},r.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,s=n.length;i=e?e:t*n[s-1];for(var o,a=0,c=s-1;a<=c;)if(r=Math.floor(a+(c-a)/2),o=n[r]-i,o<0)a=r+1;else{if(!(o>0)){c=r;break}c=r-1}if(r=c,n[r]===i){var h=r/(s-1);return h}var l=n[r],u=n[r+1],d=u-l,_=(i-l)/d,h=(r+_)/(s-1);return h},e.exports={sampleMotionPaths:s,Curve:n,Bezier:r}},{"./animation-curves":13,"./bezier":17,"./binary-search":18}],22:[function(t,e,i){function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var r=cc.js,s=n.prototype;r.get(s,"isPlaying",function(){return this._isPlaying},!0),r.get(s,"isPaused",function(){return this._isPaused},!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},s.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this.onStop())},s.pause=function(){this._isPlaying&&(this._isPaused=!0,this.onPause())},s.resume=function(){this._isPlaying&&(this._isPaused=!1,this.onResume())},s.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=n},{}],23:[function(t,e,i){function n(t,e,i){if(c.call(this),this.animator=t,this.curves=e||[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=a.Normal,i){this.delay=i.delay||this.delay;var n=i.duration;"undefined"!=typeof n&&(this.duration=n);var r=i.speed;"undefined"!=typeof r&&(this.speed=r);var s=i.wrapMode;if("undefined"!=typeof s){var h="number"==typeof s;h?this.wrapMode=s:this.wrapMode=a[s]}var l=i.repeatCount;"undefined"!=typeof l?this.repeatCount=l:this.wrapMode&o.Loop&&(this.repeatCount=1/0)}this.time=0,this._timeNoScale=0,this._firstFramePlayed=!1,this._duringDelay=!1,this.delay>0&&(this._duringDelay=!0)}var r=cc.js,s=t("./playable"),o={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},a=cc.Enum({Default:0,Normal:1,Reverse:o.Reverse,Loop:o.Loop,LoopReverse:o.Loop|o.Reverse,PingPong:o.PingPong,PingPongReverse:o.PingPong|o.Reverse});cc.WrapMode=a;var c=function(){s.call(this)};r.extend(c,s),c.prototype.update=function(t){},r.extend(n,c),r.mixin(n.prototype,{update:function(t){if(this._duringDelay){if(this._timeNoScale+=t,this._timeNoScale<this.delay)return;this._duringDelay=!1}this._firstFramePlayed?this.time+=t*this.speed:this._firstFramePlayed=!0;var e=this.sample();this._lastWrappedInfo||(this._lastWrappedInfo=e);var i=(0|e.iterations)>(0|this._lastWrappedInfo.iterations);this.repeatCount>1&&i&&((this.wrapMode&o.Reverse)===o.Reverse?this._lastWrappedInfo.direction<0&&this.emit("lastframe",this):this._lastWrappedInfo.direction>0&&this.emit("lastframe",this)),e.stopped&&(this.stop(),this.emit("finished",this)),this._lastWrappedInfo=e},_needRevers:function(t){var e=this.wrapMode,i=!1;if((e&o.PingPong)===o.PingPong){var n=t-(0|t)===0;n&&t>0&&(t-=1);var r=1&t;r&&(i=!i)}return(e&o.Reverse)===o.Reverse&&(i=!i),i},getWrappedInfo:function(t){var e=!1,i=this.duration,n=0,r=this.wrapMode,s=Math.abs(t/i);s>this.repeatCount&&(s=this.repeatCount);var a=!1;r&o.ShouldWrap&&(a=this._needRevers(s));var c=a?-1:1;if(this.speed<0&&(c*=-1),s>=this.repeatCount){e=!0;var h=this.repeatCount-(0|this.repeatCount);0===h&&(h=1),t=h*i*(t>0?1:-1)}if(t>i){var l=t%i;t=0===l?i:l}else t<0&&(t%=i,0!==t&&(t+=i));return r&o.ShouldWrap&&a&&(t=i-t),n=t/i,{ratio:n,time:t,direction:c,stopped:e,iterations:s}},sample:function(){for(var t=this.getWrappedInfo(this.time),e=this.curves,i=0,n=e.length;i<n;i++){var r=e[i];r.sample(t.time,t.ratio,this)}return t},onStop:function(){this.emit("stop",this)},onPlay:function(){this.emit("play",this)},onPause:function(){this.emit("pause",this)},onResume:function(){this.emit("resume",this)}}),cc.defineGetterSetter(n.prototype,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&o.Loop?this.repeatCount=1/0:this.repeatCount=1}),cc.js.mixin(n.prototype,cc.EventTarget.prototype),cc.AnimationNode=n,e.exports={WrapModeMask:o,WrapMode:a,AnimationNode:n}},{"./playable":22}],24:[function(t,e,i){var n=t("../core/event/event-target"),r=!1,s=[],o=function(t){n.call(this),this._src=t,this._audioType=o.Type.UNKNOWN,this._element=null,this._eventList={},this._state=o.State.INITIALZING,this._loaded=!1,this._onended=function(){this.emit("ended")}.bind(this)};cc.js.extend(o,n),o.Type={DOM:"AUDIO",WEBAUDIO:"WEBAUDIO",NATIVE:"NATIVE",UNKNOWN:"UNKNOWN"},o.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2},function(t){t.preload=function(){var t=this._src,e=this,i=cc.loader.getItem(t);return i?void(i.complete&&(e.mount(i.element||i.buffer),e.emit("load"))):cc.loader.load(t,function(i){if(!i){var n=cc.loader.getItem(t);e.mount(n.element||n.buffer),e.emit("load")}})},t._bindEnded=function(t){t=t||this._onended,this._audioType===o.Type.DOM?this._element.addEventListener("ended",t):this._element.onended=t},t._unbindEnded=function(){this._audioType===o.Type.DOM?this._element.removeEventListener("ended",this._onended):this._element.onended=null},t.mount=function(t){t instanceof HTMLElement?(this._element=document.createElement("audio"),this._element.src=t.src,this._audioType=o.Type.DOM):(this._element=new a(t,this),this._audioType=o.Type.WEBAUDIO),this._bindEnded(),this._state=o.State.INITIALZING,this._loaded=!0},t.play=function(){this._element&&(this._element.play(),this.emit("play"),this._state=o.State.PLAYING,this._audioType===o.Type.DOM&&this._element.paused&&s.push({instance:this,offset:0,audio:this._element}),r||(r=!0,cc.game.canvas.addEventListener("touchstart",function(){for(var t;t=s.pop();)t.audio.play(t.offset)})))},t.pause=function(){this._element&&(this._unbindEnded(),this._element.pause(),this.emit("pause"),this._state=o.State.PAUSED)},t.resume=function(){this._element&&0!==this._element.currentTime&&(this._bindEnded(),this._element.play(),this.emit("resume"),this._state=o.State.PLAYING)},t.stop=function(){if(this._element){try{this._element.currentTime=0}catch(t){}this._element.pause();for(var e=0;e<s;e++)if(s[e].instance===this){s.splice(e,1);break}this.emit("ended"),this.emit("stop"),this._state=o.State.PAUSED}},t.setLoop=function(t){this._element&&(this._element.loop=t)},t.getLoop=function(){return this._element&&this._element.loop},t.setVolume=function(t){this._element&&(this._element.volume=t)},t.getVolume=function(){return this._element?this._element.volume:1},t.setCurrentTime=function(t){this._element&&(this._unbindEnded(),this._bindEnded(function(){this._bindEnded()}.bind(this)),this._element.currentTime=t)},t.getCurrentTime=function(){return this._element?this._element.currentTime:0},t.getDuration=function(){return this._element?this._element.duration:0},t.getState=function(){var t=this._element;return o.State.PLAYING===this._state&&t.paused&&(this._state=o.State.PAUSED),this._state},t.__defineGetter__("src",function(){return this._src}),t.__defineSetter__("src",function(t){return this._src=t})}(o.prototype);var a=function(t,e){this._audio=e,this._context=cc.sys.__audioSupport.context,this._buffer=t,this._volume=this._context.createGain(),this._volume.gain.value=1,this._volume.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null};!function(t){t.play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._volume),e.loop=this._loop,this._startTime=this._context.currentTime,t=t||this.playedLength,t&&(this._startTime-=t);var i,n=this._buffer.duration,r=t;if(this._loop?e.start?e.start(0,r):e.notoGrainOn?e.noteGrainOn(0,r):e.noteOn(0,r):(i=n-t,e.start?e.start(0,r,i):e.notoGrainOn?e.noteGrainOn(0,r,i):e.noteOn(0,r,i)),this._currentSource=e,e.onended=function(){this.onended&&this.onended(this)}.bind(this),0===this._context.currentTime){var o=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){0===o._context.currentTime&&s.push({instance:o._audio,offset:t,audio:o})},10)}},t.pause=function(){if(clearTimeout(this._currextTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},t.__defineGetter__("paused",function(){return(!this._currentSource||!this._currentSource.loop)&&(this._startTime===-1||this._context.currentTime-this._startTime>this._buffer.duration)}),t.__defineGetter__("loop",function(){return this._loop}),t.__defineSetter__("loop",function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t}),t.__defineGetter__("volume",function(){return this._volume.gain.value}),t.__defineSetter__("volume",function(t){return this._volume.gain.value=t,cc.sys.os!==cc.sys.OS_IOS||this.paused||(this.pause(),this.play()),t}),t.__defineGetter__("currentTime",function(){return this.paused?this.playedLength:(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,this.playedLength)}),t.__defineSetter__("currentTime",function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t}),t.__defineGetter__("duration",function(){return this._buffer.duration})}(a.prototype),e.exports=cc.Audio=o},{"../core/event/event-target":98}],25:[function(t,e,i){var n=t("./CCAudio"),r=0,s={},o={},a=function(t){var e=r++,i=o[t];i||(i=o[t]=[]);var a;if(h._maxAudioInstance<=i.length){var c=i.shift(),l=s[c];l.stop()}return a=new n(t),a.on("ended",function(){var t=this.instanceId;delete s[t];var e=i.indexOf(t);cc.js.array.fastRemoveAt(i,e)}),s[e]=a,a.instanceId=e,i.push(e),a},c=function(t){return s[t]},h={AudioState:n.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:s,play:function(t,e,i){var n=a(t),r=function(){n.setLoop(e||!1),n.setVolume(i||1),n.play()};return n.__callback=r,n.on("load",r),n.preload(),n.instanceId},setLoop:function(t,e){var i=c(t);i&&i.setLoop&&i.setLoop(e)},isLoop:function(t){var e=c(t);return!(!e||!e.isLoop)&&e.isLoop()},setVolume:function(t,e){var i=c(t);i&&(i._loaded||i.once("load",function(){i.setVolume&&i.setVolume(e)}),i.setVolume&&i.setVolume(e))},getVolume:function(t){var e=c(t);return e&&e.getVolume?e.getVolume():1},setCurrentTime:function(t,e){var i=c(t);return!!i&&(i._loaded?(i.setCurrentTime&&i.setCurrentTime(e),!0):(i.once("load",function(){i.setCurrentTime&&i.setCurrentTime(e)}),!0))},getCurrentTime:function(t){var e=c(t);return e&&e.getCurrentTime?e.getCurrentTime():0},getDuration:function(t){var e=c(t);return e&&e.getDuration?e.getDuration():0},getState:function(t){var e=c(t);return e&&e.getState?e.getState():this.AudioState.ERROR},setFinishCallback:function(t,e){var i=c(t);i&&(i.off("ended"),i.on("ended",e))},pause:function(t){var e=c(t);return!(!e||!e.pause)&&(e.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var t in s){var e=s[t],i=e.getState();i===n.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){var e=c(t);return!(!e||!e.resume)&&void(0===e.getCurrentTime()?e.play():e.resume())},resumeAll:function(){for(;this._pauseIDCache.length>0;){var t=this._pauseIDCache.pop(),e=c(t);e&&e.resume&&e.resume()}},stop:function(t){var e=c(t);return!(!e||!e.stop)&&(e.off("load",e.__callback),e.stop(),e.emit("ended"),!0)},stopAll:function(){for(var t in s){var e=s[t];e&&e.stop&&(e.stop(),e.off("load",e.__callback),e.emit("ended"))}},setMaxAudioInstance:function(t){return this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=o[t];if(e)for(;e.length>0;){var i=e.pop(),n=s[i];n&&(n.stop(),delete s[i])}},uncacheAll:function(){this.stopAll(),s={},o={}},getProfile:function(t){},preload:function(t,e){cc.loader.load(t,function(t){t||e()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){this._breakCache=[];for(var t in s){var e=s[t],i=e.getState();i===n.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var t=this._breakCache.pop(),e=c(t);e&&e.resume&&e.resume()}this._breakCache=null}}};e.exports=cc.audioEngine=h;var l=t("./deprecated");l.removed(h),l.deprecated(h)},{"./CCAudio":24,"./deprecated":26}],26:[function(t,e,i){var n=cc.js;cc._LogInfos.deprecated;i.removed=function(t){function e(){cc.error("Sorry, cc.audioEngine.willPlayMusic is removed.")}n.getset(t,"willPlayMusic",e,e)},i.deprecated=function(t){var e=-1,i=1,r=1,s=1,o=1,a=[];n.get(t,"playMusic",function(){return function(n,o){return t.stop(e),e=t.play(n,o,s),i=n,r=o,e}}),n.get(t,"stopMusic",function(){return function(){return t.stop(e),e}}),n.get(t,"pauseMusic",function(){return function(){return t.pause(e),e}}),n.get(t,"resumeMusic",function(){return function(){return t.resume(e),e}}),n.get(t,"rewindMusic",function(){return function(){return t.setCurrentTime(e,0),e}}),n.get(t,"getMusicVolume",function(){return function(){return s}}),n.get(t,"setMusicVolume",function(){return function(i){return s=i,t.setVolume(e,s),s}}),n.get(t,"isMusicPlaying",function(){return function(){return t.getState(e)===t.AudioState.PLAYING}}),n.get(t,"playEffect",function(){return function(e,i,n){return t.play(e,i,void 0===n?o:n)}}),n.get(t,"setEffectsVolume",function(i){return function(i){o=i;var n=t._id2audio;for(var r in n)r!==e&&t.setVolume(r,i)}}),n.get(t,"getEffectsVolume",function(){return function(){return o}}),n.get(t,"pauseEffect",function(){return function(e){return t.pause(e)}}),n.get(t,"pauseAllEffects",function(){return function(){a.length=0;var i=t._id2audio;for(var n in i)if(n!==e){var r=i[n],s=r.getState();s===t.AudioState.PLAYING&&(a.push(n),r.pause())}}}),n.get(t,"resumeEffect",function(){return function(e){t.resume(e)}}),n.get(t,"resumeAllEffects",function(){return function(){for(var e=t._id2audio;a.length>0;){var i=a.pop(),n=e[i];n&&n.resume&&n.resume()}}}),n.get(t,"stopEffect",function(){return function(e){return t.stop(e)}}),n.get(t,"stopAllEffects",function(){return function(){var i=t._id2audio;for(var n in i)if(n!==e){var r=i[n],s=r.getState();s===t.AudioState.PLAYING&&r.stop()}}}),n.get(t,"unloadEffect",function(){return function(e){return t.stop(e)}}),n.get(t,"end",function(){return function(){return t.stopAll()}})}},{}],27:[function(t,e,i){cc.Codec={name:"Jacob__Codec"},cc.Codec.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.Codec.unzipBase64=function(){var t=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);try{return cc.Codec.GZip.gunzip.call(cc.Codec.GZip,t)}catch(e){return t.slice(7)}},cc.Codec.unzipBase64AsArray=function(t,e){e=e||1;var i,n,r,s=this.unzipBase64(t),o=[];for(i=0,r=s.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o},cc.Codec.unzipAsArray=function(t,e){e=e||1;var i,n,r,s=this.unzip(t),o=[];for(i=0,r=s.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o}},{}],28:[function(t,e,i){cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var e,i,n,r,s,o,a,c=[],h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)r=this._keyStr.indexOf(t.charAt(h++)),s=this._keyStr.indexOf(t.charAt(h++)),o=this._keyStr.indexOf(t.charAt(h++)),a=this._keyStr.indexOf(t.charAt(h++)),e=r<<2|s>>4,i=(15&s)<<4|o>>2,n=(3&o)<<6|a,c.push(String.fromCharCode(e)),64!==o&&c.push(String.fromCharCode(i)),64!==a&&c.push(String.fromCharCode(n));return c=c.join("")},cc.Codec.Base64.decodeAsArray=function(t,e){var i,n,r,s=this.decode(t),o=[];for(i=0,r=s.length/e;i<r;i++)for(o[i]=0,n=e-1;n>=0;--n)o[i]+=s.charCodeAt(i*e+n)<<8*n;return o}},{}],29:[function(t,e,i){cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0},cc.Codec.GZip.gunzip=function(t){t.constructor===Array||t.constructor===String;var e=new cc.Codec.GZip(t);return e.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},cc.Codec.GZip.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=cc.Codec.GZip.bitReverse[e]>>8-t),e},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,t=this.IsPat(),t>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if(t=this.IsPat(),t>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(t,e,i,n){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(t){for(var e,i,n,r=0,s=t[r];;)if(n=this.readBit()){if(!(32768&s.b1))return s.b1;for(s=s.jump,e=t.length,i=0;i<e;i++)if(t[i]===s){r=i;break}}else{if(!(32768&s.b0))return s.b0;r++,s=t[r]}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,i,n,r;do if(t=this.readBit(),i=this.readBits(2),0===i){var s,o;for(this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,65535&(s^~o)&&document.write("BlockLen checksum mismatch\n");s--;)e=this.readByte(),this.addBuffer(e)}else if(1===i)for(var a;;)if(a=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,a>23?(a=a<<1|this.readBit(),a>199?(a-=128,a=a<<1|this.readBit()):(a-=48,a>143&&(a+=136))):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;var r,c;for(a-=257,r=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[a]>8?(c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8):c=this.readBits(cc.Codec.GZip.cpdext[a]),c+=cc.Codec.GZip.cpdist[a],a=0;a<r;a++){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else if(2===i){var a,h,l,u,d,_=new Array(320);for(l=257+this.readBits(5),u=1+this.readBits(5),d=4+this.readBits(4),a=0;a<19;a++)_[a]=0;for(a=0;a<d;a++)_[cc.Codec.GZip.border[a]]=this.readBits(3);for(r=this.distanceTree.length,n=0;n<r;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,_,0))return this.flushBuffer(),1;h=l+u,n=0;for(var f=-1;n<h;)if(f++,a=this.DecodeValue(this.distanceTree),a<16)_[n++]=a;else if(16===a){var p;if(a=3+this.readBits(2),n+a>h)return this.flushBuffer(),1;for(p=n?_[n-1]:0;a--;)_[n++]=p}else{if(a=17===a?3+this.readBits(3):11+this.readBits(7),n+a>h)return this.flushBuffer(),1;for(;a--;)_[n++]=0}for(r=this.literalTree.length,n=0;n<r;n++)this.literalTree[n]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,l,_,0))return this.flushBuffer(),1;for(r=this.literalTree.length,n=0;n<r;n++)this.distanceTree[n]=new cc.Codec.GZip.HufNode;var g=new Array;for(n=l;n<_.length;n++)g[n-l]=_[n];if(this.CreateTree(this.distanceTree,u,g,0))return this.flushBuffer(),1;for(;;)if(a=this.DecodeValue(this.literalTree),a>=256){var r,c;if(a-=256,0===a)break;for(a--,r=this.readBits(cc.Codec.GZip.cplext[a])+cc.Codec.GZip.cplens[a],a=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[a]>8?(c=this.readBits(8),c|=this.readBits(cc.Codec.GZip.cpdext[a]-8)<<8):c=this.readBits(cc.Codec.GZip.cpdext[a]),c+=cc.Codec.GZip.cpdist[a];r--;){var e=this.buf32k[this.bIdx-c&32767];this.addBuffer(e)}}else this.addBuffer(a)}while(!t);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8,i|=this.readByte()<<16,i|=this.readByte()<<24;var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8;var s=this.readByte();for(s|=this.readByte()<<8,a=0,this.nameBuf=[];r--;){var o=this.readByte();"/"===o|":"===o?a=0:a<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(o))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<s;)o=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},cc.Codec.GZip.prototype.skipdir=function(){var t,e,i,n,r,s=[];if(8&this.gpflags&&(s[0]=this.readByte(),s[1]=this.readByte(),s[2]=this.readByte(),s[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24),this.modeZIP&&this.nextFile(),s[0]=this.readByte(),8!==s[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),i=this.readByte(),4&this.gpflags)for(s[0]=this.readByte(),s[2]=this.readByte(),this.len=s[0]+256*s[1],n=0;n<this.len;n++)this.readByte();if(8&this.gpflags)for(n=0,this.nameBuf=[];r=this.readByte();)"7"!==r&&":"!==r||(n=0),n<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[n++]=r);if(16&this.gpflags)for(;r=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24,this.modeZIP&&this.nextFile()}},{}],30:[function(t,e,i){t("./ZipUtils"),t("./base64"),t("./gzip"),t("./zlib.min")},{"./ZipUtils":27,"./base64":28,"./gzip":29,"./zlib.min":31}],31:[function(t,e,i){(function(){"use strict";function t(t){throw t}function e(t,e){var i=t.split("."),n=T;!(i[0]in n)&&n.execScript&&n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||e===v?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t){if("string"==typeof t){var e,i,n=t.split("");for(e=0,i=n.length;e<i;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var r,s=1,o=0,a=t.length,c=0;0<a;){r=1024<a?1024:a,a-=r;do s+=t[c++],o+=s;while(--r);s%=65521,o%=65521}return(o<<16|s)>>>0}function n(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(C?Uint8Array:Array)?e:new(C?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(t){this.buffer=new(C?Uint16Array:Array)(2*t),this.length=0}function s(t){var e,i,n,r,s,o,a,c,h,l=t.length,u=0,d=Number.POSITIVE_INFINITY;for(c=0;c<l;++c)t[c]>u&&(u=t[c]),t[c]<d&&(d=t[c]);for(e=1<<u,i=new(C?Uint32Array:Array)(e),n=1,r=0,s=2;n<=u;){for(c=0;c<l;++c)if(t[c]===n){for(o=0,a=r,h=0;h<n;++h)o=o<<1|1&a,a>>=1;for(h=o;h<e;h+=s)i[h]=n<<16|c;++r}++n,r<<=1,s<<=1}return[i,u,d]}function o(t,e){this.h=I,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=C&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(C?Uint8Array:Array)(32768))}function a(t,e){this.length=t,this.G=e}function c(){var e=L;switch(y){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}function h(e,i){function n(e,i){var n,r=e.G,s=[],o=0;n=M[e.length],s[o++]=65535&n,s[o++]=n>>16&255,s[o++]=n>>24;var a;switch(y){case 1===r:a=[0,r-1,0];break;case 2===r:a=[1,r-2,0];break;case 3===r:a=[2,r-3,0];break;case 4===r:a=[3,r-4,0];break;case 6>=r:a=[4,r-5,1];break;case 8>=r:a=[5,r-7,1];break;case 12>=r:a=[6,r-9,2];break;case 16>=r:a=[7,r-13,2];break;case 24>=r:a=[8,r-17,3];break;case 32>=r:a=[9,r-25,3];break;case 48>=r:a=[10,r-33,4];break;case 64>=r:a=[11,r-49,4];break;case 96>=r:a=[12,r-65,5];break;case 128>=r:a=[13,r-97,5];break;case 192>=r:a=[14,r-129,6];break;case 256>=r:a=[15,r-193,6];break;case 384>=r:a=[16,r-257,7];break;case 512>=r:a=[17,r-385,7];break;case 768>=r:a=[18,r-513,8];break;case 1024>=r:a=[19,r-769,8];break;case 1536>=r:a=[20,r-1025,9];break;case 2048>=r:a=[21,r-1537,9];break;case 3072>=r:a=[22,r-2049,10];break;case 4096>=r:a=[23,r-3073,10];break;case 6144>=r:a=[24,r-4097,11];break;case 8192>=r:a=[25,r-6145,11];break;case 12288>=r:a=[26,r-8193,12];break;case 16384>=r:a=[27,r-12289,12];break;case 24576>=r:a=[28,r-16385,13];break;case 32768>=r:a=[29,r-24577,13];break;default:t("invalid distance")}n=a,s[o++]=n[0],s[o++]=n[1],s[o++]=n[2];var c,h;for(c=0,h=s.length;c<h;++c)p[g++]=s[c];T[s[0]]++,b[s[3]]++,m=e.length+i-1,d=null}var r,s,o,c,h,l,u,d,_,f={},p=C?new Uint16Array(2*i.length):[],g=0,m=0,T=new(C?Uint32Array:Array)(286),b=new(C?Uint32Array:Array)(30),x=e.w;if(!C){for(o=0;285>=o;)T[o++]=0;for(o=0;29>=o;)b[o++]=0}for(T[256]=1,r=0,s=i.length;r<s;++r){for(o=h=0,c=3;o<c&&r+o!==s;++o)h=h<<8|i[r+o];if(f[h]===v&&(f[h]=[]),l=f[h],!(0<m--)){for(;0<l.length&&32768<r-l[0];)l.shift();if(r+3>=s){for(d&&n(d,-1),o=0,c=s-r;o<c;++o)_=i[r+o],p[g++]=_,++T[_];break}if(0<l.length){var S=v,E=v,A=0,O=v,w=v,R=v,I=v,P=i.length,w=0,I=l.length;t:for(;w<I;w++){if(S=l[I-w-1],O=3,3<A){for(R=A;3<R;R--)if(i[S+R-1]!==i[r+R-1])continue t;O=A}for(;258>O&&r+O<P&&i[S+O]===i[r+O];)++O;if(O>A&&(E=S,A=O),258===O)break}u=new a(A,r-E),d?d.length<u.length?(_=i[r-1],p[g++]=_,++T[_],n(u,0)):n(d,-1):u.length<x?d=u:n(u,0)}else d?n(d,-1):(_=i[r],p[g++]=_,++T[_])}l.push(r)}return p[g++]=256,T[256]++,e.L=T,e.K=b,C?p.subarray(0,g):p}function l(t,e){function i(t){var e=x[t][S[t]];e===m?(i(t+1),i(t+1)):--T[e],++S[t]}var n,s,o,a,c,h=t.length,l=new r(572),u=new(C?Uint8Array:Array)(h);if(!C)for(a=0;a<h;a++)u[a]=0;for(a=0;a<h;++a)0<t[a]&&l.push(a,t[a]);if(n=Array(l.length/2),s=new(C?Uint32Array:Array)(l.length/2),1===n.length)return u[l.pop().index]=1,u;for(a=0,c=l.length/2;a<c;++a)n[a]=l.pop(),s[a]=n[a].value;var d,_,f,p,g,m=s.length,v=new(C?Uint16Array:Array)(e),y=new(C?Uint8Array:Array)(e),T=new(C?Uint8Array:Array)(m),b=Array(e),x=Array(e),S=Array(e),E=(1<<e)-m,A=1<<e-1;for(v[e-1]=m,_=0;_<e;++_)E<A?y[_]=0:(y[_]=1,E-=A),E<<=1,v[e-2-_]=(v[e-1-_]/2|0)+m;for(v[0]=y[0],b[0]=Array(v[0]),x[0]=Array(v[0]),_=1;_<e;++_)v[_]>2*v[_-1]+y[_]&&(v[_]=2*v[_-1]+y[_]),b[_]=Array(v[_]),x[_]=Array(v[_]);for(d=0;d<m;++d)T[d]=e;for(f=0;f<v[e-1];++f)b[e-1][f]=s[f],x[e-1][f]=f;for(d=0;d<e;++d)S[d]=0;for(1===y[e-1]&&(--T[0],++S[e-1]),_=e-2;0<=_;--_){for(p=d=0,g=S[_+1],f=0;f<v[_];f++)p=b[_+1][g]+b[_+1][g+1],p>s[d]?(b[_][f]=p,
x[_][f]=m,g+=2):(b[_][f]=s[d],x[_][f]=d,++d);S[_]=0,1===y[_]&&i(_)}for(o=T,a=0,c=n.length;a<c;++a)u[n[a].index]=o[a];return u}function u(e){var i,n,r,s,o=new(C?Uint16Array:Array)(e.length),a=[],c=[],h=0;for(i=0,n=e.length;i<n;i++)a[e[i]]=(0|a[e[i]])+1;for(i=1,n=16;i<=n;i++)c[i]=h,h+=0|a[i],h>1<<i&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),i=0,n=e.length;i<n;i++)for(h=c[e[i]],c[e[i]]+=1,r=o[i]=0,s=e[i];r<s;r++)o[i]=o[i]<<1|1&h,h>>>=1;return o}function d(t,e){this.input=t,this.a=new(C?Uint8Array:Array)(32768),this.h=B.j;var i,n={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)n[i]=e[i];n.outputBuffer=this.a,this.z=new o(this.input,n)}function _(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=C?new Uint8Array(e):e,this.s=!1,this.m=z,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case k:this.b=32768,this.a=new(C?Uint8Array:Array)(32768+this.l+258);break;case z:this.b=0,this.a=new(C?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}function f(e,i){for(var n,r=e.g,s=e.e,o=e.input,a=e.c;s<i;)n=o[a++],n===v&&t(Error("input buffer is broken")),r|=n<<s,s+=8;return n=r&(1<<i)-1,e.g=r>>>i,e.e=s-i,e.c=a,n}function p(e,i){for(var n,r,s,o=e.g,a=e.e,c=e.input,h=e.c,l=i[0],u=i[1];a<u;)n=c[h++],n===v&&t(Error("input buffer is broken")),o|=n<<a,a+=8;return r=l[o&(1<<u)-1],s=r>>>16,e.g=o>>s,e.e=a-s,e.c=h,65535&r}function g(t){function e(t,e,i){var n,r,s,o;for(o=0;o<t;)switch(n=p(this,e)){case 16:for(s=3+f(this,2);s--;)i[o++]=r;break;case 17:for(s=3+f(this,3);s--;)i[o++]=0;r=0;break;case 18:for(s=11+f(this,7);s--;)i[o++]=0;r=0;break;default:r=i[o++]=n}return i}var i,n,r,o,a=f(t,5)+257,c=f(t,5)+1,h=f(t,4)+4,l=new(C?Uint8Array:Array)(X.length);for(o=0;o<h;++o)l[X[o]]=f(t,3);i=s(l),n=new(C?Uint8Array:Array)(a),r=new(C?Uint8Array:Array)(c),t.o(s(e.call(t,a,i,n)),s(e.call(t,c,i,r)))}function m(e,i){var n,r;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),n=e[this.c++],r=e[this.c++],15&n){case gt:this.method=gt;break;default:t(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&t(Error("invalid fcheck flag:"+((n<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new _(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var v=void 0,y=!0,T=this,C="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;n.prototype.f=function(){var t,e=this.buffer,i=e.length,n=new(C?Uint8Array:Array)(i<<1);if(C)n.set(e);else for(t=0;t<i;++t)n[t]=e[t];return this.buffer=n},n.prototype.d=function(t,e,i){var n,r=this.buffer,s=this.index,o=this.i,a=r[s];if(i&&1<e&&(t=8<e?(O[255&t]<<24|O[t>>>8&255]<<16|O[t>>>16&255]<<8|O[t>>>24&255])>>32-e:O[t]>>8-e),8>e+o)a=a<<e|t,o+=e;else for(n=0;n<e;++n)a=a<<1|t>>e-n-1&1,8===++o&&(o=0,r[s++]=O[a],a=0,s===r.length&&(r=this.f()));r[s]=a,this.buffer=r,this.i=o,this.index=s},n.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=O[e[i]],i++),C?t=e.subarray(0,i):(e.length=i,t=e),t};var b,x=new(C?Uint8Array:Array)(256);for(b=0;256>b;++b){for(var S=b,E=S,A=7,S=S>>>1;S;S>>>=1)E<<=1,E|=1&S,--A;x[b]=(E<<A&255)>>>0}var O=x,w=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];C&&new Uint32Array(w),r.prototype.getParent=function(t){return 2*((t-2)/4|0)},r.prototype.push=function(t,e){var i,n,r,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(n=this.getParent(i),s[i]>s[n]);)r=s[i],s[i]=s[n],s[n]=r,r=s[i+1],s[i+1]=s[n+1],s[n+1]=r,i=n;return this.length},r.prototype.pop=function(){var t,e,i,n,r,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],r=0;(n=2*r+2,!(n>=this.length))&&(n+2<this.length&&s[n+2]>s[n]&&(n+=2),s[n]>s[r]);)i=s[r],s[r]=s[n],s[n]=i,i=s[r+1],s[r+1]=s[n+1],s[n+1]=i,r=n;return{index:t,value:e,length:this.length}};var R,I=2,P={NONE:0,r:1,j:I,N:3},N=[];for(R=0;288>R;R++)switch(y){case 143>=R:N.push([R+48,8]);break;case 255>=R:N.push([R-144+400,9]);break;case 279>=R:N.push([R-256+0,7]);break;case 287>=R:N.push([R-280+192,8]);break;default:t("invalid literal: "+R)}o.prototype.n=function(){var e,i,r,s,o=this.input;switch(this.h){case 0:for(r=0,s=o.length;r<s;){i=C?o.subarray(r,r+65535):o.slice(r,r+65535),r+=i.length;var a=i,c=r===s,d=v,_=v,f=v,p=v,g=v,m=this.a,T=this.b;if(C){for(m=new Uint8Array(this.a.buffer);m.length<=T+a.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(d=c?1:0,m[T++]=0|d,_=a.length,f=~_+65536&65535,m[T++]=255&_,m[T++]=_>>>8&255,m[T++]=255&f,m[T++]=f>>>8&255,C)m.set(a,T),T+=a.length,m=m.subarray(0,T);else{for(p=0,g=a.length;p<g;++p)m[T++]=a[p];m.length=T}this.b=T,this.a=m}break;case 1:var b=new n(new Uint8Array(this.a.buffer),this.b);b.d(1,1,y),b.d(1,2,y);var x,S,E,A=h(this,o);for(x=0,S=A.length;x<S;x++)if(E=A[x],n.prototype.d.apply(b,N[E]),256<E)b.d(A[++x],A[++x],y),b.d(A[++x],5),b.d(A[++x],A[++x],y);else if(256===E)break;this.a=b.finish(),this.b=this.a.length;break;case I:var O,w,R,P,L,F,D,M,B,k,z,V,W,U,G,X=new n(new Uint8Array(this.a),this.b),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(O=I,X.d(1,1,y),X.d(O,2,y),w=h(this,o),F=l(this.L,15),D=u(F),M=l(this.K,7),B=u(M),R=286;257<R&&0===F[R-1];R--);for(P=30;1<P&&0===M[P-1];P--);var H,Q,q,Z,K,J,$=R,tt=P,et=new(C?Uint32Array:Array)($+tt),it=new(C?Uint32Array:Array)(316),nt=new(C?Uint8Array:Array)(19);for(H=Q=0;H<$;H++)et[Q++]=F[H];for(H=0;H<tt;H++)et[Q++]=M[H];if(!C)for(H=0,Z=nt.length;H<Z;++H)nt[H]=0;for(H=K=0,Z=et.length;H<Z;H+=Q){for(Q=1;H+Q<Z&&et[H+Q]===et[H];++Q);if(q=Q,0===et[H])if(3>q)for(;0<q--;)it[K++]=0,nt[0]++;else for(;0<q;)J=138>q?q:138,J>q-3&&J<q&&(J=q-3),10>=J?(it[K++]=17,it[K++]=J-3,nt[17]++):(it[K++]=18,it[K++]=J-11,nt[18]++),q-=J;else if(it[K++]=et[H],nt[et[H]]++,q--,3>q)for(;0<q--;)it[K++]=et[H],nt[et[H]]++;else for(;0<q;)J=6>q?q:6,J>q-3&&J<q&&(J=q-3),it[K++]=16,it[K++]=J-3,nt[16]++,q-=J}for(e=C?it.subarray(0,K):it.slice(0,K),k=l(nt,7),U=0;19>U;U++)Y[U]=k[j[U]];for(L=19;4<L&&0===Y[L-1];L--);for(z=u(k),X.d(R-257,5,y),X.d(P-1,5,y),X.d(L-4,4,y),U=0;U<L;U++)X.d(Y[U],3,y);for(U=0,G=e.length;U<G;U++)if(V=e[U],X.d(z[V],k[V],y),16<=V){switch(U++,V){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:t("invalid code: "+V)}X.d(e[U],W,y)}var rt,st,ot,at,ct,ht,lt,ut,dt=[D,F],_t=[B,M];for(ct=dt[0],ht=dt[1],lt=_t[0],ut=_t[1],rt=0,st=w.length;rt<st;++rt)if(ot=w[rt],X.d(ct[ot],ht[ot],y),256<ot)X.d(w[++rt],w[++rt],y),at=w[++rt],X.d(lt[at],ut[at],y),X.d(w[++rt],w[++rt],y);else if(256===ot)break;this.a=X.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var L,F,D=[];for(L=3;258>=L;L++)F=c(),D[L]=F[2]<<24|F[1]<<16|F[0];var M=C?new Uint32Array(D):D,B=P;d.prototype.n=function(){var e,n,r,s,o,a,c,h=0;switch(c=this.a,e=gt){case gt:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=n<<4|e,c[h++]=r,e){case gt:switch(this.h){case B.NONE:o=0;break;case B.r:o=1;break;case B.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return s=o<<6|0,c[h++]=s|31-(256*r+s)%31,a=i(this.input),this.z.b=h,c=this.z.n(),h=c.length,C&&(c=new Uint8Array(c.buffer),c.length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=a>>24&255,c[h++]=a>>16&255,c[h++]=a>>8&255,c[h++]=255&a,c},e("Zlib.Deflate",d),e("Zlib.Deflate.compress",function(t,e){return new d(t,e).n()}),e("Zlib.Deflate.CompressionType",B),e("Zlib.Deflate.CompressionType.NONE",B.NONE),e("Zlib.Deflate.CompressionType.FIXED",B.r),e("Zlib.Deflate.CompressionType.DYNAMIC",B.j);var k=0,z=1,V={D:k,C:z};_.prototype.p=function(){for(;!this.s;){var e=f(this,3);switch(1&e&&(this.s=y),e>>>=1){case 0:var i=this.input,n=this.c,r=this.a,s=this.b,o=v,a=v,c=v,h=r.length,l=v;switch(this.e=this.g=0,o=i[n++],o===v&&t(Error("invalid uncompressed block header: LEN (first byte)")),a=o,o=i[n++],o===v&&t(Error("invalid uncompressed block header: LEN (second byte)")),a|=o<<8,o=i[n++],o===v&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=o,o=i[n++],o===v&&t(Error("invalid uncompressed block header: NLEN (second byte)")),c|=o<<8,a===~c&&t(Error("invalid uncompressed block header: length verify")),n+a>i.length&&t(Error("input buffer is broken")),this.m){case k:for(;s+a>r.length;){if(l=h-s,a-=l,C)r.set(i.subarray(n,n+l),s),s+=l,n+=l;else for(;l--;)r[s++]=i[n++];this.b=s,r=this.f(),s=this.b}break;case z:for(;s+a>r.length;)r=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(C)r.set(i.subarray(n,n+a),s),s+=a,n+=a;else for(;a--;)r[s++]=i[n++];this.c=n,this.b=s,this.a=r;break;case 1:this.o(it,rt);break;case 2:g(this);break;default:t(Error("unknown BTYPE: "+e))}}return this.t()};var W,U,G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=C?new Uint16Array(G):G,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],Y=C?new Uint16Array(j):j,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],Q=C?new Uint8Array(H):H,q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Z=C?new Uint16Array(q):q,K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=C?new Uint8Array(K):K,$=new(C?Uint8Array:Array)(288);for(W=0,U=$.length;W<U;++W)$[W]=143>=W?8:255>=W?9:279>=W?7:8;var tt,et,it=s($),nt=new(C?Uint8Array:Array)(30);for(tt=0,et=nt.length;tt<et;++tt)nt[tt]=5;var rt=s(nt);_.prototype.o=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length-258;256!==(r=p(this,t));)if(256>r)n>=c&&(this.b=n,i=this.f(),n=this.b),i[n++]=r;else for(s=r-257,a=Y[s],0<Q[s]&&(a+=f(this,Q[s])),r=p(this,e),o=Z[r],0<J[r]&&(o+=f(this,J[r])),n>=c&&(this.b=n,i=this.f(),n=this.b);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.I=function(t,e){var i=this.a,n=this.b;this.u=t;for(var r,s,o,a,c=i.length;256!==(r=p(this,t));)if(256>r)n>=c&&(i=this.f(),c=i.length),i[n++]=r;else for(s=r-257,a=Y[s],0<Q[s]&&(a+=f(this,Q[s])),r=p(this,e),o=Z[r],0<J[r]&&(o+=f(this,J[r])),n+a>c&&(i=this.f(),c=i.length);a--;)i[n]=i[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},_.prototype.f=function(){var t,e,i=new(C?Uint8Array:Array)(this.b-32768),n=this.b-32768,r=this.a;if(C)i.set(r.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=r[t+32768];if(this.k.push(i),this.q+=i.length,C)r.set(r.subarray(n,n+32768));else for(t=0;32768>t;++t)r[t]=r[n+t];return this.b=32768,r},_.prototype.J=function(t){var e,i,n,r,s=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(s=t.v),"number"==typeof t.F&&(s+=t.F)),2>s?(i=(o.length-this.c)/this.u[2],r=258*(i/2)|0,n=r<a.length?a.length+r:a.length<<1):n=a.length*s,C?(e=new Uint8Array(n),e.set(a)):e=a,this.a=e},_.prototype.t=function(){var t,e,i,n,r,s=0,o=this.a,a=this.k,c=new(C?Uint8Array:Array)(this.q+(this.b-32768));if(0===a.length)return C?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=a.length;e<i;++e)for(t=a[e],n=0,r=t.length;n<r;++n)c[s++]=t[n];for(e=32768,i=this.b;e<i;++e)c[s++]=o[e];return this.k=[],this.buffer=c},_.prototype.H=function(){var t,e=this.b;return C?this.B?(t=new Uint8Array(e),t.set(this.a.subarray(0,e))):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},m.prototype.p=function(){var e,n,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n=(r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0,n!==i(e)&&t(Error("invalid adler-32 checksum"))),e},e("Zlib.Inflate",m),e("Zlib.Inflate.BufferType",V),V.ADAPTIVE=V.C,V.BLOCK=V.D,e("Zlib.Inflate.prototype.decompress",m.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];C&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];C&&new Uint16Array(ot);var at=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];C&&new Uint8Array(at);var ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];C&&new Uint16Array(ct);var ht=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];C&&new Uint8Array(ht);var lt,ut,dt=new(C?Uint8Array:Array)(288);for(lt=0,ut=dt.length;lt<ut;++lt)dt[lt]=143>=lt?8:255>=lt?9:279>=lt?7:8;s(dt);var _t,ft,pt=new(C?Uint8Array:Array)(30);for(_t=0,ft=pt.length;_t<ft;++_t)pt[_t]=5;s(pt);var gt=8}).call(window);var n=window;n=window.Zlib=n.Zlib,n.Deflate=n.Deflate,n.Deflate.compress=n.Deflate.compress,n.Inflate=n.Inflate,n.Inflate.BufferType=n.Inflate.BufferType,n.Inflate.prototype.decompress=n.Inflate.prototype.decompress},{}],32:[function(t,e,i){var n=cc._Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}});cc.ActionManager=cc._Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var r=this._hashTargets[e.__instanceId];r||(r=new n,r.paused=i,r.target=e,this._hashTargets[e.__instanceId]=r,this._arrayTargets.push(r)),this._actionAllocWithHashElement(r),r.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(i.actions.indexOf(i.currentAction)===-1||i.currentActionSalvaged||(i.currentActionSalvaged=!0),i.actions.length=0,this._currentTarget!==i||e?this._deleteHashElement(i):this._currentTargetSalvaged=!0)}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1);break}}else cc.log(cc._LogInfos.ActionManager.removeAction)}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.log(cc._LogInfos.ActionManager.addAction),cc.assert(e,cc._LogInfos.ActionManager.addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;r<n;++r){var s=i.actions[r];if(s&&s.getTag()===t&&s.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.log(cc._LogInfos.ActionManager.getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.log(cc._LogInfos.ActionManager.getActionByTag_2,t)}return null},getNumberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var i=e.actions[t];i!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],cc.js.array.remove(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){null==t.actions&&(t.actions=[])},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(this._currentTarget=i[n],e=this._currentTarget,!e.paused)for(e.actionIndex=0;e.actionIndex<(e.actions?e.actions.length:0);e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentActionSalvaged=!1,e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentActionSalvaged)e.currentAction=null;else if(e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}this._currentTargetSalvaged&&0===e.actions.length&&this._deleteHashElement(e)&&n--}}})},{}],33:[function(t,e,i){var n=t("./event/event-target"),r=t("./platform/_CCClass"),s=t("./load-pipeline/auto-release-utils");cc.g_NumberOfDraws=0,cc.Director=r.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_loadingScene:"",_runningScene:null,_scene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,ctor:function(){var t=this;n.call(t),t._lastUpdate=Date.now(),cc.game.on(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc._widgetManager&&cc._widgetManager.init(this)},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>1&&(this._deltaTime=1/60)),this._lastUpdate=t},convertToGL:null,convertToUI:null,engineUpdate:function(t){this._scheduler.update(t)},_visitScene:function(){if(this._runningScene){var t=cc.renderer;t.childrenOrderDirty?(t.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene._renderCmd.visit(),t.resetFlag()):t.transformDirty()&&t.transform()}},visit:function(t){this.emit(cc.Director.EVENT_BEFORE_VISIT,this),this._beforeVisitScene&&this._beforeVisitScene(),this._visitScene(),this._notificationNode&&this._notificationNode.visit(),this.emit(cc.Director.EVENT_AFTER_VISIT,this),this._afterVisitScene&&this._afterVisitScene()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director.popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup(),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},reset:function(){this.purgeDirector(),cc.eventManager&&cc.eventManager.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director.pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,e,i){var n,r,o=cc.game,a=o._persistRootNodes;t instanceof cc.Scene&&t._load();for(n in a)r=a[n],o._ignoreRemovePersistNode=r,r.parent=null,o._ignoreRemovePersistNode=null;var c=this._scene,h=c&&c.autoReleaseAssets&&c.dependAssets;s.autoRelease(cc.loader,h,t.dependAssets),cc.isValid(c)&&c.destroy(),this._scene=null,cc.Object._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var l=t;if(t instanceof cc.Scene){this._scene=t,l=t._sgNode;for(n in a){r=a[n];var u=t.getChildByUuid(n);if(u){var d=u.getSiblingIndex();u._destroyImmediate(),r.parent=t,r.setSiblingIndex(d)}else r.parent=t}t._activate()}if(this._runningScene){var _=this._scenesStack.length;this._scenesStack[Math.max(_-1,0)]=l,this._sendCleanupToScene=!0,this._nextScene=l}else this.pushScene(l),this.startAnimation();this._nextScene&&this.setNextScene(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assert(t,cc._LogInfos.Director.pushScene),t instanceof cc.Scene&&t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i)})},_getSceneUuid:function(t){var e=cc.game._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var i=0;i<e.length;i++){var n=e[i];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.error("loadScene: The scene index to load (%s) is out of range.",t)}else cc.error('loadScene: Unknown name type to load: "%s"',t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.error('loadScene: Failed to load scene "%s" because "%s" is already loading',t,this._loadingScene),!1;var n=this._getSceneUuid(t);if(n){var r=n.uuid;this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t;return this._loadSceneByUuid(r,e,i),!0}return cc.error('loadScene: Can not load the scene "%s" because it was not in the build settings before playing.',t),!1},preloadScene:function(t,e){var i=this._getSceneUuid(t);if(i)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),cc.loader.load({id:i.uuid,type:"uuid"},function(i,n){i&&cc.error('Failed to preload "%s", %s',t,i.message),e&&e(i,n)});else{var n='Can not preload the scene "'+t+'" because it is not in the build settings.';e(new Error(n)),cc.error("preloadScene: "+n)}},_loadSceneByUuid:function(t,e,i){cc.AssetLibrary.loadAsset(t,function(n,r){var s=cc.director;s._loadingScene="";var o;n?(n="Failed to load scene: "+n,cc.error(n)):r instanceof cc.SceneAsset?(o=r.scene,o._id=r._uuid,o._name=r._name,s.runSceneImmediate(o,i,e)):(n="The asset "+t+" is not a scene",cc.error(n),o=null),n&&e&&e(n)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director.resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!e){var i=this._runningScene;i&&(i.onExitTransitionDidStart(),i.onExit()),this._sendCleanupToScene&&i&&i.cleanup()}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),this._notificationNode=t,t&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director.popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===i)return void this.end();if(!(t>i)){for(;i>t;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!1}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.js.addon(cc.Director.prototype,n.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_COMPONENT_UPDATE="director_component_update",cc.Director.EVENT_COMPONENT_LATE_UPDATE="director_component_late_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this.emit(cc.Director.EVENT_COMPONENT_UPDATE,this._deltaTime),this.engineUpdate(this._deltaTime),this.emit(cc.Director.EVENT_COMPONENT_LATE_UPDATE,this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.visit(this._deltaTime),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),this._calculateMPF())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){
return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D},{"./event/event-target":98,"./load-pipeline/auto-release-utils":116,"./platform/_CCClass":138}],34:[function(t,e,i){t("./CCDirector"),t("./CCGame"),cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,cc.eventManager&&cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":33,"./CCGame":36}],35:[function(t,e,i){t("./CCDirector"),t("./CCGame"),t("../kazmath");var n=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++)e(n[i])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=(cc.director,cc.director._scenesStack),i=0;i<t.length;i++)e(t[i])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var r=e._openGLView,s=r._viewPortRect.x/r._scaleX,o=r._viewPortRect.y/r._scaleY;switch(t){case cc.Director.PROJECTION_2D:n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity();var a=n.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024);n.glMultMatrix(a),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var c=e.getZEye(),h=new n.Matrix4,l=new n.Matrix4;n.glMatrixMode(n.KM_GL_PROJECTION),n.glLoadIdentity(),h=n.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*c),n.glMultMatrix(h),n.glMatrixMode(n.KM_GL_MODELVIEW),n.glLoadIdentity();var u=new n.Vec3(-s+i.width/2,-o+i.height/2,c),d=new n.Vec3(-s+i.width/2,-o+i.height/2,0),_=new n.Vec3(0,1,0);l.lookAt(u,d,_),n.glMultMatrix(l);break;case cc.Director.PROJECTION_CUSTOM:e._projectionDelegate&&e._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director.setProjection)}e._projection=t,e.emit(cc.Director.EVENT_PROJECTION_CHANGED,e),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){var e=cc.renderer._clearColor;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=t.a/255},t.setOpenGLView=function(t){var e=this;e._winSizeInPoints.width=cc._canvas.width,e._winSizeInPoints.height=cc._canvas.height,e._openGLView=t||cc.view;var i=cc.configuration;i.gatherGPUInfo(),e.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){var t=this;t.setAlphaBlending(!0),t.setProjection(t._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":185,"./CCDirector":33,"./CCGame":36}],36:[function(t,e,i){var n,r=t("./event/event-target");n=t("./platform/CCView"),t("../audio/CCAudioEngine");var s={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,i=e.config,n=e.CONFIG_KEY;i[n.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=0,e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.uncacheAll(),s.onStart()},end:function(){close()},prepare:function(t){var e=this,i=e.config,r=e.CONFIG_KEY;if(this._loadConfig(),this._prepared)return void(t&&t());if(!this._prepareCalled){if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(i[r.width],i[r.height]),cc.view=n?n._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var s=i[r.jsList];return void(s&&s.length>0?cc.loader.load(s,function(i){if(i)throw new Error(JSON.stringify(i));e._prepared=!0,e.emit(e.EVENT_GAME_INITED),t&&t()}):(e.emit(e.EVENT_GAME_INITED),t&&t()))}cc.initEngine(this.config,function(){e.prepare(t)})}},run:function(t,e){"function"==typeof t?s.onStart=t:(t&&(s.config=t),"function"==typeof e&&(s.onStart=e)),this.prepare(s.onStart&&s.onStart.bind(s))},addPersistRootNode:function(t){if(!(t instanceof cc.Node&&t.uuid))return void cc.warn("The target can not be made persist because it's not a cc.Node or it doesn't have _id property.");var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i)){if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warn("The node can not be made persist because it's not under root node.");if(t.parent!==i)return void cc.warn("The node can not be made persist because it's not in current scene.")}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0}}},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)}},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/s.config[s.CONFIG_KEY.frameRate],cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==s.config[s.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,s._frameTime-(e-s._lastTime)),n=window.setTimeout(function(){t()},i);return s._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director;r.setDisplayStats(i[n.showFPS]),t=function(){e._paused||(r.mainLoop(),e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=window.requestAnimFrame(t))},window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){if(this.config)return void this._initConfig(this.config);if(document.ccConfig)this._initConfig(document.ccConfig);else{var t={};try{for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var n=e[i].getAttribute("cocos");if(""===n||n)break}var r,s,o;i<e.length&&(r=e[i].src,r&&(o=/(.*)\//.exec(r)[0],cc.loader.resPath=o,r=cc.path.join(o,"project.json")),s=cc.loader._loadTxtSync(r)),s||(s=cc.loader._loadTxtSync("project.json")),t=JSON.parse(s)}catch(a){cc.log("Failed to read or parse project.json")}this._initConfig(t||{})}},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];"number"!=typeof t[e.debugMode]&&(t[e.debugMode]=0),"number"!=typeof t[e.frameRate]&&(t[e.frameRate]=60),"number"!=typeof t[e.renderMode]&&(t[e.renderMode]=0),"boolean"!=typeof t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),t[e.showFPS]=!(e.showFPS in t)||!!t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",i&&i.indexOf("core")<0&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this._sceneInfos=t[e.scenes]||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],cc._initDebugSetting(t[e.debugMode]),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r=this.config[s.CONFIG_KEY.id],o=window,a=cc.$(r)||cc.$("#"+r);"CANVAS"===a.tagName?(t=t||a.width,e=e||a.height,this.canvas=cc._canvas=i=a,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==a.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||a.clientWidth,e=e||a.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),a.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99),cc._renderType===s.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,antialias:!cc.sys.isMobile,alpha:!0})),this._renderContext?(cc.renderer=cc.rendererWebGL,o.gl=this._renderContext,cc.renderer.init(),cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=o.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=o.gl.getExtension("OES_element_index_uint")):(cc._renderType=s.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,cc.renderer.init(),this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null),cc._gameDiv=n,s.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t,e,i=window;this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),"undefined"!=typeof document.hidden?(t="hidden",e="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",e="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange");var n=function(){s.emit(s.EVENT_HIDE,s)},r=function(){s.emit(s.EVENT_SHOW,s)};t?document.addEventListener(e,function(){document[t]?n():r()},!1):(i.addEventListener("blur",n,!1),i.addEventListener("focus",r,!1)),navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=function(){r()}),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",n,!1),i.addEventListener("pageshow",r,!1)),this.on(s.EVENT_HIDE,function(){s.pause()}),this.on(s.EVENT_SHOW,function(){s.resume()})}};r.call(s),cc.js.addon(s,r.prototype),cc.game=e.exports=s},{"../audio/CCAudioEngine":25,"./event/event-target":98,"./platform/CCView":136}],37:[function(t,e,i){"use strict";function n(t){return t?"string"==typeof t?l.getClassByName(t):t:(cc.error("getComponent: Type must be non-nil"),null)}function r(t,e){for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n instanceof e)return n}return null}function s(t,e,i){for(var n=0;n<t._components.length;++n){var r=t._components[n];r instanceof e&&i.push(r)}}function o(t,e){for(var i=0;i<t.length;++i){var n=t[i],s=r(n,e);if(s)return s;if(n.children.length>0&&(s=o(n.children,e)))return s}return null}function a(t,e,i){for(var n=0;n<t.length;++n){var r=t[n];s(r,e,i),r._children.length>0&&a(r._children,e,i)}}var c=t("./event/event-target"),h=t("./utils/prefab-helper"),l=cc.js,u=cc.Object.Flags,d=u.Destroying,_=u.DontDestroy,f=u.Activating,p=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),g=[p.TOUCH_START,p.TOUCH_MOVE,p.TOUCH_END,p.TOUCH_CANCEL],m=[p.MOUSE_DOWN,p.MOUSE_ENTER,p.MOUSE_MOVE,p.MOUSE_LEAVE,p.MOUSE_UP,p.MOUSE_WHEEL],v=null,y=function(t,e){var i=t.getLocation(),n=this.owner;return!!n._hitTest(i,this)&&(e.type=p.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0)},T=function(t,e){var i=this.owner;e.type=p.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},C=function(t,e){var i=t.getLocation(),n=this.owner;n._hitTest(i,this)?e.type=p.TOUCH_END:e.type=p.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)},b=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=p.MOUSE_DOWN,i.dispatchEvent(t),t.stopPropagation())},x=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)?(t.stopPropagation(),this._previousIn||(v&&(t.type=p.MOUSE_LEAVE,v.dispatchEvent(t),v._mouseListener._previousIn=!1),v=this.owner,t.type=p.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=p.MOUSE_MOVE,i.dispatchEvent(t)):this._previousIn&&(t.type=p.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,v=null)},S=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=p.MOUSE_UP,i.dispatchEvent(t),t.stopPropagation())},E=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=p.MOUSE_WHEEL,i.dispatchEvent(t))},A=function(t){if(cc.Mask)for(var e=0,i=null,n=t;n&&n instanceof cc.Node;n=n.parent,++e)if(i=n.getComponent(cc.Mask))return{index:e,node:n};return null},O=cc.Class({name:"cc.Node","extends":t("./utils/base-node"),mixins:[c],properties:{active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent&&this._parent._activeInHierarchy;e&&(this._onActivatedInHierarchy(t),this.emit("active-in-hierarchy-changed",this))}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}},_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&_)>0},set:function(t){t?this._objFlags|=_:this._objFlags&=~_}},groupIndex:{"default":0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),this.emit("group-changed")}}},ctor:function(){var t=arguments[0];this._name="undefined"!=typeof t?t:"New Node",this._activeInHierarchy=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._deactivateChildComponents()},_onPreDestroy:function(){var t,e;this._objFlags|=d;var i=this._parent,n=i&&i._objFlags&d,r=this._children;for(t=0,e=r.length;t<e;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t){var s=this._components[t];s._destroyImmediate()}for(cc.director.getActionManager().removeAllActionsFromTarget(this),this._releaseAllActions(),v===this&&(v=null),cc.eventManager.removeListeners(this),t=0,e=this.__eventTargets.length;t<e;++t){var o=this.__eventTargets[t];o&&o.targetOff(this)}if(this.__eventTargets.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!n){if(i){var a=i._children.indexOf(this);i._children.splice(a,1),i.emit("child-removed",this)}this._removeSgNode()}},getComponent:function(t){var e=n(t);return e?r(this,e):null},getComponents:function(t){var e=n(t),i=[];return e&&s(this,e,i),i},getComponentInChildren:function(t){var e=n(t);return e?o(this._children,e):null},getComponentsInChildren:function(t){var e=n(t),i=[];return e&&(s(this,e,i),a(this._children,e,i)),i},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(e=l.getClassByName(t),!e)return cc.error('addComponent: Failed to get class "%s"',t),cc._RFpeek()&&cc.error('addComponent: Should not add component ("%s") when the scripts are still loading.',t),null}else{if(!t)return cc.error("addComponent: Type must be non-nil"),null;e=t}if("function"!=typeof e)return cc.error("addComponent: The component to add must be a constructor"),null;if(!cc.isChildClassOf(e,cc.Component))return cc.error("addComponent: The component to add must be child class of cc.Component"),null;var i=e._requireComponent;if(i&&!this.getComponent(i)){var n=this.addComponent(i);if(!n)return null}var r=new e;return r.node=this,this._components.push(r),this._activeInHierarchy&&("function"==typeof r.__preload&&cc.Component._callPreloadOnComponent(r),r.__onNodeActivated(!0)),r},_addComponentAt:!1,removeComponent:function(t){return t?("object"!=typeof t&&(t=this.getComponent(t)),void(t&&t.destroy())):void cc.error("removeComponent: Component must be non-nil")},_getDependComponent:!1,_removeComponent:function(t){if(!t)return void cc.error("Argument must be non-nil");if(!(this._objFlags&d)){var e=this._components.indexOf(t);e!==-1?this._components.splice(e,1):t.node!==this&&cc.error("Component not owned by this entity")}},_registerIfAttached:!1,_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&h.syncWithPrefab(this),this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this));for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated()},_activeRecursively:function(t){var e=!1;if(this._objFlags&f){if(t)return void cc.error('Node "%s" is already activating',this.name);e=!0}else t&&(this._objFlags|=f);this._activeInHierarchy=t;for(var i=this._components.length,n=0;n<i;++n){var r=this._components[n];if(r instanceof cc.Component){if(r.__onNodeActivated(t),t&&!this._activeInHierarchy)return void(this._objFlags&=~f)}else r?this._removeComponent(r):l.array.removeAt(this._components,n),--n,--i}for(var s=0,o=this._children.length;s<o;++s){var a=this._children[s];if(a._active&&(a._activeRecursively(t),t&&!this._activeInHierarchy))return void(this._objFlags&=~f)}return e?void(this._objFlags&=~f):(t?(cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this),this._touchListener&&(this._touchListener.mask=A(this)),this._mouseListener&&(this._mouseListener.mask=A(this))):(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this)),void(this._objFlags&=~f))},_onActivatedInHierarchy:function(t){t&&cc.Component._callPreloadOnNode(this),this._activeRecursively(t)},_onHierarchyChanged:function(t){var e=this._parent;!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this);var i=this._active&&!(!t||!t._activeInHierarchy),n=this._active&&!(!e||!e._activeInHierarchy);i!==n&&this._onActivatedInHierarchy(n),cc._widgetManager._nodesOrderDirty=!0},_deactivateChildComponents:function(){for(var t=this._components.length,e=0;e<t;++e){var i=this._components[e];i.__onNodeActivated(!1)}for(var n=0,r=this.childrenCount;n<r;++n){var s=this._children[n];s._active&&s._deactivateChildComponents()}},_instantiate:function(){var t=cc.instantiate._clone(this,this);t._parent=null;var e=this._prefab,i=e&&this===e.root&&e.sync;return i&&(t._prefab._synced=e._synced),t._onBatchCreated(),t},on:function(t,e,i,n){var r=!1;return g.indexOf(t)!==-1?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:A(this),onTouchBegan:y,onTouchMoved:T,onTouchEnded:C}),cc.eventManager.addListener(this._touchListener,this),r=!0):m.indexOf(t)!==-1&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:A(this),onMouseDown:b,onMouseMove:x,onMouseUp:S,onMouseScroll:E}),cc.eventManager.addListener(this._mouseListener,this),r=!0)),r&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||cc.eventManager.pauseTarget(this)},this,0,0,0,!1),this._EventTargetOn(t,e,i,n)},off:function(t,e,i,n){this._EventTargetOff(t,e,i,n),g.indexOf(t)!==-1?this._checkTouchListeners():m.indexOf(t)!==-1&&this._checkMouseListeners()},targetOff:function(t){this._EventTargetTargetOff(t),this._checkTouchListeners(),this._checkMouseListeners()},_checkTouchListeners:function(){if(!(this._objFlags&d)&&this._bubblingListeners&&this._touchListener){for(var t=0;t<g.length;++t)if(this._bubblingListeners.has(g[t]))return;cc.eventManager.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&d)&&this._bubblingListeners&&this._mouseListener){for(var t=0;t<m.length;++t)if(this._bubblingListeners.has(m[t]))return;v===this&&(v=null),cc.eventManager.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,e){var i=this.width,n=this.height,r=cc.rect(0,0,i,n),s=this.getNodeToWorldTransform();cc._rectApplyAffineTransformIn(r,s);var o=t.x-r.x,a=r.x+r.width-t.x,c=t.y-r.y,h=r.y+r.height-t.y;if(o>=0&&a>=0&&h>=0&&c>=0){if(e&&e.mask){for(var l=e.mask,u=this,d=0;u&&d<l.index;++d,u=u.parent);if(u===l.node){var _=u.getComponent(cc.Mask);return!_||!_.enabledInHierarchy||_._hitTest(t)}return e.mask=null,!0}return!0}return!1},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t,!0)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t)&&e.push(i),i=i.parent},isRunning:function(){return this._activeInHierarchy},runAction:function(t){if(this.active)return cc.assert(t,cc._LogInfos.Node.runAction),cc.director.getActionManager().addAction(t,this,!1),t},stopAllActions:function(){cc.director.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(t){cc.director.getActionManager().removeAction(t)},stopActionByTag:function(t){return t===cc.Action.TAG_INVALID?void cc.log(cc._LogInfos.Node.stopActionByTag):void cc.director.getActionManager().removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.Action.TAG_INVALID?(cc.log(cc._LogInfos.Node.getActionByTag),null):void cc.director.getActionManager().getActionByTag(t,this)},getNumberOfRunningActions:function(){cc.director.getActionManager().numberOfRunningActionsInTarget(this)},_retainAction:function(t){},_releaseAllActions:function(){}});O.EventType=p,cc.Node=e.exports=O},{"./event/event-target":98,"./utils/base-node":163,"./utils/prefab-helper":168}],38:[function(t,e,i){var n=function(){};cc.Scene=cc.Class({name:"cc.Scene","extends":t("./utils/base-node"),properties:{autoReleaseAssets:void 0},ctor:function(){var t=this._sgNode=new _ccsg.Scene;t.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){for(var t=this._children,e=cc.Object.Flags.DontDestroy,i=0,n=t.length;i<n;++i){var r=t[i];r.isValid&&(r._objFlags&e||r.destroy())}this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:n,_load:function(){if(!this._inited){this._updateDummySgNode(),cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this);for(var t=this._children,e=0,i=t.length;e<i;e++)t[e]._onBatchCreated();this._inited=!0}},_activate:function(t){t=t!==!1;var e,i,n=this._children,r=n.length;for(this._activeInHierarchy=t,e=0;e<r;++e)i=n[e],i._active&&i._onActivatedInHierarchy(t)}}),e.exports=cc.Scene},{"./utils/base-node":163}],39:[function(t,e,i){var n=function(t,e,i,n,r,s,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=s,this.markedForDeletion=o};n.prototype.trigger=function(t){this.callback.call(this.target,t)};var r=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},s=function(t,e,i,n,r,s,o){var a=this;a.timers=t,a.target=e,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s,a.hh=o},o=cc._Class.extend({getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){this._elapsed===-1?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),a=o.extend({ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,n,r,s){return this._scheduler=t,this._target=e,this._selector=i,this.setupTimerWithInterval(n,r,s),!0},getSelector:function(){return this._selector},trigger:function(){this._selector&&this._target&&this._selector.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),c=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[c(e)];if(r&&r.entry){if(r.entry.priority===i)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,n):i<0?this._priorityIn(this._updatesNegList,t,e,i,n):this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[c(t.target)],cc.js.array.remove(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,i=e._hashForUpdates[c(t.target)];i&&(cc.js.array.remove(i.list,i.entry),delete e._hashForUpdates[c(i.target)],i.entry=null,i.target=null)},_priorityIn:function(t,e,i,s,o){var a=this,h=new n(null,null,e,i,s,o,(!1));if(t){for(var l=t.length-1,u=0;u<=l;u++)if(s<t[u].priority){l=u;break}t.splice(u,0,h)}else t=[],t.push(h);return a._hashForUpdates[c(i)]=new r(t,h,i,null),t},_appendIn:function(t,e,i,s){var o=this,a=new n(null,null,e,i,0,s,(!1));t.push(a),o._hashForUpdates[c(i)]=new r(t,a,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,n,r;for(e=0,i=this._updatesNegList,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);for(e=0,i=this._updates0List,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);for(e=0,i=this._updatesPosList,n=i.length;e<n;e++)r=i[e],r.paused||r.markedForDeletion||r.trigger(t);var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(e=0,i=this._updatesNegList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,s){this.schedule(e,t,i,n,r,s)},schedule:function(t,e,i,n,r,o){"use strict";if("function"!=typeof t){var h=t;t=e,e=h}4!==arguments.length&&5!==arguments.length||(o=n,n=cc.macro.REPEAT_FOREVER,r=0),cc.assert(e,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var l=c(e),u=this._hashForTimers[l];u?cc.assert(u.paused===o,""):(u=new s(null,e,0,null,null,o,null),this._arrayForTimers.push(u),this._hashForTimers[l]=u);var d,_;if(null==u.timers)u.timers=[];else for(_=0;_<u.timers.length;++_)if(d=u.timers[_],d&&t===d.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",d.getInterval(),i),void d.setInterval(i);d=new a,d.initWithSelector(this,e,t,i,n,r),u.timers.push(d)},scheduleUpdate:function(t,e,i,n){n=n||t.update,this._schedulePerFrame(n,t,e,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback||t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this,n=i._hashForTimers[c(e)];if(n)for(var r=n.timers,s=0,o=r.length;s<o;s++){var a=r[s];if(this._getUnscheduleMark(t,a))return a!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(s,1),n.timerIndex>=s&&n.timerIndex--,void(0===r.length&&(i._currentTarget===n?i._currentTargetSalvaged=!0:i._removeHashElement(n)))}}},unscheduleUpdate:function(t){if(null!=t){var e=this._hashForUpdates[c(t)];e&&(this._updateHashLocked?e.entry.markedForDeletion=!0:this._removeUpdateFromHash(e.entry))}},unscheduleAllForTarget:function(t){if(null!=t){var e=this._hashForTimers[c(t)];e&&(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),
this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var r,s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,r=this._updatesNegList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,r=this._updates0List[e],r&&this.unscheduleUpdate(r.target),s==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,r=this._updatesPosList[e],r&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assert(t,"Argument callback must not be empty"),cc.assert(e,"Argument target must be non-nullptr");var i=c(e),n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,s=0;s<r.length;++s){var o=r[s];if(t===o._selector)return!0}return!1},pauseAllTargets:function(){this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=this,s=r._arrayForTimers;for(i=0,n=s.length;i<n;i++)e=s[i],e&&(e.paused=!0);var o;if(t<0)for(i=0;i<this._updatesNegList.length;i++)o=this._updatesNegList[i],o&&o.priority>=t&&(o.paused=!0);if(t<=0)for(i=0;i<this._updates0List.length;i++)o=this._updates0List[i],o&&(o.paused=!0);for(i=0;i<this._updatesPosList.length;i++)o=this._updatesPosList[i],o&&o.priority>=t&&(o.paused=!0)},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.pauseTarget);var e=this,i=c(t),n=e._hashForTimers[i];n&&(n.paused=!0);var r=e._hashForUpdates[i];r&&(r.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler.resumeTarget);var e=this,i=c(t),n=e._hashForTimers[i];n&&(n.paused=!1);var r=e._hashForUpdates[i];r&&(r.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler.isTargetPaused);var e=c(t),i=this._hashForTimers[e];if(i)return i.paused;var n=this._hashForUpdates[e];return!!n&&n.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],40:[function(t,e,i){var n=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset","extends":n,properties:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/"+this._rawFiles[0];cc.error("asset.url is not usable in core process")}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getImportedDir(this._uuid)+"/"+this._uuid+"/";return this._rawFiles.map(function(e){return t+e})}cc.error("asset.urls is not usable in core process")}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=t.length>0?t:null}}),e.exports=cc.Asset},{"./CCRawAsset":45}],41:[function(t,e,i){var n=cc.Class({name:"cc.AudioClip","extends":cc.RawAsset});cc.AudioClip=n,e.exports=n},{}],42:[function(t,e,i){var n=cc.Class({name:"cc.BitmapFont","extends":cc.Font,properties:{texture:{"default":"",url:cc.Texture2D},fontSize:{"default":-1}}});cc.BitmapFont=n,e.exports=n},{}],43:[function(t,e,i){var n=cc.Class({name:"cc.Font","extends":cc.Asset});cc.Font=n,e.exports=n},{}],44:[function(t,e,i){var n=cc.Class({name:"cc.Prefab","extends":cc.Asset,properties:{data:null},createNode:function(t){},_instantiate:function(){this.data._prefab?this.data._prefab._synced=!0:cc.warn("internal error: _prefab is undefined");var t=cc.instantiate(this.data);return t}});cc.Prefab=e.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{}],45:[function(t,e,i){var n=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset","extends":n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}),e.exports=cc.RawAsset},{"../platform/CCObject":132}],46:[function(t,e,i){var n=cc.Class({name:"cc.SceneAsset","extends":cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,e.exports=n},{}],47:[function(t,e,i){var n=cc.Class({name:"cc.Script","extends":cc.Asset});cc._Script=n;var r=cc.Class({name:"cc.JavaScript","extends":n});cc._JavaScript=r;var s=cc.Class({name:"cc.CoffeeScript","extends":n});cc._CoffeeScript=s},{}],48:[function(t,e,i){var n=cc.Class({name:"cc.SpriteAtlas","extends":cc.Asset,properties:{_spriteFrames:{"default":{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){return this._spriteFrames[t]},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var i in e)t.push(e[i]);return t}});cc.SpriteAtlas=n,e.exports=n},{}],49:[function(t,e,i){var n=cc.Class({name:"cc.TTFFont","extends":cc.Font});cc.TTFFont=n,e.exports=n},{}],50:[function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCBitmapFont"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas")},{"../sprites/CCSpriteFrame":155,"../textures/CCTexture2D":157,"./CCAsset":40,"./CCAudioClip":41,"./CCBitmapFont":42,"./CCFont":43,"./CCPrefab":44,"./CCRawAsset":45,"./CCSceneAsset":46,"./CCScripts":47,"./CCSpriteAtlas":48,"./CCTTFFont":49}],51:[function(t,e,i){function n(t){return t instanceof cc.Scene?cc.visibleRect:!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node?t._contentSize:t.getContentSize()}function r(t,e){var i,r=t._parent,s=n(r),o=r._anchorPoint,a=r instanceof cc.Scene,c=t._position.x,h=t._position.y,l=t.getAnchorPoint();if(e._alignFlags&_){var u,d,p=s.width;a?(i=cc.visibleRect,u=i.left.x,d=i.right.x):(u=-o.x*p,d=u+p),u+=e._isAbsLeft?e._left:e._left*p,d-=e._isAbsRight?e._right:e._right*p;var g,m=l.x,v=t._scaleX;if(v<0&&(m=1-m,v=-v),e.isStretchWidth)g=d-u,t.width=g/v,c=u+m*g;else if(g=t.width*v,e.isAlignHorizontalCenter){var y=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*p,T=(.5-o.x)*p;c=T+(m-.5)*g+y}else c=e.isAlignLeft?u+m*g:d+(m-1)*g}if(e._alignFlags&f){var C,b,x=s.height;a?(i=cc.visibleRect,b=i.bottom.y,C=i.top.y):(b=-o.y*x,C=b+x),b+=e._isAbsBottom?e._bottom:e._bottom*x,C-=e._isAbsTop?e._top:e._top*x;var S,E=l.y,A=t._scaleY;if(A<0&&(E=1-E,A=-A),e.isStretchHeight)S=C-b,t.height=S/A,h=b+E*S;else if(S=t.height*A,e.isAlignVerticalCenter){var O=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*x,w=(.5-o.y)*x;h=w+(E-.5)*S+O}else h=e.isAlignBottom?b+E*S:C+(E-1)*S}t.setPosition(c,h)}function s(t){var e=t._widget;e&&(r(t,e),e.isAlignOnce?e.enabled=!1:p.push(e));for(var i=t._children,n=0;n<i.length;n++){var o=i[n];o._active&&s(o)}}function o(){var t=cc.director.getScene();if(t){if(g.isAligning=!0,g._nodesOrderDirty)p.length=0,s(t),g._nodesOrderDirty=!1;else{var e,i=g._activeWidgetsIterator;for(i.i=0;i.i<p.length;++i.i)e=p[i.i],r(e.node,e)}g.isAligning=!1}}var a=1,c=2,h=4,l=8,u=16,d=32,_=l|u|d,f=a|c|h,p=[],g=cc._widgetManager=e.exports={_AlignFlags:{TOP:a,MID:c,BOT:h,LEFT:l,CENTER:u,RIGHT:d},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(p),init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,o)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null;var e=p.indexOf(t);e>-1&&this._activeWidgetsIterator.removeAt(e)},_getParentSize:n}},{}],52:[function(t,e,i){var n=cc.Class({name:"cc.BoxCollider","extends":cc.Collider,editor:!1,properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}}});cc.BoxCollider=e.exports=n},{}],53:[function(t,e,i){var n=cc.Class({name:"cc.CircleCollider","extends":t("./CCCollider"),editor:!1,properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}}});cc.CircleCollider=e.exports=n},{"./CCCollider":54}],54:[function(t,e,i){var n=cc.Class({name:"cc.Collider","extends":cc.Component,properties:{editing:{"default":!1,serializable:!1,tooltip:"i18n:COMPONENT.collider.editing"},tag:{"default":0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=e.exports=n},{}],55:[function(t,e,i){var n=t("./CCContact"),r=n.CollisionType,s=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1},update:function(t){if(this.enabled){var e,i,n=this._colliders;for(e=0,i=n.length;e<i;e++)this.updateCollider(n[e]);var s=this._contacts,o=[];for(e=0,i=s.length;e<i;e++){var a=s[e].updateState();a!==r.None&&o.push([a,s[e]])}for(e=0,i=o.length;e<i;e++){var c=o[e];this._doCollide(c[0],c[1])}this.drawColliders()}},_doCollide:function(t,e){var i;switch(t){case r.CollisionEnter:i="onCollisionEnter";break;case r.CollisionStay:i="onCollisionStay";break;case r.CollisionExit:i="onCollisionExit"}var n,s,o,a=e.collider1,c=e.collider2,h=a.node._components,l=c.node._components;for(n=0,s=h.length;n<s;n++)o=h[n],o[i]&&o[i](c,a);for(n=0,s=l.length;n<s;n++)o=l[n],o[i]&&o[i](a,c)},shouldCollide:function(t,e){var i=t.node,n=e.node,r=cc.game.collisionMatrix;return i!==n&&r[i.groupIndex][n.groupIndex]},initCollider:function(t){if(!t.world){var e=t.world={};e.aabb=cc.rect(),e.preAabb=cc.rect(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.slice(0,t.points.length)):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null)}},updateCollider:function(t){var e=t.offset,i=t.world,n=i.aabb,r=i.transform=t.node.getNodeToWorldTransformAR(),s=i.preAabb;if(s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,t instanceof cc.BoxCollider){var o=t.size,a=cc.rect(e.x-o.width/2,e.y-o.height/2,o.width,o.height),c=i.points,h=c[0],l=c[1],u=c[2],d=c[3];cc.obbApplyAffineTransform(a,r,h,l,u,d);var _=Math.min(h.x,l.x,u.x,d.x),f=Math.min(h.y,l.y,u.y,d.y),p=Math.max(h.x,l.x,u.x,d.x),g=Math.max(h.y,l.y,u.y,d.y);n.x=_,n.y=f,n.width=p-_,n.height=g-f}else if(t instanceof cc.CircleCollider){var m=cc.pointApplyAffineTransform(t.offset,r),v=r.tx,y=r.ty;r.tx=r.ty=0;var T=cc.pointApplyAffineTransform(cc.v2(t.radius,0),r),C=cc.v2(T).mag();i.radius=C,i.position=cc.v2(m),r.tx=v,r.ty=y,n.x=m.x-C,n.y=m.y-C,n.width=2*C,n.height=2*C}else if(t instanceof cc.PolygonCollider){for(var b=t.points,x=i.points,_=1e6,f=1e6,p=-1e6,g=-1e6,S=0,E=b.length;S<E;S++){var m=b[S].add(e);m=cc.pointApplyAffineTransform(m,r),x[S]=m,m.x>p&&(p=m.x),m.x<_&&(_=m.x),m.y>g&&(g=m.y),m.y<f&&(f=m.y)}n.x=_,n.y=f,n.width=p-_,n.height=g-f}},addCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(i===-1){for(var r=0,s=e.length;r<s;r++){var o=e[r];if(this.shouldCollide(t,o)){var a=new n(t,o);this._contacts.push(a)}}e.push(t),this.initCollider(t)}t.node.on("group-changed",this.onNodeGroupChanged,this)},removeCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(i>=0){e.splice(i,1);for(var n=this._contacts,s=n.length-1;s>=0;s--){var o=n[s];o.collider1!==t&&o.collider2!==t||(o.touching&&this._doCollide(r.CollisionExit,o),n.splice(s,1))}t.node.off("group-changed",this.onNodeGroupChanged,this)}else cc.error("collider not added or already removed")},onNodeGroupChanged:function(t){for(var e=t.currentTarget,i=e.getComponents(cc.Collider),n=0,r=i.length;n<r;n++)this.removeCollider(i[n]),this.addCollider(i[n])},drawColliders:function(){if(this._enabledDebugDraw&&this._debugDrawer){this._debugDrawer.clear();for(var t=this._colliders,e=0,i=t.length;e<i;e++){var n=t[e];if(n instanceof cc.BoxCollider||n instanceof cc.PolygonCollider?this._debugDrawer.drawPoly(n.world.points.concat(),null,1,cc.Color.WHITE):n instanceof cc.CircleCollider&&this._debugDrawer.drawCircle(n.world.position,n.world.radius,0,30),this.enabledDrawBoundingBox){var r=n.world.aabb,s=[cc.v2(r.xMin,r.yMin),cc.v2(r.xMin,r.yMax),cc.v2(r.xMax,r.yMax),cc.v2(r.xMax,r.yMin)];this._debugDrawer.drawPoly(s,null,1,cc.Color.BLUE)}}}},onSceneLaunched:function(){this._enabledDebugDraw&&this._debugDrawer&&(this._debugDrawer.removeFromParent(),cc.director.getScene()._sgNode.addChild(this._debugDrawer))}});cc.js.getset(s.prototype,"enabledDebugDraw",function(){return this._enabledDebugDraw},function(t){t&&!this._enabledDebugDraw?(this._debugDrawer||(this._debugDrawer=new cc.DrawNode,this._debugDrawer.retain()),cc.director.getScene()._sgNode.addChild(this._debugDrawer),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(),this._debugDrawer.removeFromParent(!1),cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)),this._enabledDebugDraw=t}),cc.CollisionManager=e.exports=s},{"./CCContact":56}],56:[function(t,e,i){function n(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var i=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider,s=t instanceof cc.CircleCollider,o=e instanceof cc.CircleCollider;i&&n?this.testFunc=r.polygonPolygon:s&&o?this.testFunc=r.circleCircle:i&&o?this.testFunc=r.polygonCircle:s&&n?(this.testFunc=r.polygonCircle,this.collider1=e,this.collider2=t):cc.error("Can't find testFunc for (%s, $s).",cc.js.getClassName(t),cc.js.getClassName(e))}var r=t("./CCIntersection"),s=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});n.prototype.test=function(){var t=this.collider1.world,e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===r.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===r.circleCircle?this.testFunc(t,e):this.testFunc===r.polygonCircle&&this.testFunc(t.points,e))},n.prototype.updateState=function(){var t=this.test(),e=s.None;return t&&!this.touching?(this.touching=!0,e=s.CollisionEnter):t&&this.touching?e=s.CollisionStay:!t&&this.touching&&(this.touching=!1,e=s.CollisionExit),e},n.CollisionType=s,e.exports=n},{"./CCIntersection":57}],57:[function(t,e,i){function n(t,e,i,n){var r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!==o){var a=r/o,c=s/o;if(0<=a&&a<=1&&0<=c&&c<=1)return!0}return!1}function r(t,e,i){var r=new cc.Vec2(i.x,i.y),s=new cc.Vec2(i.x,i.yMax),o=new cc.Vec2(i.xMax,i.yMax),a=new cc.Vec2(i.xMax,i.y);return!!n(t,e,r,s)||(!!n(t,e,s,o)||(!!n(t,e,o,a)||!!n(t,e,a,r)))}function s(t,e,i){for(var r=i.length,s=0;s<r;++s){var o=i[s],a=i[(s+1)%r];if(n(t,e,o,a))return!0}return!1}function o(t,e){var i=t.x,n=t.y,r=t.x+t.width,s=t.y+t.height,o=e.x,a=e.y,c=e.x+e.width,h=e.y+e.height;return i<=c&&r>=o&&n<=h&&s>=a}function a(t,e){var i,n,r=new cc.Vec2(t.x,t.y),o=new cc.Vec2(t.x,t.yMax),a=new cc.Vec2(t.xMax,t.yMax),c=new cc.Vec2(t.xMax,t.y);if(s(r,o,e))return!0;if(s(o,a,e))return!0;if(s(a,c,e))return!0;if(s(c,r,e))return!0;for(i=0,n=e.length;i<n;++i)if(u(e[i],t))return!0;return!!u(r,e)||(!!u(o,e)||(!!u(a,e)||!!u(c,e)))}function c(t,e){var i,n;for(i=0,n=t.length;i<n;++i){var r=t[i],o=t[(i+1)%n];if(s(r,o,e))return!0}for(i=0,n=e.length;i<n;++i)if(u(e[i],t))return!0;for(i=0,n=t.length;i<n;++i)if(u(t[i],e))return!0;return!1}function h(t,e){var i=t.position.sub(e.position).mag();return i<t.radius+e.radius}function l(t,e){var i=e.position;if(u(i,t))return!0;for(var n=0,r=t.length;n<r;n++){var s=0===n?t[t.length-1]:t[n-1],o=t[n];if(d(i,s,o,!0)<e.radius)return!0}return!1}function u(t,e){for(var i=!1,n=t.x,r=t.y,s=e.length,o=0,a=s-1;o<s;a=o++){var c=e[o].x,h=e[o].y,l=e[a].x,u=e[a].y,d=h>r!=u>r&&n<(l-c)*(r-h)/(u-h)+c;d&&(i=!i)}return i}function d(t,e,i,n){var r,s=i.x-e.x,o=i.y-e.y,a=s*s+o*o,c=((t.x-e.x)*s+(t.y-e.y)*o)/a;return r=n?a?c<0?e:c>1?i:cc.v2(e.x+c*s,e.y+c*o):e:cc.v2(e.x+c*s,e.y+c*o),s=t.x-r.x,o=t.y-r.y,Math.sqrt(s*s+o*o)}var _={};_.lineLine=n,_.lineRect=r,_.linePolygon=s,_.rectRect=o,_.rectPolygon=a,_.polygonPolygon=c,_.circleCircle=h,_.polygonCircle=l,_.pointInPolygon=u,_.pointLineDistance=d,cc.Intersection=e.exports=_},{}],58:[function(t,e,i){var n=cc.Class({name:"cc.PolygonCollider","extends":t("./CCCollider"),editor:!1,properties:{_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{"default":function(){return[cc.v2(-50,-50),cc.v2(-50,50),cc.v2(50,50),cc.v2(50,-50)]},type:[cc.Vec2]}}});cc.PolygonCollider=e.exports=n},{"./CCCollider":54}],59:[function(t,e,i){t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")},{"./CCBoxCollider":52,"./CCCircleCollider":53,"./CCCollider":54,"./CCCollisionManager":55,"./CCPolygonCollider":58}],60:[function(t,e,i){function n(t,e){return t===e||t&&e&&(t.name===e.name||t._uuid===e._uuid)}var r=t("../../animation/animation-animator"),s=t("../../animation/animation-clip"),o=cc.Class({name:"cc.Animation","extends":t("./CCComponent"),editor:!1,ctor:function(){this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null,this._listeners=[]},properties:{_defaultClip:{"default":null,type:s},defaultClip:{type:s,get:function(){return this._defaultClip},set:function(t){return},tooltip:"i18n:COMPONENT.animation.default_clip"},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:s,visible:!1},_clips:{"default":[],type:[s],tooltip:"i18n:COMPONENT.animation.clips",visible:!0},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.animation.play_on_load"}},onEnable:function(){if(this.playOnLoad&&this._defaultClip){this.playOnLoad=!1;var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}else this.resume()},onDisable:function(){this.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){for(var i=this.playAdditive(t,e),n=this._animator.playingAnims,r=n.length;r>=0;r--)n[r]!==i&&this._animator.stopState(n[r]);return i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(i){var n=this._animator;n.isPlaying&&i.isPlaying?i.isPaused?n.resumeState(i):(n.stopState(i),n.playState(i,e)):n.playState(i,e),this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this._animator.pause()},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this._animator.resume()},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];i&&this._animator.setStateTime(i,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},addClip:function(t,e){if(!t)return void cc.warn("Invalid clip to add");this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;var n=this._clips.indexOf(i.clip);n!==-1&&this._clips.splice(n,1)}var r=new cc.AnimationState(t,e);return this._nameToState[e]=r,r},removeClip:function(t,e){if(!t)return void cc.warn("Invalid clip to remove");this._init();var i;for(var n in this._nameToState){i=this._nameToState[n];var r=i.clip;if(r===t)break}if(t===this._defaultClip){if(!e)return void cc.warn("clip is defaultClip, set force to true to force remove clip and animation state");this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void cc.warn("animation state is playing, set force to true to force stop and remove clip and animation state");this.stop(i.name)}this._clips=this._clips.filter(function(e){return e!==t}),i&&delete this._nameToState[i.name]},sample:function(t){if(this._init(),t){var e=this._nameToState[t];e&&e.sample()}else this._animator.sample()},on:function(t,e,i,n){this._init();for(var r=this._listeners,s=0,o=r.length;s<o;s++){var a=r[s];if(a[0]===t&&a[1]===e&&a[2]===i&&a[3]===n)return}for(var c=this._animator.playingAnims,h=0,l=c.length;h<l;h++)c[h].on(t,e,i,n);r.push([t,e,i,n])},off:function(t,e,i,n){this._init();for(var r=this._listeners,s=this._nameToState,o=r.length-1;o>=0;o--){var a=r[o];if(a[0]===t&&a[1]===e&&a[2]===i&&a[3]===n){for(var c in s){var h=s[c];h.off(t,e,i,n)}r.splice(o,1)}}},_init:function(){this._didInit||(this._didInit=!0,this._animator=new r(this.node,this),this._createStates())},_createStates:function(){this._nameToState={};for(var t=null,e=!1,i=0;i<this._clips.length;++i){var r=this._clips[i];r&&(t=new cc.AnimationState(r),this._nameToState[t.name]=t,n(this._defaultClip,r)&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});cc.Animation=e.exports=o},{"../../animation/animation-animator":11,"../../animation/animation-clip":12,"./CCComponent":64}],61:[function(t,e,i){var n=cc.Class({name:"cc.AudioSource","extends":t("./CCComponent"),editor:!1,ctor:function(){this.audio=new cc.Audio(this._clip)},properties:{_clip:{"default":"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{"default":!1,serializable:!1},isPlaying:{get:function(){if(!this.audio)return!1;var t=this.audio.getState();return t===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){this._clip=t,this.audio.stop(),this.audio.src=this._clip,this.audio.preload&&this.audio.preload()},url:cc.AudioClip,tooltip:"i18n:COMPONENT.audio.clip",animatable:!1},volume:{get:function(){return this._volume},set:function(t){this._volume=t;var e=this.audio;return e&&!this._mute&&(e.setVolume(t),e._loaded||e.on("load",function(){e.setVolume(t)})),t},tooltip:"i18n:COMPONENT.audio.volume"},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio&&this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:"i18n:COMPONENT.audio.mute"},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio&&this.audio.setLoop(t),t},animatable:!1,tooltip:"i18n:COMPONENT.audio.loop"},playOnLoad:{"default":!1,tooltip:"i18n:COMPONENT.audio.play_on_load",animatable:!1},preload:{"default":!1,animatable:!1}},_pausedCallback:function(){this.audio&&!this.audio.paused&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this.audio&&(this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1)},onEnable:function(){this.playOnLoad&&this.play(),this.preload&&(this.audio.src=this._clip,this.audio.preload()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var t=this._mute?0:this._volume,e=this.audio,i=this._loop;if(e._loaded)return e.stop(),e.setCurrentTime(0),void e.play();e.src=this._clip,e.once("load",function(){e.setLoop(i),e.setVolume(t),e.play()}),e.preload()}},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&this.audio.setCurrentTime(0)},getCurrentTime:function(){var t=0;return this.audio&&(t=this.audio.getCurrentTime()),t},setCurrentTime:function(t){var e=this.audio;return e?e._loaded?(e.setCurrentTime(t),t):(e.once("load",function(){e.setCurrentTime(t)}),t):t},getDuration:function(){var t=0;return this.audio&&(t=this.audio.getDuration()),t}});cc.AudioSource=e.exports=n},{"./CCComponent":64}],62:[function(t,e,i){var n=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),r=cc.Class({name:"cc.Button","extends":t("./CCComponent"),ctor:function(){this._resetState(),this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=1,this._toScale=1,this._originalScale=1,this._sprite=null},_resetState:function(){this._pressed=!1,this._hovered=!1},editor:!1,properties:{interactable:{"default":!0,tooltip:"i18n:COMPONENT.button.interactable",notify:function(t){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{"default":!1,tooltip:"i18n:COMPONENT.button.auto_gray_effect",notify:function(){this._updateDisabledState()}},transition:{"default":n.NONE,tooltip:"i18n:COMPONENT.button.transition",type:n,animatable:!1},normalColor:{"default":cc.color(214,214,214),displayName:"Normal",tooltip:"i18n:COMPONENT.button.normal_color",notify:function(){this._updateState()}},pressedColor:{"default":cc.color(211,211,211),displayName:"Pressed",tooltip:"i18n:COMPONENT.button.pressed_color"},hoverColor:{"default":cc.Color.WHITE,displayName:"Hover",tooltip:"i18n:COMPONENT.button.hover_color"},disabledColor:{"default":cc.color(124,124,124),displayName:"Disabled",tooltip:"i18n:COMPONENT.button.disabled_color",notify:function(){this._updateState()}},duration:{"default":.1,range:[0,10],tooltip:"i18n:COMPONENT.button.duration"},zoomScale:{"default":1.2,tooltip:"i18n:COMPONENT.button.zoom_scale"},normalSprite:{"default":null,type:cc.SpriteFrame,displayName:"Normal",tooltip:"i18n:COMPONENT.button.normal_sprite",notify:function(){this._updateState()}},pressedSprite:{"default":null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:"i18n:COMPONENT.button.pressed_sprite"},hoverSprite:{"default":null,type:cc.SpriteFrame,displayName:"Hover",tooltip:"i18n:COMPONENT.button.hover_sprite"},disabledSprite:{"default":null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:"i18n:COMPONENT.button.disabled_sprite",notify:function(){this._updateState()}},target:{"default":null,type:cc.Node,tooltip:"i18n:COMPONENT.button.target",notify:function(){this._applyTarget()}},clickEvents:{"default":[],type:cc.Component.EventHandler,tooltip:"i18n:COMPONENT.button.click_events"}},statics:{Transition:n},__preload:function(){this.target||(this.target=this.node),this._applyTarget(),this._updateState()},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerEvent()},update:function(t){var e=this.target;if(!this._transitionFinished&&(this.transition===n.COLOR||this.transition===n.SCALE)){this.time+=t;var i=1;this.duration>0&&(i=this.time/this.duration),i>=1&&(i=1,this._transitionFinished=!0),this.transition===n.COLOR?e.color=this._fromColor.lerp(this._toColor,i):this.transition===n.SCALE&&(e.scale=cc.lerp(this._fromScale,this._toScale,i))}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getTargetSprite:function(t){var e=null;return t&&(e=t.getComponent(cc.Sprite)),e},_applyTarget:function(){this._sprite=this._getTargetSprite(this.target),this.target&&(this._originalScale=this.target.scale)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var e=t.touch,i=this.node._hitTest(e.getLocation());if(this.transition===n.SCALE&&this.target)i?(this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,this.target.scale=this._originalScale);else{var r;r=i?"pressed":"normal",this._applyTransition(r)}t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_zoomUp:function(){this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this.time=0,this._transitionFinished=!1},_zoomBack:function(){this._fromScale=this.target.scale,this._toScale=this._originalScale,this.time=0,this._transitionFinished=!1},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==n.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},onDisable:function(){this._hovered=!1,this._pressed=!1,this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getButtonState:function(){var t;return t=this.interactable?this._pressed?"pressed":this._hovered?"hover":"normal":"disabled"},_updateColorTransition:function(t){var e=this[t+"Color"],i=this.target;this._fromColor=i.color.clone(),this._toColor=e,this.time=0,this._transitionFinished=!1},_updateSpriteTransition:function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},_updateScaleTransition:function(t){"pressed"===t?this._zoomUp():this._zoomBack()},_applyTransition:function(t){var e=this.transition;e===n.COLOR?this._updateColorTransition(t):e===n.SPRITE?this._updateSpriteTransition(t):e===n.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){this._sprite&&this._sprite._sgNode.setState(0),this.enableAutoGrayEffect&&this.transition!==n.COLOR&&(this.transition===n.SPRITE&&this.disabledSprite||this._sprite&&!this.interactable&&this._sprite._sgNode.setState(1))}});cc.Button=e.exports=r},{"./CCComponent":64}],63:[function(t,e,i){var n={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){
return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},r=cc.Class({name:"cc.Canvas","extends":t("./CCComponent"),editor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:"i18n:COMPONENT.canvas.design_resolution"},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:"i18n:COMPONENT.canvas.fit_height"},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:"i18n:COMPONENT.canvas.fit_width"}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(r.instance)return cc.error("Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time",this.node.name,r.instance.node.name);if(r.instance=this,this.node._sizeProvider);else this.node._sizeProvider=n;cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):cc.eventManager.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===n&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):cc.eventManager.removeCustomListeners("canvas-resize",this._thisOnResized),r.instance===this&&(r.instance=null)},alignWithScreen:function(){var t,e=cc.visibleRect,i=!this.fitHeight&&!this.fitWidth,n=0,r=0;i&&(t=cc.view.getDesignResolutionSize(),n=.5*(t.width-e.width),r=.5*(t.height-e.height)),this.node.setPosition(.5*e.width+n,.5*e.height+r)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=r},{"./CCComponent":64}],64:[function(t,e,i){function n(t,e){var i=t._objFlags&u;if(e){if(!i){t.onEnable&&t.onEnable();var n=!t.node._activeInHierarchy;if(n)return;cc.director.getScheduler().resumeTarget(t),r(t),t._objFlags|=u}}else i&&(t.onDisable&&t.onDisable(),cc.director.getScheduler().pauseTarget(t),s(t),t._objFlags&=~u)}function r(t){!t.start||t._objFlags&g||cc.director.__fastOn(O.EVENT_BEFORE_UPDATE,w,t,t.__eventTargets),(t.update||t.lateUpdate)&&cc.director.__fastOn(O.EVENT_BEFORE_UPDATE,o,t,t.__eventTargets)}function s(t){!t.start||t._objFlags&g||cc.director.__fastOff(O.EVENT_BEFORE_UPDATE,w,t,t.__eventTargets);var e=t.update,i=t.lateUpdate;(e||i)&&(cc.director.__fastOff(O.EVENT_BEFORE_UPDATE,o,t,t.__eventTargets),e&&cc.director.__fastOff(O.EVENT_COMPONENT_UPDATE,R,t,t.__eventTargets),i&&cc.director.__fastOff(O.EVENT_COMPONENT_LATE_UPDATE,I,t,t.__eventTargets))}function o(){var t=this.__eventTargets,e=cc.director;e.__fastOff(O.EVENT_BEFORE_UPDATE,o,this,t),this.update&&e.__fastOn(O.EVENT_COMPONENT_UPDATE,R,this,t),this.lateUpdate&&e.__fastOn(O.EVENT_COMPONENT_LATE_UPDATE,I,this,t)}function a(t){t._activeInHierarchy=!0;for(var e=t._components,i=0,n=e.length;i<n;++i){var r=e[i];!r||r._objFlags&_||"function"!=typeof r.__preload||(r.__preload(),r._objFlags|=_)}var s=t._children;for(i=0,n=s.length;i<n;++i){var o=s[i];o._active&&a(o)}}t("../platform/CCObject"),t("../CCNode");var c=new(t("../platform/id-generater"))("Comp"),h=t("../utils/misc"),l=cc.Object.Flags,u=l.IsOnEnableCalled,d=l.IsEditorOnEnableCalled,_=l.IsPreloadCalled,f=l.IsOnLoadStarted,p=l.IsOnLoadCalled,g=l.IsStartCalled,m,v,y,T,C,b,x,S,E,A,O=cc.Director,w=function(){cc.director.__fastOff(O.EVENT_BEFORE_UPDATE,w,this,this.__eventTargets),this.start(),this._objFlags|=g},R=function(t){this.update(t.detail)},I=function(t){this.lateUpdate(t.detail)},P=cc.Class({name:"cc.Component","extends":cc.Object,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},properties:{node:{"default":null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},_id:{"default":"",serializable:!1},uuid:{get:function(){var t=this._id;return t||(t=this._id=c.getNewId()),t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy&&n(this,t))},visible:!1},enabledInHierarchy:{get:function(){return(this._objFlags&u)>0},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&p}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&n(this,!1)},__onNodeActivated:function(t){if(!t||this._objFlags&f||(this._objFlags|=f,this.onLoad&&this.onLoad(),this._objFlags|=p),this._enabled){if(t){var e=!this.node._activeInHierarchy;if(e)return}n(this,t)}},_onPreDestroy:function(){var t,e,i;for(n(this,!1),this.unscheduleAllCallbacks(),t=0,e=this.__eventTargets.length;t<e;++t)i=this.__eventTargets[t],i&&i.targetOff(this);this.__eventTargets.length=0,this.onDestroy&&this._objFlags&p&&this.onDestroy(),this.node._removeComponent(this)},_destruct:h.destructIgnoreId,_instantiate:function(){var t=cc.instantiate._clone(this,this);return t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,e,i,n){cc.assert(t,cc._LogInfos.Node.schedule),cc.assert(e>=0,cc._LogInfos.Node.schedule_2),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0,cc.director.getScheduler().schedule(t,this,e,i,n,!this.enabledInHierarchy)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});P._requireComponent=null,Object.defineProperty(P,"_registerEditorProps",{value:function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i)}}),Object.defineProperties(P,{_callPreloadOnNode:{value:a},_callPreloadOnComponent:{value:function(t){t.__preload(),t._objFlags|=_}},_callResetOnComponent:{value:!1}}),P.prototype.__scriptUuid="",cc.Component=e.exports=P},{"../CCNode":37,"../platform/CCObject":132,"../platform/id-generater":142,"../utils/misc":166}],65:[function(t,e,i){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{"default":null,type:cc.Node},component:{"default":""},handler:{"default":""},customEventData:{"default":""}},statics:{emitEvents:function(t){"use strict";for(var e=0,i=t.length;e<i;e++){var n=t[e];!n instanceof cc.Component.EventHandler||n.emit(Array.prototype.slice.call(arguments,1))}}},emit:function(t){var e=this.target;if(cc.isValid(e)){var i=e.getComponent(this.component);if(cc.isValid(i)){var n=i[this.handler];"function"==typeof n&&(this.customEventData&&t.push(this.customEventData),n.apply(i,t))}}}})},{}],66:[function(t,e,i){var n=_ccsg.EditBox.KeyboardReturnType,r=_ccsg.EditBox.InputMode,s=_ccsg.EditBox.InputFlag,o=cc.Class({name:"cc.EditBox","extends":cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:"i18n:COMPONENT.editbox.string",get:function(){return this._sgNode.string},set:function(t){this._sgNode.string=this._string=t}},backgroundImage:{tooltip:"i18n:COMPONENT.editbox.backgroundImage","default":null,type:cc.SpriteFrame,notify:function(){var t=this._sgNode,e=t.getBackgroundSprite();if(this.backgroundImage){var i=this._createBackgroundSprite();i.setContentSize(t.getContentSize())}else e.removeFromParent()}},returnType:{"default":n.DEFAULT,tooltip:"i18n:COMPONENT.editbox.returnType",displayName:"KeyboardReturnType",type:n,notify:function(){this._sgNode.returnType=this.returnType}},inputFlag:{tooltip:"i18n:COMPONENT.editbox.input_flag","default":s.DEFAULT,type:s,notify:function(){this._sgNode.inputFlag=this.inputFlag}},inputMode:{tooltip:"i18n:COMPONENT.editbox.input_mode","default":r.ANY,type:r,notify:function(){this._sgNode.inputMode=this.inputMode}},fontSize:{tooltip:"i18n:COMPONENT.editbox.font_size","default":20,notify:function(){this._sgNode.fontSize=this.fontSize}},lineHeight:{tooltip:"i18n:COMPONENT.editbox.line_height","default":40,notify:function(){this._sgNode.setLineHeight(this.lineHeight)}},fontColor:{tooltip:"i18n:COMPONENT.editbox.font_color","default":cc.Color.WHITE,notify:function(){this._sgNode.fontColor=this.fontColor}},placeholder:{tooltip:"i18n:COMPONENT.editbox.placeholder","default":"Enter text here...",notify:function(){this._sgNode.placeholder=this.placeholder}},placeholderFontSize:{tooltip:"i18n:COMPONENT.editbox.placeholder_font_size","default":20,notify:function(){this._sgNode.placeholderFontSize=this.placeholderFontSize}},placeholderFontColor:{tooltip:"i18n:COMPONENT.editbox.placeholder_font_color","default":cc.Color.GRAY,notify:function(){this._sgNode.placeholderFontColor=this.placeholderFontColor}},maxLength:{tooltip:"i18n:COMPONENT.editbox.max_length","default":20,notify:function(){this._sgNode.maxLength=this.maxLength}},stayOnTop:{tooltip:"i18n:COMPONENT.editbox.stay_on_top","default":!1,notify:function(){this._sgNode.stayOnTop(this.stayOnTop),this._sgNode.fontSize=this.fontSize,this._sgNode.fontColor=this.fontColor}},_tabIndex:0,tabIndex:{tooltip:"i18n:COMPONENT.editbox.tab_index",get:function(){return this._tabIndex},set:function(t){this._tabIndex=t,this._sgNode.setTabIndex(t)}},editingDidBegan:{"default":[],type:cc.Component.EventHandler},textChanged:{"default":[],type:cc.Component.EventHandler},editingDidEnded:{"default":[],type:cc.Component.EventHandler},editingReturn:{"default":[],type:cc.Component.EventHandler}},statics:{KeyboardReturnType:n,InputFlag:s,InputMode:r},_applyCapInset:function(t){var e=this.backgroundImage;t.setInsetTop(e.insetTop),t.setInsetBottom(e.insetBottom),t.setInsetRight(e.insetRight),t.setInsetLeft(e.insetLeft)},_createSgNode:function(){return new _ccsg.EditBox(cc.size(160,40))},_createBackgroundSprite:function(){var t=this._sgNode,e=new cc.Scale9Sprite;return e.setRenderingType(cc.Scale9Sprite.RenderingType.SLICED),this.backgroundImage&&(this.backgroundImage.ensureLoadTexture(),e.setSpriteFrame(this.backgroundImage),this._applyCapInset(e)),t.initWithSizeAndBackgroundSprite(cc.size(160,40),e),e},_initSgNode:function(){var t=this._sgNode;t.createDomElementIfNeeded(),this._createBackgroundSprite(),t.setContentSize(this.node.getContentSize()),t.inputMode=this.inputMode,t.maxLength=this.maxLength,t.string=this._string,t.fontSize=this.fontSize,t.fontColor=this.fontColor,t.placeholder=this.placeholder,t.placeholderFontSize=this.placeholderFontSize,t.placeholderFontColor=this.placeholderFontColor,t.inputFlag=this.inputFlag,t.returnType=this.returnType,t.setLineHeight(this.lineHeight),t.stayOnTop(this.stayOnTop),t.setTabIndex(this.tabIndex),t.setDelegate(this)},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t,e){cc.Component.EventHandler.emitEvents(this.textChanged,e,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},__preload:function(){this._super(),this._registerEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){this._sgNode&&this._sgNode._onTouchBegan(t.touch),t.stopPropagation()},_onTouchEnded:function(t){this._sgNode&&this._sgNode._onTouchEnded(),t.stopPropagation()},setFocus:function(){this._sgNode&&this._sgNode.setFocus()},isFocused:function(){var t=!1;return this._sgNode&&(t=this._sgNode.isFocused()),t}});cc.EditBox=e.exports=o},{}],67:[function(t,e,i){var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=_ccsg.Label.Overflow,o=cc.Class({name:"cc.Label","extends":cc._RendererUnderSG,ctor:function(){},editor:!1,_updateSgNodeString:function(){this._sgNode.setString(this.string),this._updateNodeSize()},_updateSgNodeFontSize:function(){this._sgNode&&(this._sgNode.setFontSize(this._fontSize),this._updateNodeSize())},properties:{_useOriginalSize:!0,string:{"default":"Label",multiline:!0,tooltip:"i18n:COMPONENT.label.string",notify:function(){this._sgNode&&this._updateSgNodeString()}},horizontalAlign:{"default":n.LEFT,type:n,tooltip:"i18n:COMPONENT.label.horizontal_align",notify:function(){this._sgNode&&this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{"default":r.TOP,type:r,tooltip:"i18n:COMPONENT.label.vertical_align",notify:function(){this._sgNode&&this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_actualFontSize:{"default":40},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._sgNode&&(this._actualFontSize=this._sgNode.getFontSize()),this._actualFontSize}},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateSgNodeFontSize()},tooltip:"i18n:COMPONENT.label.font_size"},_lineHeight:40,lineHeight:{get:function(){return this._sgNode&&(this._lineHeight=this._sgNode.getLineHeight()),this._lineHeight},set:function(t){this._lineHeight=t,this._sgNode&&(this._sgNode.setLineHeight(t),this._updateNodeSize())},tooltip:"i18n:COMPONENT.label.line_height"},overflow:{"default":s.NONE,type:s,tooltip:"i18n:COMPONENT.label.overflow",notify:function(){this._sgNode&&(this._sgNode.setOverflow(this.overflow),this._updateNodeSize())},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._sgNode&&(this._enableWrapText=this._sgNode.isWrapTextEnabled()),this._enableWrapText},set:function(t){this._enableWrapText=t,this._sgNode&&this._sgNode.enableWrapText(t)},animatable:!1,tooltip:"i18n:COMPONENT.label.wrap"},_N$file:null,font:{get:function(){return this._N$file},set:function(t){if(t||(this._isSystemFontUsed=!0),this._N$file=t,this._bmFontOriginalSize=-1,t&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._sgNode){"string"==typeof t&&cc.warn("Sorry, the cc.Font has been modified from Raw Asset to Asset.Please load the font asset before using.");var e=t instanceof cc.Font,i=e?t.rawUrl:"",n=e?t.texture:"";this._sgNode.setFontFileOrFamily(i,n)}t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize)},type:cc.Font,tooltip:"i18n:COMPONENT.label.font",animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed=!!t,t&&(this.font=null,this._sgNode&&this._sgNode.setFontFileOrFamily("Arial"))},animatable:!1,tooltip:"i18n:COMPONENT.label.system_font"},_bmFontOriginalSize:{displayName:"BMFont Original Size","default":-1,serializable:!1,readonly:!0,visible:!0,animatable:!1}},statics:{HorizontalAlign:n,VerticalAlign:r,Overflow:s},__preload:function(){this._super();var t=this._sgNode._isUseSystemFont;t&&this._updateNodeSize(),this._sgNode.on("load",this._updateNodeSize,this)},_createSgNode:function(){return null},_initSgNode:function(){"string"==typeof this.font&&cc.warn("Sorry, the cc.Font has been modified from Raw Asset to Asset.Please load the font asset before using.");var t=this.font instanceof cc.Font,e=t?this.font.rawUrl:"",i=t?this.font.texture:"";this.font instanceof cc.BitmapFont&&(this._bmFontOriginalSize=this.font.fontSize);var n=this._sgNode=new _ccsg.Label(this.string,e,i);n.setVisible(!1),n.setHorizontalAlign(this.horizontalAlign),n.setVerticalAlign(this.verticalAlign),n.setFontSize(this._fontSize),n.setOverflow(this.overflow),n.enableWrapText(this._enableWrapText),n.setLineHeight(this._lineHeight),n.setString(this.string),n.setContentSize(this.node.getContentSize()),n.setColor(this.node.color)},_updateNodeSize:function(){var t=this._sgNode&&this._sgNode.parent;if(t&&(this.overflow===s.NONE&&this.node.setContentSize(this._sgNode.getContentSize()),this.overflow===s.RESIZE_HEIGHT)){var e=this.node.getContentSize(),i=this._sgNode.getContentSize();this.node.setContentSize(cc.size(e.width,i.height))}}});cc.Label=e.exports=o},{}],68:[function(t,e,i){var n=cc.Class({name:"cc.LabelOutline","extends":t("./CCComponent"),editor:!1,ctor:function(){this._labelSGNode=null},properties:{_color:cc.color(255,255,255,255),_width:1,color:{get:function(){return this._color},set:function(t){this._color=cc.color(t),this._labelSGNode&&this._labelSGNode.setOutlineColor(cc.color(this._color))}},width:{get:function(){return this._width},set:function(t){this._width=t,this._labelSGNode&&(this._labelSGNode.setOutlineWidth(t),this._labelSGNode.setMargin(t))}}},onEnable:function(){var t=this.node.getComponent("cc.Label"),e=this._labelSGNode=t&&t._sgNode;this._labelSGNode&&(e.setOutlined(!0),e.setOutlineColor(cc.color(this._color)),e.setOutlineWidth(this._width),e.setMargin(this._width))},onDisable:function(){this._labelSGNode&&(this._labelSGNode.setOutlined(!1),this._labelSGNode.setMargin(0)),this._labelSGNode=null}});cc.LabelOutline=e.exports=n},{"./CCComponent":64}],69:[function(t,e,i){var n=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),r=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),s=cc.Enum({HORIZONTAL:0,VERTICAL:1}),o=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),a=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),c=cc.Class({name:"cc.Layout","extends":t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{"default":!0,serializable:!1},_resize:r.NONE,_N$layoutType:n.NONE,type:{type:n,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t;this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.layout_type"},resizeMode:{type:r,tooltip:"i18n:COMPONENT.layout.resize_mode",get:function(){return this._resize},set:function(t){if(this.type!==n.NONE||t!==r.CHILDREN){this._resize=t;this._doLayoutDirty()}},animatable:!1},cellSize:{"default":cc.size(40,40),tooltip:"i18n:COMPONENT.layout.cell_size",type:cc.Size,notify:function(){this._doLayoutDirty()},animatable:!1},startAxis:{"default":s.HORIZONTAL,tooltip:"i18n:COMPONENT.layout.start_axis",type:s,notify:function(){this._doLayoutDirty()},animatable:!1},_N$padding:{"default":0},paddingLeft:{"default":0,tooltip:"i18n:COMPONENT.layout.padding_left",notify:function(){this._doLayoutDirty()},animatable:!1},paddingRight:{"default":0,tooltip:"i18n:COMPONENT.layout.padding_right",notify:function(){this._doLayoutDirty()},animatable:!1},paddingTop:{"default":0,tooltip:"i18n:COMPONENT.layout.padding_top",notify:function(){this._doLayoutDirty()},animatable:!1},paddingBottom:{"default":0,tooltip:"i18n:COMPONENT.layout.padding_bottom",notify:function(){this._doLayoutDirty()},animatable:!1},spacingX:{"default":0,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.space_x"},spacingY:{"default":0,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.space_y"},verticalDirection:{"default":o.TOP_TO_BOTTOM,type:o,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.vertical_direction"},horizontalDirection:{"default":a.LEFT_TO_RIGHT,type:a,notify:function(){this._doLayoutDirty()},animatable:!1,tooltip:"i18n:COMPONENT.layout.horizontal_direction"}},statics:{Type:n,VerticalDirection:o,HorizontalDirection:a,ResizeMode:r,AxisDirection:s},_migratePaddingData:function(){this.paddingLeft=this._N$padding,this.paddingRight=this._N$padding,this.paddingTop=this._N$padding,this.paddingBottom=this._N$padding,this._N$padding=0},__preload:function(){cc.sizeEqualToSize(this.node.getContentSize(),cc.size(0,0))&&this.node.setContentSize(this._layoutSize),0!==this._N$padding&&this._migratePaddingData(),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("child-reorder",this._doLayoutDirty,this),this._updateChildrenEventListener()},_doLayoutDirty:function(){this._layoutDirty=!0},_updateChildrenEventListener:function(){var t=this.node.children;t.forEach(function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("position-changed",this._doLayoutDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_childAdded:function(t){var e=t.detail;e.on("size-changed",this._doLayoutDirty,this),e.on("position-changed",this._doLayoutDirty,this),e.on("anchor-changed",this._doLayoutDirty,this),e.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){var e=t.detail;e.off("size-changed",this._doLayoutDirty,this),e.off("position-changed",this._doLayoutDirty,this),e.off("anchor-changed",this._doLayoutDirty,this),e.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(t,e,i,s){var c=this.node.getAnchorPoint(),h=this.node.children,l=1,u=this.paddingLeft,d=-c.x*t;this.horizontalDirection===a.RIGHT_TO_LEFT&&(l=-1,d=(1-c.x)*t,u=this.paddingRight);var _=d+l*u-l*this.spacingX,f=0,p=0,g=0,m=0,v=0,y=0,T=this.cellSize.width;return this.type!==n.GRID&&this.resizeMode===r.CHILDREN&&(T=(t-(this.paddingLeft+this.paddingRight)-(h.length-1)*this.spacingX)/h.length),h.forEach(function(h){if(h.activeInHierarchy){this._resize===r.CHILDREN&&(h.width=T,this.type===n.GRID&&(h.height=this.cellSize.height));var C=h.anchorX;g>p&&(p=g),h.height>=p&&(g=p,p=h.height,y=h.getAnchorPoint().y),this.horizontalDirection===a.RIGHT_TO_LEFT&&(C=1-h.anchorX),_=_+l*C*h.width+l*this.spacingX;var b=l*(1-C)*h.width;if(e){var x=_+b+l*(l>0?this.paddingRight:this.paddingLeft),S=this.horizontalDirection===a.LEFT_TO_RIGHT&&x>(1-c.x)*t,E=this.horizontalDirection===a.RIGHT_TO_LEFT&&x<-c.x*t;(S||E)&&(h.height>=p?(0===g&&(g=p),f+=g,g=p):(f+=p,g=h.height,p=0),_=d+l*(u+C*h.width),m++)}var A=i(h,f,m);t>=h.width+this.paddingLeft+this.paddingRight&&s&&h.setPosition(cc.p(_,A));var O,w=1,R=0===p?h.height:p;this.verticalDirection===o.TOP_TO_BOTTOM?(v=v||this.node._contentSize.height,w=-1,O=A+w*(R*y+this.paddingBottom),O<v&&(v=O)):(v=v||-this.node._contentSize.height,O=A+w*(R*y+this.paddingTop),O>v&&(v=O)),_+=b}}.bind(this)),v},_getVerticalBaseHeight:function(t){var e=0,i=0;return this.resizeMode===r.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(i++,e+=t.height)}),e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop):e=this.node.getContentSize().height,e},_doLayoutVertically:function(t,e,i,s){var c=this.node.getAnchorPoint(),h=this.node.children,l=1,u=this.paddingBottom,d=-c.y*t;this.verticalDirection===o.TOP_TO_BOTTOM&&(l=-1,d=(1-c.y)*t,u=this.paddingTop);var _=d+l*u-l*this.spacingY,f=0,p=0,g=0,m=0,v=0,y=0,T=this.cellSize.height;return this.type!==n.GRID&&this.resizeMode===r.CHILDREN&&(T=(t-(this.paddingTop+this.paddingBottom)-(h.length-1)*this.spacingY)/h.length),h.forEach(function(h){if(h.activeInHierarchy){this.resizeMode===r.CHILDREN&&(h.height=T,this.type===n.GRID&&(h.width=this.cellSize.width));var C=h.anchorY;g>p&&(p=g),h.width>=p&&(g=p,p=h.width,y=h.getAnchorPoint().x),this.verticalDirection===o.TOP_TO_BOTTOM&&(C=1-h.anchorY),_=_+l*C*h.height+l*this.spacingY;var b=l*(1-C)*h.height;if(e){var x=_+b+l*(l>0?this.paddingTop:this.paddingBottom),S=this.verticalDirection===o.BOTTOM_TO_TOP&&x>(1-c.y)*t,E=this.verticalDirection===o.TOP_TO_BOTTOM&&x<-c.y*t;(S||E)&&(h.width>=p?(0===g&&(g=p),f+=g,g=p):(f+=p,g=h.width,p=0),_=d+l*(u+C*h.height),m++)}var A=i(h,f,m);t>=h.height+(this.paddingTop+this.paddingBottom)&&s&&h.setPosition(cc.p(A,_));var O,w=1,R=0===p?h.width:p;this.horizontalDirection===a.RIGHT_TO_LEFT?(w=-1,v=v||this.node._contentSize.width,O=A+w*(R*y+this.paddingLeft),O<v&&(v=O)):(v=v||-this.node._contentSize.width,O=A+w*(R*y+this.paddingRight),O>v&&(v=O)),_+=b}}.bind(this)),v},_doLayoutBasic:function(){var t=this.node.children,e=null;if(t.forEach(function(t){t.activeInHierarchy&&(e=e?cc.rectUnion(e,t.getBoundingBoxToWorld()):t.getBoundingBoxToWorld())}),e){var i=this.node.parent.convertToNodeSpaceAR(cc.p(e.x,e.y));i=cc.pAdd(i,cc.p(-this.paddingLeft,-this.paddingBottom));var n=this.node.parent.convertToNodeSpaceAR(cc.p(e.x+e.width,e.y+e.height));n=cc.pAdd(n,cc.p(this.paddingRight,this.paddingTop));var r=cc.size(parseFloat((n.x-i.x).toFixed(2)),parseFloat((n.y-i.y).toFixed(2))),s=this.node.getPosition(),o=(s.x-i.x)/r.width,a=(s.y-i.y)/r.height,c=cc.p(parseFloat(o.toFixed(2)),parseFloat(a.toFixed(2)));this.node.setAnchorPoint(c),this.node.setContentSize(r)}},_doLayoutGridAxisHorizontal:function(t,e){var i=e.width,n=1,s=-t.y*e.height,a=this.paddingBottom;this.verticalDirection===o.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*e.height,a=this.paddingTop);var c=function(t,e,i){return s+n*(e+t.anchorY*t.height+a+i*this.spacingY)}.bind(this),h=0;if(this.resizeMode===r.CONTAINER){var l=this._doLayoutHorizontally(i,!0,c,!1);h=s-l,h<0&&(h*=-1),s=-t.y*h,this.verticalDirection===o.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*h)}this._doLayoutHorizontally(i,!0,c,!0),this.resizeMode===r.CONTAINER&&this.node.setContentSize(i,h)},_doLayoutGridAxisVertical:function(t,e){var i=e.height,n=1,s=-t.x*e.width,o=this.paddingLeft;this.horizontalDirection===a.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*e.width,o=this.paddingRight);var c=function(t,e,i){return s+n*(e+t.anchorX*t.width+o+i*this.spacingX)}.bind(this),h=0;if(this.resizeMode===r.CONTAINER){var l=this._doLayoutVertically(i,!0,c,!1);h=s-l,h<0&&(h*=-1),s=-t.x*h,this.horizontalDirection===a.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*h)}this._doLayoutVertically(i,!0,c,!0),this.resizeMode===r.CONTAINER&&this.node.setContentSize(h,i)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();this.startAxis===s.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===s.VERTICAL&&this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0,i=0;return this.resizeMode===r.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(i++,e+=t.width)}),e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight):e=this.node.getContentSize().width,e},_doLayout:function(){if(this.type===n.HORIZONTAL){var t=this._getHorizontalBaseWidth(this.node.children),e=function(t){return t.y};this._doLayoutHorizontally(t,!1,e,!0),this.node.width=t}else if(this.type===n.VERTICAL){var i=this._getVerticalBaseHeight(this.node.children),s=function(t){return t.x};this._doLayoutVertically(i,!1,s,!0),this.node.height=i}else this.type===n.NONE?this.resizeMode===r.CONTAINER&&this._doLayoutBasic():this.type===n.GRID&&this._doLayoutGrid()},onEnable:function(){cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this._updateLayout,this)},onDisable:function(){cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this._updateLayout,this)},_updateLayout:function(){this._layoutDirty&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)}});Object.defineProperty(c.prototype,"padding",{get:function(){return cc.warn("Property padding is deprecated, please use paddingLeft, paddingRight, paddingTop and paddingBottom instead"),this.paddingLeft},set:function(t){this._N$padding=t,this._migratePaddingData(),this._doLayoutDirty()}}),cc.Layout=e.exports=c},{"./CCComponent":64}],70:[function(t,e,i){var n=cc._RendererInSG,r=cc.Enum({RECT:0,ELLIPSE:1}),s=cc.Class({name:"cc.Mask","extends":n,editor:!1,properties:{_clippingStencil:{"default":null,serializable:!1},_type:0,_segements:64,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:r},segements:{get:function(){return this._segements},set:function(t){t<3&&(t=3),this._segements=t,this._refreshStencil()},type:cc.Integer}},statics:{Type:r},_createSgNode:function(){return this._clippingStencil=new cc.DrawNode,new cc.ClippingNode(this._clippingStencil)},_initSgNode:function(){},_hitTest:function(t){var e=this.node.getContentSize(),i=e.width,n=e.height,s=this.node.getNodeToWorldTransform();if(this._type===r.RECT){var o=cc.rect(0,0,i,n);cc._rectApplyAffineTransformIn(o,s);var a=t.x-o.x,c=o.x+o.width-t.x,h=t.y-o.y,l=o.y+o.height-t.y;return a>=0&&c>=0&&l>=0&&h>=0}var u=i/2,d=n/2,_=s.a*u+s.c*d+s.tx,f=s.b*u+s.d*d+s.ty,p=t.x-_,g=t.y-f;return p*p/(u*u)+g*g/(d*d)<1},onEnable:function(){this._refreshStencil(),this._super(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},_calculateCircle:function(t,e,i){for(var n=[],r=2*Math.PI/i,s=0;s<i;++s)n.push(cc.v2(e.x*Math.cos(r*s)+t.x,e.y*Math.sin(r*s)+t.y));return n},_refreshStencil:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=t.width,n=t.height,s=-i*e.x,o=-n*e.y,a=cc.color(255,255,255,0);if(this._clippingStencil.clear(),this._type===r.RECT){var c=[cc.v2(s,o),cc.v2(s+i,o),cc.v2(s+i,o+n),cc.v2(s,o+n)];this._clippingStencil.drawPoly(c,a,0,a)}else{var h=cc.v2(s+i/2,o+n/2),l={x:i/2,y:n/2},u=this._segements;this._clippingStencil.drawPoly(this._calculateCircle(h,l,u),a,0,a)}}});cc.Mask=e.exports=s},{}],71:[function(t,e,i){var n=cc.Enum({Unified:0,Free:1}),r=cc.Enum({Horizontal:0,Vertical:1}),s=cc.Enum({PAGE_TURNING:0}),o=cc.Class({name:"cc.PageView","extends":cc.ScrollView,editor:!1,ctor:function(){this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[]},properties:{sizeMode:{"default":n.Unified,type:n,tooltip:"i18n:COMPONENT.pageview.sizeMode",notify:function(){this._syncSizeMode()}},direction:{"default":r.Horizontal,type:r,tooltip:"i18n:COMPONENT.pageview.direction",notify:function(){this._syncScrollDirection()}},scrollThreshold:{"default":.5,type:cc.Float,slide:!0,range:[0,1,.01],tooltip:"i18n:COMPONENT.pageview.scrollThreshold"},autoPageTurningThreshold:{"default":100,type:cc.Float,tooltip:"i18n:COMPONENT.pageview.autoPageTurningThreshold"},pageTurningEventTiming:{"default":.1,type:cc.Float,range:[0,1,.01],tooltip:"i18n:COMPONENT.pageview.pageTurningEventTiming"},indicator:{"default":null,type:cc.PageViewIndicator,tooltip:"i18n:COMPONENT.pageview.indicator",notify:function(){this.indicator&&this.indicator.setPageView(this)}},pageEvents:{"default":[],type:cc.Component.EventHandler,tooltip:"i18n:COMPONENT.pageview.pageEvents"}},statics:{SizeMode:n,Direction:r,EventType:s},__preload:function(){this._super(),this.node.on("size-changed",this._updateAllPagesSize,this)},onEnable:function(){this._super(),this.node.on("scroll-ended",this._dispatchPageTurningEvent,this)},onDisable:function(){this._super(),this.node.off("scroll-ended",this._dispatchPageTurningEvent,this)},onLoad:function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},onDestroy:function(){this._super(),this.node.off("size-changed",this._updateAllPagesSize,this);
},getCurrentPageIndex:function(){return this._curPageIdx},setCurrentPageIndex:function(t){this.scrollToPage(t,!0)},getPages:function(){return this._pages},addPage:function(t){t&&this._pages.indexOf(t)===-1&&this.content&&(this.content.addChild(t),this._pages.push(t),this._updatePageView())},insertPage:function(t,e){if(!(e<0)&&t&&this._pages.indexOf(t)===-1&&this.content){var i=this._pages.length;e>=i?this.addPage(t):(this._pages.splice(e,0,t),this.content.addChild(t),this._updatePageView())}},removePage:function(t){if(t&&this.content){var e=this._pages.indexOf(t);return e===-1?void cc.warn("can not found the %s page.",t.name):void this.removePageAtIndex(e)}},removePageAtIndex:function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},removeAllPages:function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},scrollToPage:function(t,e){t<0||t>this._pages.length||(e=void 0!==e?e:.3,this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},getScrollEndedEventTiming:function(){return this.pageTurningEventTiming},_syncScrollDirection:function(){this.horizontal=this.direction===r.Horizontal,this.vertical=this.direction===r.Vertical},_syncSizeMode:function(){if(this.content){var t=this.content.getComponent(cc.Layout);if(t){if(0===this._pages.length)t.padding=0;else{var e=this._pages[this._pages.length-1];this.sizeMode===n.Free&&(this.direction===r.Horizontal?(t.paddingLeft=(this.node.width-this._pages[0].width)/2,t.paddingRight=(this.node.width-e.width)/2):this.direction===r.Vertical&&(t.paddingTop=(this.node.height-this._pages[0].height)/2,t.paddingBottom=(this.node.height-e.height)/2))}t._updateLayout()}}},_updatePageView:function(){var t=this._pages.length,e=this.content.getComponent(cc.Layout);e&&e.enabledInHierarchy&&e._updateLayout(),this._curPageIdx>=t&&(this._curPageIdx=0===t?0:t-1,this._lastPageIdx=this._curPageIdx);for(var i=0;i<t;++i)this._pages[i].setSiblingIndex(i),this.direction===r.Horizontal?this._scrollCenterOffsetX[i]=Math.abs(this.content.x+this._pages[i].x):this._scrollCenterOffsetY[i]=Math.abs(this.content.y+this._pages[i].y);this.indicator&&this.indicator._refresh()},_updateAllPagesSize:function(){if(this.sizeMode===n.Unified)for(var t=this._pages,e=this.node.getContentSize(),i=0,r=t.length;i<r;i++)t[i].setContentSize(e)},_initPages:function(){if(this.content){for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},_dispatchPageTurningEvent:function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cc.Component.EventHandler.emitEvents(this.pageEvents,this,s.PAGE_TURNING),this.node.emit("page-turning",this))},_isScrollable:function(t,e,i){if(this.sizeMode===n.Free){var s,o;if(this.direction===r.Horizontal)return s=this._scrollCenterOffsetX[e],o=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(s-o)*this.scrollThreshold;if(this.direction===r.Vertical)return s=this._scrollCenterOffsetY[e],o=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(s-o)*this.scrollThreshold}else{if(this.direction===r.Horizontal)return Math.abs(t.x)>=this.node.width*this.scrollThreshold;if(this.direction===r.Vertical)return Math.abs(t.y)>=this.node.height*this.scrollThreshold}},_isQuicklyScrollable:function(t){if(this.direction===r.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===r.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},_moveOffsetValue:function(t){var e=cc.p(0,0);return this.sizeMode===n.Free?this.direction===r.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===r.Vertical&&(e.y=this._scrollCenterOffsetY[t]):this.direction===r.Horizontal?e.x=t*this.node.width:this.direction===r.Vertical&&(e.y=t*this.node.height),e},_updatePageIndex:function(t){var e=0;return this.direction===r.Horizontal?e+=t.x>0?1:-1:this.direction===r.Vertical&&(e+=t.y<0?1:-1),this._curPageIdx+e},_handleReleaseLogic:function(t){var e=this._startBounceBackIfNeeded();if(!e){var i=this._curPageIdx,n=cc.pSub(this._touchBeganPosition,this._touchEndPosition),r=this._updatePageIndex(n);if(r<this._pages.length){if(this._isScrollable(n,i,r))return void this.scrollToPage(r);var s=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(s))return void this.scrollToPage(r)}this.scrollToPage(i)}},_onTouchBegan:function(t,e){this._touchBeganPosition=t.touch.getLocation(),this._super(t,e)},_onTouchMoved:function(t,e){this._super(t,e)},_onTouchEnded:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onTouchCancelled:function(t,e){this._touchEndPosition=t.touch.getLocation(),this._super(t,e)},_onMouseWheel:function(){}});cc.PageView=e.exports=o},{}],72:[function(t,e,i){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),r=cc.Class({name:"cc.PageViewIndicator","extends":t("./CCComponent"),editor:!1,properties:{_layout:null,_pageView:null,_indicators:[],spriteFrame:{"default":null,type:cc.SpriteFrame,tooltip:"i18n:COMPONENT.pageview_indicator.spriteFrame"},direction:{"default":n.HORIZONTAL,type:n,tooltip:"i18n:COMPONENT.pageview_indicator.direction"},cellSize:{"default":cc.size(20,20),tooltip:"i18n:COMPONENT.layout.cell_size"},spacing:{"default":0,tooltip:"i18n:COMPONENT.pageview_indicator.spacing"}},statics:{Direction:n},onLoad:function(){this._updateLayout()},setPageView:function(t){this._pageView=t,this._refresh()},_updateLayout:function(){this._layout=this.getComponent(cc.Layout),this._layout||(this._layout=this.addComponent(cc.Layout)),this.direction===n.HORIZONTAL?(this._layout.type=cc.Layout.Type.HORIZONTAL,this._layout.spacingX=this.spacing):this.direction===n.VERTICAL&&(this._layout.type=cc.Layout.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=cc.Layout.ResizeMode.CONTAINER},_createIndicator:function(){var t=new cc.Node,e=t.addComponent(cc.Sprite);return e.spriteFrame=this.spriteFrame,t.parent=this.node,t.width=this.cellSize.width,t.height=this.cellSize.height,t},_changedState:function(){var t=this._indicators;if(0!==t.length){var e=this._pageView._curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i];n.opacity=127.5}t[e].opacity=255}}},_refresh:function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else{var n=t.length-e.length;for(i=n;i>0;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1)}}this._layout&&this._layout.enabledInHierarchy&&this._layout._updateLayout(),this._changedState()}}}});cc.PageViewIndicator=e.exports=r},{"./CCComponent":64}],73:[function(t,e,i){var n=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),r=cc.Class({name:"cc.ProgressBar","extends":t("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=this.node.getContentSize(),i=this.node.getAnchorPoint(),r=t.getContentSize();t.parent===this.node&&this.node.setContentSize(r),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=n.FILLED);var s=t.getContentSize();if(this.mode===n.HORIZONTAL?this.totalLength=s.width:this.mode===n.VERTICAL?this.totalLength=s.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node){var o=-e.width*i.x,a=0;t.setPosition(cc.p(o,a))}}},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e,i,r,s=t.getAnchorPoint(),o=t.getContentSize(),a=t.getPosition(),c=cc.p(0,.5),h=cc.clamp01(this.progress),l=this.totalLength*h;switch(this.mode){case n.HORIZONTAL:this.reverse&&(c=cc.p(1,.5)),e=cc.size(l,o.height),i=this.totalLength,r=o.height;break;case n.VERTICAL:c=this.reverse?cc.p(.5,1):cc.p(.5,0),e=cc.size(o.width,l),i=o.width,r=this.totalLength;break;case n.FILLED:this.reverse&&(l*=-1),this.barSprite.fillRange=l}if(this.barSprite.type!==cc.Sprite.Type.FILLED){var u=c.x-s.x,d=c.y-s.y,_=cc.p(i*u,r*d);t.setPosition(cc.pAdd(a,_)),t.setAnchorPoint(c),t.setContentSize(e)}}},properties:{barSprite:{"default":null,type:cc.Sprite,tooltip:"i18n:COMPONENT.progress.bar_sprite",notify:function(){this._initBarSprite()},animatable:!1},mode:{"default":n.HORIZONTAL,type:n,tooltip:"i18n:COMPONENT.progress.mode",notify:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=t.getContentSize();this.mode===n.HORIZONTAL?this.totalLength=e.width:this.mode===n.VERTICAL?this.totalLength=e.height:this.mode===n.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},totalLength:{"default":1,range:[0,Number.MAX_VALUE],tooltip:"i18n:COMPONENT.progress.total_length",notify:function(t){this._updateBarStatus()}},progress:{"default":1,type:"Float",range:[0,1,.1],slide:!0,tooltip:"i18n:COMPONENT.progress.progress",notify:function(){this._updateBarStatus()}},reverse:{"default":!1,tooltip:"i18n:COMPONENT.progress.reverse",notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:n}});cc.ProgressBar=e.exports=r},{"./CCComponent":64}],74:[function(t,e,i){var n=cc.Class({"extends":t("./CCSGComponent"),name:"cc._RendererInSG",ctor:function(){var t=this._sgNode=this._createSgNode();t.setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(t){var e=this.node,i=e._sgNode;i._entity=null;var n=i.getChildren().slice();i.removeAllChildren(!1),t.getChildrenCount()>0&&t.removeAllChildren(!1);for(var r=0,s=n.length;r<s;++r)t.addChild(n[r]);var o=i.getParent();o&&(o.removeChild(i,!1),o.addChild(t),t._arrivalOrder=i._arrivalOrder,cc.renderer.childrenOrderDirty=o._reorderChildDirty=!0),e._sgNode=t,e._sgNode._entity=e,e._updateSgNode()}});cc._RendererInSG=e.exports=n},{"./CCSGComponent":77}],75:[function(t,e,i){var n=cc.Class({"extends":t("./CCSGComponent"),name:"cc._RendererUnderSG",ctor:function(){var t=this._sgNode=this._createSgNode();t&&t.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(t){if(t){var e=this.node;t.setColor(e._color),e._cascadeOpacityEnabled||t.setOpacity(e._opacity),t.setAnchorPoint(e._anchorPoint),t.setIgnoreAnchorPointForPosition(e.__ignoreAnchor),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1);var i=e._sgNode;i.addChild(t)}}});cc._RendererUnderSG=e.exports=n},{"./CCSGComponent":77}],76:[function(t,e,i){t("../label/CCHtmlTextParser.js"),t("../label/CCTextUtils.js");var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=cc.Class({name:"cc.RichText","extends":cc._RendererUnderSG,ctor:function(){this._textArray=null,this._labelSegmentsCache=[],this._resetState(),this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{"default":"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:"i18n:COMPONENT.richtext.string",notify:function(){this._updateRichTextStatus()}},horizontalAlign:{"default":n.LEFT,type:n,tooltip:"i18n:COMPONENT.richtext.horizontal_align",animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{"default":40,tooltip:"i18n:COMPONENT.richtext.font_size",notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},font:{"default":null,type:cc.TTFFont,tooltip:"i18n:COMPONENT.richtext.font",notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font&&this._onTTFLoaded(),this._updateRichTextStatus())}},maxWidth:{"default":0,tooltip:"i18n:COMPONENT.richtext.max_width",notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{"default":40,tooltip:"i18n:COMPONENT.richtext.line_height",notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{"default":null,type:cc.SpriteAtlas,tooltip:"i18n:COMPONENT.richtext.image_atlas",notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}}},statics:{HorizontalAlign:n,VerticalAlign:r},__preload:function(){this._super(),this._registerEvents()},_createSgNode:function(){var t=new _ccsg.Node;t.setCascadeOpacityEnabled(!0);var e=this;return t.setColor=function(){e._updateLabelSegmentTextAttributes()},t._setContentSize=t.setContentSize,t.setContentSize=function(){},t},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t)}.bind(this))},_initSgNode:function(){this._updateRichText(),this._onTTFLoaded()},_createFontLabel:function(t){return new _ccsg.Label(t,this._getFontRawUrl())},_getFontRawUrl:function(){var t=this.font instanceof cc.TTFFont,e=t?this.font.rawUrl:"";return e},_onTTFLoaded:function(){var t=this,e=function(){t._layoutDirty=!0,t._updateRichText()};cc.CustomFontLoader.loadTTF(this._getFontRawUrl(),e)},_measureText:function(t,e){var i=this,n=function(e){var n;0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0],n.setString(e)),n._styleIndex=t,i._applyTextAttribute(n);var r=n.getContentSize();return r.width};return e?n(e):n},_onTouchEnded:function(t){if(this.enabledInHierarchy)for(var e=this.node.getComponents(cc.Component),i=0;i<this._labelSegments.length;++i){var n=this._labelSegments[i],r=n._clickHandler;r&&this._containsTouchLocation(n,t.touch.getLocation())&&e.forEach(function(e){e.enabledInHierarchy&&e[r]&&e[r](t)})}},_containsTouchLocation:function(t,e){var i=t.getBoundingBoxToWorld();return cc.rectContainsPoint(i,e)},_registerEvents:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_resetState:function(){var t=this._sgNode;t&&t.removeAllChildren(),this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},_addLabelSegment:function(t,e){var i;0===this._labelSegmentsCache.length?i=this._createFontLabel(t):(i=this._labelSegmentsCache.pop(),i.setString(t)),i._styleIndex=e,i._lineCount=this._lineCount,this._applyTextAttribute(i),i.setAnchorPoint(cc.p(0,0)),this._sgNode.addChild(i),this._labelSegments.push(i);return i},_updateRichTextWithMaxWidth:function(t,e,i){var n,r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this.maxWidth)for(var s=0;this._lineOffsetX<=this.maxWidth;){var o=this._getFirstWordLen(t,s,t.length),a=t.substr(s,o),c=this._measureText(i,a);if(!(this._lineOffsetX+c<=this.maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=c,s+=o}if(r>this.maxWidth)for(var l=cc.TextUtils.fragmentText(t,r,this.maxWidth,this._measureText(i)),u=0;u<l.length;++u){var d=l[u];n=this._addLabelSegment(d,i);var _=n.getContentSize();this._lineOffsetX+=_.width,l.length>1&&u<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,i)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],n=t[e];if(i.text!=n.text)return!0;if(i.style){if(n.style){if(i.style.size!==n.style.size||i.style.italic!==n.style.italic||i.style.isImage!==n.style.isImage)return!0;if(i.style.isImage===n.style.isImage&&i.style.src!==n.style.src)return!0}else if(i.style.size||i.style.italic||i.style.isImage)return!0}else if(n.style&&(n.style.size||n.style.italic||n.style.isImage))return!0}return!1},_onSpriteFrameLoaded:function(t,e){var i;i=e?e:t.target;var n=i.__sprite;n.setSpriteFrame(i)},_applySpriteFrame:function(t){t&&(t.textureLoaded()?this._onSpriteFrameLoaded(null,t):(t.once("load",this._onSpriteFrameLoaded,this),t.ensureLoadTexture()))},_addRichTextImageElement:function(t){var e=t.style.src,i=this.imageAtlas.getSpriteFrame(e);if(i){var n=new cc.Scale9Sprite;n.setAnchorPoint(cc.p(0,0)),i.__sprite=n,this._sgNode.addChild(n),this._labelSegments.push(n);var r=i.getRect(),s=1;r.height>this.lineHeight&&(s=this.lineHeight/r.height),this.maxWidth>0?(this._lineOffsetX+r.width*s>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=r.width*s):(this._lineOffsetX+=r.width*s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),this._applySpriteFrame(i),n.setContentSize(cc.size(r.width*s,r.height*s)),n._lineCount=this._lineCount,t.style.event&&t.style.event.click&&(n._clickHandler=t.style.event.click)}else cc.warn("Invalid RichText img tag! The sprite frame name can't be found in the ImageAtlas!")},_updateRichText:function(){if(this.enabled){var t=cc.htmlTextParser.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t;var e=this._sgNode;this._resetState();for(var i,n,r=!1,s=0;s<this._textArray.length;++s){var o=this._textArray[s],a=o.text;if(""===a){if(o.style&&o.style.newline){this._updateLineInfo();continue}if(o.style&&o.style.isImage&&this.imageAtlas){this._addRichTextImageElement(o);continue}}for(var c=a.split("\n"),h=0;h<c.length;++h){var l=c[h];if(""!==l)if(r=!1,this.maxWidth>0){var u=this._measureText(s,l);this._updateRichTextWithMaxWidth(l,u,s),c.length>1&&h<c.length-1&&this._updateLineInfo()}else i=this._addLabelSegment(l,s),n=i.getContentSize(),this._lineOffsetX+=n.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),c.length>1&&h<c.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&h==c.length-1)continue;this._updateLineInfo(),r=!0}}}r||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=this._lineCount*this.lineHeight,e._setContentSize(cc.size(this._labelWidth,this._labelHeight)),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(n)||cc.TextUtils.isUnicodeSpace(n))return 1;for(var r=1,s=e+1;s<i&&(n=t.charAt(s),!cc.TextUtils.isUnicodeSpace(n)&&!cc.TextUtils.isUnicodeCJK(n));++s)r++;return r},_updateRichTextPosition:function(){for(var t=0,e=1,i=this._lineCount,n=0;n<this._labelSegments.length;++n){var r=this._labelSegments[n],s=r._lineCount;s>e&&(t=0,e=s);var o=0;switch(this.horizontalAlign){case cc.TextAlignment.LEFT:o=0;break;case cc.TextAlignment.CENTER:o=(this._labelWidth-this._linesWidth[s-1])/2;break;case cc.TextAlignment.RIGHT:o=this._labelWidth-this._linesWidth[s-1]}r.setPositionX(t+o);var a=r.getContentSize(),c=(i-s)*this.lineHeight;r instanceof cc.Scale9Sprite&&(c+=(this.lineHeight-r.getContentSize().height)/2),r.setPositionY(c),s===e&&(t+=a.width)}},_applyTextAttribute:function(t){if(!(t instanceof cc.Scale9Sprite)){var e=t._styleIndex;t.setLineHeight(this.lineHeight),t.setVerticalAlign(r.CENTER),t.enableBold(!1),t.enableItalics(!1),t.enableUnderline(!1);var i=null;if(this._textArray[e]&&(i=this._textArray[e].style),i&&i.color){var n=i.color.toUpperCase();cc.Color[n]?t.setColor(cc.Color[n]):t.setColor(cc.hexToColor(i.color))}else t.setColor(this.node.color);i&&i.bold&&t.enableBold(!0),i&&i.italic&&t.enableItalics(!0),i&&i.underline&&t.enableUnderline(!0),i&&i.size?t.setFontSize(i.size):t.setFontSize(this.fontSize),i&&i.event&&i.event.click&&(t._clickHandler=i.event.click)}}});cc.RichText=e.exports=s},{"../label/CCHtmlTextParser.js":111,"../label/CCTextUtils.js":112}],77:[function(t,e,i){var n=t("../utils/scene-graph-helper"),r=cc.Class({"extends":t("./CCComponent"),name:"cc._SGComponent",editor:!1,properties:{_sgNode:{"default":null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:n.removeSgNode,_registSizeProvider:function(){if(this.node._sizeProvider);else this.node._sizeProvider=this._sgNode}});cc._SGComponent=e.exports=r},{"../utils/scene-graph-helper":169,"./CCComponent":64}],78:[function(t,e,i){var n=20,r=cc.Enum({HORIZONTAL:0,VERTICAL:1}),s=cc.Class({name:"cc.Scrollbar","extends":t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{"default":0,serializable:!1},_opacity:255,handle:{"default":null,type:cc.Sprite,tooltip:"i18n:COMPONENT.scrollbar.handle",notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},direction:{"default":r.HORIZONTAL,type:r,tooltip:"i18n:COMPONENT.scrollbar.direction",notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},enableAutoHide:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollbar.auto_hide"},autoHideTime:{"default":1,animatable:!1,tooltip:"i18n:COMPONENT.scrollbar.auto_hide_time"}},statics:{Direction:r},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=t.convertToWorldSpace(cc.p(0,0)),i=this._scrollView.node.convertToNodeSpace(e);return i},_setOpacity:function(t){this.handle&&this.node.setOpacity(t)},_onScroll:function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e.getContentSize(),n=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(i,n))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var s=0,o=0,a=0,c=0;this.direction===r.HORIZONTAL?(s=i.width,o=n.width,a=t.x,c=-this._convertToScrollViewSpace(e).x):this.direction===r.VERTICAL&&(s=i.height,o=n.height,a=t.y,c=-this._convertToScrollViewSpace(e).y);var h=this._calculateLength(s,o,a),l=this._calculatePosition(s,o,c,a,h);this._updateLength(h),this._updateHanlderPosition(l)}}},_updateHanlderPosition:function(t){if(this.handle){var e=this._fixupHandlerPosition();this.handle.node.setPosition(cc.pAdd(t,e))}},_fixupHandlerPosition:function(){var t,e=this.node.getContentSize(),i=this.node.getAnchorPoint(),n=(this.node.getPosition(),this.handle.node.parent);if(this.direction===r.HORIZONTAL){var s=this.node.convertToWorldSpaceAR(cc.p(-e.width*i.x,-e.height*i.y));t=n.convertToNodeSpaceAR(s)}else if(this.direction===r.VERTICAL){var o=this.node.convertToWorldSpaceAR(cc.p(-e.width*i.x,-e.height*i.y));t=n.convertToNodeSpaceAR(o)}return this.handle.node.setPosition(t),t},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===r.HORIZONTAL||t.height<=e.height&&this.direction===r.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),i=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i){var r=t;i&&(r+=(i>0?i:-i)*n);var s=e/r;return e*s},_calculatePosition:function(t,e,i,n,s){var o=t-e;n&&(o+=Math.abs(n));var a=0;o&&(a=i/o,a=cc.clamp01(a));var c=(e-s)*a;return this.direction===r.VERTICAL?cc.p(0,c):cc.p(c,0)},_updateLength:function(t){if(this.handle){var e=this.handle.node,i=this.node.getContentSize();e.setAnchorPoint(cc.p(0,0)),this.direction===r.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=s},{"./CCComponent":64}],79:[function(t,e,i){var n=5,r=.05,s=1e-7,o=.7,a=function(t){return t-=1,t*t*t*t*t+1},c=function(){var t=new Date;return t.getMilliseconds()},h=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,AUTOSCROLL_ENDED:9,TOUCH_UP:10}),l={"scroll-to-top":h.SCROLL_TO_TOP,"scroll-to-bottom":h.SCROLL_TO_BOTTOM,"scroll-to-left":h.SCROLL_TO_LEFT,"scroll-to-right":h.SCROLL_TO_RIGHT,scrolling:h.SCROLLING,"bounce-bottom":h.BOUNCE_BOTTOM,"bounce-left":h.BOUNCE_LEFT,"bounce-right":h.BOUNCE_RIGHT,"bounce-top":h.BOUNCE_TOP,"scroll-ended":h.AUTOSCROLL_ENDED,"touch-up":h.TOUCH_UP},u=cc.Class({name:"cc.ScrollView","extends":t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),this._outOfBoundaryAmount=cc.p(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedEventFired=!1},properties:{content:{"default":void 0,type:cc.Node,tooltip:"i18n:COMPONENT.scrollview.content"},horizontal:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.horizontal"},vertical:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.vertical"},inertia:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.inertia"},brake:{"default":.5,type:"Float",range:[0,1,.1],animatable:!1,tooltip:"i18n:COMPONENT.scrollview.brake"},elastic:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.elastic"},bounceDuration:{"default":1,range:[0,10],animatable:!1,tooltip:"i18n:COMPONENT.scrollview.bounceDuration"},horizontalScrollBar:{"default":void 0,type:cc.Scrollbar,tooltip:"i18n:COMPONENT.scrollview.horizontal_bar",notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{"default":void 0,type:cc.Scrollbar,tooltip:"i18n:COMPONENT.scrollview.vertical_bar",notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{"default":[],type:cc.Component.EventHandler,tooltip:"i18n:COMPONENT.scrollview.scrollEvents"},cancelInnerEvents:{"default":!0,animatable:!1,tooltip:"i18n:COMPONENT.scrollview.cancelInnerEvents"}},statics:{EventType:h},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,e!==!1):this._moveContent(i)},scrollToOffset:function(t,e,i){var n=this.getMaxScrollOffset(),r=cc.p(0,0);0===n.x?r.x=0:r.x=t.x/n.x,0===n.y?r.y=1:r.y=(n.y-t.y)/n.y,this.scrollTo(r,e,i)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.p(e,t)},getMaxScrollOffset:function(){var t=this.node.getContentSize(),e=this.content.getContentSize(),i=e.width-t.width,n=e.height-t.height;return i=i>=0?i:0,n=n>=0?n:0,cc.p(i,n)},scrollToPercentHorizontal:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(n,e,i!==!1):this._moveContent(n)},scrollTo:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:t,applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,i!==!1):this._moveContent(n)},scrollToPercentVertical:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(n,e,i!==!1):this._moveContent(n)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){if(!cc.pFuzzyEqual(t,this.getContentPosition(),s)&&(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0,this.elastic)){var e=this._getHowMuchOutOfBoundary();e.y>0&&this._dispatchEvent("bounce-top"),e.y<0&&this._dispatchEvent("bounce-bottom"),e.x>0&&this._dispatchEvent("bounce-right"),e.x<0&&this._dispatchEvent("bounce-left")}},getContentPosition:function(){return this.content.getPosition()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=cc.p(0,0),n=-.1;this.vertical?i=cc.p(0,t.getScrollY()*n):this.horizontal&&(i=cc.p(t.getScrollY()*n,0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},_checkMouseWheel:function(t){var e=this._getHowMuchOutOfBoundary(),i=.1;return cc.pFuzzyEqual(e,cc.p(0,0),s)?(this._mouseWheelEventElapsedTime+=t,void(this._mouseWheelEventElapsedTime>i&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1))):(this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1))},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,n=t.applyToVertical;this._calculateBoundary(),e=cc.pClamp(e,cc.p(0,0),cc.p(1,1));var r=this.node.getContentSize(),s=this.content.getContentSize(),o=this._getContentBottomBoundary()-this._bottomBoundary;o=-o;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var c=cc.p(0,0),h=0;return i&&(h=s.width-r.width,c.x=a-h*e.x),n&&(h=s.height-r.height,c.y=o-h*e.y),c},_moveContentToTopLeft:function(t){
var e=this.content.getContentSize(),i=this._getContentBottomBoundary()-this._bottomBoundary;i=-i;var n=cc.p(0,0),r=0,s=this._getContentLeftBoundary()-this._leftBoundary;s=-s,e.height<t.height?(r=e.height-t.height,n.y=i-r,this.verticalScrollBar&&this.verticalScrollBar.hide()):this.verticalScrollBar&&this.verticalScrollBar.show(),e.width<t.width?(r=e.width-t.width,n.x=s,this.horizontalScrollBar&&this.horizontalScrollBar.hide()):this.horizontalScrollBar&&this.horizontalScrollBar.show(),this._moveContent(n),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t._updateLayout();var e=this.node.getContentSize(),i=this._convertToContentParentSpace(cc.p(0,0));this._leftBoundary=i.x,this._bottomBoundary=i.y;var n=this._convertToContentParentSpace(cc.p(e.width,e.height));this._rightBoundary=n.x,this._topBoundary=n.y,this._moveContentToTopLeft(e)}},_convertToContentParentSpace:function(t){var e=this.node.convertToWorldSpace(t),i=this.content.parent;return i.convertToNodeSpaceAR(e)},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(this.node===n)return!!t.target.getComponent(cc.ViewGroup);if(n.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=t.touch;this.content&&this._handlePressLogic(i),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},_onTouchMoved:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this.content&&this._handleMoveLogic(i),this.cancelInnerEvents){var n=cc.pSub(i.getLocation(),i.getStartLocation());if(cc.pLength(n)>7&&!this._touchMoved&&t.target!==this.node){var r=new cc.Event.EventTouch(t.getTouches(),t.bubbles);r.type=cc.Node.EventType.TOUCH_CANCEL,r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},_onTouchEnded:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=t.touch;this.content&&this._handleReleaseLogic(i),this._dispatchEvent("touch-up"),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)}},_onTouchCancelled:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){if(!t.simulate){var i=t.touch;this.content&&this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_handleMoveLogic:function(t){var e=t.getDelta();this._processDeltaMove(e)},_scrollChildren:function(t){t=this._clampDelta(t);var e,i=t;this.elastic&&(e=this._getHowMuchOutOfBoundary(),i.x*=0===e.x?1:.5,i.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(i),i=cc.pAdd(i,e));var n=-1;if(i.y>0){var r=this.content.y-this.content.anchorY*this.content.height;r+i.y>this._bottomBoundary&&(n="scroll-to-bottom")}else if(i.y<0){var s=this.content.y-this.content.anchorY*this.content.height+this.content.height;s+i.y<=this._topBoundary&&(n="scroll-to-top")}else if(i.x<0){var o=this.content.x-this.content.anchorX*this.content.width+this.content.width;o+i.x<=this._rightBoundary&&(n="scroll-to-right")}else if(i.x>0){var a=this.content.x-this.content.anchorX*this.content.width;a+i.x>=this._leftBoundary&&(n="scroll-to-left")}this._moveContent(i,!1),0===i.x&&0===i.y||this._dispatchEvent("scrolling"),n!==-1&&this._dispatchEvent(n)},_handlePressLogic:function(){this._autoScrolling=!1,this._touchMovePreviousTimestamp=c(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this.node.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);this._touchMoveDisplacements.length>=n;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var e=c();this._touchMoveTimeDeltas.push((e-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=e},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(t=this._clampDelta(t),cc.pFuzzyEqual(t,cc.p(0,0),s))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),!0},_processInertiaScroll:function(){var t=this._startBounceBackIfNeeded();if(!t&&this.inertia){var e=this._calculateTouchMoveVelocity();!cc.pFuzzyEqual(e,cc.p(0,0),s)&&this.brake<1&&this._startInertiaScroll(e)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var e=t.getDelta();this._gatherTouchMove(e),this._processInertiaScroll()},_isOutOfBoundary:function(){var t=this._getHowMuchOutOfBoundary();return!cc.pFuzzyEqual(t,cc.p(0,0),s)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return s},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?r:1;this._autoScrollAccumulatedTime+=t*(1/i);var n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(n=a(n));var o=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,n)),c=1===n,h=Math.abs(n-1)<=this.getScrollEndedEventTiming();if(h&&!this._isScrollEndedEventFired&&(this._dispatchEvent("scroll-ended"),this._isScrollEndedEventFired=!0),this.elastic){var l=cc.pSub(o,this._autoScrollBrakingStartPosition);e&&(l=cc.pMult(l,i)),o=cc.pAdd(this._autoScrollBrakingStartPosition,l)}else{var u=cc.pSub(o,this.getContentPosition()),d=this._getHowMuchOutOfBoundary(u);cc.pFuzzyEqual(d,cc.p(0,0),s)||(o=cc.pAdd(o,d),c=!0)}c&&(this._autoScrolling=!1,this._isScrollEndedEventFired||this._dispatchEvent("scroll-ended"));var _=cc.pSub(o,this.getContentPosition());this._moveContent(_,c)},_startInertiaScroll:function(t){var e=cc.pMult(t,o);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){if(this.brake<=0)return 1-this.brake;var e=(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9));return e},_startAttenuatingAutoScroll:function(t,e){var i=this._calculateAutoScrollTimeByInitalSpeed(cc.pLength(e)),n=cc.pNormalize(t),r=this.content.getContentSize(),s=this.node.getContentSize(),o=r.width-s.width,a=r.height-s.height,c=this._calculateAttenuatedFactor(o),h=this._calculateAttenuatedFactor(a);n=cc.p(n.x*o*(1-this.brake)*c,n.y*a*h*(1-this.brake));var l=cc.pLength(t),u=cc.pLength(n)/l;n=cc.pAdd(n,t),this.brake>0&&u>7&&(u=Math.sqrt(u),n=cc.pAdd(cc.pMult(t,u),t)),this.brake>0&&u>3&&(u=3,i*=u),0===this.brake&&u>1&&(i*=u),this._startAutoScroll(n,i,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){var e=Math.sqrt(Math.sqrt(t/5));return e},_startAutoScroll:function(t,e,i){var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedEventFired=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var r=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(r,cc.p(0,0),s)){this._autoScrollCurrentlyOutOfBoundary=!0;var o=this._getHowMuchOutOfBoundary(n);(r.x*o.x>0||r.y*o.y>0)&&(this._autoScrollBraking=!0)}},_calculateTouchMoveVelocity:function(){var t=0;if(t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},t),t<=0||t>=.5)return cc.p(0,0);var e=cc.p(0,0);return e=this._touchMoveDisplacements.reduce(function(t,e){return cc.pAdd(t,e)},e),cc.p(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},_moveContent:function(t,e){var i=this._flattenVectorByDirection(t),n=cc.pAdd(this.getContentPosition(),i);this.setContentPosition(n);var r=this._getHowMuchOutOfBoundary();this._updateScrollBar(r),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){var t=this.getContentPosition(),e=t.x-this.content.getAnchorPoint().x*this.content.getContentSize().width;return e},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){var t=this.getContentPosition(),e=t.y-this.content.getAnchorPoint().y*this.content.getContentSize().height;return e},_getHowMuchOutOfBoundary:function(t){if(t=t||cc.p(0,0),cc.pFuzzyEqual(t,cc.p(0,0),s)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.p(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),cc.pFuzzyEqual(t,cc.p(0,0),s)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e=this._clampDelta(e)},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){cc.Component.EventHandler.emitEvents(this.scrollEvents,this,l[t]),this.node.emit(t,this)},__preload:function(){this._registerEvent(),this.node.on("size-changed",this._calculateBoundary,this),this.content&&this.content.on("size-changed",this._calculateBoundary,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var t=this._getHowMuchOutOfBoundary(cc.p(0,0)),e=cc.pAdd(this.getContentPosition(),t);this.content&&(this.content.setPosition(e),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_AFTER_VISIT,this._adjustContentOutOfBoundary,this)},onDestroy:function(){this.node.off("size-changed",this._calculateBoundary,this),this.content&&this.content.off("size-changed",this._calculateBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},_showScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.show(),this.verticalScrollBar&&this.verticalScrollBar.show()},onDisable:function(){this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._showScrollbar()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=u},{"./CCViewGroup":86}],80:[function(t,e,i){var n=cc.Enum({Horizontal:0,Vertical:1}),r=cc.Class({name:"cc.Slider","extends":t("./CCComponent"),editor:!1,ctor:function(){this._dragging=!1},properties:{handle:{"default":null,type:cc.Button,tooltip:"i18n:COMPONENT.slider.handle",notify:function(){}},direction:{"default":n.Horizontal,type:n,tooltip:"i18n:COMPONENT.slider.direction"},progress:{"default":.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:"i18n:COMPONENT.slider.progress",notify:function(){this._updateHandlePosition()}},slideEvents:{"default":[],type:cc.Component.EventHandler,tooltip:"i18n:COMPONENT.slider.slideEvents"}},statics:{Direction:n},__preload:function(){this._registerEvent(),this._updateHandlePosition()},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){if(this.handle){var e=null,i=0,r=this.node.convertTouchToNodeSpaceAR(t);this.direction===n.Horizontal?(e=this.node.width/2-this.handle.node.width*this.handle.node.anchorX,i=cc.clamp01((r.x+e)/(2*e),0,1)):this.direction===n.Vertical&&(e=this.node.height/2-this.handle.node.height*this.handle.node.anchorY,i=cc.clamp01((r.y+e)/(2*e),0,1)),this.progress=i}},_updateHandlePosition:function(){if(this.handle){var t;t=this.direction===n.Horizontal?cc.p(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.p(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var e=this.node.convertToWorldSpaceAR(t);this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(e)}}});cc.Slider=e.exports=r},{"./CCComponent":64}],81:[function(t,e,i){var n=t("./CCRendererUnderSG"),r=cc.Scale9Sprite.RenderingType,s=cc.Scale9Sprite.FillType,o=cc.BlendFunc.BlendFactor,a=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),c=cc.Class({name:"cc.Sprite","extends":n,editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{"default":null,type:cc.SpriteFrame},_type:r.SIMPLE,_sizeMode:a.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:o.SRC_ALPHA,_dstBlendFactor:o.ONE_MINUS_SRC_ALPHA,_atlas:{"default":null,type:cc.SpriteAtlas,tooltip:"i18n:COMPONENT.sprite.atlas",editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(this._type),this._applyCapInset()},type:r,animatable:!1,tooltip:"i18n:COMPONENT.sprite.type"},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:s,tooltip:"i18n:COMPONENT.sprite.fill_type"},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:"i18n:COMPONENT.sprite.fill_center"},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:"i18n:COMPONENT.sprite.fill_start"},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:"i18n:COMPONENT.sprite.fill_range"},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t))},animatable:!1,tooltip:"i18n:COMPONENT.sprite.trim"},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:"i18n:COMPONENT.sprite.src_blend_factor"},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:"i18n:COMPONENT.sprite.dst_blend_factor"},sizeMode:{get:function(){return this._sizeMode},set:function(t){this._sizeMode=t,t!==a.CUSTOM&&this._applySpriteSize()},animatable:!1,type:a,tooltip:"i18n:COMPONENT.sprite.size_mode"}},statics:{FillType:s,Type:r,SizeMode:a},setVisible:function(t){this.enabled=t},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},_applyAtlas:!1,_applyCapInset:function(){if(this._type===r.SLICED&&this._spriteFrame){var t=this._sgNode;t.setInsetTop(this._spriteFrame.insetTop),t.setInsetBottom(this._spriteFrame.insetBottom),t.setInsetRight(this._spriteFrame.insetRight),t.setInsetLeft(this._spriteFrame.insetLeft)}},_applySpriteSize:function(){if(a.CUSTOM!==this._sizeMode&&this._spriteFrame)if(a.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(a.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node.setContentSize(cc.size(e.width,e.height))}else this.node.setContentSize(this.node.getContentSize(!0));else this.node.setContentSize(this.node.getContentSize(!0))},_onSpriteFrameLoaded:function(t){var e=this,i=this._sgNode;i.setSpriteFrame(e._spriteFrame),e._applyCapInset(),e._applySpriteSize(),e.enabledInHierarchy&&!i.isVisible()&&i.setVisible(!0)},_applySpriteFrame:function(t){var e=this._sgNode;t&&t.off&&t.off("load",this._onSpriteFrameLoaded,this);var i=this._spriteFrame;i?i.textureLoaded()?this._onSpriteFrameLoaded(null):(i.once("load",this._onSpriteFrameLoaded,this),i.ensureLoadTexture()):e.setVisible(!1)},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){this._applySpriteFrame(null);var t=this._sgNode;t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:!1}),h=t("../utils/misc"),l=["insetLeft","insetTop","insetRight","insetBottom"],u={type:[null,"setRenderingType"]};h.propertyDefine(c,l,u),cc.Sprite=e.exports=c},{"../utils/misc":166,"./CCRendererUnderSG":75}],82:[function(t,e,i){var n=cc.Class({name:"cc.SpriteDistortion","extends":t("./CCComponent"),editor:!1,ctor:function(){this._spriteSGNode=null},properties:{_distortionOffset:cc.v2(0,0),offset:{get:function(){return this._distortionOffset},set:function(t){this._distortionOffset.x=t.x,this._distortionOffset.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionOffset(this._distortionOffset)}},_distortionTiling:cc.v2(1,1),tiling:{get:function(){return this._distortionTiling},set:function(t){this._distortionTiling.x=t.x,this._distortionTiling.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionTiling(this._distortionTiling)}}},onEnable:function(){var t=this.node.getComponent("cc.Sprite"),e=this._spriteSGNode=t&&t._sgNode;this._spriteSGNode&&(e.setState(cc.Scale9Sprite.state.DISTORTION),e.setDistortionOffset(this._distortionOffset),e.setDistortionTiling(this._distortionTiling))},onDisable:function(){this._spriteSGNode&&this._spriteSGNode.setState(cc.Scale9Sprite.state.NORMAL),this._spriteSGNode=null}});cc.SpriteDistortion=e.exports=n},{"./CCComponent":64}],83:[function(t,e,i){var n=cc.Class({name:"cc.Toggle","extends":t("./CCButton.js"),editor:!1,properties:{isChecked:{"default":!0,tooltip:"i18n:COMPONENT.toggle.isChecked",notify:function(){this._updateCheckMark()}},toggleGroup:{"default":null,tooltip:"i18n:COMPONENT.toggle.toggleGroup",type:cc.ToggleGroup},checkMark:{"default":null,type:cc.Sprite,tooltip:"i18n:COMPONENT.toggle.checkMark"},checkEvents:{"default":[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},__preload:function(){this._super()},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.removeToggle(this)},_updateCheckMark:function(){this.checkMark&&(this.checkMark.enabled=!!this.isChecked)},_updateDisabledState:function(){this._super(),this.checkMark&&this.checkMark._sgNode.setState(0),this.enableAutoGrayEffect&&this.checkMark&&!this.interactable&&this.checkMark._sgNode.setState(1)},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},toggle:function(t){this.toggleGroup&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!this.isChecked,this._updateCheckMark(),this._emitToggleEvents(t),this.toggleGroup&&this.toggleGroup.updateToggles(this))},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)},check:function(){this.toggleGroup&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!0,this.node.emit("toggle",this),this.toggleGroup&&this.toggleGroup.updateToggles(this))},uncheck:function(){this.toggleGroup&&this.isChecked&&!this.toggleGroup.allowSwitchOff||(this.isChecked=!1,this.node.emit("toggle",this))}});cc.Toggle=e.exports=n},{"./CCButton.js":62}],84:[function(t,e,i){var n=cc.Class({name:"cc.ToggleGroup","extends":cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:"i18n:COMPONENT.toggle_group.allowSwitchOff","default":!1}},updateToggles:function(t){this.enabledInHierarchy&&this._toggleItems.forEach(function(e){t.isChecked&&e!==t&&e.isChecked&&e.enabled&&(e.isChecked=!1)})},addToggle:function(t){var e=this._toggleItems.indexOf(t);e>-1?cc.warn("Toggle alreay in ToggleGroup.Something bad happened, please report this issue to the Creator developer, thanks."):this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){var e=this._toggleItems.indexOf(t);e>-1?this._toggleItems.splice(e,1):cc.warn("Toggle is not in ToggleGroup.Something bad happened, please report this issue to the Creator developer, thanks."),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var t=!1;return this._toggleItems.forEach(function(e){t&&e.enabled&&(e.isChecked=!1),e.isChecked&&e.enabled&&(t=!0)}),t},_makeAtLeastOneToggleChecked:function(){var t=this._allowOnlyOneToggleChecked();t||this.allowSwitchOff||this._toggleItems.length>0&&(this._toggleItems[0].isChecked=!0)},start:function(){this._makeAtLeastOneToggleChecked()}});cc.ToggleGroup=e.exports=n},{}],85:[function(t,e,i){var n=_ccsg.VideoPlayer.EventType,r=cc.Enum({REMOTE:0,LOCAL:1}),s=cc.Class({name:"cc.VideoPlayer","extends":cc._RendererUnderSG,editor:!1,properties:{_resourceType:r.REMOTE,resourceType:{tooltip:"i18n:COMPONENT.videoplayer.resourceType",type:r,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:"i18n:COMPONENT.videoplayer.url",type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{"default":null,url:cc.RawAsset},clip:{tooltip:"i18n:COMPONENT.videoplayer.video",get:function(){return this._clip},set:function(t){"string"!=typeof t&&(t=""),this._clip=t,this._updateVideoSource()},url:cc.RawAsset},currentTime:{tooltip:"i18n:COMPONENT.videoplayer.currentTime",type:cc.Float,set:function(t){this._sgNode&&this._sgNode.seekTo(t)},get:function(){return this._sgNode?this._sgNode.currentTime():-1}},keepAspectRatio:{tooltip:"i18n:COMPONENT.videoplayer.keepAspectRatio","default":!0,type:cc.Boolean,notify:function(){this._sgNode.setKeepAspectRatioEnabled(this.keepAspectRatio)}},isFullscreen:{tooltip:"i18n:COMPONENT.videoplayer.isFullscreen","default":!1,type:cc.Boolean,notify:function(){this._sgNode.setFullScreenEnabled(this.isFullscreen)}},videoPlayerEvent:{"default":[],type:cc.Component.EventHandler}},statics:{EventType:n,ResourceType:r},onLoad:function(){},_createSgNode:function(){return new _ccsg.VideoPlayer},_updateVideoSource:function(){var t=this._sgNode;this.resourceType===r.REMOTE?t.setURL(this.remoteURL):t.setURL(this._clip||"")},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),this._updateVideoSource(),t.seekTo(this.currentTime),t.setKeepAspectRatioEnabled(this.keepAspectRatio),t.setFullScreenEnabled(this.isFullscreen),t.setContentSize(this.node.getContentSize()),this.pause(),t.setEventListener(n.PLAYING,this.onPlaying.bind(this)),t.setEventListener(n.PAUSED,this.onPasued.bind(this)),t.setEventListener(n.STOPPED,this.onStopped.bind(this)),t.setEventListener(n.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(n.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(n.CLICKED,this.onClicked.bind(this)),t.setEventListener(n.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onReadyToPlay:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PLAYING),this.node.emit("playing",this)},onPasued:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PAUSED),this.node.emit("paused",this)},onStopped:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.COMPLETED),this.node.emit("completed",this)},play:function(){this._sgNode&&this._sgNode.play()},resume:function(){this._sgNode&&this._sgNode.resume()},pause:function(){this._sgNode&&this._sgNode.pause()},stop:function(){this._sgNode&&this._sgNode.stop()},getDuration:function(){return this._sgNode?this._sgNode.duration():-1},isPlaying:function(){return!!this._sgNode&&this._sgNode.isPlaying()}});cc.VideoPlayer=e.exports=s},{}],86:[function(t,e,i){var n=cc.Class({name:"cc.ViewGroup","extends":t("./CCComponent")});cc.ViewGroup=e.exports=n},{"./CCComponent":64}],87:[function(t,e,i){var n=_ccsg.WebView.EventType,r=cc.Class({name:"cc.WebView","extends":cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_url:"",url:{type:String,tooltip:"i18n:COMPONENT.webview.url",get:function(){return this._url},set:function(t){this._url=t;var e=this._sgNode;e&&e.loadURL(t)}},webviewEvents:{"default":[],type:cc.Component.EventHandler}},statics:{EventType:n},onLoad:!1,_createSgNode:function(){return new _ccsg.WebView},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),t.setEventListener(n.LOADED,this._onWebViewLoaded.bind(this)),t.setEventListener(n.LOADING,this._onWebViewLoading.bind(this)),t.setEventListener(n.ERROR,this._onWebViewLoadError.bind(this)),t.loadURL(this._url),t.setContentSize(this.node.getContentSize()))},_onWebViewLoaded:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADED),this.node.emit("loaded",this)},_onWebViewLoading:function(){return cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.LOADING),this.node.emit("loading",this),!0},_onWebViewLoadError:function(){cc.Component.EventHandler.emitEvents(this.webviewEvents,this,n.ERROR),this.node.emit("error",this)}});cc.WebView=e.exports=r},{}],88:[function(t,e,i){var n=t("../base-ui/CCWidgetManager"),r=n._AlignFlags,s=r.TOP,o=r.MID,a=r.BOT,c=r.LEFT,h=r.CENTER,l=r.RIGHT,u=s|a,d=c|l,_=cc.Class({name:"cc.Widget","extends":t("./CCComponent"),editor:!1,properties:{isAlignTop:{get:function(){return(this._alignFlags&s)>0},set:function(t){this._setAlign(s,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_top"},isAlignVerticalCenter:{get:function(){return(this._alignFlags&o)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=o):this._alignFlags&=~o},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_v_center"},isAlignBottom:{get:function(){return(this._alignFlags&a)>0},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_bottom"},isAlignLeft:{get:function(){return(this._alignFlags&c)>0},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_left"},isAlignHorizontalCenter:{get:function(){return(this._alignFlags&h)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=h):this._alignFlags&=~h},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_h_center"},isAlignRight:{get:function(){return(this._alignFlags&l)>0},set:function(t){this._setAlign(l,t)},animatable:!1,tooltip:"i18n:COMPONENT.widget.align_right"},isStretchWidth:{get:function(){return(this._alignFlags&d)===d},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&u)===u},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:"i18n:COMPONENT.widget.top"},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:"i18n:COMPONENT.widget.bottom"},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:"i18n:COMPONENT.widget.left"},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:"i18n:COMPONENT.widget.right"},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:"i18n:COMPONENT.widget.horizontal_center"},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:"i18n:COMPONENT.widget.vertical_center"},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{
get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},isAlignOnce:{"default":!0,tooltip:"i18n:COMPONENT.widget.align_once",displayName:"AlignOnce"},_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){n.add(this)},onDisable:function(){n.remove(this)},_setAlign:function(t,e){var i=(this._alignFlags&t)>0;if(e!=i){var n=(t&d)>0;e?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(n?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t)}}});cc.Widget=e.exports=_},{"../base-ui/CCWidgetManager":51,"./CCComponent":64}],89:[function(t,e,i){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),e.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./CCEditBox"),t("./CCVideoPlayer"),t("./CCWebView"),t("./CCSpriteDistortion"),t("./CCLabelOutline"),t("./CCRichText"),t("./CCToggleGroup"),t("./CCToggle")]},{"./CCAnimation":60,"./CCAudioSource":61,"./CCButton":62,"./CCCanvas":63,"./CCComponent":64,"./CCComponentEventHandler":65,"./CCEditBox":66,"./CCLabel":67,"./CCLabelOutline":68,"./CCLayout":69,"./CCMask":70,"./CCPageView":71,"./CCPageViewIndicator":72,"./CCProgressBar":73,"./CCRendererInSG":74,"./CCRendererUnderSG":75,"./CCRichText":76,"./CCScrollBar":78,"./CCScrollView":79,"./CCSlider":80,"./CCSprite":81,"./CCSpriteDistortion":82,"./CCToggle":83,"./CCToggleGroup":84,"./CCVideoPlayer":85,"./CCWebView":87,"./CCWidget":88,"./missing-script":90}],90:[function(t,e,i){var n=cc.js,r=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{"default":null,visible:!1,editorOnly:!0}}}),s=cc.Class({name:"cc.MissingScript","extends":cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{"default":!1,serializable:!1},_$erialized:{"default":null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){var i=n._getClassById(t);return i?i:t?(cc.deserialize.reportMissingClass(t),e.node,r):null}},onLoad:function(){cc.warn('Script attached to "%s" is missing or invalid.',this.node.name)}});cc._MissingScript=e.exports=s},{}],91:[function(t,e,i){var n=cc.js,r=cc.Event;cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration";var s=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};n.extend(s,cc.Event),n.mixin(s.prototype,{setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getPreviousLocation:function(){return{x:this._prevX,y:this._prevY}},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),s.NONE=0,s.DOWN=1,s.UP=2,s.MOVE=3,s.SCROLL=4,s.BUTTON_LEFT=0,s.BUTTON_RIGHT=2,s.BUTTON_MIDDLE=1,s.BUTTON_4=3,s.BUTTON_5=4,s.BUTTON_6=5,s.BUTTON_7=6,s.BUTTON_8=7;var o=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.currentTouch=null};n.extend(o,cc.Event),n.mixin(o.prototype,{getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t},setLocation:function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},getLocation:function(){return this.touch?this.touch.getLocation():cc.v2()},getLocationInView:function(){return this.touch?this.touch.getLocationInView():cc.v2()},getPreviousLocation:function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},getStartLocation:function(){return this.touch?this.touch.getStartLocation():cc.v2()},getID:function(){return this.touch?this.touch.getID():null},getDelta:function(){return this.touch?this.touch.getDelta():cc.v2()},getDeltaX:function(){return this.touch?this.touch.getDelta().x:0},getDeltaY:function(){return this.touch?this.touch.getDelta().y:0},getLocationX:function(){return this.touch?this.touch.getLocationX():0},getLocationY:function(){return this.touch?this.touch.getLocationY():0}}),o.MAX_TOUCHES=5,o.BEGAN=0,o.MOVED=1,o.ENDED=2,o.CANCELED=3;var a=function(t,e){cc.Event.call(this,r.ACCELERATION,e),this.acc=t};n.extend(a,cc.Event);var c=function(t,e,i){cc.Event.call(this,r.KEYBOARD,i),this.keyCode=t,this.isPressed=e};n.extend(c,cc.Event),cc.Event.EventMouse=s,cc.Event.EventTouch=o,cc.Event.EventAcceleration=a,cc.Event.EventKeyboard=c,e.exports=r},{}],92:[function(t,e,i){cc.EventListener=cc._Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_target:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this,n=function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,n)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this,e=function(e){var i=cc.Event.EventMouse;switch(e._eventType){case i.DOWN:t.onMouseDown&&t.onMouseDown(e);break;case i.UP:t.onMouseUp&&t.onMouseUp(e);break;case i.MOVE:t.onMouseMove&&t.onMouseMove(e);break;case i.SCROLL:t.onMouseScroll&&t.onMouseScroll(e)}};cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._checkEventListenerAvailable.touchOneByOne),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._checkEventListenerAvailable.touchAllAtOnce),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener.create);var e=t.event;delete t.event;var i=null;e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION?(i=new cc._EventListenerAcceleration(t.callback),delete t.callback):e===cc.EventListener.FOCUS&&(i=new cc._EventListenerFocus);for(var n in t)i[n]=t[n];return i},cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var t=new cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return!!this.onFocusChanged||(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){var t=function(t){this.onFocusChanged&&this.onFocusChanged(t._widgetLoseFocus,t._widgetGetFocus)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,t)}}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this,i=function(t){e._onAccelerationEvent(t.acc,t)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,i)},checkAvailable:function(){return cc.assert(this._onAccelerationEvent,cc._LogInfos._checkEventListenerAvailable.acceleration),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this,e=function(e){e.isPressed?t.onKeyPressed&&t.onKeyPressed(e.keyCode,e):t.onKeyReleased&&t.onKeyReleased(e.keyCode,e)};cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._checkEventListenerAvailable.keyboard),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],93:[function(t,e,i){var n=cc._Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),r=function(t){var e=cc.Event,i=t.getType();return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i.startsWith(e.MOUSE)?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i.startsWith(e.TOUCH)&&cc.log(cc._LogInfos._getListenerID),i)};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t.getChildren)for(var e=t.getChildren(),i=0,n=e.length;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){if(!(t instanceof cc._BaseNode||t instanceof _ccsg.Node))return void cc.warn(cc._LogInfos.EventManager.addListener_5);var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!0);if(e===!0){var s=t.getChildren();for(i=0,n=s.length;i<n;i++)this.pauseTarget(s[i],!0)}},resumeTarget:function(t,e){if(!(t instanceof cc._BaseNode||t instanceof _ccsg.Node))return void cc.warn(cc._LogInfos.EventManager.addListener_5);var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),e===!0&&t.getChildren){var s=t.getChildren();for(i=0,n=s.length;i<n;i++)this.resumeTarget(s[i],!0)}},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new n,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var r=t._getSceneGraphPriority();null===r&&cc.log(cc._LogInfos.EventManager._forceAddEventListener),this._associateNodeAndEventListener(r,t),r.isRunning()&&this.resumeTarget(r)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,s=i.length;r<s;r++)if(t=n[i[r].__instanceId])for(var o=0,a=t.length;o<a;o++)e=t[o],e&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)e=t[i],e._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var n=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var s,o=this._toAddedListeners;for(e=0;e<o.length;)s=o[e],s&&s._getListenerID()===t?cc.js.array.remove(o,s):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=cc.director.getScene();n&&this._sortListenersOfSceneGraphPriority(t,n)}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[r.__instanceId]-i[n.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;n<r&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var i,n,r,s=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=this._toRemovedListeners;if(o)for(i=0;i<o.length;)n=o[i],n._isRegistered()?++i:(cc.js.array.remove(o,n),r=a.indexOf(n),r!==-1&&a.splice(r,1));if(s)for(i=0;i<s.length;)n=s[i],n._isRegistered()?++i:(cc.js.array.remove(s,n),r=a.indexOf(n),r!==-1&&a.splice(r,1));o&&0===o.length&&e.clearSceneGraphListeners(),s&&0===s.length&&e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(e>0,cc._LogInfos.EventManager._updateListeners),!(e>1)){t.getType().startsWith(cc.Event.TOUCH)?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(r(t)),cc.assert(1===e,cc._LogInfos.EventManager._updateListeners_2);var i=this._listenersMap,n=this._priorityDirtyFlagMap;for(var s in i)i[s].empty()&&(delete n[s],delete i[s]);var o=this._toAddedListeners;if(0!==o.length){for(var a=0,c=o.length;a<c;a++)this._forceAddEventListener(o[a]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r,s=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();o&&(r=o.indexOf(i),o.splice(r,1)),s&&(r=s.indexOf(i),s.splice(r,1))}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=i.currentTouch;i.currentTarget=t._node;var r,s=!1,o=i.getEventCode(),a=cc.Event.EventTouch;return o===a.BEGAN?t.onTouchBegan&&(s=t.onTouchBegan(n,i),s&&t._registered&&t._claimedTouches.push(n)):t._claimedTouches.length>0&&(r=t._claimedTouches.indexOf(n))!==-1&&(s=!0,o===a.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):o===a.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):o===a.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(cc.eventManager._updateListeners(i),!0):!!(s&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)if(t.currentTouch=n[o],this._dispatchEventToListeners(e,this._onTouchEventCallback,s),t.isStopped())return;i&&r.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,r=e.touches,s=n.getEventCode();return n.currentTarget=t._node,s===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,n):s===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,n):s===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,n):s===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,n),!!n.isStopped()&&(cc.eventManager._updateListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(n=0;n<a.length;n++)if(r=a[n],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if(r=o[c],r.isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){t._reorderChildDirty&&t.sortAllChildren();var i=t.getChildren(),n=0,r=i.length,s=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(r>0){for(var a;n<r&&(a=i[n],a&&a.getLocalZOrder()<0);n++)this._visitTarget(a,!1);for(void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));n<r;n++)a=i[n],a&&this._visitTarget(a,!1)}else void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));if(e){var c=[];for(var h in s)c.push(h);c.sort(this._sortNumberAsc);var l,u,d=c.length,_=this._nodePriorityMap;for(n=0;n<d;n++)for(l=s[c[n]],u=0;u<l.length;u++)_[l[u]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.EventManager.addListener_2),!(cc.js.isNumber(e)||e instanceof cc._BaseNode||e instanceof _ccsg.Node))return void cc.warn(cc._LogInfos.EventManager.addListener_5);if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.EventManager.addListener_4)}else cc.assert(!cc.js.isNumber(e),cc._LogInfos.EventManager.addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.EventManager.addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var n in i){var r=i[n],s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(o,t),e?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(s,t),e&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[n]),e)break}if(!e)for(var a=this._toAddedListeners,c=0,h=a.length;c<h;c++){var l=a[c];if(l===t){cc.js.array.remove(a,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,r):this._toRemovedListeners.push(r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.js.array.remove(t,r),!0}return!1},removeListeners:function(t,e){var i,n=this;if(!(cc.js.isNumber(t)||t instanceof cc._BaseNode||t instanceof _ccsg.Node))return void cc.warn(cc._LogInfos.EventManager.addListener_5);if(void 0!==t.__instanceId){delete n._nodePriorityMap[t.__instanceId],cc.js.array.remove(n._dirtyNodes,t);var i,r=n._nodeListenersMap[t.__instanceId];if(r){var s=cc.js.array.copy(r);for(i=0;i<s.length;i++)n.removeListener(s[i]);delete n._nodeListenersMap[t.__instanceId]}var o=n._toAddedListeners;for(i=0;i<o.length;){var a=o[i];a._getSceneGraphPriority()===t?(a._setSceneGraphPriority(null),a._setRegistered(!1),o.splice(i,1)):++i}if(e===!0){var c,h=t.getChildren();for(i=0,c=h.length;i<c;i++)n.removeListeners(h[i],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?n._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?n._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?n._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?n._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?n._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.EventManager.removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)e.indexOf(i)===-1&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n],s=r.getFixedPriorityListeners();if(s){var o=s.indexOf(t);if(o!==-1)return null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.EventManager.setPriority),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=r(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&this._dispatchEventToListeners(i,this._onListenerCallback,t),this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}}},{}],94:[function(t,e,i){var n=t("../event/event-target"),r=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),s=null,o=null,a=cc.Class({name:"SystemEvent","extends":n,statics:{EventType:r},on:function(t,e,i,n){this._super(t,e,i,n),s||t!==r.KEY_DOWN&&t!==r.KEY_UP||(s=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=r.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=r.KEY_UP,cc.systemEvent.dispatchEvent(e)}}),cc.eventManager.addListener(s,1)),o||t!==r.DEVICEMOTION||(o=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=r.DEVICEMOTION,cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ?e.acc=cc.p(-t.x,-t.y):e.acc=cc.p(t.x,t.y),cc.systemEvent.dispatchEvent(e)}}),cc.eventManager.addListener(o,1))},off:function(t,e,i,n){if(this._super(t,e,i,n),s&&(t===r.KEY_DOWN||t===r.KEY_UP)){var a=this.hasEventListener(r.KEY_DOWN),c=this.hasEventListener(r.KEY_UP);a||c||cc.eventManager.removeListener(s)}o&&t===r.DEVICEMOTION&&cc.eventManager.removeListener(o)}});cc.SystemEvent=e.exports=a,cc.systemEvent=new cc.SystemEvent},{"../event/event-target":98}],95:[function(t,e,i){cc.Touch=cc._Class.extend({_lastModified:0,_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){void 0===e?this._prevPoint=cc.p(t.x,t.y):this._prevPoint=cc.p(t||0,e||0)}})},{}],96:[function(t,e,i){t("./CCTouch"),t("./CCEventListener"),t("./CCEventManager"),t("./CCEvent"),t("./CCSystemEvent")},{"./CCEvent":91,"./CCEventListener":92,"./CCEventManager":93,"./CCSystemEvent":94,"./CCTouch":95}],97:[function(t,e,i){function n(){s.call(this)}var r=cc.js,s=t("../platform/callbacks-invoker").CallbacksHandler,o=s.REMOVE_PLACEHOLDER;r.extend(n,s),n.prototype.invoke=function(t,e){var i,n,r,s,a,c=t.type,h=this._callbackTable[c];if(this._invoking[c]=!0,h)if(1===h.length)r=h[0],r!==o&&r.call(t.currentTarget,t,e);else if(n=h.length-1,c===cc.Director.EVENT_COMPONENT_UPDATE){var l=t.detail;for(i=1;i<=n;i+=2)s=h[i],s!==o&&s.update(l)}else for(i=0;i<=n;){r=h[i];var u=1;if(r!==o&&(s=h[i+1],a=s&&"object"==typeof s,a?(r.call(s,t,e),u=2):r.call(t.currentTarget,t,e),t._propagationImmediateStopped||i+u>n))break;i+=u}this._invoking[c]=!1,this._clearToRemove(c)},e.exports=n},{"../platform/callbacks-invoker":140}],98:[function(t,e,i){var n=t("./event-listeners");t("./event");var r=cc.js,s=r.array.fastRemove,o=new Array(16);o.length=0;var a=function(t,e){var i,n;for(e.target=t,o.length=0,t._getCapturingTargets(e.type,o),e.eventPhase=1,n=o.length-1;n>=0;--n)if(i=o[n],i._isTargetActive(e.type)&&i._capturingListeners&&(e.currentTarget=i,i._capturingListeners.invoke(e,o),e._propagationStopped))return void(o.length=0);if(o.length=0,t._isTargetActive(e.type)&&(e.eventPhase=2,e.currentTarget=t,t._capturingListeners&&t._capturingListeners.invoke(e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.invoke(e)),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,o),e.eventPhase=3,n=0;n<o.length;++n)if(i=o[n],i._isTargetActive(e.type)&&i._bubblingListeners&&(e.currentTarget=i,i._bubblingListeners.invoke(e),e._propagationStopped))return void(o.length=0);
o.length=0},c=function(){this._capturingListeners=null,this._bubblingListeners=null};r.mixin(c.prototype,{hasEventListener:function(t,e){return!!(e&&this._capturingListeners&&this._capturingListeners.has(t))||!(e||!this._bubblingListeners||!this._bubblingListeners.has(t))},on:function(t,e,i,r){if("boolean"==typeof i?(r=i,i=void 0):r=!!r,!e)return void cc.error("Callback of event must be non-nil");var s=null;return s=r?this._capturingListeners=this._capturingListeners||new n:this._bubblingListeners=this._bubblingListeners||new n,s.has(t,e,i)||(s.add(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this)),e},__fastOn:function(t,e,i,r){var s=this._bubblingListeners;s||(s=this._bubblingListeners=new n),s.add(t,e,i),r.push(this)},off:function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=n?this._capturingListeners:this._bubblingListeners;r&&(r.remove(t,e,i),i&&i.__eventTargets&&s(i.__eventTargets,this))}},__fastOff:function(t,e,i,n){var r=this._bubblingListeners;r&&(r.remove(t,e,i),s(n,this))},targetOff:function(t){this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t)},once:function(t,e,i,n){var r=this,s=function(o){r.off(t,s,i,n),e.call(this,o)};this.on(t,s,i,n)},dispatchEvent:function(t){a(this,t),o.length=0},emit:function(t,e){var i=this._capturingListeners&&this._capturingListeners._callbackTable[t],n=this._bubblingListeners&&this._bubblingListeners._callbackTable[t];if(i&&0!==i.length||n&&0!==n.length){var r=new cc.Event.EventCustom(t);r.detail=e,r.eventPhase=2,r.target=r.currentTarget=this,i&&this._capturingListeners.invoke(r),n&&!r._propagationImmediateStopped&&this._bubblingListeners.invoke(r)}},_isTargetActive:function(t){return!0},_getCapturingTargets:function(t,e){},_getBubblingTargets:function(t,e){}}),c.prototype._EventTargetOn=c.prototype.on,c.prototype._EventTargetOnce=c.prototype.once,c.prototype._EventTargetOff=c.prototype.off,c.prototype._EventTargetTargetOff=c.prototype.targetOff,cc.EventTarget=e.exports=c},{"./event":99,"./event-listeners":97}],99:[function(t,e,i){var n=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};n.extend(r,cc.Event),n.mixin(r.prototype,{setUserData:function(t){this.detail=t},getUserData:function(){return this.detail},getEventName:cc.Event.prototype.getType}),cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":145}],100:[function(t,e,i){t("./event.js"),t("./event-listeners.js"),t("./event-target.js")},{"./event-listeners.js":97,"./event-target.js":98,"./event.js":99}],101:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n=e&&e.length,s=n?e[0]*i:t.length,a=r(t,0,s,i,!0),c=[];if(!a)return c;var h,l,d,_,f,p,g;if(n&&(a=u(t,e,a,i)),t.length>80*i){h=d=t[0],l=_=t[1];for(var m=i;m<s;m+=i)f=t[m],p=t[m+1],f<h&&(h=f),p<l&&(l=p),f>d&&(d=f),p>_&&(_=p);g=Math.max(d-h,_-l)}return o(a,c,i,h,l,g),c}function r(t,e,i,n,r){var s,o;if(r===P(t,e,i,n)>0)for(s=e;s<i;s+=n)o=w(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=w(s,t[s],t[s+1],o);return o&&b(o,o.next)&&(R(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!b(n,n.next)&&0!==C(n.prev,n,n.next))n=n.next;else{if(R(n),n=e=n.prev,n===n.next)return null;i=!0}while(i||n!==e);return e}function o(t,e,i,n,r,u,d){if(t){!d&&u&&p(t,n,r,u);for(var _,f,g=t;t.prev!==t.next;)if(_=t.prev,f=t.next,u?c(t,n,r,u):a(t))e.push(_.i/i),e.push(t.i/i),e.push(f.i/i),R(t),t=f.next,g=f.next;else if(t=f,t===g){d?1===d?(t=h(t,e,i),o(t,e,i,n,r,u,2)):2===d&&l(t,e,i,n,r,u):o(s(t),e,i,n,r,u,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(C(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(y(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&C(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function c(t,e,i,n){var r=t.prev,s=t,o=t.next;if(C(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,c=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,h=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,l=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,u=m(a,c,e,i,n),d=m(h,l,e,i,n),_=t.nextZ;_&&_.z<=d;){if(_!==t.prev&&_!==t.next&&y(r.x,r.y,s.x,s.y,o.x,o.y,_.x,_.y)&&C(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(_=t.prevZ;_&&_.z>=u;){if(_!==t.prev&&_!==t.next&&y(r.x,r.y,s.x,s.y,o.x,o.y,_.x,_.y)&&C(_.prev,_,_.next)>=0)return!1;_=_.prevZ}return!0}function h(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!b(r,s)&&x(r,n,n.next,s)&&E(r,s)&&E(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),R(n),R(n.next),n=t=s),n=n.next}while(n!==t);return n}function l(t,e,i,n,r,a){var c=t;do{for(var h=c.next.next;h!==c.prev;){if(c.i!==h.i&&T(c,h)){var l=O(c,h);return c=s(c,c.next),l=s(l,l.next),o(c,e,i,n,r,a),void o(l,e,i,n,r,a)}h=h.next}c=c.next}while(c!==t)}function u(t,e,i,n){var o,a,c,h,l,u=[];for(o=0,a=e.length;o<a;o++)c=e[o]*n,h=o<a-1?e[o+1]*n:t.length,l=r(t,c,h,n,!1),l===l.next&&(l.steiner=!0),u.push(v(l));for(u.sort(d),o=0;o<u.length;o++)_(u[o],i),i=s(i,i.next);return i}function d(t,e){return t.x-e.x}function _(t,e){if(e=f(t,e)){var i=O(e,t);s(i,i.next)}}function f(t,e){var i,n=e,r=t.x,s=t.y,o=-(1/0);do{if(s<=n.y&&s>=n.next.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i.prev;var c,h=i,l=i.x,u=i.y,d=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=l&&y(s<u?r:o,s,l,u,s<u?o:r,s,n.x,n.y)&&(c=Math.abs(s-n.y)/(r-n.x),(c<d||c===d&&n.x>i.x)&&E(n,t)&&(i=n,d=c)),n=n.next;return i}function p(t,e,i,n){var r=t;do null===r.z&&(r.z=m(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,g(r)}function g(t){var e,i,n,r,s,o,a,c,h=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ,n);e++);for(c=h;a>0||c>0&&n;)0===a?(r=n,n=n.nextZ,c--):0!==c&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,c--):(r=i,i=i.nextZ,a--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(o>1);return t}function m(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function v(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function y(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function T(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!S(t,e)&&E(t,e)&&E(e,t)&&A(t,e)}function C(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,i,n){return!!(b(t,e)&&b(i,n)||b(t,n)&&b(i,e))||C(t,e,i)>0!=C(t,e,n)>0&&C(i,n,t)>0!=C(i,n,e)>0}function S(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function E(t,e){return C(t.prev,t,t.next)<0?C(t,e,t.next)>=0&&C(t,t.prev,e)>=0:C(t,e,t.prev)<0||C(t,t.next,e)<0}function A(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function O(t,e){var i=new I(t.i,t.x,t.y),n=new I(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function w(t,e,i,n){var r=new I(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}e.exports=n,n.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(P(t,0,s,i));if(r)for(var a=0,c=e.length;a<c;a++){var h=e[a]*i,l=a<c-1?e[a+1]*i:t.length;o-=Math.abs(P(t,h,l,i))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,_=n[a+1]*i,f=n[a+2]*i;u+=Math.abs((t[d]-t[f])*(t[_+1]-t[d+1])-(t[d]-t[_])*(t[f+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],102:[function(t,e,i){var n=cc.js,r=t("./types").LineCap,s=t("./types").LineJoin,o=t("./helper"),a=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this.cmds=[]},c=a.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);c.constructor=a,c._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,this._currentRegion.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height)},c.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();n.setTransform(this._worldTransform,e,i),r.save(),r.scale(1,-1);for(var s=!0,o=this.cmds,a=0,c=o.length;a<c;a++){var h=o[a],l=h[0],u=h[1];"moveTo"===l&&s?(r.beginPath(),s=!1):"fill"!==l&&"stroke"!==l&&"fillRect"!==l||(s=!0),"function"==typeof r[l]?r[l].apply(r,u):r[l]=u}r.restore()},n.mixin(c,{setStrokeColor:function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["strokeStyle",e])},setFillColor:function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["fillStyle",e])},setLineWidth:function(t){this.cmds.push(["lineWidth",t])},setLineCap:function(t){t===r.BUTT?this.cmds.push(["lineCap","butt"]):t===r.ROUND?this.cmds.push(["lineCap","round"]):t===r.SQUARE&&this.cmds.push(["lineCap","square"])},setLineJoin:function(t){t===s.BEVEL?this.cmds.push(["lineJoin","bevel"]):t===s.ROUND?this.cmds.push(["lineJoin","round"]):t===s.MITER&&this.cmds.push(["lineJoin","miter"])},setMiterLimit:function(t){this.cmds.push(["miterLimit",t])},beginPath:function(){},moveTo:function(t,e){this.cmds.push(["moveTo",arguments])},lineTo:function(){this.cmds.push(["lineTo",arguments])},bezierCurveTo:function(){this.cmds.push(["bezierCurveTo",arguments])},quadraticCurveTo:function(){this.cmds.push(["quadraticCurveTo",arguments])},arc:function(t,e,i,n,r,s){o.arc(this,t,e,i,n,r,s)},ellipse:function(t,e,i,n){o.ellipse(this,t,e,i,n)},circle:function(t,e,i){o.ellipse(this,t,e,i,i)},rect:function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close()},roundRect:function(t,e,i,n,r){o.roundRect(this,t,e,i,n,r)},fillRect:function(t,e,i,n){this.cmds.push(["fillRect",arguments]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},close:function(){this.cmds.push(["closePath",arguments])},stroke:function(){this.cmds.push(["stroke",arguments]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},fill:function(){this.cmds.push(["fill",arguments]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},clear:function(){this.cmds.length=0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)}}),e.exports=a},{"./helper":106,"./types":109}],103:[function(t,e,i){var n=t("./graphics-canvas-cmd"),r=t("./graphics-webgl-cmd"),s=t("./types").LineCap,o=t("./types").LineJoin,a=cc.js,c=_ccsg.Node.extend({ctor:function(){this._super(),this.strokeColor=cc.Color.BLACK,this.fillColor=cc.Color.WHITE},clear:function(t){this._renderCmd.clear(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new n(this):new r(this)}}),h=c.prototype;a.mixin(h,{_strokeColor:null,_fillColor:null,_lineWidth:1,_lineCap:s.BUTT,_lineJoin:o.MITER,_miterLimit:10,setStrokeColor:function(t){this._strokeColor=t,this._renderCmd.setStrokeColor(t)},getStrokeColor:function(){return this._strokeColor},setFillColor:function(t){this._fillColor=t,this._renderCmd.setFillColor(t)},getFillColor:function(){return this._fillColor},setLineWidth:function(t){this._lineWidth=t,this._renderCmd.setLineWidth(t)},getLineWidth:function(){return this._lineWidth},setLineCap:function(t){this._lineCap=t,this._renderCmd.setLineCap(t)},getLineCap:function(){return this._lineCap},setLineJoin:function(t){this._lineJoin=t,this._renderCmd.setLineJoin(t)},getLineJoin:function(){return this._lineJoin},setMiterLimit:function(t){this._miterLimit=t,this._renderCmd.setMiterLimit(t)},getMiterLimit:function(){return this._miterLimit},beginPath:function(){this._renderCmd.beginPath()},moveTo:function(t,e){this._renderCmd.moveTo(t,e)},lineTo:function(t,e){this._renderCmd.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,s){this._renderCmd.bezierCurveTo(t,e,i,n,r,s)},quadraticCurveTo:function(t,e,i,n){this._renderCmd.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,s){this._renderCmd.arc(t,e,i,n,r,s)},ellipse:function(t,e,i,n){this._renderCmd.ellipse(t,e,i,n)},circle:function(t,e,i){this._renderCmd.circle(t,e,i)},rect:function(t,e,i,n){this._renderCmd.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._renderCmd.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this._renderCmd.fillRect(t,e,i,n)},close:function(){this._renderCmd.close()},stroke:function(){this._renderCmd.stroke()},fill:function(){this._renderCmd.fill()}}),e.exports=c},{"./graphics-canvas-cmd":102,"./graphics-webgl-cmd":104,"./types":109}],104:[function(t,e,i){function n(t,e,i){return t<e?e:t>i?i:t}function r(t,e){d.call(this,t,e),this.reset()}function s(){this.reset()}function o(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0;var e=cc._renderContext;this._vertsOffset=0,this._vertsVBO=e.createBuffer(),this._vertsBuffer=null,this._vertsDirty=!1,this._indicesOffset=0,this._indicesVBO=e.createBuffer(),this._indicesBuffer=null,this._indicesDirty=!1,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._paths=[],this._points=[],this._cmds=[],this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST),this._shader=new cc.GLProgram,this._shader.initWithVertexShaderByteArray(a.vert,a.frag),this._shader.retain(),this._shader.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),this._shader.link(),this._shader.updateUniforms(),this._allocVerts(f)}var a=t("./shader"),c=t("./types").LineCap,h=t("./types").LineJoin,l=t("./earcut"),u=t("./helper"),d=cc.Vec2,_=cc.js,f=32,p=2,g=8,m=Math.PI,v=Math.min,y=Math.max,T=Math.ceil,C=Math.acos,b=Math.cos,x=Math.sin,S=Math.atan2,E=Math.abs,A=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});_.extend(r,d),_.mixin(r.prototype,{reset:function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}}),s.prototype.reset=function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},o.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),o.prototype.constructor=o;var O=o.prototype;_.mixin(O,{_tessTol:.25,_distTol:.01,lineWidth:1,lineCap:c.BUTT,lineJoin:h.MITER,miterLimit:10,beginPath:function(){this._pathOffset=this._pathLength},moveTo:function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,A.PT_CORNER),this._commandx=t,this._commandy=e},lineTo:function(t,e){this._addPoint(t,e,A.PT_CORNER),this._commandx=t,this._commandy=e},bezierCurveTo:function(t,e,i,n,r,s){var o=this._curPath,a=o.points[o.points.length-1];return a.x===t&&a.y===e&&i===r&&n===s?void this.lineTo(r,s):(this._tesselateBezier(a.x,a.y,t,e,i,n,r,s,0,A.PT_CORNER),this._commandx=r,void(this._commandy=s))},quadraticCurveTo:function(t,e,i,n){var r=this._commandx,s=this._commandy;this.bezierCurveTo(r+2/3*(t-r),s+2/3*(e-s),i+2/3*(t-i),n+2/3*(e-n),i,n)},arc:function(t,e,i,n,r,s){u.arc(this,t,e,i,n,r,s)},ellipse:function(t,e,i,n){u.ellipse(this,t,e,i,n),this._curPath.complex=!1},circle:function(t,e,i){u.ellipse(this,t,e,i,i),this._curPath.complex=!1},rect:function(t,e,i,n){this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},roundRect:function(t,e,i,n,r){u.roundRect(this,t,e,i,n,r),this._curPath.complex=!1},fillRect:function(t,e,i,n){this.rect(t,e,i,n),this.fill()},close:function(){this._curPath.closed=!0},stroke:function(){this._flattenPaths(),this._expandStroke(),this._vertsDirty=!0,this._updatePathOffset=!0},fill:function(){this._expandFill(),this._vertsDirty=!0,this._updatePathOffset=!0,this._filling=!1}}),_.mixin(O,{_strokeColor:null,_fillColor:null,setStrokeColor:function(t){this._strokeColor=t},getStrokeColor:function(){return this._strokeColor},setFillColor:function(t){this._fillColor=t},getFillColor:function(){return this._fillColor},setLineWidth:function(t){this.lineWidth=t},setLineJoin:function(t){this.lineJoin=t},setLineCap:function(t){this.lineCap=t},setMiterLimit:function(t){this.miterLimit=t}}),cc.defineGetterSetter(O,"strokeColor",O.getStrokeColor,O.setStrokeColor),cc.defineGetterSetter(O,"fillColor",O.getFillColor,O.setFillColor),_.mixin(O,{_render:function(){var t=this._vertsBuffer;if(t&&0!==t.length&&0!==this._cmds.length){var e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._vertsVBO),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesVBO),this._vertsDirty&&(e.bufferData(e.ARRAY_BUFFER,t,e.STREAM_DRAW),this._vertsDirty=!1),this._indicesDirty&&this._indicesBuffer&&(e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer,e.STREAM_DRAW),this._indicesDirty=!1),this._vertsOffset>65536&&cc.warn("Too many graphics vertices generated, only 65536 vertices support."),e.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),e.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,g,0);for(var i=this._shader,n=i.getUniformLocationForName("color"),r=this._cmds,s=0,o=r.length;s<o;s++){var a=r[s];if(a.nIndices){var c=a.color;e.uniform4f(n,c.r/255,c.g/255,c.b/255,c.a/255),e.drawElements(e.TRIANGLES,a.nIndices,e.UNSIGNED_SHORT,2*a.indicesOffset),cc.incrementGLDraws(a.nverts)}}cc.checkGLErrorDebug()}},rendering:function(){cc.gl.blendFunc(this._blendFunc.src,this._blendFunc.dst);var t=this._worldTransform,e=this._matrix.mat;e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty;var i=this._shader;i.use(),i._setUniformForMVPMatrixWithMat4(this._matrix),this._render()},clear:function(t){this._vertsOffset=0,this._indicesOffset=0,this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,this._cmds.length=0,t&&(this._paths.length=0,this._points.length=0,this._vertsBuffer=null,this._indicesBuffer=null)}}),_.mixin(O,{_updatePathOffset:!1,_paths:null,_pathLength:0,_pathOffset:0,_points:null,_pointsOffset:0,_commandx:0,_commandy:0,_addPath:function(){var t=this._pathLength,e=this._paths[t];return e?e.reset():(e=new s,this._paths.push(e)),this._pathLength++,this._curPath=e,e},_addPoint:function(t,e,i){var n=this._curPath;if(n){var s,o=this._points,a=n.points,c=this._pointsOffset++;s=o[c],s?(s.x=t,s.y=e):(s=new r(t,e),o.push(s)),s.flags=i,a.push(s)}},_flattenPaths:function(){for(var t=this._paths,e=this._pathOffset,i=this._pathLength;e<i;e++){var n=t[e],r=n.points,s=r[r.length-1],o=r[0];s.equals(o)&&(n.closed=!0,r.pop(),s=r[r.length-1]);for(var a=0,c=r.length;a<c;a++){var h=o.sub(s);s.len=h.mag(),(h.x||h.y)&&h.normalizeSelf(),s.dx=h.x,s.dy=h.y,s=o,o=r[a+1]}}},_allocVerts:function(t){var e=this._vertsOffset+t,i=this._vertsBuffer,n=i?i.length/p:0;if(e>n){for(0===n&&(n=f);e>n;)n*=2;var r=new Float32Array(n*p);if(i)for(var s=0,o=i.length;s<o;s++)r[s]=i[s];this._vertsBuffer=r}},_allocIndices:function(t){var e=this._indicesBuffer,i=this._indicesOffset+t,n=e?e.length:0;if(i>n){for(0===n&&(n=3*f);i>n;)n*=2;var r=new Uint16Array(n);if(e)for(var s=0,o=e.length;s<o;s++)r[s]=e[s];this._indicesBuffer=r}},_pushCmd:function(t){var e=this._cmds,i=e[e.length-1];if(i){var n=i.color,r=t.color;n.r===r.r&&n.g===r.g&&n.b===r.b&&n.a===r.a&&i.indicesOffset+i.nIndices===t.indicesOffset?(i.nIndices+=t.nIndices,i.nverts+=t.nverts):e.push(t)}else e.push(t)},_expandStroke:function(){var t=.5*this.lineWidth,e=this.lineCap,i=this.lineJoin,n=this.miterLimit,r=this._curveDivs(t,m,this._tessTol),s=this._paths;this._calculateJoins(t,i,n);for(var o=0,a=this._pathOffset,l=this._pathLength;a<l;a++){var u=s[a],d=u.points.length;o+=i===h.ROUND?2*(d+u.nbevel*(r+2)+1):2*(d+5*u.nbevel+1),u.closed||(o+=e===c.ROUND?2*(2*r+2):12)}this._allocVerts(o),this._allocIndices(3*(o-2*(this._pathLength-this._pathOffset)));for(var a=this._pathOffset,l=this._pathLength;a<l;a++){var _,f,p,g,v,u=s[a],y=u.points,d=u.points.length;v=u.closed;var T=this._vertsOffset;if(v?(_=y[d-1],f=y[0],p=0,g=d):(_=y[0],f=y[1],p=1,g=d-1),!v){var C=f.sub(_);C.normalizeSelf();var b=C.x,x=C.y;e===c.BUTT?this._buttCap(_,b,x,t,0):e===c.SQUARE?this._buttCap(_,b,x,t,t):e===c.ROUND&&this._roundCapStart(_,b,x,t,r)}for(var S=p;S<g;++S)i===h.ROUND?this._roundJoin(_,f,t,t,r):0!==(f.flags&(A.PT_BEVEL|A.PT_INNERBEVEL))?this._bevelJoin(_,f,t,t):(this._vset(f.x+f.dmx*t,f.y+f.dmy*t),this._vset(f.x-f.dmx*t,f.y-f.dmy*t)),_=f,f=y[S+1];if(v){var E=this._vget(T),O=this._vget(T+1);this._vset(E.x,E.y),this._vset(O.x,O.y)}else{var C=f.sub(_);C.normalizeSelf();var b=C.x,x=C.y;e===c.BUTT?this._buttCap(f,b,x,t,0):e===c.BUTT||e===c.SQUARE?this._buttCap(f,b,x,t,t):e===c.ROUND&&this._roundCapEnd(f,b,x,t,r)}for(var w=this._indicesOffset,R=this._indicesBuffer,I=T+2,P=this._vertsOffset;I<P;I++)R[w++]=I-2,R[w++]=I-1,R[w++]=I;this._pushCmd({color:this._strokeColor,indicesOffset:this._indicesOffset,nIndices:w-this._indicesOffset,vertsOffset:T,nverts:this._vertsOffset-T}),this._indicesOffset=w,this._indicesDirty=!0}},_expandFill:function(){for(var t=this._paths,e=0,i=this._pathOffset,n=this._pathLength;i<n;i++){var r=t[i],s=r.points.length;e+=s}this._allocVerts(e),this._allocIndices(3*(e-2*(this._pathLength-this._pathOffset)));for(var i=this._pathOffset,n=this._pathLength;i<n;i++){var r=t[i],o=r.points,s=o.length;if(0!==s){for(var a=this._vertsOffset,c=0;c<s;++c)this._vset(o[c].x,o[c].y,.5,1);var h=r.indicesOffset=this._indicesOffset,u=this._indicesBuffer,d=0;if(r.complex){var _=new Float32Array(this._vertsBuffer.buffer,8*a,2*(this._vertsOffset-a)),f=l(_,null,2);if(!f||0===f.length)continue;d=f.length;for(var c=0,p=d;c<p;c++)u[h+c]=f[c]+a}else{for(var g=a,m=a+2,v=this._vertsOffset;m<v;m++)u[h++]=g,u[h++]=m-1,u[h++]=m;d=h-this._indicesOffset}this._pushCmd({color:this._fillColor,indicesOffset:this._indicesOffset,nIndices:d,vertsOffset:a,nverts:this._vertsOffset-a}),this._indicesOffset+=d,this._indicesDirty=!0}}},_curveDivs:function(t,e,i){var n=2*C(t/(t+i));return y(2,T(e/n))},_calculateJoins:function(t,e,i){var n=0;t>0&&(n=1/t);for(var r=this._paths,s=this._pathOffset,o=this._pathLength;s<o;s++){var a=r[s],c=a.points,l=c.length,u=c[l-1],d=c[0],_=0;a.nbevel=0;for(var f=0;f<l;f++){var p,g,m,T=u.dy,C=-u.dx,b=d.dy,x=-d.dx;if(d.dmx=.5*(T+b),d.dmy=.5*(C+x),p=d.dmx*d.dmx+d.dmy*d.dmy,p>1e-6){var S=1/p;S>600&&(S=600),d.dmx*=S,d.dmy*=S}g=d.dx*u.dy-u.dx*d.dy,g>0&&(_++,d.flags|=A.PT_LEFT),m=y(11,v(u.len,d.len)*n),p*m*m<1&&(d.flags|=A.PT_INNERBEVEL),d.flags&A.PT_CORNER&&(p*i*i<1||e===h.BEVEL||e===h.ROUND)&&(d.flags|=A.PT_BEVEL),0!==(d.flags&(A.PT_BEVEL|A.PT_INNERBEVEL))&&a.nbevel++,u=d,d=c[f+1]}}},_vset:function(t,e){var i=this._vertsOffset*p,n=this._vertsBuffer;n[i]=t,n[i+1]=e,this._vertsOffset++},_vget:function(t){var e=this._vertsBuffer,i=t*p;return{x:e[i],y:e[i+1]}},_chooseBevel:function(t,e,i,n){var r,s,o,a,c=i.x,h=i.y;return 0!==t?(r=c+e.dy*n,s=h-e.dx*n,o=c+i.dy*n,a=h-i.dx*n):(r=o=c+i.dmx*n,s=a=h+i.dmy*n),[r,s,o,a]},_buttCap:function(t,e,i,n,r){var s=t.x-e*r,o=t.y-i*r,a=i,c=-e;this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n)},_roundCapStart:function(t,e,i,n,r){for(var s=t.x,o=t.y,a=i,c=-e,h=0;h<r;h++){var l=h/(r-1)*m,u=b(l)*n,d=x(l)*n;this._vset(s-a*u-e*d,o-c*u-i*d),this._vset(s,o)}this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n)},_roundCapEnd:function(t,e,i,n,r){var s=t.x,o=t.y,a=i,c=-e;this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n);for(var h=0;h<r;h++){var l=h/(r-1)*m,u=b(l)*n,d=x(l)*n;this._vset(s,o),this._vset(s-a*u+e*d,o-c*u+i*d)}},_roundJoin:function(t,e,i,r,s){var o=t.dy,a=-t.dx,c=e.dy,h=-e.dx,l=e.x,u=e.y;if(0!==(e.flags&A.PT_LEFT)){var d=this._chooseBevel(e.flags&A.PT_INNERBEVEL,t,e,i),_=d[0],f=d[1],p=d[2],g=d[3],v=S(-a,-o),y=S(-h,-c);y>v&&(y-=2*m),this._vset(_,f),this._vset(l-o*r,e.y-a*r);for(var C=n(T((v-y)/m)*s,2,s),E=0;E<C;E++){var O=E/(C-1),w=v+O*(y-v),R=l+b(w)*r,I=u+x(w)*r;this._vset(l,u),this._vset(R,I)}this._vset(p,g),this._vset(l-c*r,u-h*r)}else{var d=this._chooseBevel(e.flags&A.PT_INNERBEVEL,t,e,-r),P=d[0],N=d[1],L=d[2],F=d[3],v=S(a,o),y=S(h,c);y<v&&(y+=2*m),this._vset(l+o*r,u+a*r),this._vset(P,N);for(var C=n(T((y-v)/m)*s,2,s),E=0;E<C;E++){var O=E/(C-1),w=v+O*(y-v),D=l+b(w)*i,M=u+x(w)*i;this._vset(D,M),this._vset(l,u)}this._vset(l+c*r,u+h*r),this._vset(L,F)}},_bevelJoin:function(t,e,i,n){var r,s,o,a,c,h,l,u,d=t.dy,_=-t.dx,f=e.dy,p=-e.dx;if(e.flags&A.PT_LEFT){var g=this._chooseBevel(e.flags&A.PT_INNERBEVEL,t,e,i);c=g[0],h=g[1],l=g[2],u=g[3],this._vset(c,h),this._vset(e.x-d*n,e.y-_*n),this._vset(l,u),this._vset(e.x-f*n,e.y-p*n)}else{var g=this._chooseBevel(e.flags&A.PT_INNERBEVEL,t,e,-n);r=g[0],s=g[1],o=g[2],a=g[3],this._vset(e.x+d*i,e.y+_*i),this._vset(r,s),this._vset(e.x+f*i,e.y+p*i),this._vset(o,a)}},_tesselateBezier:function(t,e,i,n,r,s,o,a,c,h){var l,u,d,_,f,p,g,m,v,y,T,C,b,x,S,O;if(!(c>10)){if(l=.5*(t+i),u=.5*(e+n),d=.5*(i+r),_=.5*(n+s),f=.5*(r+o),p=.5*(s+a),g=.5*(l+d),m=.5*(u+_),b=o-t,x=a-e,S=E((i-o)*x-(n-a)*b),O=E((r-o)*x-(s-a)*b),(S+O)*(S+O)<this._tessTol*(b*b+x*x))return void this._addPoint(o,a,0===h?h|A.PT_BEVEL:h);v=.5*(d+f),y=.5*(_+p),T=.5*(g+v),C=.5*(m+y),this._tesselateBezier(t,e,l,u,g,m,T,C,c+1,0),this._tesselateBezier(T,C,v,y,f,p,o,a,c+1,h)}}}),e.exports=o},{"./earcut":101,"./helper":106,"./shader":108,"./types":109}],105:[function(t,e,i){var n=t("./types").LineCap,r=t("./types").LineJoin,s=cc.Class({name:"cc.Graphics","extends":cc._RendererUnderSG,editor:!1,properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:r.MITER,_lineCap:n.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._sgNode.lineWidth=this._lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._sgNode.lineJoin=this._lineJoin=t},type:r},lineCap:{get:function(){return this._lineCap},set:function(t){this._sgNode.lineCap=this._lineCap=t},type:n},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._sgNode.strokeColor=this._strokeColor=t}},fillColor:{get:function(){return this._fillColor},set:function(t){this._sgNode.fillColor=this._fillColor=t}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._sgNode.miterLimit=this._miterLimit=t}}},statics:{LineJoin:r,LineCap:n},_createSgNode:function(){return new _ccsg.GraphicsNode},_initSgNode:function(){var t=this._sgNode;t.lineWidth=this._lineWidth,t.lineJoin=this._lineJoin,t.lineCap=this._lineCap,t.strokeColor=this._strokeColor,t.fillColor=this._fillColor,t.miterLimit=this._miterLimit,t.setContentSize(this.node.getContentSize(!0))},moveTo:function(t,e){this._sgNode.moveTo(t,e)},lineTo:function(t,e){this._sgNode.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,s){this._sgNode.bezierCurveTo(t,e,i,n,r,s)},quadraticCurveTo:function(t,e,i,n){this._sgNode.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,s){s=s||!1,this._sgNode.arc(t,e,i,n,r,s)},ellipse:function(t,e,i,n){this._sgNode.ellipse(t,e,i,n)},circle:function(t,e,i){this._sgNode.circle(t,e,i)},rect:function(t,e,i,n){this._sgNode.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._sgNode.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this._sgNode.fillRect(t,e,i,n)},clear:function(){this._sgNode.clear()},close:function(){this._sgNode.close()},stroke:function(){this._sgNode.stroke()},fill:function(){this._sgNode.fill()}});cc.Graphics=e.exports=s},{"./types":109}],106:[function(t,e,i){function n(t,e,i,n,r,s,d){d=d||!1;var _,f,p=0,g=0,m=0,v=0,y=0,T=0,C=0,b=0,x=0,S=0,E=0,A=0,O=0,w=0;if(g=s-r,d)if(u(g)>=2*o)g=2*o;else for(;g<0;)g+=2*o;else if(u(g)>=2*o)g=2*-o;else for(;g>0;)g-=2*o;for(f=0|c(1,a(u(g)/(.5*o)+.5,5)),m=g/f/2,v=u(4/3*(1-h(m))/l(m)),d||(v=-v),_=0;_<=f;_++)p=r+g*(_/f),y=h(p),T=l(p),C=e+y*n,b=i+T*n,x=-T*n*v,S=y*n*v,0===_?t.moveTo(C,b):t.bezierCurveTo(E+O,A+w,C-x,b-S,C,b),E=C,A=b,O=x,w=S}function r(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*_,e-n*_,i+r,e,i+r),t.bezierCurveTo(e+n*_,i+r,e+n,i+r*_,e+n,i),t.bezierCurveTo(e+n,i-r*_,e+n*_,i-r,e,i-r),t.bezierCurveTo(e-n*_,i-r,e-n,i-r*_,e-n,i),t.close()}function s(t,e,i,n,r,s){if(s<.1)return void t.rect(e,i,n,r);var o=a(s,.5*u(n))*d(n),c=a(s,.5*u(r))*d(r);t.moveTo(e,i+c),t.lineTo(e,i+r-c),t.bezierCurveTo(e,i+r-c*(1-_),e+o*(1-_),i+r,e+o,i+r),t.lineTo(e+n-o,i+r),t.bezierCurveTo(e+n-o*(1-_),i+r,e+n,i+r-c*(1-_),e+n,i+r-c),t.lineTo(e+n,i+c),t.bezierCurveTo(e+n,i+c*(1-_),e+n-o*(1-_),i,e+n-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-_),i,e,i+c*(1-_),e,i+c),t.close()}var o=Math.PI,a=Math.min,c=Math.max,h=Math.cos,l=Math.sin,u=Math.abs,d=Math.sign,_=.5522847493;e.exports={arc:n,ellipse:r,roundRect:s}},{}],107:[function(t,e,i){"use strict";var n;if(n=cc.sys.isNative?_ccsg.GraphicsNode=cc.GraphicsNode:_ccsg.GraphicsNode=t("./graphics-node")){var r=t("../utils/misc");r.propertyDefine(n,["lineWidth","lineCap","lineJoin","miterLimit","strokeColor","fillColor"],{})}t("./graphics")},{"../utils/misc":166,"./graphics":105,"./graphics-node":103}],108:[function(t,e,i){var n=["attribute vec4 a_position;","","void main()","{","    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;","}"],r=["#ifdef GL_ES","precision mediump float;","#endif","","uniform vec4 color;","","void main(void) {","    gl_FragColor = color;","}"];e.exports={vert:n.join(" \n"),frag:r.join(" \n")}},{}],109:[function(t,e,i){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2});e.exports={LineCap:n,LineJoin:r}},{}],110:[function(t,e,i){t("./platform"),t("./assets"),t("./sprites/CCSpriteFrameCache"),t("./CCNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./base-ui/CCWidgetManager")},{"./CCNode":37,"./CCScene":38,"./assets":50,"./base-ui/CCWidgetManager":51,"./collider":59,"./components":89,"./graphics":107,"./platform":143,"./sprites/CCSpriteFrameCache":156}],111:[function(t,e,i){var n=/^(click)(\s)*=/;cc.HtmlTextParser=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])},cc.HtmlTextParser.prototype={constructor:cc.HtmlTextParser,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,i=t.length;e<i;){var n=t.indexOf("<",e);if(n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{this._processResult(t.substring(e,n));var r=t.indexOf(">",e);r===-1?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(t.substring(n+1,r)),e=r+1}}return this._resultObjectArray},_attributeToObject:function(t){t=t.trim();var e,i,r,s,o={},a=t.match(/^(color|size)(\s)*=/);if(a){if(e=a[0],t=t.substring(e.length).trim(),""===t)return o;switch(i=t.indexOf(" "),e[0]){case"c":i>-1?o.color=t.substring(0,i).trim():o.color=t;break;case"s":o.size=parseInt(t)}return i>-1&&(s=t.substring(i+1).trim(),
r=this._processEventHandler(s),o.event=r),o}if(a=t.match(/^(br(\s)*\/)/),a&&a[0].length>0&&(e=a[0].trim(),e.startsWith("br")&&"/"===e[e.length-1]))return o.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),o;if(a=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/),a&&a[0].length>0&&(e=a[0].trim(),e.startsWith("img")&&"/"===e[e.length-1])){var c,h=e.indexOf("="),l=e.substring(h+1).trim(),u=-1,d=!1;switch(l[0]){case"'":u=l.indexOf("'",1),u>-1&&(c=l.substring(1,u),d=!0);break;case'"':u=l.indexOf('"',1),u>-1&&(c=l.substring(1,u),d=!0)}return d&&(o.isImage=!0,o.src=c,s=l.substring(u+1).trim(),s.match(n)&&(r=this._processEventHandler(s),o.event=r),this._resultObjectArray.push({text:"",style:o})),{}}if(a=t.match(/^(on|u|b|i)(\s)*/),a&&a[0].length>0){switch(e=a[0],t=t.substring(e.length).trim(),e[0]){case"u":o.underline=!0;break;case"i":o.italic=!0;break;case"b":o.bold=!0}if(""===t)return o;r=this._processEventHandler(t),o.event=r}return o},_processEventHandler:function(t){for(var e=0,i={},r=t.match(n),s=!1;r;){var o=r[0],a="";if(s=!1,t=t.substring(o.length).trim(),'"'===t.charAt(0))e=t.indexOf('"',1),e>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else if("'"===t.charAt(0))e=t.indexOf("'",1),e>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else{var c=t.match(/(\S)+/);a=c?c[0]:"",e=a.length}s&&(o=o.substring(0,o.length-1).trim(),i[o]=a),t=t.substring(e).trim(),r=t.match(n)}return i},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],n=this._specialSymbolArray[e][1];t=t.replace(i,n)}return t}},cc.htmlTextParser=new cc.HtmlTextParser},{}],112:[function(t,e,i){var n=function(){this._status="unloaded",this._observers=[]};n.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach(function(t){t()})},n.prototype.isLoaded=function(){return"loaded"===this._status},n.prototype.addHandler=function(t){this._observers.indexOf(t)===-1&&this._observers.push(t)};var r={_fontCache:{},loadTTF:function(t,e){var i=cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_APP&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&i?this._loadWithFontFace(t,e):this._loadWithCSS(t,e)},_loadWithFontFace:function(t,e){var i=this._getFontFamily(t),r=this._fontCache[i];if(r)r.isLoaded()||r.addHandler(e);else{var s=new FontFace(i,"url('"+t+"')");document.fonts.add(s),r=new n,r.addHandler(e),this._fontCache[i]=r,s.loaded.then(function(){r.onLoaded()})}},_loadWithCSS:function(t,e){var i=this._getFontFamily(t),r=this._fontCache[i];if(r)r.isLoaded()||r.addHandler(e);else{var s=document,o=document.createElement("style");o.type="text/css",s.body.appendChild(o);var a="";a+=isNaN(i-0)?"@font-face { font-family:"+i+"; src:":"@font-face { font-family:'"+i+"'; src:",a+="url('"+t+"');",o.textContent=a+"}";var c=document.createElement("div"),h=c.style;h.fontFamily=i,c.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",s.body.appendChild(c),r=new n,r.addHandler(e),this._fontCache[i]=r,o.onload=function(){setTimeout(function(){r.onLoaded()},100)}}},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(e===-1)return t;var i,n=t.lastIndexOf("/");return i=n===-1?t.substring(0,e)+"_LABEL":t.substring(n+1,e)+"_LABEL"}},s={label_wordRex:/([a-zA-Z0-9--]+|\S)/,label_symbolRex:/^[!,.:;}\]%\?>]/,label_lastWordRex:/([a-zA-Z0-9--]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9--]+$/,label_firsrEnglish:/^[a-zA-Z0-9--]/,label_wrapinspection:!0,isUnicodeCJK:function(t){var e=/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,i=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,n=/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/;return e.test(t)||i.test(t)||n.test(t)},isUnicodeSpace:function(t){return t=t.charCodeAt(0),t>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},fragmentText:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var s=t;e>i&&s.length>1;){for(var o=s.length*(i/e)|0,a=s.substr(o),c=e-n(a),h=a,l=0,u=0,d=10;c>i&&u++<d;)o*=i/c,o=0|o,a=s.substr(o),c=e-n(a);for(u=0;c<i&&u++<d;){if(a){var _=this.label_wordRex.exec(a);l=_?_[0].length:1,h=a}o+=l,a=s.substr(o),c=e-n(a)}o-=l,0===o&&(o=1,h=h.substr(1));var f,p=s.substr(0,o);this.label_wrapinspection&&this.label_symbolRex.test(h||a)&&(f=this.label_lastWordRex.exec(p),o-=f?f[0].length:0,0===o&&(o=1),h=s.substr(o),p=s.substr(0,o)),this.label_firsrEnglish.test(h)&&(f=this.label_lastEnglish.exec(p),f&&p!==f[0]&&(o-=f[0].length,h=s.substr(o),p=s.substr(0,o))),p.trim().length>0&&r.push(p),s=h||a,e=n(s)}return s.length>0&&r.push(s),r}};cc.TextUtils=e.exports=s,cc.CustomFontLoader=e.exports=r},{}],113:[function(t,e,i){function n(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")}function r(){var t=new c,e=new h;o.call(this,[t,e]),this.downloader=t,this.loader=e,this.onProgress=null,this._autoReleaseSetting={}}var s=t("../platform/js"),o=t("./pipeline"),a=t("./loading-items"),c=t("./downloader"),h=t("./loader"),l=t("./asset-table"),u=t("../platform/utils").callInNextTick,d=t("./auto-release-utils"),_=new l,f=[],p=[];s.extend(r,o),s.mixin(r.prototype,{getXMLHttpRequest:n,addDownloadHandlers:function(t){this.downloader.addHandlers(t)},addLoadHandlers:function(t){this.loader.addHandlers(t)},load:function(t,e,i){void 0===i&&(i=e,e=this.onProgress||null);var n=this,r=null;t instanceof Array||(r=t,t=t?[t]:[]),f.length=t.length;for(var s=0;s<t.length;++s){var o=t[s].id||t[s];if("string"==typeof o){var c=this.getItem(o);c?f[s]=c:f[s]=t[s]}}var h=a.create(this,e,function(t,e){u(function(){if(i){if(r){var s=r.id||r;i.call(n,e.getError(s),e.getContent(s))}else i.call(n,t,e);i=null;var s;e.destroy()}})});a.initQueueDeps(h),h.append(f),f.length=0},flowInDeps:function(t,e,i){t&&!t.deps&&(t.deps=[]),p.length=0;for(var n=0;n<e.length;++n){var r=e[n].id||e[n];if("string"==typeof r){var s=this.getItem(r);s?(p.push(s),t&&t.deps.push(s)):p.push(e[n])}}var o=a.create(this,t?function(){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(s)}:null,function(e,n){i(e,n),t&&(t.deps.length=0),n.destroy()});if(t){var c=a.getQueue(t);o._ownerQueue=c._ownerQueue||c}var h=o.append(p,t);return p.length=0,h},_resources:_,_getResUuid:function(t,e){var i=_.getUuid(t,e);if(!i){var n=cc.path.extname(t);n&&(t=t.slice(0,-n.length),i=_.getUuid(t,e),i&&cc.warn("loadRes: should not specify the extname in "+t+n))}return i},loadRes:function(t,e,i){i||!e||cc.isChildClassOf(e,cc.RawAsset)||(i=e,e=null);var n=this,r=n._getResUuid(t,e);r?this.load({id:r,type:"uuid",uuid:r},function(t,e){e&&n.setAutoReleaseRecursively(r,!1),i&&i(t,e)}):u(function(){var n;n=e?s.getClassName(e)+' in "'+t+'" does not exist.':'Resources url "'+t+'" does not exist.',i&&i(new Error(n),null)})},loadResAll:function(t,e,i){i||!e||cc.isChildClassOf(e,cc.RawAsset)||(i=e,e=null);var n=this,r=_.getUuidArray(t,e),s=r.length;if(s>0){for(var o=[],a=0,c=s;a<c;++a){var h=r[a];o.push({id:h,type:"uuid",uuid:h})}this.load(o,function(t,e){for(var r=[],s=0;s<o.length;++s){var a=o[s].uuid,c=e.getContent(a);c&&(n.setAutoReleaseRecursively(a,!1),r.push(c))}i&&i(t,r)})}else u(function(){i&&i(null,[])})},getRes:function(t){var e=this._cache[t];if(e&&e.alias&&(e=this._cache[e.alias]),!e){var i=this._getResUuid(t);e=this._cache[i]}return e?e.content:null},getResCount:function(){return this._cache.length},getDependsRecursively:function(t){var e;if("string"==typeof t?(e=t,this._cache[e]||(e=this._getResUuid(e)||e)):"object"==typeof t&&(e=t._uuid||null),e){var i=d.getDependsRecursively(e);return i.push(e),i}return[]},release:function(t){if(Array.isArray(t))d.autoRelease(this,t);else if(t){var e=t._uuid||t.url||t,i=this.getItem(e);if(i){this.removeItem(e);t=i.content,t instanceof cc.Texture2D&&cc.textureCache.removeTextureForKey(i.url)}}},releaseAsset:function(t){var e=t._uuid;e&&this.release(e)},releaseRes:function(t){var e=this._getResUuid(t);e?this.release(e):cc.error('Resources url "%s" does not exist.',t)},releaseAll:function(){for(var t in this._cache)this.release(t)},removeItem:function(t){var e=o.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e},setAutoRelease:function(t,e){var i=d.getKey(this,t);i&&(this._autoReleaseSetting[i]=!!e)},setAutoReleaseRecursively:function(t,e){e=!!e;var i=d.getKey(this,t);if(i){this._autoReleaseSetting[i]=e;for(var n=d.getDependsRecursively(i),r=0;r<n.length;r++){var s=n[r];this._autoReleaseSetting[s]=e}}},isAutoRelease:function(t){var e=d.getKey(this,t);return!!e&&!!this._autoReleaseSetting[e]}}),cc.loader=new r,e.exports=cc.loader},{"../platform/js":145,"../platform/utils":150,"./asset-table":114,"./auto-release-utils":116,"./downloader":117,"./loader":120,"./loading-items":121,"./pipeline":123}],114:[function(t,e,i){function n(t,e){this.uuid=t,this.type=e}function r(){this._pathToUuid={}}function s(t,e){if(t.length>e.length){var i=t.charCodeAt(e.length);return 46===i||47===i}return!0}cc.js.mixin(r.prototype,{getUuid:function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var n=0;n<i.length;n++){var r=i[n];if(cc.isChildClassOf(r.type,e))return r.uuid}}else if(!e||cc.isChildClassOf(i.type,e))return i.uuid;return""},getUuidArray:function(t,e){t=cc.url.normalize(t),"/"===t[t.length-1]&&(t=t.slice(0,-1));var i,n,r=this._pathToUuid,o=[];if(e){var a=cc.isChildClassOf;for(i in r)if(i.startsWith(t)&&s(i,t)){var c=r[i];if(Array.isArray(c))for(n=0;n<c.length;n++){var h=c[n];a(h.type,e)&&o.push(h.uuid)}else a(c.type,e)&&o.push(c.uuid)}}else for(i in r)if(i.startsWith(t)&&s(i,t)){var c=r[i];if(Array.isArray(c))for(n=0;n<c.length;n++)o.push(c[n].uuid);else o.push(c.uuid)}return o},getAllPaths:function(){return Object.keys(this._pathToUuid)},add:function(t,e,i,r){t=t.substring(0,t.length-cc.path.extname(t).length);var s=new n(e,i),o=this._pathToUuid,a=o[t];a?Array.isArray(a)?r?a.unshift(s):a.push(s):r?o[t]=[s,a]:o[t]=[a,s]:o[t]=s},reset:function(){this._pathToUuid={}}}),e.exports=r},{}],115:[function(t,e,i){function n(t,e){var i=document.createElement("audio");i.src=t.url;var n=function(){clearTimeout(r),i.removeEventListener("canplaythrough",s,!1),i.removeEventListener("error",o,!1),c.USE_LOADER_EVENT&&i.removeEventListener(c.USE_LOADER_EVENT,s,!1)},r=setTimeout(function(){0===i.readyState?o():s()},8e3),s=function(){n(),t.element=i,e(null,t.url)},o=function(){n(),cc.log("load audio failure - "+t.url)};i.addEventListener("canplaythrough",s,!1),i.addEventListener("error",o,!1),c.USE_LOADER_EVENT&&i.addEventListener(c.USE_LOADER_EVENT,s,!1)}function r(t,e){if(l){var i=cc.loader.getXMLHttpRequest();i.open("GET",t.url,!0),i.responseType="arraybuffer",i.onload=function(){l.decodeAudioData(i.response,function(i){t.buffer=i,e(null,t.url)},function(){e("decode error - "+t.url,null)})},i.onerror=function(){e("request error - "+t.url,null)},i.send()}}function s(t,e){if(0===h.length)return e(new Error("Audio Downloader: audio not supported on this browser!"));if(t.content=t.url,!c.WEB_AUDIO)return n(t,e);var i=cc.loader.getXMLHttpRequest();i.open("HEAD",t.url,!0),i.onload=function(){var i=this.getResponseHeader("Content-Length");return i>a._maxWebAudioSize?n(t,e):r(t,e)},i.onerror=function(){var i="can not found the resource of audio! Last match url is : "+t.url;return e({status:520,errorMessage:i},null)},i.send()}var o=(t("../utils/CCPath"),t("../platform/CCSys")),a=(t("./pipeline"),t("../../audio/CCAudioEngine")),c=o.__audioSupport,h=c.format,l=c.context;e.exports=s},{"../../audio/CCAudioEngine":25,"../platform/CCSys":135,"../utils/CCPath":161,"./pipeline":123}],116:[function(t,e,i){function n(t,e){var i=cc.loader.getItem(t);if(i){var r=i.dependKeys;if(r)for(var s=0;s<r.length;s++){var o=r[s];e[o]||(e[o]=!0,n(o,e))}}}function r(t,e,i){i&&i.indexOf(e)!==-1||t.release(e)}e.exports={getKey:function(t,e){if(e){if("string"==typeof e){var i=cc.loader.getItem(e);return i&&i.url||e}if(e._uuid)return e._uuid}return""},autoRelease:function(t,e,i){var n,s,o=t._autoReleaseSetting;if(e)for(n=0;n<e.length;n++)s=e[n],o[s]!==!1&&r(t,s,i);var a=Object.keys(o);for(n=0;n<a.length;n++)s=a[n],o[s]===!0&&r(t,s,i)},getDependsRecursively:function(t){var e={};return n(t,e),Object.keys(e)}}},{}],117:[function(t,e,i){function n(t,e,i){function n(){a.parentNode.removeChild(a),a.removeEventListener("load",n,!1),a.removeEventListener("error",r,!1),e(null,s)}function r(){a.parentNode.removeChild(a),a.removeEventListener("load",n,!1),a.removeEventListener("error",r,!1),e(new Error("Load "+s+" failed!"),s)}var s=t.url,o=document,a=document.createElement("script");a.async=i,a.src=p(s),a.addEventListener("load",n,!1),a.addEventListener("error",r,!1),o.body.appendChild(a)}function r(t,e,i){function n(){a.removeEventListener("load",n),a.removeEventListener("error",s),e&&e(null,a)}function s(){a.removeEventListener("load",n),a.removeEventListener("error",s),a.crossOrigin&&"anonymous"===a.crossOrigin.toLowerCase()?r(t,e,!1):e("Load image ("+o+") failed")}void 0===i&&(i=!0);var o=p(t.url),a=new Image;i&&"file://"!==window.location.origin&&(a.crossOrigin="anonymous"),a.complete&&a.naturalWidth>0?e(null,a):(a.addEventListener("load",n),a.addEventListener("error",s)),a.src=o}function s(t,e,i){var n=document,r=cc.path,s=document.createElement("style");s.type="text/css",n.body.appendChild(s);var o="";if(o+=isNaN(t-0)?"@font-face { font-family:"+t+"; src:":"@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var a=0,c=e.length;a<c;a++){var h=e[a];i=r.extname(h).toLowerCase(),o+="url('"+e[a]+"') format('"+g[i]+"')",o+=a===c-1?";":","}else i=i.toLowerCase(),o+="url('"+e+"') format('"+g[i]+"');";s.textContent+=o+"}";var l=document.createElement("div"),u=l.style;u.fontFamily=t,l.innerHTML=".",u.position="absolute",u.left="-100px",u.top="-100px",n.body.appendChild(l)}function o(t,e){var i=t.url,n=t.type,r=t.name,o=t.srcs;r&&o?(o.indexOf(i)===-1&&o.push(i),s(r,o)):(n=cc.path.extname(i),r=cc.path.basename(i,n),s(r,i,n)),document.fonts?document.fonts.load("1em "+r).then(function(){e(null,null)},function(t){e(t)}):e(null,null)}function a(t,e){var i=t.id,n=this;cc.AssetLibrary.queryAssetInfo(i,function(r,s,o){if(r)e(r);else if(t.url=s,t.isRawAsset=o,o){var a=l.extname(s).toLowerCase();if(!a)return void e(new Error("Download Uuid: can not find type of raw asset["+i+"]: "+s));a=a.substr(1);var c=d.getQueue(t);m[0]={queueId:t.queueId,id:s,url:s,type:a,error:null,alias:t.id,complete:!0},c.append(m);var h=n.extMap[a]||n.extMap["default"];t.type=a,h(t,e)}else{var u=_.load(t,e);u||n.extMap.json(t,e)}})}var c,h=t("../platform/js"),l=t("../utils/CCPath"),u=t("./pipeline"),d=t("./loading-items"),_=t("./pack-downloader"),f=t("./text-downloader"),p=t("./utils").urlAppendTimestamp;c=t("./audio-downloader");var g={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},m=[],v={js:n,png:r,jpg:r,bmp:r,jpeg:r,gif:r,ico:r,tiff:r,webp:r,image:r,mp3:c,ogg:c,wav:c,mp4:c,m4a:c,txt:f,xml:f,vsh:f,fsh:f,atlas:f,tmx:f,tsx:f,json:f,ExportJson:f,plist:f,fnt:f,font:o,eot:o,ttf:o,woff:o,svg:o,ttc:o,uuid:a,"default":f},y="Downloader",T=function(t){this.id=y,this.async=!0,this.pipeline=null,this.maxConcurrent=cc.sys.isMobile?2:512,this._curConcurrent=0,this._loadQueue=[],this.extMap=h.mixin(t,v)};T.ID=y,h.mixin(T.prototype,{addHandlers:function(t){h.mixin(this.extMap,t)},handle:function(t,e){var i=this,n=this.extMap[t.type]||this.extMap["default"];this._curConcurrent<this.maxConcurrent?(this._curConcurrent++,n.call(this,t,function(t,n){for(i._curConcurrent=Math.max(0,i._curConcurrent-1);i._curConcurrent<i.maxConcurrent;){var r=i._loadQueue.shift();if(!r)break;i.handle(r.item,r.callback)}e&&e(t,n)})):t.ignoreMaxConcurrency?n.call(this,t,function(t,i){e&&e(t,i)}):this._loadQueue.push({item:t,callback:e})}}),u.Downloader=e.exports=T},{"../platform/js":145,"../utils/CCPath":161,"./audio-downloader":115,"./loading-items":121,"./pack-downloader":122,"./pipeline":123,"./text-downloader":124,"./utils":125}],118:[function(t,e,i){t("./downloader"),t("./loader"),t("./json-unpacker"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":113,"./downloader":117,"./json-unpacker":119,"./loader":120,"./loading-items":121,"./pipeline":123}],119:[function(t,e,i){function n(){this.jsons={}}n.prototype.read=function(t,e){var i="string"==typeof e?JSON.parse(e):e;i.length!==t.length&&cc.error("Pack indices and data do not match in size");for(var n=0;n<t.length;n++){var r=t[n],s=i[n];this.jsons[r]=s}},n.prototype.retrieve=function(t){return this.jsons[t]||null},e.exports=n},{}],120:[function(t,e,i){function n(t,e){e(null,null)}function r(t,e){"string"!=typeof t.content&&e(new Error("JSON Loader: Input item doesn't contain string content"));try{var i=JSON.parse(t.content);e(null,i)}catch(n){e(new Error("JSON Loader: Parse json ["+t.id+"] failed : "+n))}}function s(t,e){t.content instanceof Image||e(new Error("Image Loader: Input item doesn't contain Image content"));var i=t.url,n=cc.textureCache.getTextureForKey(i)||new u;n.url=i,n.initWithElement(t.content),n.handleLoadedTexture(),cc.textureCache.cacheImage(i,n),e(null,n)}function o(t,e){"string"!=typeof t.content&&e(new Error("Plist Loader: Input item doesn't contain string content"));var i=cc.plistParser.parse(t.content);i?e(null,i):e(new Error("Plist Loader: Parse ["+t.id+"] failed"))}function a(t){var e=t.match(_.ITEM_EXP),i={};if(e)for(var n=0,r=e.length;n<r;n++){var s=e[n],o=s.indexOf("="),a=s.substring(0,o),c=s.substring(o+1);c.match(_.INT_EXP)?c=parseInt(c):'"'===c[0]&&(c=c.substring(1,c.length-1)),i[a]=c}return i}function c(t,e){var i,n,r=t.content,s=t.url,o={},c=a(r.match(_.INFO_EXP)[0]),h=c.padding.split(","),l=({left:parseInt(h[0]),top:parseInt(h[1]),right:parseInt(h[2]),bottom:parseInt(h[3])},a(r.match(_.COMMON_EXP)[0]));if(o.commonHeight=l.lineHeight,o.fontSize=c.size,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var u=cc.configuration.getMaxTextureSize();(l.scaleW>u.width||l.scaleH>u.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==l.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var d=a(r.match(_.PAGE_EXP)[0]);0!==d.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),o.atlasName=cc.path.changeBasename(s,d.file);var f=r.match(_.CHAR_EXP),p=o.fontDefDictionary={};for(i=0,n=f.length;i<n;i++){var g=a(f[i]),m=g.id;p[m]={rect:{x:g.x,y:g.y,width:g.width,height:g.height},xOffset:g.xoffset,yOffset:g.yoffset,xAdvance:g.xadvance}}var v=o.kerningDict={},y=r.match(_.KERNING_EXP);if(y)for(i=0,n=y.length;i<n;i++){var T=a(y[i]);v[T.first<<16|65535&T.second]=T.amount}e(null,o)}var h=t("../platform/js"),l=t("./pipeline"),u=t("../textures/CCTexture2D"),d=t("./uuid-loader"),_={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/},f={png:s,jpg:s,bmp:s,jpeg:s,gif:s,ico:s,tiff:s,webp:s,image:s,json:r,ExportJson:r,plist:o,fnt:c,uuid:d,prefab:d,fire:d,scene:d,"default":n},p="Loader",g=function(t){this.id=p,this.async=!0,this.pipeline=null,this.extMap=h.mixin(t,f)};g.ID=p,h.mixin(g.prototype,{addHandlers:function(t){this.extMap=h.mixin(this.extMap,t)},handle:function(t,e){var i=this.extMap[t.type]||this.extMap["default"];i.call(this,t,function(t,i){t?e&&e(t):e&&e(null,i)})}}),l.Loader=e.exports=g},{"../platform/js":145,"../textures/CCTexture2D":157,"./pipeline":123,"./uuid-loader":126}],121:[function(t,e,i){function n(t){var e=t.id||t;return"string"==typeof e}function r(t,e){var i;if("object"==typeof t&&t.id?(t.type||(t.type=a.extname(t.id).toLowerCase().substr(1)),i={queueId:e,url:t.url||t.id,error:null,content:null,complete:!1,states:{},deps:null},c.mixin(i,t)):"string"==typeof t&&(i={queueId:e,id:t,url:t,type:a.extname(t).toLowerCase().substr(1),error:null,content:null,complete:!1,states:{},deps:null}),i.skips)for(var n=0,r=i.skips.length;n<r;n++){var s=i.skips[n];i.states[s]=_.COMPLETE}return i}function s(t,e,i){if(!t||!e)return!1;var n=!1;if(p.push(e.id),e.deps){var r,o,a=e.deps;for(r=0;r<a.length;r++){if(o=a[r],o.id===t.id){n=!0;break}if(!(p.indexOf(o.id)>=0)&&o.deps&&s(t,o,!0)){n=!0;break}}}return i||(p.length=0),n}var o=t("../platform/callbacks-invoker"),a=t("../utils/CCPath"),c=t("../platform/js"),h=0|998*Math.random(),l={},u=[],d=10,_={WORKING:1,COMPLETE:2,ERROR:3},f={},p=[],g=function(t,e,i,n){o.call(this),this._id=++h,l[this._id]=this,this._pipeline=t,this._errorUrls=[],this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=n,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&e.length>0&&this.append(e)};g.ItemState=new cc.Enum(_),g.create=function(t,e,i,n){void 0===i?"function"==typeof e&&(n=e,e=i=null):void 0===n&&("function"==typeof e?(n=i,i=e,e=null):(n=i,i=null));var r=u.pop();return r?(r._pipeline=t,r.onProgress=i,r.onComplete=n,l[r._id]=r,r._pipeline&&(r.active=!0),e&&r.append(e)):r=new g(t,e,i,n),r},g.getQueue=function(t){return t.queueId?l[t.queueId]:null},g.itemComplete=function(t){var e=l[t.queueId];e&&e.itemComplete(t.id)},g.initQueueDeps=function(t){var e=f[t._id];e?(e.completed.length=0,e.deps.length=0):e=f[t._id]={completed:[],deps:[]}},g.registerDep=function(t,e){var i=t.queueId||t;if(!i)return!1;var n=f[i];if(n)n.deps.indexOf(e)===-1&&n.deps.push(e);else if(t.id)for(var r in f){var s=f[r];s.deps.indexOf(t.id)!==-1&&s.deps.indexOf(e)===-1&&s.deps.push(e)}},g.finishDep=function(t){for(var e in f){var i=f[e];i.deps.indexOf(t)!==-1&&i.completed.indexOf(t)===-1&&i.completed.push(t)}},c.mixin(g.prototype,o.prototype,{append:function(t,e){if(!this.active)return[];this._appending=!0;var i,o,a,c=[];for(i=0;i<t.length;++i)if(o=t[i],!o.queueId||this.map[o.id]){if(n(o)){a=r(o,this._id);var h=a.id;this.map[h]||(this.map[a.id]=a,this.totalCount++,g.registerDep(e||this._id,h),c.push(a))}}else{if(this.map[o.id]=o,o.complete||s(e,o)){this.totalCount++,this.itemComplete(o.id);continue}var u=this,d=l[o.queueId];d&&(this.totalCount++,g.registerDep(e||this._id,o.id),d.addListener(o.id,function(t){u.itemComplete(t.id)}))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(c),c},_childOnProgress:function(t){if(this.onProgress){var e=f[this._id];this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t)}},allComplete:function(){var t=0===this._errorUrls.length?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},isCompleted:function(){return this.completedCount>=this.totalCount},isItemCompleted:function(t){return!!this.completed[t]},exists:function(t){return!!this.map[t]},getContent:function(t){var e=this.map[t],i=null;return e&&(e.content?i=e.content:e.alias&&(i=this.getContent(e.alias))),i},getError:function(t){var e=this.map[t],i=null;return e&&(e.error?i=e.error:e.alias&&(i=this.getError(e.alias))),i},addListener:o.prototype.add,hasListener:o.prototype.has,removeListener:o.prototype.remove,removeAllListeners:o.prototype.removeAll,removeItem:function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias],delete this.map[e.alias]),this.completedCount--,this.totalCount--)},itemComplete:function(t){var e=this.map[t];if(e){var i=this._errorUrls.indexOf(t);if(e.error&&i===-1?this._errorUrls.push(t):e.error||i===-1||this._errorUrls.splice(i,1),this.completed[t]=e,this.completedCount++,g.finishDep(t),this.onProgress){var n=f[this._id];this.onProgress(n?n.completed.length:this.completedCount,n?n.deps.length:this.totalCount,e)}this.invokeAndRemove(t,e),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},destroy:function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,this._errorUrls.length=0,this.onProgress=null,this.onComplete=null,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,o.call(this),l[this._id]=null,f[this._id]&&(f[this._id].completed.length=0,f[this._id].deps.length=0),u.indexOf(this)===-1&&u.length<d&&u.push(this)}}),cc.LoadingItems=e.exports=g},{"../platform/callbacks-invoker":140,"../platform/js":145,"../utils/CCPath":161}],122:[function(t,e,i){function n(t,e,i){t(new Error("Can not retrieve "+e+" from packer "+i))}var r=t("./json-unpacker"),s=t("./loading-items"),o={},a={},c={};e.exports={initPacks:function(t){a=t;for(var e in t)for(var i=t[e],n=0;n<i.length;n++){var r=i[n];o[r]=e}},_loadNewPack:function(t,e,i){var o=cc.AssetLibrary.getImportedDir(e)+"/"+e+".json";s.create(cc.loader,[{id:o,ignoreMaxConcurrency:!0}],function(s,h){if(s)return cc.error("Failed to download package for "+t),i(s);var l=h.getContent(o),u=c[e];u||(console.log("Load pack %s for %s",e,t),u=c[e]=new r),u.read(a[e],l);var d=u.retrieve(t);d?i(null,d):n(i,t,e)})},load:function(t,e){var i=t.id,r=o[i];if(!r)return!1;var s=c[r];return s?setTimeout(function(){var t=s.retrieve(i);t?e(null,t):n(e,i,r)},0):this._loadNewPack(i,r,e),!0}}},{"./json-unpacker":119,"./loading-items":121}],123:[function(t,e,i){function n(t){var e=this.id,i=t.states[e],n=this.next;if(!t.error&&i!==a.WORKING&&i!==a.ERROR)if(i===a.COMPLETE)n?n.flowIn(t):this.pipeline.flowOut(t);else{t.states[e]=a.WORKING;var r=this;this.handle(t,function(i,s){i?(t.error=i,t.states[e]=a.ERROR,r.pipeline.flowOut(t)):(s&&(t.content=s),t.states[e]=a.COMPLETE,n?n.flowIn(t):r.pipeline.flowOut(t))})}}function r(t){var e=this.id,i=t.states[e],n=this.next;if(!t.error&&i!==a.WORKING&&i!==a.ERROR)if(i===a.COMPLETE)n?n.flowIn(t):this.pipeline.flowOut(t);else{t.states[e]=a.WORKING;var r=this.handle(t);r instanceof Error?(t.error=r,t.states[e]=a.ERROR,this.pipeline.flowOut(t)):(r&&(t.content=r),t.states[e]=a.COMPLETE,n?n.flowIn(t):this.pipeline.flowOut(t))}}var s=t("../platform/js"),o=t("./loading-items"),a=o.ItemState,c=function(t){this._pipes=t,this._cache={};for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null,i.flowIn=i.async?n:r)}};c.ItemState=a,s.mixin(c.prototype,{insertPipe:function(t,e){t.handle&&t.id&&(t.pipeline=this,t.flowIn=t.async?n:r,e<this._pipes.length?(t.next=this._pipes[e],this._pipes.splice(e,0,t)):(t.next=null,this._pipes.push(t)))},appendPipe:function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,t.flowIn=t.async?n:r,this._pipes.push(t))},flowIn:function(t){var e,i,n=this._pipes[0];if(n)for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i,n.flowIn(i);else for(e=0;e<t.length;e++)this.flowOut(t[e])},flowInDeps:function(t,e,i){var n=o.create(this,function(t,e){i(t,e),e.destroy()});return n.append(e,t)},flowOut:function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,o.itemComplete(t)},copyItemStates:function(t,e){if(!(e instanceof Array))return void(e.states=t.states);for(var i=0;i<e.length;++i)e[i].states=t.states},isFlowing:function(){return!0},getItems:function(){return null},getItem:function(t){var e=this._cache[t];return e?(e.alias&&(e=this._cache[e.alias]),e):e},removeItem:function(t){var e=this._cache[t];return delete this._cache[t],e&&!e.complete&&(e.error=new Error("Canceled manually"),this.flowOut(e)),e},clear:function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e))}}}),cc.Pipeline=e.exports=c},{"../platform/js":145,"./loading-items":121}],124:[function(t,e,i){var n=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var i=t.url,r=cc.loader.getXMLHttpRequest(),s="Load "+i+" failed!",o=window.navigator;i=n(i),r.open("GET",i,!0),/msie/i.test(o.userAgent)&&!/opera/i.test(o.userAgent)?(r.setRequestHeader("Accept-Charset","utf-8"),r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status?e(null,r.responseText):e({status:r.status,errorMessage:s}))}):(r.overrideMimeType&&r.overrideMimeType("text/plain; charset=utf-8"),r.onload=function(){4===r.readyState&&(200===r.status||0===r.status?e(null,r.responseText):e({status:r.status,errorMessage:s}))},r.onerror=function(){e({status:r.status,errorMessage:s})}),r.send(null)}},{"./utils":125}],125:[function(t,e,i){var n=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(t+=n.test(t)?"&_t="+(new Date-0):"?_t="+(new Date-0)),t}}},{}],126:[function(t,e,i){function n(t){var e="cc.Scene",i="cc.Prefab";return t&&(t[0]&&t[0].__type__===e||t[1]&&t[1].__type__===e||t[0]&&t[0].__type__===i)}function r(t,e,i,n,r,s){var o,h,l,u,d,_=e.id,f=n.uuidList;if(r)for(o=[],h=[],l=[],u=0;u<f.length;u++){d=f[u];var p=n.uuidObjList[u],g=n.uuidPropList[u],m=cc.AssetLibrary._getAssetInfoInRuntime(d);if(m.raw){var v=m.url;p[g]=v}else o.push(p),h.push(g),l.push({id:d,type:"uuid",uuid:d,deferredLoadRaw:!0})}else for(o=a.array.copy(n.uuidObjList),h=a.array.copy(n.uuidPropList),l=new Array(f.length),u=0;u<f.length;u++)d=f[u],l[u]={id:d,type:"uuid",uuid:d};if(n.rawProp&&(o.push(i),h.push(n.rawProp),l.push(e.url)),0===l.length)return i._uuid=_,s(null,i);var y=e.dependKeys=[];e.content=i,t.flowInDeps(e,l,function(t,e){var n;for(var r in e.map)n=e.map[r],n.uuid&&n.content&&(n.content._uuid=n.uuid);for(var a=0;a<l.length;a++){var u=l[a].uuid,d=o[a],f=h[a];if(n=e.map[u])if(n.complete||n.content)if(n.error)cc._throw(n.error);else{var p=n.isRawAsset?n.url:n.content;d[f]=p,y.push(u||n.url)}else{var g=function(t){var e=t.isRawAsset?t.url:t.content;this.obj[this.prop]=e,y.push(t.uuid||t.url)},m={obj:d,prop:f},v=c.getQueue(n),T=v._callbackTable[u];T?T.unshift(g,m):v.addListener(u,g,m)}}i._uuid=_,s(null,i)})}function s(t,e,i){var n=e.deferredLoadRaw;return n?t instanceof cc.Asset&&t.constructor.preventDeferredLoadDependents&&(n=!1):i&&t instanceof cc.SceneAsset&&(n=t.asyncLoadAssets),n}function o(t,e){var i;if("string"==typeof t.content)try{i=JSON.parse(t.content)}catch(o){return void e(new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+o.stack))}else{if("object"!=typeof t.content)return void e(new Error("JSON Loader: Input item doesn't contain string content"));i=t.content}var c,l=n(i),u=l?cc._MissingScript.safeFindClass:function(t){var e=a._getClassById(t);return e?e:(cc.warn('Can not get class "%s"',t),Object)},d=t.deserializeInfo||h;try{c=cc.deserialize(i,d,{classFinder:u,target:t.existingAsset,customEnv:t})}catch(o){var _=o.stack;return void e(new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+_))}var f=s(c,t,l);r(this.pipeline,t,c,d,f,e),d.reset()}var a=t("../platform/js");t("../platform/deserialize");var c=t("./loading-items"),h=new cc.deserialize.Details;e.exports=o,o.isSceneObj=n},{"../platform/deserialize":141,"../platform/js":145,"./loading-items":121}],127:[function(t,e,i){function n(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}var r=t("../assets/CCAsset"),s=t("./utils").callInNextTick,o=t("../load-pipeline/CCLoader"),a=t("../load-pipeline/pack-downloader"),c=t("../load-pipeline/auto-release-utils"),h="",l="",u={},d={loadAsset:function(t,e,i){if("string"!=typeof t)return s(e,new Error("[AssetLibrary] uuid must be string"),null);var r={id:t,type:"uuid"};i&&i.deserializeInfo&&(r.deserializeInfo=i.deserializeInfo),i&&i.existingAsset&&(r.existingAsset=i.existingAsset),
o.load(r,function(i,r){i||!r?i=new Error("[AssetLibrary] loading JSON or dependencies failed: "+(i?i.message:"Unknown error")):(r.constructor===cc.SceneAsset&&(r.scene.dependAssets=c.getDependsRecursively(t)),n(r)&&o.removeItem(t)),e&&e(i,r)})},getImportedDir:function(t){return h+t.slice(0,2)},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t){var e=u[t];if(e&&!cc.isChildClassOf(e.type,cc.Asset))return{url:l+e.url,raw:!0};var i=this.getImportedDir(t)+"/"+t+".json";return{url:i,raw:!1}},queryAssetInfo:function(t,e){var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)},parseUuidInEditor:function(t){},loadJson:function(t,e){var i=""+((new Date).getTime()+Math.random()),r={id:i,type:"uuid",content:t,skips:[o.downloader.id]};o.load(r,function(t,r){t?t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message):(r.constructor===cc.SceneAsset&&(r.scene.dependAssets=c.getDependsRecursively(i)),n(r)&&o.removeItem(i)),r._uuid="",e&&e(t,r)})},getAssetByUuid:function(t){return d._uuidToAsset[t]||null},init:function(t){var e=t.libraryPath;e=e.replace(/\\/g,"/"),h=cc.path._setEndWithSep(e,"/"),l=t.rawAssetsBase;var i=o._resources;i.reset();var n=t.rawAssets;if(n){var s="resources/";for(var c in n){var d=n[c];for(var _ in d){var f=d[_],p=f[0],g=f[1],m=cc.js._getClassById(g);if(m){if(u[_]={url:c+"/"+p,type:m},"assets"===c&&p.startsWith(s)){if(cc.isChildClassOf(m,r)){var v=cc.path.extname(p);p=v?p.slice(s.length,-v.length):p.slice(s.length)}else p=p.slice(s.length);var y=1===f[2];i.add(p,_,m,!y)}}else cc.error("Cannot get",g)}}}t.packedAssets&&a.initPacks(t.packedAssets);var T=t.mountPaths;T||(T={assets:l+"assets",internal:l+"internal"}),cc.url._init(T)}};d._uuidToAsset={},cc.AssetLibrary=d},{"../assets/CCAsset":40,"../load-pipeline/CCLoader":113,"../load-pipeline/auto-release-utils":116,"../load-pipeline/pack-downloader":122,"./utils":150}],128:[function(require,module,exports){function appendProp(t,e){var i=t.__props__.indexOf(e);i<0&&t.__props__.push(e)}function defineProp(t,e,i,n,r){if(Attr.setClassAttr(t,i,"default",n),appendProp(t,i),r){for(var s=null,o=0;o<r.length;o++){var a=r[o];Attr.attr(t,i,a),a._onAfterProp&&(s=s||[],s.push(a._onAfterProp))}if(s)for(var c=0;c<s.length;c++)s[c](t,i)}}function defineGetSet(t,e,i,n,r){var s=n.get,o=n.set,a=t.prototype,c=Object.getOwnPropertyDescriptor(a,i);if(s){if(r)for(var h=0;h<r.length;++h){var l=r[h];Attr.attr(t,i,l)}var u=!1;u||Attr.attr(t,i,Attr.NonSerialized),u&&appendProp(t,i),c?Object.defineProperty(a,i,{get:s}):Object.defineProperty(a,i,{get:s,configurable:!0,enumerable:!0})}o&&(c?Object.defineProperty(a,i,{set:o}):Object.defineProperty(a,i,{set:o,configurable:!0,enumerable:!0}))}function getDefault(t){return"function"==typeof t?t():t}function instantiateProps(t,e){var i=Attr.getClassAttrs(e),n=e.__props__;null===n&&(deferredInitializer.init(),n=e.__props__);for(var r=0;r<n.length;r++){var s=n[r],o=s+DELIMETER+"default";if(o in i){var a=i[o];a&&("object"==typeof a&&a?a="function"==typeof a.clone?a.clone():Array.isArray(a)?[]:{}:"function"==typeof a&&(a=getDefault(a))),t[s]=a}}}function getInheritanceChain(t){for(var e=[];;){var i=Object.getPrototypeOf(t.prototype);if(t=i&&i.constructor,!t)break;t!==Object&&e.push(t)}return e}function doDefine(t,e,i,n,r){var s=_createCtor(n,e,i,t,r);if(Object.defineProperty(s,"extend",{value:function(t){return t["extends"]=this,CCClass(t)},writable:!0,configurable:!0}),e&&(JS.extend(s,e),s.$super=e),i){for(var o=0;o<i.length;++o){var a=i[o];JS.mixin(s.prototype,a.prototype);for(var c in a)a.hasOwnProperty(c)&&INVALID_STATICS.indexOf(c)<0&&(s[c]=a[c]);CCClass._isCCClass(a)&&JS.mixin(Attr.getClassAttrs(s).constructor.prototype,Attr.getClassAttrs(a).constructor.prototype)}s.prototype.constructor=s}return JS.setClassName(t,s),s}function define(t,e,i,n,r){if(cc.isChildClassOf(e,cc.Component)){var s=cc._RFpeek();if(s){if(s.beh)return cc.error("Each script can have at most one Component."),a;var o=s.uuid;t=t||s.script;var a=doDefine(t,e,i,n,r);return o&&JS._setClassId(o,a),s.beh=a,a}}return doDefine(t,e,i,n,r)}function _checkCtor(t,e){}function normalizeClassName(t){var e}function _createCtor(ctor,baseClass,mixins,className,options){for(var useTryCatch=!(className&&className.startsWith("cc.")),shouldAddProtoCtor,originCtor,superCallBounded=options&&baseClass&&boundSuperCalls(baseClass,options),ctors=[],baseOrMixins=[baseClass].concat(mixins),b=0;b<baseOrMixins.length;b++){var baseOrMixin=baseOrMixins[b];if(baseOrMixin)if(CCClass._isCCClass(baseOrMixin)){var baseCtors=baseOrMixin.__ctors__;baseCtors&&(ctors=ctors.concat(baseCtors))}else baseOrMixin&&ctors.push(baseOrMixin)}ctor&&ctors.push(ctor);var body;if(body="(function(){\n",superCallBounded&&(body+="this._super=null;\n"),body+="instantiateProps(this,fireClass);\n",ctors.length>0){if(body+="var cs=fireClass.__ctors__;\n",useTryCatch&&(body+="try{\n"),ctors.length<=5)for(var i=0;i<ctors.length;i++)body+="(cs["+i+"]).apply(this,arguments);\n";else body+="for(var i=0,l=cs.length;i<l;++i){\n",body+="(cs[i]).apply(this,arguments);\n}\n";useTryCatch&&(body+="}catch(e){\ncc._throw(e);\n}\n")}body+="})";var fireClass=eval(body);return Object.defineProperty(fireClass,"__ctors__",{value:ctors.length>0?ctors:null}),fireClass}function _boundSuperCall(t,e,i){var n=null,r=JS.getPropertyDescriptor(i.prototype,e);if(r&&(n=r.value,"function"==typeof n)){var s=SuperCallReg.test(t);if(s)return function(){var e=this._super;this._super=n;var i=t.apply(this,arguments);return this._super=e,i}}return null}function boundSuperCalls(t,e){var i=!1;for(var n in e)if(BUILTIN_ENTRIES.indexOf(n)<0){var r=e[n];if("function"==typeof r){var s=_boundSuperCall(r,n,t);s&&(i=!0,e[n]=s)}}return i}function declareProperties(t,e,i,n,r){if(t.__props__=[],n&&n.__props__&&(t.__props__=n.__props__.slice()),r)for(var s=0;s<r.length;++s){var o=r[s];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter(function(e){return t.__props__.indexOf(e)<0})))}if(i){preprocessAttrs(i,e,t);for(var a in i){var c=i[a],h=parseAttributes(c,e,a);"default"in c?defineProp(t,e,a,c["default"],h):defineGetSet(t,e,a,c,h)}}}function CCClass(t){if(0===arguments.length)return define();if(!t)return cc.error("cc.Class: Option must be non-nil"),define();var e,i=t.name,n=t["extends"],r=t.mixins;e=define(i,n,r,t.ctor,t),i||(i=cc.js.getClassName(e));var s=t.properties;"function"==typeof s||n&&null===n.__props__||r&&r.some(function(t){return null===t.__props__})?(deferredInitializer.push({cls:e,props:s,mixins:r}),e.__props__=null):declareProperties(e,i,s,n,t.mixins);var o=t.statics;if(o){var a;for(a in o)e[a]=o[a]}for(var c in t)if(!(BUILTIN_ENTRIES.indexOf(c)>=0)){var h=t[c];if("function"==typeof h||null===h)Object.defineProperty(e.prototype,c,{value:h,enumerable:!0,configurable:!0,writable:!0});else;}return e}function parseAttributes(t,e,i){function n(e,i,n){if(e in t){var s=t[e];if(typeof s===i)if(n)r.push("function"==typeof n?n(s):n);else{var o={};o[e]=s,r.push(o)}}}tmpAttrs.length=0;var r=tmpAttrs,s=t.type;if(s){var o=PrimitiveTypes[s];if(o)r.push({type:s,_onAfterProp:getTypeChecker(o,"cc."+s)});else if("Object"===s);else if(s===Attr.ScriptUuid){var a=Attr.ObjectType(cc.ScriptAsset);a.type="Script",r.push(a)}else"object"==typeof s?Enum.isEnum(s)&&r.push({type:"Enum",enumList:Enum.getList(s)}):"function"==typeof s&&(t.url?r.push({type:"Object",ctor:s,_onAfterProp:getTypeChecker("String","cc.String")}):r.push(Attr.ObjectType(s)))}n("rawType","string",Attr.RawType),n("editorOnly","boolean",Attr.EditorOnly),t.url&&r.push({saveUrlAsAsset:!0}),t.serializable===!1&&r.push(Attr.NonSerialized);var c=t.range;return c&&Array.isArray(c)&&c.length>=2&&r.push({min:c[0],max:c[1],step:c[2]}),n("min","number"),n("max","number"),n("step","number"),r}var JS=require("./js"),Enum=require("../value-types/CCEnum"),Utils=require("./utils"),_isPlainEmptyObj_DEV=Utils.isPlainEmptyObj_DEV,_cloneable_DEV=Utils.cloneable_DEV,Attr=require("./attribute"),getTypeChecker=Attr.getTypeChecker,preprocessAttrs=require("./preprocess-attrs"),BUILTIN_ENTRIES=["name","extends","mixins","ctor","properties","statics","editor"],TYPO_TO_CORRECT=!1,INVALID_STATICS=!1,deferredInitializer={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout(function(){e.init()},0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props;"function"==typeof r&&(r=r());var s=JS.getClassName(n);r?declareProperties(n,s,r,n.$super,i.mixins):cc.error('Properties function of "%s" should return an object!',s)}this.datas=null}}},DELIMETER=Attr.DELIMETER;cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){var i=t.prototype,n=i&&Object.getPrototypeOf(i);if(t=n&&n.constructor,!t)return!1;if(t===e)return!0}}return!1};var SuperCallReg=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;CCClass._isCCClass=function(t){return!!t&&"undefined"!=typeof t.__ctors__},CCClass._fastDefine=function(t,e,i){JS.setClassName(t,e);for(var n=e.__props__=Object.keys(i),r=0;r<n.length;r++){var s=n[r],o=i[s];Attr.setClassAttr(e,s,"visible",!1),Attr.setClassAttr(e,s,"default",o)}},CCClass.Attr=Attr,CCClass.attr=Attr.attr,CCClass.getInheritanceChain=getInheritanceChain;var PrimitiveTypes={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},tmpAttrs=[];cc.Class=CCClass,module.exports={instantiateProps:instantiateProps,isArray:function(t){return t=getDefault(t),Array.isArray(t)},fastDefine:CCClass._fastDefine}},{"../value-types/CCEnum":172,"./attribute":139,"./js":145,"./preprocess-attrs":147,"./utils":150}],129:[function(t,e,i){var n=t("./CCInputManager");n.setAccelerometerEnabled=function(t){var e=this;if(e._accelEnabled!==t){e._accelEnabled=t;var i=cc.director.getScheduler();e._accelEnabled?(e._accelCurTime=0,i.scheduleUpdate(e)):(e._accelCurTime=0,i.scheduleUpdate(e))}},n.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},n._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,(!0))),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,(!1))),t.stopPropagation(),t.preventDefault()},!1)},n._registerAccelerometerEvent=function(){var t=window,e=this;e._acceleration=new cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e._accelDeviceEvent=window.DeviceOrientationEvent);var i=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(e._minus=-1),t.addEventListener(i,e.didAccelerate.bind(e),!1)},n.didAccelerate=function(t){var e=this,i=window;if(e._accelEnabled){var n,r,s,o=e._acceleration;if(e._accelDeviceEvent===window.DeviceMotionEvent){var a=t.accelerationIncludingGravity;n=e._accelMinus*a.x*.1,r=e._accelMinus*a.y*.1,s=.1*a.z}else n=t.gamma/90*.981,r=.981*-(t.beta/90),s=t.alpha/90*.981;o.x=n,o.y=r,o.z=s,o.timestamp=t.timeStamp||Date.now();var c=o.x;i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(o.x=-o.y,o.y=c):i.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(o.x=o.y,o.y=-c):i.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(o.x=-o.x,o.y=-o.y)}}},{"./CCInputManager":130}],130:[function(t,e,i){var n=t("./CCMacro"),r=n.TOUCH_TIMEOUT,s={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>r)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r,s=[],o=this._touchesIntegerDict,a=cc.sys.now(),c=0,h=t.length;c<h;c++)if(e=t[c],r=e.getID(),i=o[r],null==i){var l=this._getUnUsedIndex();if(l===-1){cc.log(cc._LogInfos.inputManager.handleTouchesBegin,l);continue}n=this._touches[l]=new cc.Touch(e._point.x,e._point.y,e.getID()),n._lastModified=a,n._setPrevPoint(e._prevPoint),o[r]=l,s.push(n)}if(s.length>0){this._glView._convertTouchesWithScale(s);var u=new cc.Event.EventTouch(s);u._eventCode=cc.Event.EventTouch.BEGAN,cc.eventManager.dispatchEvent(u)}},handleTouchesMove:function(t){for(var e,i,n,r=[],s=this._touches,o=cc.sys.now(),a=0,c=t.length;a<c;a++)e=t[a],n=e.getID(),i=this._touchesIntegerDict[n],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),s[i]._lastModified=o,r.push(s[i]));if(r.length>0){this._glView._convertTouchesWithScale(r);var h=new cc.Event.EventTouch(r);h._eventCode=cc.Event.EventTouch.MOVED,cc.eventManager.dispatchEvent(h)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,cc.eventManager.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,cc.eventManager.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)e=t[a],n=e.getID(),i=o[n],null!=i&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window,n=null;return n="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():t instanceof HTMLCanvasElement?{left:0,top:0,width:t.width,height:t.height}:{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:n.left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(r.x,r.y);return s._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,s},getMouseEvent:function(t,e,i){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var r=new cc.Event.EventMouse(i);return r.setLocation(t.x,t.y),r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,s=[],o=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,h=0;h<c;h++)if(i=t.changedTouches[h]){var l;l=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?o.convertToLocationInView(i.pageX,i.pageY,e):o.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(n=new cc.Touch(l.x,l.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n)):(n=new cc.Touch(l.x,l.y),n._setPrevPoint(a.x,a.y)),a.x=l.x,a.y=l.y,s.push(n)}return s},registerSystemEvent:function(t){if(!this._isRegisterEvent){var e=(this._glView=cc.view,this),i="mouse"in cc.sys.capabilities,n="touches"in cc.sys.capabilities,r=!1;if(cc.sys.isMobile&&(r=!0),i&&(!r&&window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),!r&&window.addEventListener("mouseup",function(i){var n=e._mousePressed;if(e._mousePressed=!1,n){var r=e.getHTMLElementPosition(t),s=e.getPointByEvent(i,r);if(!cc.rectContainsPoint(new cc.Rect(r.left,r.top,r.width,r.height),s)){e.handleTouchesEnd([e.getTouchByXY(s.x,s.y,r)]);var o=e.getMouseEvent(s,r,cc.Event.EventMouse.UP);o.setButton(i.button),cc.eventManager.dispatchEvent(o)}}},!1),!r&&t.addEventListener("mousedown",function(i){e._mousePressed=!0;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesBegin([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.DOWN);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault(),t.focus()},!1),!r&&t.addEventListener("mouseup",function(i){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.UP);s.setButton(i.button),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),!r&&t.addEventListener("mousemove",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);e.handleTouchesMove([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.MOVE);e._mousePressed?s.setButton(i.button):s.setButton(null),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("mousewheel",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.wheelDelta),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(i){var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n),s=e.getMouseEvent(r,n,cc.Event.EventMouse.SCROLL);s.setButton(i.button),s.setScrollData(0,i.detail*-120),cc.eventManager.dispatchEvent(s),i.stopPropagation(),i.preventDefault()},!1)),window.navigator.msPointerEnabled){var s={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var o in s)!function(i,n){t.addEventListener(i,function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()},!1)}(o,s[o])}n&&(t.addEventListener("touchstart",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchend",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1),t.addEventListener("touchcancel",function(i){if(i.changedTouches){var n=e.getHTMLElementPosition(t);n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(i,n)),i.stopPropagation(),i.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};cc.inputManager=s,e.exports=s},{"./CCMacro":131}],131:[function(t,e,i){t("./_CCClass"),cc._tmp=cc._tmp||{},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.ImageFormat.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:1,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_ATLAS_USE_TRIANGLE_STRIP:0,TEXTURE_ATLAS_USE_VAO:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1,TOUCH_TIMEOUT:5e3},cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA}),cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.log(cc._LogInfos.checkGLErrorDebug,t)}},e.exports=cc.macro},{"./_CCClass":138}],132:[function(t,e,i){function n(){this._name="",this._objFlags=0}function r(){for(var t=A.length,e=0;e<t;++e){var i=A[e];i._objFlags&o||i._destroyImmediate()}t===A.length?A.length=0:A.splice(0,t)}var s=t("./js"),o=1,a=4,c=8,h=16,l=32,u=64,d=128,_=256,f=2048,p=4096,g=8192,m=16384,v=32768,y=65536,T=1<<17,C=1<<18,b=1<<19,x=1<<20,S=1<<21,E=~(a|l|d|u|_|g|v|m|y|f|p|T|C|b|x|S);n.Flags={Destroyed:o,DontSave:c,EditorOnly:h,Dirty:l,DontDestroy:u,PersistentMask:E,Destroying:d,Activating:_,IsPreloadCalled:g,IsOnLoadCalled:m,IsOnLoadStarted:v,IsOnEnableCalled:f,IsStartCalled:y,IsEditorOnEnableCalled:p,IsPositionLocked:S,IsRotationLocked:T,IsScaleLocked:C,IsAnchorLocked:b,IsSizeLocked:x},t("./CCClass").fastDefine("cc.Object",n,{_name:"",_objFlags:0});var A=[];Object.defineProperty(n,"_deferredDestroy",{value:r});var O=n.prototype;s.getset(O,"name",function(){return this._name},function(t){this._name=t}),s.get(O,"isValid",function(){return!(this._objFlags&o)});O.destroy=function(){return this._objFlags&o?(cc.warn("object already destroyed"),!1):!(this._objFlags&a)&&(this._objFlags|=a,A.push(this),!0)},O._destruct=function(){for(var t in this)if(this.hasOwnProperty(t))switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},O._onPreDestroy=null,O._destroyImmediate=function(){return this._objFlags&o?void cc.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=o))},O._deserialize=null,cc.isValid=function(t){return"object"==typeof t?!(!t||t._objFlags&o):"undefined"!=typeof t},cc.Object=n,e.exports=n},{"./CCClass":128,"./js":145}],133:[function(t,e,i){cc.SAXParser=cc._Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warn("Not a plist file!"),{};for(var n=null,r=0,s=i.childNodes.length;r<s&&(n=i.childNodes[r],1!==n.nodeType);r++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],134:[function(t,e,i){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n,r=this._fnMap;for(t=0,e=r.length;t<e;t++)if(i=r[t],i&&i[1]in document){for(t=0,n=i.length;t<n;t++)this._fn[r[0][t]]=i[t];break}this._supportsFullScreen="undefined"!=typeof this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){function i(){n.removeEventListener(r._touchEvent,i),r.requestFullScreen(t,e)}t=t||document.body;var n=cc.game.canvas||t,r=this;this.requestFullScreen(t,e),n.addEventListener(this._touchEvent,i)}},cc.screen.init()},{}],135:[function(t,e,i){if(!cc.sys){cc.sys={};var n=cc.sys;n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_UNKNOWN="unknown",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document;var r=window,s=r.navigator,o=document,a=o.documentElement,c=s.userAgent.toLowerCase();n.isMobile=/mobile|android|iphone|ipad/.test(c),n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER;
var h=s.language;h=h?h:s.browserLanguage,h=h?h.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=h;var l=!1,u=!1,d="",_=0,f=/android (\d+(?:\.\d+)+)/i.exec(c)||/android (\d+(?:\.\d+)+)/i.exec(s.platform);f&&(l=!0,d=f[1]||"",_=parseInt(d)||0),f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(c),f?(u=!0,d=f[2]||"",_=parseInt(d)||0):/(iPhone|iPad|iPod)/.exec(s.platform)&&(u=!0);var p=n.OS_UNKNOWN;s.appVersion.indexOf("Win")!==-1?p=n.OS_WINDOWS:u?p=n.OS_IOS:s.appVersion.indexOf("Mac")!==-1?p=n.OS_OSX:s.appVersion.indexOf("X11")!==-1&&s.appVersion.indexOf("Linux")===-1?p=n.OS_UNIX:l?p=n.OS_ANDROID:s.appVersion.indexOf("Linux")!==-1&&(p=n.OS_LINUX),n.os=p,n.osVersion=d,n.osMainVersion=_,n.browserType=n.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,e=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,i=t.exec(c);i||(i=e.exec(c));var r=i?i[0]:n.BROWSER_TYPE_UNKNOWN;"micromessenger"===r?r=n.BROWSER_TYPE_WECHAT:"safari"===r&&c.match(/android.*applewebkit/)?r=n.BROWSER_TYPE_ANDROID:"trident"===r?r=n.BROWSER_TYPE_IE:"360 aphone"===r?r=n.BROWSER_TYPE_360:"mxbrowser"===r?r=n.BROWSER_TYPE_MAXTHON:"opr"===r&&(r=n.BROWSER_TYPE_OPERA),n.browserType=r}(),n.browserVersion="",function(){var t=/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,e=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,i=c.match(t);i||(i=c.match(e)),n.browserVersion=i?i[4]:""}();var g=window.innerWidth||document.documentElement.clientWidth,m=window.innerHeight||document.documentElement.clientHeight,v=window.devicePixelRatio||1;n.windowPixelResolution={width:v*g,height:v*m},n._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var y=document.createElement("canvas"),T=document.createElement("canvas");if(cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(s){}if(n)break}return n},n._supportCanvasNewBlendModes=function(){var t,e,i=y;i.width=1,i.height=1;var n=i.getContext("2d");n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply";var r=T;r.width=1,r.height=1;var s=r.getContext("2d");s.fillStyle="#fff",s.fillRect(0,0,1,1),n.drawImage(r,0,0,1,1),t=n.getImageData(0,0,1,1).data[0],i=y,i.width=1,i.height=1;var n=i.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,1,1),n.globalCompositeOperation="destination-atop",r=T,r.width=1,r.height=1;var s=r.getContext("2d");return s.fillStyle="#000",s.fillRect(0,0,1,1),n.drawImage(r,0,0,1,1),e=n.getImageData(0,0,1,1).data[0],0===t&&0===e}(),cc.sys.isMobile){var C=document.createElement("style");C.type="text/css",document.body.appendChild(C),C.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var b=n.localStorage=r.localStorage;b.setItem("storage",""),b.removeItem("storage"),b=null}catch(x){var S=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};n.localStorage={getItem:S,setItem:S,removeItem:S,clear:S}}var E=!!y.getContext("2d"),A=!1;if(r.WebGLRenderingContext){var O=document.createElement("CANVAS");try{var w=cc.create3DContext(O,{stencil:!0});if(w&&w.getShaderPrecisionFormat&&(A=!0),A&&n.os===n.OS_IOS&&9===n.osMainVersion&&(window.indexedDB||(A=!1)),A&&n.os===n.OS_ANDROID){var R=parseFloat(n.browserVersion);switch(n.browserType){case n.BROWSER_TYPE_MOBILE_QQ:case n.BROWSER_TYPE_BAIDU:case n.BROWSER_TYPE_BAIDU_APP:A=R>=6.2;break;case n.BROWSER_TYPE_ANDROID:n.osMainVersion&&n.osMainVersion>=5&&(A=!0);break;case n.BROWSER_TYPE_CHROME:A=R>=30;break;case n.BROWSER_TYPE_UNKNOWN:case n.BROWSER_TYPE_360:case n.BROWSER_TYPE_MIUI:case n.BROWSER_TYPE_UC:A=!1}}}catch(x){}O=null}var I=n.capabilities={canvas:E,opengl:A};(void 0!==a.ontouchstart||void 0!==o.ontouchstart||s.msPointerEnabled)&&(I.touches=!0),void 0!==a.onmouseup&&(I.mouse=!0),void 0!==a.onkeyup&&(I.keyboard=!0),(r.DeviceMotionEvent||r.DeviceOrientationEvent)&&(I.accelerometer=!0);var P;!function(){var t=!1,e=n.browserVersion,i=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);P={ONLY_ONE:!1,WEB_AUDIO:i,DELAY_CREATE_CTX:!1},n.os===n.OS_IOS&&(P.USE_LOADER_EVENT="loadedmetadata"),n.browserType===n.BROWSER_TYPE_FIREFOX&&(P.DELAY_CREATE_CTX=!0,P.USE_LOADER_EVENT="canplay"),n.os===n.OS_ANDROID&&n.browserType===n.BROWSER_TYPE_UC&&(P.ONE_SOURCE=!0),t&&setTimeout(function(){cc.log("browse type: "+n.browserType),cc.log("browse version: "+e),cc.log("MULTI_CHANNEL: "+P.MULTI_CHANNEL),cc.log("WEB_AUDIO: "+P.WEB_AUDIO),cc.log("AUTOPLAY: "+P.AUTOPLAY)},0)}();try{P.WEB_AUDIO&&(P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),P.DELAY_CREATE_CTX&&setTimeout(function(){P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(N){P.WEB_AUDIO=!1,cc.log("browser don't support web audio")}var L=[];!function(){var t=document.createElement("audio");if(t.canPlayType){var e=t.canPlayType('audio/ogg; codecs="vorbis"');e&&L.push(".ogg");var i=t.canPlayType("audio/mpeg");i&&L.push(".mp3");var n=t.canPlayType('audio/wav; codecs="1"');n&&L.push(".wav");var r=t.canPlayType("audio/mp4");r&&L.push(".mp4");var s=t.canPlayType("audio/x-m4a");s&&L.push(".m4a")}}(),P.format=L,n.__audioSupport=P,n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){return!!t},n.dump=function(){var t=this,e="";e+="isMobile : "+t.isMobile+"\r\n",e+="language : "+t.language+"\r\n",e+="browserType : "+t.browserType+"\r\n",e+="browserVersion : "+t.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(t.capabilities)+"\r\n",e+="os : "+t.os+"\r\n",e+="osVersion : "+t.osVersion+"\r\n",e+="platform : "+t.platform+"\r\n",e+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(e)},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},e.exports=n}},{}],136:[function(t,e,i){var n={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(n.adaptationType=cc.sys.BROWSER_TYPE_MIUI),cc.sys.os===cc.sys.OS_IOS&&(n.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),n.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:n.meta["minimal-ui"]="true",n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:n.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:n.availWidth=function(t){return t.clientWidth},n.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:n.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var r=cc.rect(),s=cc._Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_orientationChanging:!0,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,_antiAliasEnabled:!0,ctor:function(){var t=this,e=cc.ContainerStrategy,i=cc.ContentStrategy;n.init(this),t._frameSize=cc.size(0,0),t._initFrameSize();var r=cc.game.canvas.width,s=cc.game.canvas.height;t._designResolutionSize=cc.size(r,s),t._originalDesignResolutionSize=cc.size(r,s),t._viewPortRect=cc.rect(0,0,r,s),t._visibleRect=cc.rect(0,0,r,s),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var o=cc.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._targetDensityDPI=cc.macro.DENSITYDPI_HIGH,t.enableAntiAlias(!0)},_resizeEvent:function(){var t;t=this.setDesignResolutionSize?this:cc.view;var e=t._frameSize.width,i=t._frameSize.height,n=t._isRotated;if(t._initFrameSize(),t._isRotated!==n||t._frameSize.width!==e||t._frameSize.height!==i){var r=t._originalDesignResolutionSize.width,s=t._originalDesignResolutionSize.height;r>0&&t.setDesignResolutionSize(r,s,t._resolutionPolicy),cc.eventManager.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if(t&=cc.macro.ORIENTATION_AUTO){this._orientation=t;var e=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(e,i,this._resolutionPolicy)}},_initFrameSize:function(){var t=this._frameSize,e=n.availWidth(cc.game.frame),i=n.availHeight(cc.game.frame),r=e>=i;!this._orientationChanging||!cc.sys.isMobile||r&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!r&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;n=a?a.content:"",i=i||document.createElement("meta"),i.id="cocosMetaElement",i.name="viewport",i.content="";for(r in t)n.indexOf(r)==-1?n+=","+r+"="+t[r]:e&&(s=new RegExp(r+"s*=s*[^,]+"),n.replace(s,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,a&&(a.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(n.meta,!1),this._isAdjustViewPort=!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var e=cc.loader._items.map;for(var i in e){var n=e[i],r=n&&n.content instanceof cc.Texture2D?n.content:null;r&&(t?r.setAntiAliasTexParameters():r.setAliasTexParameters())}}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var s=cc._canvas.getContext("2d");s.imageSmoothingEnabled=t,s.mozImageSmoothingEnabled=t;var o=cc.rendererCanvas._dirtyRegion;if(o){var a=new cc.Region;a.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height),o.addRegion(a)}}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.game.frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(!(t>0||e>0))return void cc.log(cc._LogInfos.view.setDesignResolutionSize);this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(!n)return void cc.log(cc._LogInfos.view.setDesignResolutionSize_2);n.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var s=this._viewPortRect,o=this._visibleRect,a=r.viewport;s.x=a.x,s.y=a.y,s.width=a.width,s.height=a.height,o.x=-s.x/this._scaleX,o.y=-s.y/this._scaleY,o.width=cc.game.canvas.width/this._scaleX,o.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(s.x,-s.y)}var c=cc.director;c._winSizeInPoints.width=this._designResolutionSize.width,c._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=c._winSizeInPoints.width,cc.winSize.height=c._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?c.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this._setViewportMeta({width:t},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*s*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*s*r,n*o*r)},setScissorInPoints:function(t,e,i,n){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;r.x=t,r.y=e,r.width=i,r.height=n,cc._renderContext.scissor(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,i*o*s,n*a*s)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return cc.rect(r)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){var n=this._devicePixelRatio*(t-i.left),r=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?{x:this._viewPortRect.width-r,y:n}:{x:n,y:r}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect,n=this;t.x=(n._devicePixelRatio*(t.x-e.left)-i.x)/n._scaleX,t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-i.y)/n._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)e=t[a],i=e._point,n=e._prevPoint,i.x=(i.x-r.x)/s,i.y=(i.y-r.y)/o,n.x=(n.x-r.x)/s,n.y=(n.y-r.y)/o}});s._getInstance=function(){return this._instance||(this._instance=this._instance||new s,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px";var s=t._devicePixelRatio=1;t.isRetinaEnabled()&&(s=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*s,n.height=i*s,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",cc.container.style.position="fixed",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var o=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return cc._renderType===cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,s],this._result.viewport=o,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){var e=t._frameSize.height,i=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.marginLeft=e+"px":i.margin="0px"}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,s=t._frameSize.height,o=cc.container.style,a=e.width,c=e.height,h=r/a,l=s/c;h<l?(i=r,n=c*h):(i=a*l,n=s);var u=Math.round((r-i)/2),d=Math.round((s-n)/2);i=r-2*u,n=s-2*d,this._setupContainer(t,i,n),t._isRotated?o.marginLeft=s+"px":o.margin="0px",o.paddingLeft=u+"px",o.paddingRight=u+"px",o.paddingTop=d+"px",o.paddingBottom=d+"px"}}),i=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,s=n/e.height;return this._buildResult(i,n,i,n,r,s)}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,a=e.height,c=r/o,h=s/a,l=0;return c<h?(l=c,i=r,n=a*l):(l=h,i=o*l,n=s),this._buildResult(r,s,i,n,l,l)}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,s=cc.game.canvas.width,o=cc.game.canvas.height,a=e.width,c=e.height,h=s/a,l=o/c;return h<l?(i=l,n=a*i,r=o):(i=h,n=s,r=c*i),this._buildResult(s,o,n,r,i,i)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=e.height,s=n/r,o=i,a=n;return this._buildResult(i,n,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=e.width,s=i/r,o=i,a=n;return this._buildResult(i,n,o,a,s,s)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new s,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new a}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,e.exports=s},{}],137:[function(t,e,i){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,s=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=n+e/2,this.top.y=s,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}}},{}],138:[function(t,e,i){var n=cc.ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}},r=/\b_super\b/,s=function(){};s.extend=function(t){function e(){this.__instanceId=n.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var i=this.prototype,o=Object.create(i),a=n.getNewID();n[a]=i;var c={writable:!0,configurable:!0};o.__instanceId=null,e.id=a,c.value=a,Object.defineProperty(o,"__cid__",c),e.prototype=o,c.value=e,Object.defineProperty(e.prototype,"constructor",c);for(var h=0,l=arguments.length;h<l;++h){var u=arguments[h];for(var d in u){var _="function"==typeof u[d],f="function"==typeof i[d],p=r.test(u[d]);_&&f&&p?(c.value=function(t,e){return function(){var n=this._super;this._super=i[t];var r=e.apply(this,arguments);return this._super=n,r}}(d,u[d]),Object.defineProperty(o,d,c)):_?(c.value=u[d],Object.defineProperty(o,d,c)):o[d]=u[d]}}return e.extend=s.extend,e.implement=function(t){for(var e in t)o[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,n,r,s){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];"object"!=typeof n||!n||n instanceof _ccsg.Node||n instanceof HTMLElement?e[i]=n:e[i]=cc.clone(n)}return e},cc._Class=e.exports=s},{}],139:[function(t,e,i){function n(t,e,i){var n,r;n=function(){},i&&u.extend(n,i.constructor);var s=new n;return Object.defineProperty(t,"__attrs__",{value:s}),s}function r(t){for(var e,i=cc.Class.getInheritanceChain(t),r=i.length-1;r>=0;r--){var s=i[r],o=s.__attrs__;o||(e=i[r+1],n(s,s,e&&e.__attrs__))}return e=i[0],n(t,t,e&&e.__attrs__),t.__attrs__}function s(t,e,i){var s,o,a;if("function"==typeof t)s=t.__attrs__||r(t),o=s.constructor.prototype;else{var c=t;if(s=c.__attrs__,!s){t=c.constructor;var h=t.__attrs__||r(t);s=n(c,t,h)}o=s}if("undefined"==typeof i){var l=e+_,u={};for(a in s)a.startsWith(l)&&(u[a.slice(l.length)]=s[a]);return u}if("object"==typeof i)for(a in i)95!==a.charCodeAt(0)&&(o[e+_+a]=i[a])}function o(t){return t.__attrs__||r(t)}function a(t,e,i,n){var s=t.__attrs__||r(t);s.constructor.prototype[e+_+i]=n}function c(t,e){}function h(t){return{type:"Object",ctor:t,_onAfterProp:!1}}function l(t){return{rawType:t,serializable:!1,_canUsedInGetter:!1,_onAfterProp:function(t,e){}}}var u=t("./js"),d=t("./utils").isPlainEmptyObj_DEV,_="$_$";cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String";var f={serializable:!1,_canUsedInGetter:!1},p={editorOnly:!0,_canUsedInGetter:!1};e.exports={attr:s,getClassAttrs:o,setClassAttr:a,DELIMETER:_,getTypeChecker:c,NonSerialized:f,EditorOnly:p,ObjectType:h,RawType:l,ScriptUuid:{}}},{"./js":145,"./utils":150}],140:[function(t,e,i){var n=t("./js"),r=function(){this._callbackTable={},this._invoking={},this._toRemove={},this._toRemoveAll=null},s={};r.REMOVE_PLACEHOLDER=s,r.prototype._clearToRemove=function(t){var e=this._callbackTable[t];if(this._toRemove[t]&&e){for(var i=e.indexOf(s),n=i,r=i+1;r<e.length;++r){var o=e[r];o!==s&&(e[n]=o,++n)}e.length=n,this._toRemove[t]=!1}this._toRemoveAll&&(this.removeAll(this._toRemoveAll),this._toRemoveAll=null)},r.prototype.add=function(t,e,i){var n=this._callbackTable[t];return"undefined"!=typeof n?("object"==typeof i?n.push(e,i):n.push(e),!1):(n="object"==typeof i?[e,i]:[e],this._callbackTable[t]=n,!0)},r.prototype.has=function(t,e,i){if(this._toRemoveAll===t)return!1;var n,r,o=this._callbackTable[t];if(!o)return!1;if(!e){if(this._toRemove[t]){for(r=0;r<o.length;r++)if(o[r]!==s)return!0;return!1}return o.length>0}if("function"!=typeof e)return!1;for(r=o.indexOf(e);r!==-1;){if(n=o[r+1],"object"!=typeof n&&(n=void 0),n===i)return!0;r=cc.js.array.indexOf.call(o,e,r+1)}return!1},r.prototype.removeAll=function(t){if(this._invoking[t])return void(this._toRemoveAll=t);if("object"==typeof t){var e,i,n,r=t;for(t in this._callbackTable)for(e=this._callbackTable[t],i=e.lastIndexOf(r);i!==-1;)n=e[i-1],"function"==typeof n?e.splice(i-1,2):e.splice(i,1),i=e.lastIndexOf(r)}else delete this._callbackTable[t],delete this._toRemove[t]},r.prototype.remove=function(t,e,i){var n,r,o=this._callbackTable[t];if(o){for(n=o.indexOf(e);n!==-1;){if(r=o[n+1],"object"!=typeof r&&(r=void 0),r===i){this._invoking[t]?(o[n]=s,r&&(o[n+1]=s),this._toRemove[t]=!0):o.splice(n,r?2:1);break}n=cc.js.array.indexOf.call(o,e,n+1)}return!0}return!1};var o=function(){r.call(this)};n.extend(o,r),o.prototype.invoke=function(t,e,i,n,r,o){this._invoking[t]=!0;var a=this._callbackTable[t];if(a){var c,h=a.length-1;for(c=0;c<=h;){var l=a[c],u=1;if(l!==s){var d=a[c+1],_=d&&"object"==typeof d;_?(l.call(d,e,i,n,r,o),u=2):l(e,i,n,r,o)}c+=u}}this._invoking[t]=!1,this._clearToRemove(t)},o.prototype.invokeAndRemove=function(t,e,i,n,r,o){this._invoking[t]=!0;var a,c,h,l,u,d=this._callbackTable[t];if(d)for(a=0,c=d.length;a<c;)l=d[a],h=1,l!==s&&(u=d[a+1],u&&"object"==typeof u?(l.call(u,e,i,n,r,o),h=2):l(e,i,n,r,o)),a+=h;this._invoking[t]=!1,this._toRemove[t]=!1,this.removeAll(t)},o.prototype.bindKey=function(t,e){var i=this;return function(n,r,s,o,a){var c,h,l,u=i._callbackTable[t];if(u)for(c=0,h=u.length;c<h;)l=u[c+1],l&&"object"==typeof l?(u[c].call(l,n,r,s,o,a),c+=2):(u[c](n,r,s,o,a),++c);e&&i.removeAll(t)}},o.CallbacksHandler=r,e.exports=o},{"./js":145}],141:[function(t,e,i){var n=t("./js"),r=(t("./CCObject"),t("./attribute")),s=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};s.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},s.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},s.prototype.push=function(t,e,i){this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)};var o=function(){function t(t,i,n,r,o,a){if(this._classFinder=r,this._idList=[],this._idObjList=[],this._idPropList=[],this.result=i||new s,this.customEnv=o,Array.isArray(t)){var h=t,l=h.length;this.deserializedList=new Array(l);for(var u=0;u<l;u++)if(h[u]){var d;this.deserializedList[u]=c(this,h[u],d)}this.deserializedData=l>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=t?c(this,t,n):null,this.deserializedList[0]=this.deserializedData;e(this)}function e(t){for(var e=t.deserializedList,i=t._idPropList,n=t._idList,r=t._idObjList,s=0,o=t._idList.length;s<o;s++){var a=i[s],c=n[s];r[s][a]=e[c]}}function i(t,e,i){for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];"object"!=typeof r?"__type__"!==n&&(e[n]=r):r?t._deserializeObjField(e,r,n):e[n]=null}}function o(t,e,i){for(var n in e){var r=i[n];"undefined"!=typeof r&&i.hasOwnProperty(n)&&("object"!=typeof r?e[n]=r:r?t._deserializeObjField(e,r,n):e[n]=null)}}function a(t,e,n,s,o){for(var a=s.__props__,c=r.getClassAttrs(s),u=0;u<a.length;u++){var d=a[u],_=c[d+h];if(_)t.result.rawProp&&cc.error("not support multi raw object in a file"),t.result.rawProp=d;else{if(c[d+l]===!1)continue;var f=n[d];if("undefined"==typeof f)continue;"object"!=typeof f?e[d]=f:f?t._deserializeObjField(e,f,d):e[d]=null}}"_$erialized"===a[a.length-1]&&(e._$erialized=JSON.parse(JSON.stringify(n)),i(t,e._$erialized,n))}function c(t,e,r){var s,c=null,h=null;if(e.__type__){var l=e.__type__;if(h=t._classFinder(l,e),!h){var u=t._classFinder===n._getClassById;return u&&cc.deserialize.reportMissingClass(l),null}if(c=new h,c._deserialize)return c._deserialize(e.content,t),c;cc.Class._isCCClass(h)?a(t,c,e,h,r):o(t,c,e)}else if(Array.isArray(e)){c=new Array(e.length);for(var d=0;d<e.length;d++)s=e[d],"object"==typeof s&&s?t._deserializeObjField(c,s,""+d):c[d]=s}else c={},i(t,c,e);return c}t.prototype._deserializeObjField=function(t,e,i,n){
var r=e.__id__;if("undefined"==typeof r){var s=e.__uuid__;s?(this.result.uuidList.push(s),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i)):t[i]=c(this,e)}else{var o=this.deserializedList[r];o?t[i]=o:(this._idList.push(r),this._idObjList.push(t),this._idPropList.push(i))}};var h=r.DELIMETER+"rawType",l=(r.DELIMETER+"editorOnly",r.DELIMETER+"serializable");return t}();cc.deserialize=function(t,e,i){i=i||{};var r=i.classFinder||n._getClassById,a=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,c=!1,h=i.customEnv,l=i.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t)),a&&!e&&(e=new s),cc.game._isCloning=!0;var u=new o(t,e,c,r,h,l);return cc.game._isCloning=!1,a&&e.assignAssetsBy(Editor.serialize.asAsset),u.deserializedData},cc.deserialize.Details=s,cc.deserialize.reportMissingClass=function(t){cc.warn('Can not find class "%s"',t)}},{"./CCObject":132,"./attribute":139,"./js":145}],142:[function(t,e,i){function n(t){this.id=0|998*Math.random(),this.prefix=t?""+t+r:""}var r=".";n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n},{}],143:[function(t,e,i){t("./js"),t("./CCClass"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),cc.sys.isBrowser&&t("./CCAssetLibrary"),t("./miniFramework"),t("./CCVisibleRect")},{"./CCAssetLibrary":127,"./CCClass":128,"./CCMacro":131,"./CCObject":132,"./CCSys":135,"./CCVisibleRect":137,"./callbacks-invoker":140,"./deserialize":141,"./instantiate":144,"./js":145,"./miniFramework":146,"./requiring-frame":148,"./url":149}],144:[function(t,e,i){function n(t){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(t instanceof a&&!t.isValid)return null;var e;if(t instanceof a){if(t._instantiate)return cc.game._isCloning=!0,e=t._instantiate(),cc.game._isCloning=!1,e;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,e=r(t),cc.game._isCloning=!1,e}function r(t,e){if(Array.isArray(t))return cc.error("Can not instantiate array"),null;if(l&&l(t))return cc.error("Can not instantiate DOM element"),null;var i;if(t._iN$t)i=t._iN$t;else{var n=t.constructor;i=new n}s(t,i,e);for(var r=0,o=u.length;r<o;++r)u[r]._iN$t=null;return u.length=0,i}function s(t,e,i){var n,r,s,l=t.constructor;if(t._iN$t=e,u.push(t),cc.Class._isCCClass(l))for(var d=h.DELIMETER,_=l.__props__,f=h.getClassAttrs(l),p=0;p<_.length;p++)s=_[p],f[s+d+"serializable"]!==!1&&(n=t[s],r=typeof n,"object"===r?e[s]=n?o(n,i,e,s):n:e[s]="function"!==r?n:null);else for(s in t)!t.hasOwnProperty(s)||95===s.charCodeAt(0)&&95===s.charCodeAt(1)&&"__type__"!==s||(n=t[s],n!==e&&(r=typeof n,"object"===r?e[s]=n?o(n,i,e,s):n:e[s]="function"!==r?n:null));t instanceof a&&(e._objFlags&=c)}function o(t,e,i,n){var r=t._iN$t;if(r)return r;if(!cc.isValid(t))return null;if(t instanceof cc.Asset)return t;if(Array.isArray(t)){var a=t.length;r=new Array(a),t._iN$t=r;for(var c=0;c<a;++c){var h=t[c],l=typeof h;"object"===l?r[c]=h?o(h,e,r,""+c):h:r[c]="function"!==l?h:null}return u.push(t),r}if(t instanceof cc.ValueType)return t.clone();var d=t.constructor;if(cc.Class._isCCClass(d)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t}else if(d!==Object)return t;return r=new d,s(t,r,e),r}var a=t("./CCObject"),c=a.Flags.PersistentMask,h=t("./attribute"),l=t("./utils").isDomNode,u=[];n._clone=r,cc.instantiate=n,e.exports=n},{"./CCObject":132,"./attribute":139,"./utils":150}],145:[function(t,e,i){function n(t,e){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;var r=Object.getPrototypeOf(t);return r?n(r,e):null}function r(t,e,i){var r=n(e,t);Object.defineProperty(i,t,r)}function s(){return g+m++}function o(t,e){t.splice(e,1)}function a(t,e){var i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)}function c(t,e){var i=t.indexOf(e);return i!==-1&&(o(t,i),!0)}function h(t,e){var i=t.indexOf(e);i!==-1&&(t[i]=t[t.length-1],--t.length)}function l(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log(cc._LogInfos.Array.verifyType),!1;return!0}function u(t,e){for(var i=0,n=e.length;i<n;i++)c(t,e[i])}function d(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t}function _(t,e){return v.call(t,e)!==-1}function f(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n}var p={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.addon called on non-object:",n);continue}for(var s in n)s in t||r(s,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.error("cc.js.mixin: arguments must be type object:",n);continue}for(var s in n)r(s,n,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:n};p.getClassName=function(t){if("function"==typeof t){if(t.prototype.__classname__)return t.prototype.__classname__}else if(t&&t.constructor){if(t.constructor.prototype&&t.constructor.prototype.hasOwnProperty("__classname__"))return t.__classname__;var e;if(t.constructor.name&&(e=t.constructor.name),t.constructor.toString){var i,n=t.constructor.toString();i="["===n.charAt(0)?n.match(/\[\w+\s*(\w+)\]/):n.match(/function\s*(\w+)/),i&&2===i.length&&(e=i[1])}return"Object"!==e?e:""}return""};var g="cc.TmpCId.",m=0;!function(){function t(t,e){return function(i,n){if(n.prototype.hasOwnProperty(t)&&delete e[n.prototype[t]],n.prototype[t]=i,i){var r=e[i];if(r&&r!==n){var s="A Class already exists with the same "+t+' : "'+i+'".';cc.error(s)}else e[i]=n}}}var e={},i={};p._setClassId=t("__cid__",e);var n=t("__classname__",i);p.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||s();i&&p._setClassId(i,e)}},p.unregisterClass=function(t){"use strict";for(var n=0;n<arguments.length;n++){var r=arguments[n].prototype,s=r.__cid__;s&&delete e[s];var o=r.__classname__;o&&delete i[o]}},p._getClassById=function(t){return e[t]},p.getClassByName=function(t){return i[t]},p._getClassId=function(t,e){e="undefined"==typeof e||e;var i;if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return i=t.prototype.__cid__;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty("__cid__"))return i=t.__cid__}return""}}(),p.getset=function(t,e,i,n,r){"function"!=typeof n&&(r=n,n=void 0),Object.defineProperty(t,e,{get:i,set:n,enumerable:!!r})},p.get=function(t,e,i,n){Object.defineProperty(t,e,{get:i,enumerable:!!n})},p.set=function(t,e,i,n){Object.defineProperty(t,e,{set:i,enumerable:!!n})},p.obsolete=function(t,e,i,n){function r(){return this[i]}var s=e.split(".").slice(-1);n?p.getset(t,s,r,function(t){this[i]=t}):p.get(t,s,r)},p.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];p.obsolete(t,e+"."+r,s,n)}},p.formatStr=function(){var t=arguments,e=t.length;if(e<1)return"";var i=/(%d)|(%s)/,n=1,r=t[0],s="string"==typeof r&&i.test(r);if(s)for(var o=/%s/;n<e;++n){var a=t[n],c="number"==typeof a?i:o;c.test(r)?r=r.replace(c,a):r+=" "+a}else if(e>1)for(;n<e;++n)r+=" "+t[n];else r=""+r;return r};var v=Array.prototype.indexOf;p.array={remove:c,fastRemove:h,removeAt:o,fastRemoveAt:a,contains:_,verifyType:l,removeArray:u,appendObjectsAt:d,copy:f,indexOf:v,MutableForwardIterator:t("../utils/mutable-forward-iterator")},cc.js=p,e.exports=p},{"../utils/mutable-forward-iterator":167}],146:[function(t,e,i){switch(cc.$=function(t){var e=this===cc?document:this,i=t instanceof HTMLElement?t:e.querySelector(t);return i&&(i.find=i.find||cc.$,i.hasClass=i.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},i.addClass=i.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},i.removeClass=i.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},i.remove=i.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},i.appendTo=i.appendTo||function(t){return t.appendChild(this),this},i.prependTo=i.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},i.transforms=i.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},i.position=i.position||{x:0,y:0},i.rotation=i.rotation||0,i.scale=i.scale||{x:1,y:1},i.skew=i.skew||{x:0,y:0},i.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},i.rotate=function(t){return this.rotation=t,this.transforms(),this},i.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},i.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),i},cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit",cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O",cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}}},{}],147:[function(t,e,i){function n(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var s={};n[r]=s;for(var o in a){var c=a[o];t.hasOwnProperty(o)&&(s[o]=t[o],c.canUsedInGet||delete t[o])}}}function r(t,e,i,n){Array.isArray(n)&&n.length>0&&(n=n[0]),t.type=n}function s(t,e,i,n){if(Array.isArray(e)){if(!(e.length>0))return cc.error("Invalid type of %s.%s",i,n);t.type=e=e[0]}}function o(t,e,i,n){}var a={url:{canUsedInGet:!0},"default":{},serializable:{},editorOnly:{},rawType:{}};e.exports=function(t,e,i){for(var a in t){var c=t[a],h=c&&c.constructor===Object;if(!h){if(Array.isArray(c)&&c.length>0)c={"default":[],type:c};else if("function"==typeof c){var l=c;c=cc.RawAsset.isRawAssetType(l)?{"default":"",url:l}:cc.isChildClassOf(l,cc.ValueType)?{"default":new l}:{"default":null,type:c}}else c={"default":c};t[a]=c}if(c){var u=c.notify;u&&n(c,a,u,t),"type"in c&&s(c,c.type,e,a),"url"in c&&r(c,e,a,c.url),"type"in c&&o(c,c.type,e,a)}}}},{"./CCClass":128}],148:[function(t,e,i){var n=[];cc._RFpush=function(t,e,i){2===arguments.length&&(i=e,e=""),n.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},cc._RFpop=function(){var t=n.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=i=t.beh}},cc._RFpeek=function(){return n[n.length-1]}},{}],149:[function(t,e,i){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){return 46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1)),t},raw:function(t){return t=this.normalize(t),t.startsWith("resources/")||cc.error('Sorry can not load "%s" because it is not placed in the "resources" folder.',t),this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var e in t){var i=t[e];i=cc.path._setEndWithSep(i,"/"),n[e]=i}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},e.exports=cc.url},{}],150:[function(t,e,i){e.exports={isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},0)}}},{}],151:[function(t,e,i){function n(){var t=c.pop();return t||(t=new o),t}function r(t){c.push(t)}function s(t,e){var i=t._minX<e._minX?t._minX:e._minX,n=t._minY<e._minY?t._minY:e._minY,r=t._maxX>e._maxX?t._maxX:e._maxX,s=t._maxY>e._maxY?t._maxY:e._maxY;return(r-i)*(s-n)}var o=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a=o.prototype,c=[];a.setTo=function(t,e,i,n){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=n,this.updateArea(),this},a.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},a.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},a.union=function(t){return this.isEmpty()?void this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),void this.updateArea())},a.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a.isEmpty=function(){return this._width<=0||this._height<=0},a.intersects=function(t){if(this.isEmpty()||t.isEmpty())return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(e>i)&&(e=this._minY>t._minY?this._minY:t._minY,i=this._maxY<t._maxY?this._maxY:t._maxY,e<=i)},a.updateRegion=function(t,e){if(0===t.width||0===t.height)return void this.setEmpty();var i,n,r,s,o=e,a=o.a,c=o.b,h=o.c,l=o.d,u=o.tx,d=o.ty,_=t.x,f=t.y,p=_+t.width,g=f+t.height;if(1===a&&0===c&&0===h&&1===l)i=_+u-1,n=f+d-1,r=p+u+1,s=g+d+1;else{var m=a*_+h*f+u,v=c*_+l*f+d,y=a*p+h*f+u,T=c*p+l*f+d,C=a*p+h*g+u,b=c*p+l*g+d,x=a*_+h*g+u,S=c*_+l*g+d,E=0;m>y&&(E=m,m=y,y=E),C>x&&(E=C,C=x,x=E),i=(m<C?m:C)-1,r=(y>x?y:x)+1,v>T&&(E=v,v=T,T=E),b>S&&(E=b,b=S,S=E),n=(v<b?v:b)-1,s=(T>S?T:S)+1}this._minX=i,this._minY=n,this._maxX=r,this._maxY=s,this._width=r-i,this._height=s-n,this._area=this._width*this._height};var h=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},l=h.prototype;l.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},l.addRegion=function(t){var e=t._minX,i=t._minY,r=t._maxX,s=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),r>this.clipWidth&&(r=this.clipWidth),s>this.clipHeight&&(s=this.clipHeight)),e>=r||i>=s)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,a=n();return o.push(a.setTo(e,i,r,s)),this.mergeDirtyList(o),!0},l.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)r(t[i]);t.length=0},l.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=n();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var i=this.dirtyList.length;if(i>0)for(var r=0;r<i;r++)this.dirtyList[r].intValues();return this.dirtyList},l.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var i=this.hasClipRect,n=e>3?Number.POSITIVE_INFINITY:0,o=0,a=0,c=0,h=0;h<e-1;h++){var l=t[h];i&&(c+=l.area);for(var u=h+1;u<e;u++){var d=t[u],_=s(l,d)-l.area-d.area;n>_&&(o=h,a=u,n=_)}}if(i&&c/this.clipArea>.95&&(this.clipRectChanged=!0),o!==a){var f=t[a];return t[o].union(f),r(f),t.splice(a,1),!0}return!1},cc.Region=o,cc.DirtyRegion=h},{}],152:[function(t,e,i){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!0,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,init:function(){cc.sys.browserType!==cc.sys.BROWSER_TYPE_IE&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC||this.enableDirtyRegion(!1)},getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,n=this._dirtyRegion,r=_ccsg.Node.CanvasRenderCmd.RegionStatus,s=0,o=!0;for(t=0,e=i.length;t<e;t++){var a=i[t],c=a._regionFlag,h=a._oldRegion,l=a._currentRegion;c>r.NotDirty&&(++s,s>this._dirtyRegionCountThreshold&&(o=!1),o&&(!l.isEmpty()&&n.addRegion(l),a._regionFlag>r.Dirty&&!h.isEmpty()&&n.addRegion(h)),a._regionFlag=r.NotDirty)}return o},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save();var n=t._scaleX,r=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,r),e.beginPath();for(var s=0,o=i.length;s<o;++s){var a=i[s];e.rect(a._minX,-a._maxY,a._width,a._height)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions(),n=t._scaleX,r=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,r),e.beginPath();for(var s=0,o=i.length;s<o;++s){var a=i[s];e.rect(a._minX,-a._maxY,a._width,a._height)}var c=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=c}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,n=t||cc._renderContext,r=n.getContext(),s=cc.view.getScaleX(),o=cc.view.getScaleY();n.setViewScale(s,o),n.computeRealOffsetY();var a,c,h=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,u=this._allNeedDraw||!this._enableDirtyRegion;for(u||(u=u||!this._collectDirtyRegion()),u||this._beginDrawDirtyRegion(n),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,i.width,i.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),r.fillRect(0,0,i.width,i.height)),a=0,c=l.length;a<c;a++){var d=l[a];if(d._needDraw){var _=!1,f=d._currentRegion;if(!f||u)_=!0;else for(var p=0,g=h.length;p<g;++p)if(h[p].intersects(f)){_=!0;break}_&&d.rendering(n,s,o)}}u||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(r)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,n){t||cc.log("The context of RenderTexture is invalid."),i=void 0===i?1:i,n=void 0===n?1:n,e=e||this._currentID;var r,s,o=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,s=o.length;r<s;r++)o[r].rendering(t,i,n);this._removeCache(e);var a=this._cacheInstanceIds;0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.rendering)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds,n=i[e];n.indexOf(t)===-1&&n.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._currentAlpha=this._context.globalAlpha,this._saveCount--},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._context.fillStyle=t},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-(t.ty*i))):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}}()},{}],153:[function(t,e,i){function n(t){var e=cc._renderContext;if(c){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),v=new Uint16Array(6*t);for(var i=0,n=0,r=6*t;n<r;n+=6)v[n]=i+0,v[n+1]=i+1,v[n+2]=i+2,v[n+3]=i+1,v[n+4]=i+2,v[n+5]=i+3,i+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,v,e.DYNAMIC_DRAW)}if(h){p=4*t*_;var s=4*p;f=new ArrayBuffer(s),g=new Float32Array(f),m=new Uint32Array(f),e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,g,e.DYNAMIC_DRAW)}l=4*(t-100)}function r(t){var e=cc._renderContext;null===c&&(h=e.createBuffer(),c=e.createBuffer()),n(t)}var s=2e3,o={texture:null,blendSrc:null,blendDst:null,shader:null},a=!1,c=null,h=null,l=0,u=0,d=0,_=6,f=null,p=0,g=null,m=null,v=null,y=0,T=!0,C=!1,b=cc.Enum({QUAD:0,TRIANGLE:1});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:b,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var t=cc._renderContext;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),r(s),cc.sys.os===cc.sys.OS_IOS&&(C=!0)},getVertexSize:function(){return l},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext;this.rendering(i,e),this._removeCache(t);var n=this._cacheInstanceIds;0===n.length?this._isCacheToBufferOn=!1:this._currentID=n[n.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);var e,i,n;for(e=0,i=t.length;e<i;e++)n=t[e],n.updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds,n=i[e];n.indexOf(t)===-1&&n.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)},_increaseBatchingSize:function(t,e){e=e||b.QUAD;var i,n;switch(e){case b.QUAD:for(i=0;i<t;i+=4)n=u+i,v[d++]=n+0,v[d++]=n+1,v[d++]=n+2,v[d++]=n+1,v[d++]=n+2,v[d++]=n+3;break;case b.TRIANGLE:for(T=!1,i=0;i<t;i+=3)n=u+i,v[d++]=n+0,v[d++]=n+1,v[d++]=n+2;break;default:return}u+=t},_breakBatch:function(){a=!0},_uploadBufferData:function(t){u>=l&&this._batchRendering();var e=t._node,i=t._texture||e._texture||e._spriteFrame._texture,n=t._node._blendFunc.src,r=t._node._blendFunc.dst,s=t._shaderProgram;(a||o.texture!==i||o.blendSrc!==n||o.blendDst!==r||o.shader!==s)&&(this._batchRendering(),o.texture=i,o.blendSrc=n,o.blendDst=r,o.shader=s,a=!1);var c=t.uploadData(g,m,u*_);if(c>0){var h,f,p=t.vertexType||b.QUAD;switch(p){case b.QUAD:for(h=0;h<c;h+=4)f=u+h,v[d++]=f+0,v[d++]=f+1,v[d++]=f+2,v[d++]=f+1,v[d++]=f+2,v[d++]=f+3;break;case b.TRIANGLE:for(T=!1,h=0;h<c;h+=3)f=u+h,v[d++]=f+0,v[d++]=f+1,v[d++]=f+2;break;default:return}u+=c}},_batchRendering:function(){if(0!==u&&o.texture){var t=cc._renderContext,e=o.texture,i=o.shader,n=u>.5*l;if(i&&(i.use(),i._updateProjectionUniform()),cc.gl.blendFunc(o.blendSrc,o.blendDst),cc.gl.bindTexture2DN(0,e),t.bindBuffer(t.ARRAY_BUFFER,h),n)t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW);else{var r=g.subarray(0,u*_);t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW)}t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,c),(!y||!T||d>y)&&(n?t.bufferData(t.ELEMENT_ARRAY_BUFFER,v,t.DYNAMIC_DRAW):t.bufferData(t.ELEMENT_ARRAY_BUFFER,v.subarray(0,d),t.DYNAMIC_DRAW)),t.drawElements(t.TRIANGLES,d,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,T?y=d:(y=0,T=!0),u=0,d=0}},rendering:function(t,e){var i,n,r,s=e||this._renderCmds,a=t||cc._renderContext;for(a.bindBuffer(a.ARRAY_BUFFER,null),i=0,n=s.length;i<n;++i)r=s[i],r._needDraw&&(r.uploadData?this._uploadBufferData(r):(u>0&&this._batchRendering(),r.rendering(a)));this._batchRendering(),o.texture=null}}},{}],154:[function(t,e,i){t("./RendererCanvas"),t("./RendererWebGL"),t("./DirtyRegion")},{"./DirtyRegion":151,"./RendererCanvas":152,"./RendererWebGL":153}],155:[function(t,e,i){var n=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame","extends":t("../assets/CCAsset"),mixins:[n],properties:{_textureFilenameSetter:{set:function(t){this._textureFilename=t,t&&this._loadTexture()}}},ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,void 0!==t&&this.initWithTexture(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_refreshTexture:function(t){function e(){i._textureLoaded=!0;var e=t.width,n=t.height;if(i._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=t.getHtmlElementObj();r=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,i.getRect());var s=new cc.Texture2D;s.initWithElement(r),s.handleLoadedTexture(),i._texture=s,i._rotated=!1,e=i._texture.width,n=i._texture.height,i.setRect(cc.rect(0,0,e,n))}i._rect?i._checkRect(i._texture):i.setRect(cc.rect(0,0,e,n)),i._originalSize||i.setOriginalSize(cc.size(e,n)),i._offset||i.setOffset(cc.v2(0,0)),i.emit("load")}var i=this;if(i._texture!==t){var n=t.isLoaded();this._textureLoaded=n,this._texture=t,n?e():t.once("load",e)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,n,r){e?this.setRect(e):this._rect=null,n?this.setOffset(n):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=i||!1;var s=t;return cc.js.isString(s)?(this._textureFilename=s,this._loadTexture()):s instanceof cc.Texture2D&&this._refreshTexture(s),!0},_loadTexture:function(){if(this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(t)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.getPixelWidth()&&cc.error(cc._LogInfos.RectWidth,t.url+"/"+this.name),n>t.getPixelHeight()&&cc.error(cc._LogInfos.RectHeight,t.url+"/"+this.name)},_serialize:!1,_deserialize:function(t,e){var i=t.rect;i&&this.setRect(new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var n=t.capInsets;n&&(this.insetLeft=n[0],this.insetTop=n[1],this.insetRight=n[2],this.insetBottom=n[3]);var r=t.texture;if(r){var s=e.customEnv&&e.customEnv.deferredLoadRaw,o=s?"_textureFilename":"_textureFilenameSetter";e.result.push(this,o,r)}}});var r=cc.SpriteFrame.prototype;r.copyWithZone=r.clone,r.copy=r.clone,r.initWithTexture=r.setTexture},{"../assets/CCAsset":40,"../event/event-target":98}],156:[function(t,e,i){t("./CCSpriteFrame"),cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);return e?cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):cc.rect(0,0,0,0);
},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.p(parseFloat(e[1]),parseFloat(e[2])):cc.p(0,0)},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?cc.size(parseFloat(e[1]),parseFloat(e[2])):cc.size(0,0)},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),cc.loader.release(t),e._inited?(this._frameConfigCache[t]=e,e):(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return cc.assert(e,cc._LogInfos.spriteFrameCache._getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,i=t.metadata||t.meta,n={},r={},s=0;if(i){var o=i.format;s=o.length<=1?parseInt(o):o,r.image=i.textureFileName||i.textureFileName||i.image}for(var a in e){var c=e[a];if(c){var h={};if(0==s){h.rect=cc.rect(c.x,c.y,c.width,c.height),h.rotated=!1,h.offset=cc.p(c.offsetX,c.offsetY);var l=c.originalWidth,u=c.originalHeight;l&&u||cc.log(cc._LogInfos.spriteFrameCache._getFrameConfig),l=Math.abs(l),u=Math.abs(u),h.size=cc.size(l,u)}else if(1==s||2==s)h.rect=this._rectFromString(c.frame),h.rotated=c.rotated||!1,h.offset=this._pointFromString(c.offset),h.size=this._sizeFromString(c.sourceSize);else if(3==s){var d=this._sizeFromString(c.spriteSize),_=this._rectFromString(c.textureRect);d&&(_=cc.rect(_.x,_.y,d.width,d.height)),h.rect=_,h.rotated=c.textureRotated||!1,h.offset=this._pointFromString(c.spriteOffset),h.size=this._sizeFromString(c.spriteSourceSize),h.aliases=c.aliases}else{var f=c.frame,p=c.sourceSize;a=c.filename||a,h.rect=cc.rect(f.x,f.y,f.w,f.h),h.rotated=c.rotated||!1,h.offset=cc.p(0,0),h.size=cc.size(p.w,p.h)}n[a]=h}}return{_inited:!0,frames:n,meta:r}},_addSpriteFramesByObject:function(t,e,i){if(cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2),e&&e.frames){var n=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,n,i)}},_createSpriteFrames:function(t,e,i){var n=e.frames,r=e.meta;if(i)i instanceof cc.Texture2D||(cc.js.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache.addSpriteFrames_3));else{var s=cc.path.changeBasename(t,r.image||".png");i=cc.textureCache.addImage(s)}var o=this._spriteFramesAliases,a=this._spriteFrames;for(var c in n){var h=n[c],l=a[c];if(!l){l=new cc.SpriteFrame(i,h.rect,h.rotated,h.offset,h.size);var u=h.aliases;if(u)for(var d=0,_=u.length;d<_;d++){var f=u[d];o[f]&&cc.log(cc._LogInfos.spriteFrameCache.addSpriteFrames,f),o[f]=c}if(cc._renderType===cc.game.RENDER_TYPE_CANVAS&&l.isRotated()){var p=l.getTexture();if(p.isLoaded()){var g=l.getTexture().getHtmlElementObj();g=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(g,l.getRect());var m=new cc.Texture2D;m.initWithElement(g),m.handleLoadedTexture(),l.setTexture(m);var v=l._rect;l.setRect(cc.rect(0,0,v.width,v.height))}}a[c]=l}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache.addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);if(i&&i.frames){var n=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,n,e)}},_checkConflict:function(t){var e=t.frames;for(var i in e)this._spriteFrames[i]&&cc.log(cc._LogInfos.spriteFrameCache._checkConflict,i)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases,r=e._frameConfigCache[t];if(r){var s=r.frames;for(var o in s)if(i[o]){delete i[o];for(var a in n)n[a]===o&&delete n[a]}}},removeSpriteFramesFromTexture:function(t){var e=this,i=e._spriteFrames,n=e._spriteFramesAliases;for(var r in i){var s=i[r];if(s&&s.getTexture()===t){delete i[r];for(var o in n)n[o]===r&&delete n[o]}}},getSpriteFrame:function(t){var e=this,i=e._spriteFrames[t];if(!i){var n=e._spriteFramesAliases[t];n&&(i=e._spriteFrames[n.toString()],i||delete e._spriteFramesAliases[t])}return i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}}},{"./CCSpriteFrame":155}],157:[function(t,e,i){var n=t("../event/event-target"),r=t("../platform/CCSys"),s=t("../platform/js"),o=t("../utils/misc"),a=t("../CCGame");t("../platform/_CCClass"),t("../platform/CCClass");var c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),h=cc.Class({name:"cc.Texture2D","extends":t("../assets/CCRawAsset"),mixins:[n],statics:{WrapMode:c},ctor:function(){this.url=null,this._textureLoaded=!1,this._htmlElementObj=null,this._contentSize=cc.size(0,0),this._pixelWidth=0,this._pixelHeight=0,cc._renderType===a.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===a.RENDER_TYPE_WEBGL&&(this._pixelFormat=h.defaultPixelFormat,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._webTextureObj=null)},getPixelWidth:function(){return this._pixelWidth},getPixelHeight:function(){return this._pixelHeight},getContentSize:function(){return cc.size(this._contentSize.width,this._contentSize.height)},_getWidth:function(){return this._contentSize.width},_getHeight:function(){return this._contentSize.height},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(t){t&&(this._htmlElementObj=t,this._pixelWidth=this._contentSize.width=t.width,this._pixelHeight=this._contentSize.height=t.height,this._textureLoaded=!0)},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var t=this;if(!t._htmlElementObj){var e=cc.loader.getRes(t.url);if(!e)return;t.initWithElement(e)}if(t._htmlElementObj.width&&t._htmlElementObj.height){var i=t._htmlElementObj;t._pixelWidth=t._contentSize.width=i.width,t._pixelHeight=t._contentSize.height=i.height,t._textureLoaded=!0,cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.view._antiAliasEnabled?t.setAntiAliasTexParameters():t.setAliasTexParameters()),t.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.getName()+" | Dimensions = "+this.getPixelWidth()+" x "+this.getPixelHeight()+">"},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj)},getName:function(){return this._webTextureObj||null},getPixelFormat:function(){return this._pixelFormat||null},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha||!1},hasMipmaps:function(){return this._hasMipmaps||!1},setTexParameters:function(t,e,i,n){return void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),t.wrapS===c.REPEAT&&t.wrapT===c.REPEAT?void(this._pattern="repeat"):t.wrapS===c.REPEAT?void(this._pattern="repeat-x"):t.wrapT===c.REPEAT?void(this._pattern="repeat-y"):void(this._pattern="")},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(t){return-1}});h.WrapMode=c;var l=h;l.PIXEL_FORMAT_RGBA8888=2,l.PIXEL_FORMAT_RGB888=3,l.PIXEL_FORMAT_RGB565=4,l.PIXEL_FORMAT_A8=5,l.PIXEL_FORMAT_I8=6,l.PIXEL_FORMAT_AI88=7,l.PIXEL_FORMAT_RGBA4444=8,l.PIXEL_FORMAT_RGB5A1=7,l.PIXEL_FORMAT_PVRTC4=9,l.PIXEL_FORMAT_PVRTC2=10,l.PIXEL_FORMAT_DEFAULT=l.PIXEL_FORMAT_RGBA8888,l.defaultPixelFormat=l.PIXEL_FORMAT_DEFAULT;var u=h._M={};u[l.PIXEL_FORMAT_RGBA8888]="RGBA8888",u[l.PIXEL_FORMAT_RGB888]="RGB888",u[l.PIXEL_FORMAT_RGB565]="RGB565",u[l.PIXEL_FORMAT_A8]="A8",u[l.PIXEL_FORMAT_I8]="I8",u[l.PIXEL_FORMAT_AI88]="AI88",u[l.PIXEL_FORMAT_RGBA4444]="RGBA4444",u[l.PIXEL_FORMAT_RGB5A1]="RGB5A1",u[l.PIXEL_FORMAT_PVRTC4]="PVRTC4",u[l.PIXEL_FORMAT_PVRTC2]="PVRTC2";var d=h._B={};d[l.PIXEL_FORMAT_RGBA8888]=32,d[l.PIXEL_FORMAT_RGB888]=24,d[l.PIXEL_FORMAT_RGB565]=16,d[l.PIXEL_FORMAT_A8]=8,d[l.PIXEL_FORMAT_I8]=8,d[l.PIXEL_FORMAT_AI88]=16,d[l.PIXEL_FORMAT_RGBA4444]=16,d[l.PIXEL_FORMAT_RGB5A1]=16,d[l.PIXEL_FORMAT_PVRTC4]=4,d[l.PIXEL_FORMAT_PVRTC2]=3;var _=h.prototype;_.name,cc.defineGetterSetter(_,"name",_.getName),_.pixelFormat,cc.defineGetterSetter(_,"pixelFormat",_.getPixelFormat),_.pixelWidth,cc.defineGetterSetter(_,"pixelWidth",_.getPixelWidth),_.pixelHeight,cc.defineGetterSetter(_,"pixelHeight",_.getPixelHeight),_.width,cc.defineGetterSetter(_,"width",_._getWidth),_.height,cc.defineGetterSetter(_,"height",_._getHeight),a.once(a.EVENT_RENDERER_INITED,function(){if(cc._renderType===a.RENDER_TYPE_CANVAS){var t=function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var s,o=r.getImageData(0,0,i,n).data,a=0;a<4;a++){s=e[a].getContext("2d");for(var c=s.getImageData(0,0,i,n),h=c.data,l=0;l<o.length;l+=4)h[l]=0===a?o[l]:0,h[l+1]=1===a?o[l+1]:0,h[l+2]=2===a?o[l+2]:0,h[l+3]=o[l+3];s.putImageData(c,0,0)}t.onload=null},e=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),s=r.data,o=0,a=s.length;o<a;o+=4)s[o]=s[o+1]=s[o+2]=.34*s[o]+.5*s[o+1]+.16*s[o+2];return n.putImageData(r,0,0),i};s.mixin(h.prototype,{_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var e=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return t(this._htmlElementObj,e),this.channelCache=e},_switchToGray:function(t){this._textureLoaded&&this._isGray!==t&&(this._isGray=t,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=e(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;var t=e(this._htmlElementObj),i=new h;return i.initWithElement(t),i.handleLoadedTexture(),i},_generateColorTexture:r._supportCanvasNewBlendModes?function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._htmlElementObj;if(n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,n.width,n.height),a.globalCompositeOperation="multiply",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),a.globalCompositeOperation="destination-atop",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height)}if(s)return r;var c=new h;return c.initWithElement(r),c.handleLoadedTexture(),c}:function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._htmlElementObj;if(n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var c=a.getImageData(0,0,r.width,r.height),l=c.data;t/=255,e/=255,i/=255;for(var u=0;u<l.length;u+=4)l[u]=l[u]*t,l[u+1]=l[u+1]*e,l[u+2]=l[u+2]*i;a.putImageData(c,0,0)}if(s)return r;var d=new h;return d.initWithElement(r),d.handleLoadedTexture(),d}})}else cc._renderType===a.RENDER_TYPE_WEBGL&&s.mixin(h.prototype,{initWithData:function(t,e,i,n,r){var s=this,o=h,a=cc._renderContext,c=a.RGBA,l=a.UNSIGNED_BYTE,u=h._B[e],d=i*u/8;switch(d%8===0?a.pixelStorei(a.UNPACK_ALIGNMENT,8):d%4===0?a.pixelStorei(a.UNPACK_ALIGNMENT,4):d%2===0?a.pixelStorei(a.UNPACK_ALIGNMENT,2):a.pixelStorei(a.UNPACK_ALIGNMENT,1),s._webTextureObj=a.createTexture(),cc.gl.bindTexture2D(s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:c=a.RGBA;break;case o.PIXEL_FORMAT_RGB888:c=a.RGB;break;case o.PIXEL_FORMAT_RGBA4444:l=a.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:l=a.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:l=a.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:c=a.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:c=a.ALPHA;break;case o.PIXEL_FORMAT_I8:c=a.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D.initWithData)}return a.texImage2D(a.TEXTURE_2D,0,c,i,n,0,c,l,t),s._contentSize.width=r.width,s._contentSize.height=r.height,s._pixelWidth=i,s._pixelHeight=n,s._pixelFormat=e,s._hasPremultipliedAlpha=!1,s._hasMipmaps=!1,s._textureLoaded=!0,!0},initWithImage:function(t){if(null==t)return cc.log(cc._LogInfos.Texture2D.initWithImage),!1;var e=t.getWidth(),i=t.getHeight(),n=cc.configuration.getMaxTextureSize();return e>n||i>n?(cc.log(cc._LogInfos.Texture2D.initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0)},handleLoadedTexture:function(t){t=!!t;var e=this;if(a._rendererInitialized){if(!e._htmlElementObj){var i=cc.loader.getRes(e.url);if(!i)return;e.initWithElement(i)}if(e._htmlElementObj.width&&e._htmlElementObj.height){var n=cc._renderContext;cc.gl.bindTexture2D(e),n.pixelStorei(n.UNPACK_ALIGNMENT,4),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),cc.gl.bindTexture2D(null),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var r=e._htmlElementObj.width,s=e._htmlElementObj.height;e._pixelWidth=e._contentSize.width=r,e._pixelHeight=e._contentSize.height=s,e._pixelFormat=h.PIXEL_FORMAT_RGBA8888,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e._textureLoaded=!0,cc.view._antiAliasEnabled?e.setAntiAliasTexParameters():e.setAliasTexParameters(),e.emit("load")}}},setTexParameters:function(t,e,i,n){var r=this,s=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(r._pixelWidth===o.NextPOT(r._pixelWidth)&&r._pixelHeight===o.NextPOT(r._pixelHeight)||t.wrapS===s.CLAMP_TO_EDGE&&t.wrapT===s.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.gl.bindTexture2D(r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t.minFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t.magFilter),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,t.wrapS),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.gl.bindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelWidth===o.NextPOT(t._pixelWidth)&&t._pixelHeight===o.NextPOT(t._pixelHeight),"Mimpap texture only works in POT textures"),cc.gl.bindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return h._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=h._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D.bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n,r=h,s=t.getData(),o=null,a=null,c=t.hasAlpha(),l=cc.size(t.getWidth(),t.getHeight()),u=r.defaultPixelFormat,d=t.getBitsPerComponent();c||(d>=8?u=r.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D._initPremultipliedATextureWithImage),u=r.PIXEL_FORMAT_RGB565));var _=e*i;if(u===r.PIXEL_FORMAT_RGB565)if(c)for(s=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>2<<5|(o[n]>>16&255)>>3<<0;else for(s=new Uint16Array(e*i),a=t.getData(),n=0;n<_;++n)s[n]=(255&a[n])>>3<<11|(255&a[n])>>2<<5|(255&a[n])>>3<<0;else if(u===r.PIXEL_FORMAT_RGBA4444)for(s=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)s[n]=(o[n]>>0&255)>>4<<12|(o[n]>>8&255)>>4<<8|(o[n]>>16&255)>>4<<4|(o[n]>>24&255)>>4<<0;else if(u===r.PIXEL_FORMAT_RGB5A1)for(s=new Uint16Array(e*i),o=t.getData(),n=0;n<_;++n)s[n]=(o[n]>>0&255)>>3<<11|(o[n]>>8&255)>>3<<6|(o[n]>>16&255)>>3<<1|(o[n]>>24&255)>>7<<0;else if(u===r.PIXEL_FORMAT_A8)for(s=new Uint8Array(e*i),o=t.getData(),n=0;n<_;++n)s[n]=o>>24&255;if(c&&u===r.PIXEL_FORMAT_RGB888)for(o=t.getData(),s=new Uint8Array(e*i*3),n=0;n<_;++n)s[3*n]=o>>0&255,s[3*n+1]=o>>8&255,s[3*n+2]=o>>16&255;return this.initWithData(s,u,e,i,l),s!=t.getData()&&(s=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0}})}),cc.Texture2D=e.exports=h},{"../CCGame":36,"../assets/CCRawAsset":45,"../event/event-target":98,"../platform/CCClass":128,"../platform/CCSys":135,"../platform/_CCClass":138,"../platform/js":145,"../utils/misc":166}],158:[function(t,e,i){var n=t("../platform/_CCClass"),r=t("../platform/js"),s=t("../CCGame"),o=n.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],cc.js.isString(t)?this.initWithFile(t,e):t instanceof cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var i=0;i<t.length;i++)this._setQuadToArray(t[i],e+i)},_setQuadToArray:function(t,e){var i=this._quads;return i[e]?(i[e].bl=t.bl,i[e].br=t.br,i[e].tl=t.tl,void(i[e].tr=t.tr)):void(i[e]=new cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT))},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(0!==this._capacity)for(var t=this._indices,e=this._capacity,i=0;i<e;i++)cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[6*i+0]=4*i+0,t[6*i+1]=4*i+0,t[6*i+2]=4*i+2,t[6*i+3]=4*i+1,t[6*i+4]=4*i+3,t[6*i+5]=4*i+3):(t[6*i+0]=4*i+0,t[6*i+1]=4*i+1,t[6*i+2]=4*i+2,t[6*i+3]=4*i+3,t[6*i+4]=4*i+2,t[6*i+5]=4*i+1)},initWithFile:function(t,e){var i=cc.textureCache.addImage(t);return i?this.initWithTexture(i,e):(cc.log(cc._LogInfos.TextureAtlas.initWithFile,t),!1)},initWithTexture:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.initWithTexture),e=0|e,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(6*e);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(i*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),(!this._quads||!this._indices)&&e>0)return!1;for(var n=this._quads,r=0;r<e;r++)n[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*i);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){cc.assert(t,cc._LogInfos.TextureAtlas.updateQuad),cc.assert(e>=0&&e<this._capacity,cc._LogInfos.TextureAtlas.updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(cc.assert(e<this._capacity,cc._LogInfos.TextureAtlas.insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._totalQuads-1-e,r=e*i,s=n*i;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*i),this._quadsReader.set(this._quadsReader.subarray(r,r+s),r+i),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,i){i=i||t.length,cc.assert(e+i<=this._capacity,cc._LogInfos.TextureAtlas.insertQuads);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=i,this._totalQuads>this._capacity)return void cc.log(cc._LogInfos.TextureAtlas.insertQuad);var r,s=this._totalQuads-1-e-i,o=e*n,a=s*n,c=this._totalQuads-1-i;for(r=0;r<i;r++)this._quads[c+r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+a),o+n*i),r=0;r<i;r++)this._setQuadToArray(t[r],e+r);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){cc.assert(e>=0||e<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex),cc.assert(t>=0||t<this._totalQuads,cc._LogInfos.TextureAtlas.insertQuadFromIndex_2);var i,n,r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._quadsReader,o=s.subarray(t*r,r);t>e?(i=e*r,n=(t-e)*r,s.set(s.subarray(i,i+n),i+r),s.set(o,i)):(i=(t+1)*r,n=(e-t)*r,s.set(s.subarray(i,i+n),i-r),s.set(o,e*r)),this.dirty=!0}},removeQuadAtIndex:function(t){cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadAtIndex);var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var i=(t+1)*e,n=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(i,i+n),i-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(cc.assert(t+e<=this._totalQuads,cc._LogInfos.TextureAtlas.removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var i=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*i,r=(this._totalQuads-t)*i,s=t*i;this._quadsReader.set(this._quadsReader.subarray(n,n+r),s)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,r=this._capacity,s=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*r),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;n<r;n++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e);else{var o,a,c=this._quads;if(r>i){for(o=[],a=new ArrayBuffer(e*r),n=0;n<s;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);for(;n<r;n++)o[n]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}else{var h=Math.max(s,r);for(o=[],a=new ArrayBuffer(e*r),n=0;n<h;n++)o[n]=new cc.V3F_C4B_T2F_Quad(c[n].tl,c[n].bl,c[n].tr,c[n].br,a,n*e);this._quadsReader=new Uint8Array(a),this._quads=o,this._quadsArrayBuffer=a}}if(null===this._indices)this._indices=new Uint16Array(6*r);else if(r>i){var l=new Uint16Array(6*r);l.set(this._indices,0),this._indices=l}else this._indices=this._indices.subarray(0,6*r);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,i){if(void 0===i){if(i=e,e=this._totalQuads-t,cc.assert(i+(this._totalQuads-t)<=this._capacity,cc._LogInfos.TextureAtlas.moveQuadsFromIndex),0===e)return}else if(cc.assert(i+e<=this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_2),cc.assert(t<this._totalQuads,cc._LogInfos.TextureAtlas.moveQuadsFromIndex_3),t===i)return;var n,r,s=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,o=t*s,a=e*s,c=this._quadsReader,h=c.subarray(o,o+a),l=i*s;i<t?(n=(t-i)*s,r=i*s,c.set(c.subarray(r,r+n),r+a)):(n=(i-t)*s,r=(t+e)*s,c.set(c.subarray(r,r+n),o)),c.set(h,l),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var i=e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i),r=0;r<i;r++)n[r]=0},_setupVBO:function(){},_mapBuffers:function(){},drawQuads:function(){},drawNumberOfQuads:null,_releaseBuffer:function(){var t=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}}),a=o.prototype;a.totalQuads,cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads),a.capacity,cc.defineGetterSetter(a,"capacity",a.getCapacity),a.quads,cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads),s.once(s.EVENT_RENDERER_INITED,function(){cc._renderType===s.RENDER_TYPE_WEBGL&&r.mixin(o.prototype,{_setupVBO:function(){var t=this,e=cc._renderContext;t._buffersVBO[0]=e.createBuffer(),t._buffersVBO[1]=e.createBuffer(),t._quadsWebBuffer=e.createBuffer(),t._mapBuffers()},_mapBuffers:function(){var t=this,e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,t._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,t._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t._indices,e.STATIC_DRAW)},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},drawNumberOfQuads:function(t,e){var i=this;if(e=e||0,0!==t&&i.texture&&i.texture.isLoaded()){var n=cc._renderContext;cc.gl.bindTexture2D(i.texture),n.bindBuffer(n.ARRAY_BUFFER,i._quadsWebBuffer),n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),n.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),i.dirty&&(n.bufferData(n.ARRAY_BUFFER,i._quadsArrayBuffer,n.DYNAMIC_DRAW),i.dirty=!1),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._buffersVBO[1]),cc.macro.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?n.drawElements(n.TRIANGLE_STRIP,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT):n.drawElements(n.TRIANGLES,6*t,n.UNSIGNED_SHORT,6*e*i._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++}}})}),cc.TextureAtlas=e.exports=o},{"../CCGame":36,"../platform/_CCClass":138,"../platform/js":145}],159:[function(t,e,i){var n=t("../CCGame"),r=t("./CCTexture2D"),s={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},handleLoadedTexture:null,_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache.textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},getAllTextures:function(){var t=[];for(var e in this._textures){var i=this._textures[e];t.push(i)}return t},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){if("string"==typeof t){var e=this._textures;e[t]&&(e[t].releaseTexture(),delete e[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.invalidKey),e instanceof r)return void(this._textures[t]=e);var i=new r;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i},addUIImage:function(t,e){if(cc.assert(t,cc._LogInfos.textureCache.addUIImage_2),e&&this._textures[e])return this._textures[e];var i=new r;return i.initWithImage(t),null!=e?this._textures[e]=i:cc.log(cc._LogInfos.textureCache.addUIImage),i},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];t++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo,n,r.getHtmlElementObj().src,r.getPixelWidth(),r.getPixelHeight()):cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,r.getPixelWidth(),r.getPixelHeight()),e+=r.getPixelWidth()*r.getPixelHeight()*4}var s=this._textureColorsCache;for(n in s){var o=s[n];for(var a in o){var c=o[a];t++,cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_2,n,c.width,c.height),e+=c.width*c.height*4}}cc.log(cc._LogInfos.textureCache.dumpCachedTextureInfo_3,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}};n.once(n.EVENT_RENDERER_INITED,function(){var t=s;cc._renderType===n.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(cc.assert(t,cc._LogInfos.textureCache.invalidKey),i=e[t]=new r,i.url=t),i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage);var n=this._textures,o=n[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o):(o=n[t]=new r,o.url=t,cc.loader.load(t,function(n,r){return n?e&&e.call(i,n||new Error("Unknown error")):(s.handleLoadedTexture(t),void(e&&e.call(i,o)))}),o)},t.addImageAsync=t.addImage):cc._renderType===n.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){var e,i,n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore),e=n[t],e||(cc.assert(t,cc._LogInfos.textureCache.invalidKey),e=n[t]=new r,e.url=t),i=cc.macro.AUTO_PREMULTIPLIED_ALPHA_FOR_PNG&&".png"===cc.path.extname(t),e.handleLoadedTexture(i)},t.addImage=function(t,e,i){cc.assert(t,cc._LogInfos.Texture2D.addImage_2);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var o=n[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",function(){e&&e.call(i,o)},i),o):(o=n[t]=new r,o.url=t,cc.loader.load(t,function(n,r){return n?e&&e.call(i,n||new Error("Unknown error")):(s.handleLoadedTexture(t),void(e&&e.call(i,o)))}),o)},t.addImageAsync=t.addImage)}),cc.textureCache=e.exports=s},{"../CCGame":36,"./CCTexture2D":157}],160:[function(t,e,i){t("./CCTexture2D"),t("./CCTextureAtlas"),t("./CCTextureCache")},{"./CCTexture2D":157,"./CCTextureAtlas":158,"./CCTextureCache":159}],161:[function(t,e,i){t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=n.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g,r=n.exec(t.replace(/(\/|\\\\)$/,""));if(!r)return null;var s=r[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?s.substring(0,s.length-e.length):s},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),
i<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",s=i?this.extname(t):"";return n>0&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=n<=0?0:n+1,t.substring(0,n)+e+s+r},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(r,"");while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",_setEndWithSep:function(t,e){var i=cc.path.sep;"undefined"==typeof e?e=!0:"string"==typeof e&&(i=e,e=!!e);var n=t[t.length-1],r="\\"===n||"/"===n;return!r&&e?t+=i:r&&!e&&(t=t.slice(0,-1)),t}},e.exports=cc.path},{"../platform/CCSys":135}],162:[function(t,e,i){cc.profiler=function(){var t=!1,e=!1,i=0,n=0,r=0,s=0,o=null,a=null,c=null,h=null,l=.6,u=10,d=[0,10,20,30],_=[0,0,0,0],f=3,p=0,g=0,m=function(){o=document.createElement("div"),a=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),h.id="fps",h.style.position="absolute",h.style.padding="3px",h.style.textAlign="left",h.style.backgroundColor="rgb(0, 0, 34)",h.style.bottom=cc.macro.DIRECTOR_STATS_POSITION.y+"0px",h.style.left=cc.macro.DIRECTOR_STATS_POSITION.x+"px",h.style.width="45px",h.style.height="60px";for(var t=[c,a,o],e=0;e<3;++e){var i=t[e].style;i.color="rgb(0, 255, 255)",i.font="bold 12px Helvetica, Arial",i.lineHeight="20px",i.width="100%",h.appendChild(t[e])}},v=function(t){var e,i=d.length-1,n=i,r=0;for(p++,g+=t;n>=0;n--)if(t>=d[n]){_[n]++;break}if(p>=u){for(r=g/u,n=i;n>0;n--)if(e=_[n]/u,e>=l&&r>=d[n]){n!==f&&(f=n,T.onFrameRateChange&&T.onFrameRateChange(r.toFixed(2)));break}for(p=0,g=0,n=i;n>0;n--)_[n]=0}},y=function(){r=cc.director.getSecondsPerFrame(),i++,s+=cc.director.getDeltaTime(),s>cc.macro.DIRECTOR_FPS_INTERVAL&&(n=i/s,i=0,s=0,T.onFrameRateChange&&v(n),e&&(a.innerText=r.toFixed(3),o.innerText=n.toFixed(1),c.innerText=(0|cc.g_NumberOfDraws).toString()))},T={onFrameRateChange:null,getSecondsPerFrame:function(){return r},getFrameRate:function(){return n},setProfileDuration:function(t){!isNaN(t)&&t>0&&(u=t/cc.macro.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.director.on(cc.Director.EVENT_AFTER_VISIT,y)},stopProfiling:function(){cc.director.off(cc.Director.EVENT_AFTER_VISIT,y)},isShowingStats:function(){return e},showStats:function(){t||this.init(),null===h.parentElement&&cc.container.appendChild(h),e=!0},hideStats:function(){e=!1,h&&h.parentElement===cc.container&&cc.container.removeChild(h)},init:function(){t||(m(),this.resumeProfiling(),t=!0)}};return T}(),e.exports=cc.profiler},{}],163:[function(t,e,i){function n(t){var e=t._parent;e._reorderChildDirty=!0,e._delaySort(),cc.eventManager._setDirtyForNode(t)}var r=t("./scene-graph-helper"),s=t("../platform/CCObject").Flags.Destroying,o=t("./misc"),a=(o.DirtyFlags,t("../platform/id-generater")),c="position-changed",h="size-changed",l="anchor-changed",u="child-added",d="child-removed",_="child-reorder",f=new a("Node"),p=cc.Class({name:"cc._BaseNode","extends":cc.Object,mixins:[cc.EventTarget],properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_parent:null,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_children:[],_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_tag:cc.macro.NODE_TAG_INVALID,_opacityModifyRGB:!1,name:{get:function(){return this._name},set:function(t){this._name=t}},parent:{get:function(){return this._parent},set:function(t){if(this._parent!==t){var e=this._sgNode;e.parent&&e.parent.removeChild(e,!1);var i=this._parent;if(this._parent=t||null,t){var r=t._sgNode;r.addChild(e),n(this),t._children.push(this),t.emit(u,this)}if(i){if(!(i._objFlags&s)){var o=i._children.indexOf(this);i._children.splice(o,1),i.emit(d,this),this._onHierarchyChanged(i)}}else t&&this._onHierarchyChanged(null)}}},_id:{"default":"",editorOnly:!0},uuid:{get:function(){var t=this._id;return t||(t=this._id=f.getNewId()),t}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},zIndex:{get:function(){return this._localZOrder},set:function(t){this._localZOrder!==t&&(this._localZOrder=t,this._sgNode.zIndex=t,this._parent&&n(this))}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node.getRotation),this._rotationX},set:function(t){this._rotationX===t&&this._rotationY===t||(this._rotationX=this._rotationY=t,this._sgNode.rotation=t)}},rotationX:{get:function(){return this._rotationX},set:function(t){this._rotationX!==t&&(this._rotationX=t,this._sgNode.rotationX=t)}},rotationY:{get:function(){return this._rotationY},set:function(t){this._rotationY!==t&&(this._rotationY=t,this._sgNode.rotationY=t)}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._sgNode.scaleX=t)}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._sgNode.scaleY=t)}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x){e.x=t,this._sgNode.setPositionX(t);var i=this._capturingListeners&&this._capturingListeners._callbackTable[c],n=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(i&&i.length>0||n&&n.length>0)&&this.emit(c)}}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y){e.y=t,this._sgNode.setPositionY(t);var i=this._capturingListeners&&this._capturingListeners._callbackTable[c],n=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(i&&i.length>0||n&&n.length>0)&&this.emit(c)}}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;if(e.x!==t){e.x=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(l)}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;if(e.y!==t){e.y=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(l)}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){var e=this._sizeProvider;e&&e.setContentSize(t,e._getHeight());this._contentSize.width=t,this.emit(h)}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){var e=this._sizeProvider;e&&e.setContentSize(e._getWidth(),t);this._contentSize.height=t,this.emit(h)}}},_ignoreAnchor:{get:function(){return this.__ignoreAnchor},set:function(t){if(this.__ignoreAnchor!==t){this.__ignoreAnchor=t,this._sgNode.ignoreAnchor=t;var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&(e.ignoreAnchor=t),this.emit(l)}}},tag:{get:function(){return this._tag},set:function(t){this._tag=t,this._sgNode.tag=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t&&(this._opacity=t,this._sgNode.setOpacity(t),!this._cascadeOpacityEnabled)){var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacity(t)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t){this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t;var e=t?255:this._opacity,i=this._sizeProvider;i instanceof _ccsg.Node&&i.setOpacity(e)}}},color:{get:function(){var t=this._color;return new cc.Color(t.r,t.g,t.b,t.a)},set:function(t){if(!this._color.equals(t)){var e=this._color;e.r=t.r,e.g=t.g,e.b=t.b,this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(t)}}}},ctor:function(){var t=this._sgNode=new _ccsg.Node;cc.game._isCloning||(t.cascadeOpacity=!0),this._sizeProvider=null,this.__ignoreAnchor=!1,this._reorderChildDirty=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},_onPreDestroy:function(){cc.eventManager.removeListeners(this);for(var t=0,e=this.__eventTargets.length;t<e;++t){var i=this.__eventTargets[t];i&&i.targetOff(this)}cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_destruct:o.destructIgnoreId,_onHierarchyChanged:null,init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node.getScale),this._scaleX},setScale:function(t,e){"object"==typeof t?(e=t.y,t=t.x):e=e||0===e?e:t,this._scaleX===t&&this._scaleY===e||(this._scaleX=t,this._scaleY=e,this._sgNode.setScale(t,e))},getPosition:function(){return cc.p(this._position)},setPosition:function(t,e){var i;"undefined"==typeof e?(i=t.x,e=t.y):(i=t,e=e);var n=this._position;if(n.x!==i||n.y!==e){n.x=i,n.y=e,this._sgNode.setPosition(i,e);var r=this._capturingListeners&&this._capturingListeners._callbackTable[c],s=this._bubblingListeners&&this._bubblingListeners._callbackTable[c];(r&&r.length>0||s&&s.length>0)&&this.emit(c)}},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}var n=this._sizeProvider;n instanceof _ccsg.Node&&n.setAnchorPoint(i),this.emit(l)},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,e}return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._sizeProvider&&this._sizeProvider.setContentSize(i),this.emit(h)},getBoundingBox:function(){var t=this.getContentSize(),e=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},cleanup:function(){cc.director.getActionManager().removeAllActionsFromTarget(this),cc.eventManager.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)e=this._children[t],e&&e.cleanup()},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;"undefined"==typeof i?(i=void 0,n=t._name):cc.js.isString(i)?(n=i,i=void 0):cc.js.isNumber(i)&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node.addChild_3),cc.assert(null===t._parent,"child already added. It can't be added again"),t.parent=this,t.zIndex=e,r?t.setTag(i):t.setName(n)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){this._children.indexOf(t)>-1&&((e||void 0===e)&&t.cleanup(),t.parent=null)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node.removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node.removeChildByTag_2,t)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;i>=0;i--){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},setNodeDirty:function(){this._sgNode.setNodeDirty()},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},_isSgTransformArToMe:function(t){var e=this._sgNode.getContentSize();return 0===e.width&&0===e.height&&(0!==t.width||0!==t.height)||!!this._sgNode.isIgnoreAnchorPointForPosition()},getNodeToWorldTransform:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransformAR:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},convertToNodeSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.convertToNodeSpace(t);return cc.pAdd(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=t.x-this._anchorPoint.x*this._contentSize.width,i=t.y-this._anchorPoint.y*this._contentSize.height;return cc.v2(this._sgNode.convertToWorldSpace(cc.v2(e,i)))},convertToNodeSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(t)):this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(t)):cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},getNodeToParentTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToParentTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getBoundingBoxToWorld:function(){var t;return this.parent&&(t=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var e=this.getContentSize(),i=e.width,n=e.height,r=cc.rect(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),s=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(r,s),!this._children)return r;for(var o=this._children,a=0;a<o.length;a++){var c=o[a];if(c&&c.active){var h=c._getBoundingBoxTo(s);h&&(r=cc.rectUnion(r,h))}}return r},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t);var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=t!==-1?t:e.length-1;var i=e.indexOf(this);if(t!==i){e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this);for(var n,r=this._parent,s=r._children,o=0,a=s.length;o<a;o++)n=s[o]._sgNode,n._arrivalOrder=o,cc.eventManager._setDirtyForNode(n);cc.renderer.childrenOrderDirty=!0,r._sgNode._reorderChildDirty=!0,r._reorderChildDirty=!0,r._delaySort()}}},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;if(t.length>1){var e,i,n,r=t.length;for(e=1;e<r;e++){for(n=t[e],i=e-1;i>=0;){if(n._localZOrder<t[i]._localZOrder)t[i+1]=t[i];else{if(!(n._localZOrder===t[i]._localZOrder&&n._sgNode._arrivalOrder<t[i]._sgNode._arrivalOrder))break;t[i+1]=t[i]}i--}t[i+1]=n}this.emit(_)}}cc.director.off(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_delaySort:function(){cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)},_updateDummySgNode:function(){var t=this,e=t._sgNode;e.setPosition(t._position),e.setRotationX(t._rotationX),e.setRotationY(t._rotationY),e.setScale(t._scaleX,t._scaleY),e.setSkewX(t._skewX),e.setSkewY(t._skewY),e.setIgnoreAnchorPointForPosition(t.__ignoreAnchor);var i=e._arrivalOrder;e.setLocalZOrder(t._localZOrder),e._arrivalOrder=i,e.setGlobalZOrder(t._globalZOrder),e.setOpacity(t._opacity),e.setOpacityModifyRGB(t._opacityModifyRGB),e.setCascadeOpacityEnabled(t._cascadeOpacityEnabled),e.setTag(t._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color),this._activeInHierarchy?(cc.director.getActionManager().resumeTarget(this),cc.eventManager.resumeTarget(this)):(cc.director.getActionManager().pauseTarget(this),cc.eventManager.pauseTarget(this))},onRestore:!1,_removeSgNode:r.removeSgNode}),g=["name","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","opacity","color","tag"],m={x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"]};o.propertyDefine(p,g,m),cc._BaseNode=e.exports=p},{"../platform/CCObject":132,"../platform/id-generater":142,"./misc":166,"./scene-graph-helper":169}],164:[function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.error("Argument must be non-nil"),null;if(!e){var i=cc.director.getScene();if(!i)return null;e=i}for(var n=e,r="/"!==t[0]?0:1,s=t.split("/"),o=r;o<s.length;o++){var a=s[o],c=n._children;n=null;for(var h=0,l=c.length;h<l;++h){var u=c[h];if(u.name===a){n=u;break}}if(!n)return null}return n}},{}],165:[function(t,e,i){t("./CCPath"),t("./CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":161,"./CCProfiler":162,"./find":164,"./mutable-forward-iterator":167}],166:[function(t,e,i){var n={};n.propertyDefine=function(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set);else{var s=t[i];cc.js.getset(t,e,s,t[n])}}for(var r,s=t.prototype,o=0;o<e.length;o++){r=e[o];var a=r[0].toUpperCase()+r.slice(1);n(s,r,"get"+a,"set"+a)}for(r in i){var c=i[r];n(s,r,c[0],c[1])}},n.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1},n.destructIgnoreId=function(){for(var t in this)if(this.hasOwnProperty(t)&&"_id"!==t)switch(typeof this[t]){case"string":this[t]="";break;case"object":case"function":this[t]=null}},e.exports=n},{}],167:[function(t,e,i){function n(t){this.i=0,this.array=t}var r=n.prototype;r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=n},{}],168:[function(t,e,i){cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{"default":!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.error('Failed to load prefab asset for node "%s"',t.name),void(t._prefab=null);var i=t._objFlags,n=t._parent,r=t._id,s=t._name,o=t._active,a=t._position,c=t._rotationX,h=t._rotationY,l=t._localZOrder,u=t._globalZOrder,d=e.asset.data;d._prefab._synced=!0,d._iN$t=t,cc.game._isCloning=!0,cc.instantiate._clone(d,d),cc.game._isCloning=!1,t._objFlags=i,t._parent=n,t._id=r,t._prefab=e,t._name=s,t._active=o,t._position=a,t._rotationX=c,t._rotationY=h,t._localZOrder=l,t._globalZOrder=u}}},{}],169:[function(t,e,i){var n={removeSgNode:function(){var t=this._sgNode;if(t){var e=t._parent;e&&e.removeChild(t),t.release(),this._sgNode._entity&&(this._sgNode._entity=null)}}};e.exports=n},{}],170:[function(t,e,i){cc.AffineTransform=function(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s},cc.affineTransformMake=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;return void 0===i?(i=e,n=t.x,r=t.y):(n=t,r=e),{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=t.x,n=t.y,r=i+t.width,s=n+t.height,o=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*s+e.tx,u=e.b*i+e.d*s+e.ty,d=e.a*r+e.c*s+e.tx,_=e.b*r+e.d*s+e.ty,f=Math.min(o,c,l,d),p=Math.max(o,c,l,d),g=Math.min(a,h,u,_),m=Math.max(a,h,u,_);return cc.rect(f,g,p-f,m-g)},cc._rectApplyAffineTransformIn=function(t,e){var i=t.x,n=t.y,r=i+t.width,s=n+t.height,o=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*s+e.tx,u=e.b*i+e.d*s+e.ty,d=e.a*r+e.c*s+e.tx,_=e.b*r+e.d*s+e.ty,f=Math.min(o,c,l,d),p=Math.max(o,c,l,d),g=Math.min(a,h,u,_),m=Math.max(a,h,u,_);return t.x=f,t.y=g,t.width=p-f,t.height=m-g,t},cc.obbApplyAffineTransform=function(t,e,i,n,r,s){var o=t.x,a=t.y,c=t.width,h=t.height,l=e.a*o+e.c*a+e.tx,u=e.b*o+e.d*a+e.ty,d=e.a*c,_=e.b*c,f=e.c*h,p=e.d*h;n.x=l,n.y=u,r.x=d+l,r.y=_+u,i.x=f+l,i.y=p+u,s.x=d+f+l,s.y=_+p+u},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.tx,a=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+s*e.c,t.d=r*e.b+s*e.d,t.tx=o*e.a+a*e.c+e.tx,t.ty=o*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}}},{}],171:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js"),s=function(){function e(t,e,i,n){"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),this.r=t||0,this.g=e||0,this.b=i||0,this.a="number"==typeof n?n:255}r.extend(e,n),t("../platform/CCClass").fastDefine("cc.Color",e,{r:0,g:0,b:0,a:255});var i={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var s in i){var o=function(t,i,n,r){return function(){return new e(t,i,n,r)}}.apply(null,i[s]);Object.defineProperty(e,s,{get:o})}return e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},e.prototype.lerp=function(t,i,n){n=n||new e;var r=this.r,s=this.g,o=this.b,a=this.a;return n.r=r+(t.r-r)*i,n.g=s+(t.g-s)*i,n.b=o+(t.b-o)*i,n.a=a+(t.a-a)*i,n},e.prototype.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},e.prototype.setR=function(t){return this.r=t,this},e.prototype.setG=function(t){return this.g=t,this},e.prototype.setB=function(t){return this.b=t,this},e.prototype.setA=function(t){return this.a=t,this},e.prototype.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},e.prototype.clamp=function(){this.r=cc.clampf(this.r,0,255),this.g=cc.clampf(this.g,0,255),this.b=cc.clampf(this.b,0,255),this.a=cc.clampf(this.a,0,255)},e.prototype.fromHEX=function(t){var e=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this.r=e>>16,this.g=(65280&e)>>8,this.b=255&e,this},e.prototype.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)e[i].length>1&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);return e.join("")},e.prototype.toRGBValue=function(){return(cc.clampf(this.r,0,255)<<16)+(cc.clampf(this.g,0,255)<<8)+cc.clampf(this.b,0,255)},e.prototype.fromHSV=function(t,i,n){var r=e.hsv2rgb(t,i,n);return this.r=r.r,this.g=r.g,this.b=r.b,this},e.prototype.toHSV=function(){return e.rgb2hsv(this.r,this.g,this.b)},e}();s.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i),o=0;return n.v=r,n.s=r?(r-s)/r:0,n.s?(o=r-s,t===r?n.h=(e-i)/o:e===r?n.h=2+(i-t)/o:n.h=4+(t-e)/o,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},s.hsv2rgb=function(t,e,i){var n={r:0,g:0,b:0};if(0===e)n.r=n.g=n.b=i;else if(0===i)n.r=n.g=n.b=0;else{1===t&&(t=0),t*=6,e=e,i=i;var r=Math.floor(t),s=t-r,o=i*(1-e),a=i*(1-e*s),c=i*(1-e*(1-s));switch(r){case 0:n.r=i,n.g=c,n.b=o;break;case 1:n.r=a,n.g=i,n.b=o;break;case 2:n.r=o,n.g=i,n.b=c;break;case 3:n.r=o,n.g=a,n.b=i;break;case 4:n.r=c,n.g=o,n.b=i;break;case 5:n.r=i,n.g=o,n.b=a}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=s,cc.color=function(t,e,i,n){if("string"==typeof t){var r=new cc.Color;return r.fromHEX(t)}return"object"==typeof t?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,i,n)},cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(65280&e)>>8,r=255&e;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},e.exports=cc.Color},{"../platform/CCClass":128,"../platform/js":145,"./CCValueType":178}],172:[function(t,e,i){cc.Enum=function(t){var e={};Object.defineProperty(e,"__enums__",{value:void 0,writable:!0});var i=-1;for(var n in t){var r=t[n];r===-1?r=++i:i=r,e[n]=r;var s=""+r;if(n!==s){if(e.hasOwnProperty(s),!1){cc.error("%s already defined in Enum.",s);continue}Object.defineProperty(e,s,{value:n})}}return e},cc.Enum.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},cc.Enum.getList=function(t){if(void 0!==t.__enums__)return t.__enums__;var e=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r="number"==typeof n&&(0|n)===n;r&&e.push({name:i,value:n})}return e.sort(function(t,e){return t.value-e.value}),t.__enums__=e,e};e.exports=cc.Enum},{}],173:[function(t,e,i){var n=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t<i?t:i},cc.clamp01=function(t){return t<0?0:t<1?t:1},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),r=cc.pNormalize(e),s=Math.atan2(i.x*r.y-i.y*r.x,cc.pDot(i,r));return Math.abs(s)<n?0:s},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<n?0:i},cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e),r=Math.cos(i),s=Math.sin(i),o=n.x;return n.x=o*r-n.y*s+e.x,n.y=o*s+n.y*r+e.y,n},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var s=e.x-t.x,o=e.y-t.y,a=n.x-i.x,c=n.y-i.y,h=t.x-i.x,l=t.y-i.y,u=c*s-a*o;return r.x=a*l-c*h,r.y=s*l-o*h,0===u?0===r.x||0===r.y:(r.x=r.x/u,r.y=r.y/u,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var s=cc.p(0,0);return s.x=t.x+r.x*(e.x-t.x),s.y=t.y+r.x*(e.y-t.y),s}return cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&(t.x===e.x&&t.y===e.y)},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}},{}],174:[function(t,e,i){function n(t,e,i,n){t&&"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Rect",n,{x:0,y:0,width:0,height:0}),n.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),r=Math.min(t.y,e.y),s=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return new n(i,r,s-i,o-r)},n.contain=function(t,e){return t.x<e.x&&t.x+t.width>e.x+e.width&&t.y<e.y&&t.y+t.height>e.y+e.height?1:e.x<t.x&&e.x+e.width>t.x+t.width&&e.y<t.y&&e.y+e.height>t.y+t.height?-1:0};var o=n.prototype;o.clone=function(){return new n(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.x,s=this.y,o=this.width,a=this.height;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(o,"xMin",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}}),Object.defineProperty(o,"yMin",{get:function(){return this.y;
},set:function(t){this.height+=this.y-t,this.y=t}}),Object.defineProperty(o,"xMax",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}}),Object.defineProperty(o,"yMax",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}}),Object.defineProperty(o,"center",{get:function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}}),Object.defineProperty(o,"size",{get:function(){return new cc.Size(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<t.x&&this.x+this.width>t.x&&this.y<t.y&&this.y+this.height>t.y},o.containsRect=function(t){return this.x<t.x&&this.x+this.width>t.x+t.width&&this.y<t.y&&this.y+this.height>t.y+t.height},cc.Rect=n,cc.rect=function(t,e,i,r){return new n(t,e,i,r)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e)&&!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,s=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||s<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect},{"../platform/CCClass":128,"../platform/js":145,"./CCValueType":178}],175:[function(t,e,i){function n(t,e){t&&"object"==typeof t&&(e=t.height,t=t.width),this.width=t||0,this.height=e||0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Size",n,{width:0,height:0}),s.get(n,"ZERO",function(){return new n(0,0)});var o=n.prototype;o.clone=function(){return new n(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.width,s=this.height;return i.width=r+(t.width-r)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new n(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=n},{"../platform/CCClass":128,"../platform/js":145,"./CCValueType":178}],176:[function(t,e,i){cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e};var n=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(n.ONE,n.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE)},cc.BlendFunc.BlendFactor=n,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TextAlignment.CENTER,e.verticalAlign=cc.VerticalTextAlignment.TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"},cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),cc._Dictionary=cc.Class({ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|10*Math.random())},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(null!=e){var i=this.__getKey();this._keyMapTb[i]=e,this._valueMapTb[i]=t}},objectForKey:function(t){if(null==t)return null;var e=this._keyMapTb;for(var i in e)if(e[i]===t)return this._valueMapTb[i];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(null!=t){var e=this._keyMapTb;for(var i in e)if(e[i]===t)return delete this._valueMapTb[i],void delete e[i]}},removeObjectsForKeys:function(t){if(null!=t)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var i in e)t.push(e[i]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}})},{}],177:[function(t,e,i){cc.WebGLColor=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._view=new Uint8Array(o,a,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,"number"==typeof n?this._view[3]=n:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4;var n=cc.WebGLColor.prototype;n._getR=function(){return this._view[0]},n._setR=function(t){this._view[0]=t<0?0:t},n._getG=function(){return this._view[1]},n._setG=function(t){this._view[1]=t<0?0:t},n._getB=function(){return this._view[2]},n._setB=function(t){this._view[2]=t<0?0:t},n._getA=function(){return this._view[3]},n._setA=function(t){this._view[3]=t<0?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8;var n=cc.Vertex2F.prototype;n._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._view=new Float32Array(s,o,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,n=cc.Vertex3F.prototype,n._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},n._getZ=function(){return this._view[2]},n._setZ=function(t){this._view[2]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,n=cc.Tex2F.prototype,n._getU=function(){return this._view[0]},n._setU=function(t){this._view[0]=t},n._getV=function(){return this._view[1]},n._setV=function(t){this._view[1]=t},cc.js.getset(n,"u",n._getU,n._setU),cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._tr=e?new cc.Vertex2F(e.x,e.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._bl=i?new cc.Vertex2F(i.x,i.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._br=n?new cc.Vertex2F(n.x,n.y,o,a):new cc.Vertex2F(0,0,o,a)},cc.Quad2.BYTES_PER_ELEMENT=32,n=cc.Quad2.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,o,a):new cc.Vertex3F(0,0,0,o,a)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,o):new cc.Vertex3F(0,0,0,s,o),o+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,n=cc.V3F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,n=cc.V3F_C4B_T2F_Quad.prototype,n._getTL=function(){return this._tl},n._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,o):new cc.Vertex2F(0,0,s,o),o+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,n=cc.V2F_C4B_T2F.prototype,n._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,n=cc.V2F_C4B_T2F_Triangle.prototype,n._getA=function(){return this._a},n._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.js.getset(n,"a",n._getA,n._setA),cc.js.getset(n,"b",n._getB,n._setB),cc.js.getset(n,"c",n._getC,n._setC)},{}],178:[function(t,e,i){function n(){}var r=t("../platform/js");r.setClassName("cc.ValueType",n),r.mixin(n.prototype,{clone:!1,equals:!1,toString:function(){return""+{}},lerp:!1}),cc.ValueType=n,e.exports=n},{"../platform/js":145}],179:[function(t,e,i){function n(t,e){t&&"object"==typeof t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0}var r=t("./CCValueType"),s=t("../platform/js"),o=t("../platform/CCClass");s.extend(n,r),o.fastDefine("cc.Vec2",n,{x:0,y:0}),s.mixin(n.prototype,{clone:function(){return new n(this.x,this.y)},set:function(t){return this.x=t.x,this.y=t.y,this},equals:function(t){return t&&this.x===t.x&&this.y===t.y},toString:function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},lerp:function(t,e,i){i=i||new n;var r=this.x,s=this.y;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,e){return e=e||new n,e.x=this.x+t.x,e.y=this.y+t.y,e},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,e){return e=e||new n,e.x=this.x-t.x,e.y=this.y-t.y,e},mulSelf:function(t){return this.x*=t,this.y*=t,this},mul:function(t,e){return e=e||new n,e.x=this.x*t,e.y=this.y*t,e},scaleSelf:function(t){return this.x*=t.x,this.y*=t.y,this},scale:function(t,e){return e=e||new n,e.x=this.x*t.x,e.y=this.y*t.y,e},divSelf:function(t){return this.x/=t,this.y/=t,this},div:function(t,e){return e=e||new n,e.x=this.x/t,e.y=this.y/t,e},negSelf:function(){return this.x=-this.x,this.y=-this.y,this},neg:function(t){return t=t||new n,t.x=-this.x,t.y=-this.y,t},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.y*t.x-this.x*t.y},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSqr:function(){return this.x*this.x+this.y*this.y},normalizeSelf:function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},normalize:function(t){return t=t||new n,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},angle:function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t),r=n/Math.sqrt(e*i);return r=cc.clampf(r,-1,1),Math.acos(r)},signAngle:function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},rotate:function(t,e){return e=e||new n,e.x=this.x,e.y=this.y,e.rotateSelf(t)},rotateSelf:function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x;return this.x=i*n-e*this.y,this.y=e*n+i*this.y,this}}),s.get(n,"ONE",function(){return new n(1,1)}),s.get(n,"ZERO",function(){return new n(0,0)}),s.get(n,"UP",function(){return new n(0,1)}),s.get(n,"RIGHT",function(){return new n(1,0)}),cc.Vec2=n,cc.v2=function(t,e){return new n(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2},{"../platform/CCClass":128,"../platform/js":145,"./CCValueType":178}],180:[function(t,e,i){t("./CCValueType"),t("./CCEnum"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":170,"./CCColor":171,"./CCEnum":172,"./CCPointExtension":173,"./CCRect":174,"./CCSize":175,"./CCTypes":176,"./CCTypesWebGL":177,"./CCValueType":178,"./CCVec2":179}],181:[function(require,module,exports){function deprecateEnum(obj,oldPath,newPath,hasTypePrefixBefore){hasTypePrefixBefore=hasTypePrefixBefore!==!1;for(var enumDef=eval(newPath),entries=cc.Enum.getList(enumDef),delimiter=hasTypePrefixBefore?"_":".",i=0;i<entries.length;i++){var entry=entries[i].name,oldPropName;if(hasTypePrefixBefore){var oldTypeName=oldPath.split(".").slice(-1)[0];oldPropName=oldTypeName+"_"+entry}else oldPropName=entry;js.get(obj,oldPropName,function(t){return cc.warn(INFO,oldPath+delimiter+t,newPath+"."+t),enumDef[t]}.bind(null,entry))}}function markAsRemoved(t,e,i){i=i||js.getClassName(t),e.forEach(function(e){function n(){cc.error("Sorry, %s.%s is removed.",i,e)}js.getset(t.prototype,e,n,n)})}function provideClearError(t,e,i){function n(e,i){function n(t){cc.error(s,e,t)}Array.isArray(i)||(i=i.split(",").map(function(t){return t.trim()})),js.getset(t,e,n.bind(null,i[0]),i[1]&&n.bind(null,i[1]))}var r=i||cc.js.getClassName(t),s="Sorry, "+r+".%s is removed, please use %s instead.";for(var o in e){var a=e[o];if("*"===o[0]){var c=o.slice(1);n("g"+c,a),n("s"+c,a)}else o.split(",").map(function(t){return t.trim()}).forEach(function(t){n(t,a)})}}function shouldNotUseNodeProp(t){var e=t.prototype;for(var i in cc.Node.prototype)!function(t){t in e||"_"===t[0]||Object.defineProperty(e,t,{get:function(){var e=cc.js.getClassName(this),i="Sorry, "+e+".%s is undefined, please use cc.Node.%s instead.";cc.error(i,t,t)},enumerable:!1,configurable:!0})}(i)}var js,INFO,ERR},{}],182:[function(t,e,i){cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t}},{}],183:[function(t,e,i){cc.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]};var n=cc.math.Matrix4Stack.prototype;n.initialize=function(){this.stack.length=0,this.top=null},n.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t)},n.pop=function(){this.top=this.stack.pop()},n.release=function(){this.stack=null,this.top=null,this._matrixPool=null},n._getFromPool=function(t){var e=this._matrixPool;if(0===e.length)return new cc.math.Matrix4(t);var i=e.pop();return i.assignFrom(t),i},n._putInPool=function(t){this._matrixPool.push(t)}},{}],184:[function(t,e,i){var n=cc.math;n.KM_GL_MODELVIEW=5888,n.KM_GL_PROJECTION=5889,n.KM_GL_TEXTURE=5890,n.modelview_matrix_stack=new n.Matrix4Stack,n.projection_matrix_stack=new n.Matrix4Stack,n.texture_matrix_stack=new n.Matrix4Stack,cc.current_stack=null;var r=!1,s=function(){if(!r){var t=new n.Matrix4;n.modelview_matrix_stack.initialize(),n.projection_matrix_stack.initialize(),n.texture_matrix_stack.initialize(),cc.current_stack=n.modelview_matrix_stack,r=!0,t.identity(),n.modelview_matrix_stack.push(t),n.projection_matrix_stack.push(t),n.texture_matrix_stack.push(t)}};s(),n.glFreeAll=function(){n.modelview_matrix_stack.release(),n.modelview_matrix_stack=null,n.projection_matrix_stack.release(),n.projection_matrix_stack=null,n.texture_matrix_stack.release(),n.texture_matrix_stack=null,r=!1,cc.current_stack=null},n.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top)},n.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t},n.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},n.glMatrixMode=function(t){switch(t){case n.KM_GL_MODELVIEW:cc.current_stack=n.modelview_matrix_stack;break;case n.KM_GL_PROJECTION:cc.current_stack=n.projection_matrix_stack;break;case n.KM_GL_TEXTURE:cc.current_stack=n.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},n.glLoadIdentity=function(){cc.current_stack.top.identity()},n.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t)},n.glMultMatrix=function(t){cc.current_stack.top.multiply(t)};var o=new n.Matrix4;n.glTranslatef=function(t,e,i){var r=n.Matrix4.createByTranslation(t,e,i,o);cc.current_stack.top.multiply(r)};var a=new n.Vec3;n.glRotatef=function(t,e,i,r){a.fill(e,i,r);var s=n.Matrix4.createByAxisAndAngle(a,cc.degreesToRadians(t),o);cc.current_stack.top.multiply(s)},n.glScalef=function(t,e,i){var r=n.Matrix4.createByScale(t,e,i,o);cc.current_stack.top.multiply(r)},n.glGetMatrix=function(t,e){switch(t){case n.KM_GL_MODELVIEW:e.assignFrom(n.modelview_matrix_stack.top);break;case n.KM_GL_PROJECTION:e.assignFrom(n.projection_matrix_stack.top);break;case n.KM_GL_TEXTURE:e.assignFrom(n.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],185:[function(t,e,i){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")},{"./aabb":182,"./gl/mat4stack":183,"./gl/matrix":184,"./mat3":186,"./mat4":187,"./plane":188,"./quaternion":189,"./ray2":190,"./utility":191,"./vec2":192,"./vec3":193,"./vec4":194}],186:[function(t,e,i){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)};var n=cc.math.Matrix3.prototype;n.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return t[0]=s*h-o*c,t[1]=n*c-i*h,t[2]=i*o-n*s,t[3]=o*a-r*h,t[4]=e*h-n*a,t[5]=n*r-e*o,t[6]=r*c-s*a,t[8]=e*s-i*r,this},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var r=new cc.math.Matrix3;n.inverse=function(t){if(0===t)return this;r.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],o=t[7];return t[1]=n,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},n.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=i[0],_=i[1],f=i[2],p=i[3],g=i[4],m=i[5],v=i[6],y=i[7],T=i[8];return e[0]=n*d+o*_+h*f,e[1]=r*d+a*_+l*f,e[2]=s*d+c*_+u*f,e[3]=s*d+c*_+u*f,e[4]=r*p+a*g+l*m,e[5]=s*p+c*g+u*m,e[6]=n*v+o*y+h*T,e[7]=r*v+a*y+l*T,e[8]=s*v+c*y+u*T,this},n.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,e){var i=Math.cos(e),n=Math.sin(e),r=new cc.math.Matrix3,s=r.mat;return s[0]=i+t.x*t.x*(1-i),s[1]=t.z*n+t.y*t.x*(1-i),s[2]=-t.y*n+t.z*t.x*(1-i),s[3]=-t.z*n+t.x*t.y*(1-i),s[4]=i+t.y*t.y*(1-i),s[5]=t.x*n+t.z*t.y*(1-i),s[6]=t.y*n+t.x*t.z*(1-i),s[7]=-t.x*n+t.y*t.z*(1-i),s[8]=i+t.z*t.z*(1-i),r},n.assignFrom=function(t){if(this===t)return cc.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.equals=function(t){if(this===t)return!0;for(var e=cc.math.EPSILON,i=this.mat,n=t.mat,r=0;r<9;++r)if(!(i[r]+e>n[r]&&i[r]-e<n[r]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=Math.cos(t),i[5]=Math.sin(t),i[6]=0,i[7]=-Math.sin(t),i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationY=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[4]=1,i[5]=0,i[6]=Math.sin(t),i[7]=0,i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationZ=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=-Math.sin(t),i[2]=0,i[3]=Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByRotation=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[2]=0,i[3]=-Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByScale=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[0]=t,i.mat[4]=e,i},cc.math.Matrix3.createByTranslation=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[6]=t,i.mat[7]=e,i},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var e=new cc.math.Matrix3,i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y-t.w*t.z),i[2]=2*(t.x*t.z+t.w*t.y),i[3]=2*(t.x*t.y+t.w*t.z),i[4]=1-2*(t.x*t.x+t.z*t.z),i[5]=2*(t.y*t.z-t.w*t.x),i[6]=2*(t.x*t.z-t.w*t.y),i[7]=2*(t.y*t.z+t.w*t.x),i[8]=1-2*(t.x*t.x+t.y*t.y),e},n.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],187:[function(t,e,i){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var n=cc.math.Matrix4.prototype;n.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},n.get=function(t,e){return this.mat[t+4*e]},n.set=function(t,e,i){this.mat[t+4*e]=i},n.swap=function(t,e,i,n){var r=this.mat,s=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=s},cc.math.Matrix4._gaussj=function(t,e){var i,n,r,s,o,a,c,h,l,u=0,d=0,_=4,f=4,p=[0,0,0,0],g=[0,0,0,0],m=[0,0,0,0];for(i=0;i<_;i++){for(c=0,n=0;n<_;n++)if(1!==m[n])for(r=0;r<_;r++)0===m[r]&&(a=Math.abs(t.get(n,r)),a>=c&&(c=a,d=n,u=r));if(++m[u],d!==u){for(s=0;s<_;s++)t.swap(d,s,u,s);for(s=0;s<f;s++)e.swap(d,s,u,s)}if(g[i]=d,p[i]=u,0===t.get(u,u))return!1;for(l=1/t.get(u,u),t.set(u,u,1),s=0;s<_;s++)t.set(u,s,t.get(u,s)*l);for(s=0;s<f;s++)e.set(u,s,e.get(u,s)*l);for(o=0;o<_;o++)if(o!==u){for(h=t.get(o,u),t.set(o,u,0),s=0;s<_;s++)t.set(o,s,t.get(o,s)-t.get(u,s)*h);for(s=0;s<f;s++)e.set(o,s,t.get(o,s)-e.get(u,s)*h)}}for(s=_-1;s>=0;s--)if(g[s]!==p[s])for(r=0;r<_;r++)t.swap(r,g[s],r,p[s]);return!0};var r=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,e){var i=new cc.math.Matrix4(e),n=new cc.math.Matrix4(r);return cc.math.Matrix4._gaussj(i,n)===!1?null:(t.assignFrom(i),t)},n.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(r);return cc.math.Matrix4._gaussj(t,e)===!1?null:t},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],s=t[6],o=t[7],a=t[8],c=t[9],h=t[11],l=t[12],u=t[13],d=t[14];return t[1]=r,t[2]=a,t[3]=l,t[4]=e,t[6]=c,t[7]=u,t[8]=i,t[9]=s,t[11]=d,t[12]=n,t[13]=o,t[14]=h,this},cc.math.mat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,s=i.mat,o=r[0],a=r[1],c=r[2],h=r[3],l=r[4],u=r[5],d=r[6],_=r[7],f=r[8],p=r[9],g=r[10],m=r[11],v=r[12],y=r[13],T=r[14],C=r[15],b=s[0],x=s[1],S=s[2],E=s[3],A=s[4],O=s[5],w=s[6],R=s[7],I=s[8],P=s[9],N=s[10],L=s[11],F=s[12],D=s[13],M=s[14],B=s[15];return n[0]=b*o+x*l+S*f+E*v,n[1]=b*a+x*u+S*p+E*y,n[2]=b*c+x*d+S*g+E*T,n[3]=b*h+x*_+S*m+E*C,n[4]=A*o+O*l+w*f+R*v,n[5]=A*a+O*u+w*p+R*y,n[6]=A*c+O*d+w*g+R*T,n[7]=A*h+O*_+w*m+R*C,n[8]=I*o+P*l+N*f+L*v,n[9]=I*a+P*u+N*p+L*y,n[10]=I*c+P*d+N*g+L*T,n[11]=I*h+P*_+N*m+L*C,n[12]=F*o+D*l+M*f+B*v,n[13]=F*a+D*u+M*p+B*y,n[14]=F*c+D*d+M*g+B*T,n[15]=F*h+D*_+M*m+B*C,t},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=e[9],_=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],y=i[0],T=i[1],C=i[2],b=i[3],x=i[4],S=i[5],E=i[6],A=i[7],O=i[8],w=i[9],R=i[10],I=i[11],P=i[12],N=i[13],L=i[14],F=i[15];
return e[0]=y*n+T*a+C*u+b*p,e[1]=y*r+T*c+C*d+b*g,e[2]=y*s+T*h+C*_+b*m,e[3]=y*o+T*l+C*f+b*v,e[4]=x*n+S*a+E*u+A*p,e[5]=x*r+S*c+E*d+A*g,e[6]=x*s+S*h+E*_+A*m,e[7]=x*o+S*l+E*f+A*v,e[8]=O*n+w*a+R*u+I*p,e[9]=O*r+w*c+R*d+I*g,e[10]=O*s+w*h+R*_+I*m,e[11]=O*o+w*l+R*f+I*v,e[12]=P*n+N*a+L*u+F*p,e[13]=P*r+N*c+L*d+F*g,e[14]=P*s+N*h+L*_+F*m,e[15]=P*o+N*l+L*f+F*v,this},cc.math.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},cc.math.mat4Assign=function(t,e){if(t===e)return cc.log("cc.math.mat4Assign(): pOut equals pIn"),t;var i=t.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],t},n.assignFrom=function(t){if(this===t)return cc.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},n.equals=function(t){if(this===t)return cc.log("cc.math.Matrix4 equal: pMat1 and pMat2 are same object."),!0;for(var e=this.mat,i=t.mat,n=cc.math.EPSILON,r=0;r<16;r++)if(!(e[r]+n>i[r]&&e[r]-n<i[r]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=Math.cos(t),s=Math.sin(t),o=Math.cos(e),a=Math.sin(e),c=Math.cos(i),h=Math.sin(i),l=s*a,u=r*a,d=n.mat;return d[0]=o*c,d[4]=o*h,d[8]=-a,d[1]=l*c-r*h,d[5]=l*h+r*c,d[9]=s*o,d[2]=u*c+s*h,d[6]=u*h-s*c,d[10]=r*o,d[3]=d[7]=d[11]=0,d[15]=1,n},cc.math.Matrix4.createByQuaternion=function(t,e){e=e||new cc.math.Matrix4;var i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,i){i=i||new cc.math.Matrix4;var n=i.mat,r=t.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=r[3],n[5]=r[4],n[6]=r[5],n[7]=0,n[8]=r[6],n[9]=r[7],n[10]=r[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,i},cc.math.Matrix4.createByScale=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=n.mat;return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,n},cc.math.mat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},cc.math.Matrix4.createByTranslation=function(t,e,i,n){return n=n||new cc.math.Matrix4,n.identity(),n.mat[12]=t,n.mat[13]=e,n.mat[14]=i,n},n.getUpVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[4],t[5],t[6]);return e.normalize()},n.getRightVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[0],t[1],t[2]);return e.normalize()},n.getForwardVec3=function(){var t=this.mat,e=new cc.math.Vec3(t[8],t[9],t[10]);return e.normalize()},cc.math.mat4PerspectiveProjection=function(t,e,i,n,r){var s=cc.degreesToRadians(e/2),o=r-n,a=Math.sin(s);if(0===o||0===a||0===i)return null;var c=Math.cos(s)/a;return t.identity(),t.mat[0]=c/i,t.mat[5]=c,t.mat[10]=-(r+n)/o,t.mat[11]=-1,t.mat[14]=-2*n*r/o,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,i,n){var r=cc.degreesToRadians(t/2),s=n-i,o=Math.sin(r);if(0===s||0===o||0===e)return null;var a=Math.cos(r)/o,c=new cc.math.Matrix4,h=c.mat;return c.identity(),h[0]=a/e,h[5]=a,h[10]=-(n+i)/s,h[11]=-1,h[14]=-2*i*n/s,h[15]=0,c},cc.math.mat4OrthographicProjection=function(t,e,i,n,r,s,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-s),t.mat[12]=-((i+e)/(i-e)),t.mat[13]=-((r+n)/(r-n)),t.mat[14]=-((o+s)/(o-s)),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,i,n,r,s){var o=new cc.math.Matrix4,a=o.mat;return o.identity(),a[0]=2/(e-t),a[5]=2/(n-i),a[10]=-2/(s-r),a[12]=-((e+t)/(e-t)),a[13]=-((n+i)/(n-i)),a[14]=-((s+r)/(s-r)),o},cc.math.mat4LookAt=function(t,e,i,n){var r=new cc.math.Vec3(i),s=new cc.math.Vec3(n);r.subtract(e),r.normalize(),s.normalize();var o=new cc.math.Vec3(r);o.cross(s),o.normalize();var a=new cc.math.Vec3(o);a.cross(r),o.normalize(),t.identity(),t.mat[0]=o.x,t.mat[4]=o.y,t.mat[8]=o.z,t.mat[1]=a.x,t.mat[5]=a.y,t.mat[9]=a.z,t.mat[2]=-r.x,t.mat[6]=-r.y,t.mat[10]=-r.z;var c=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(c),t};var s=new cc.math.Matrix4;n.lookAt=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),o=this.mat;n.subtract(t),n.normalize(),r.normalize();var a=new cc.math.Vec3(n);a.cross(r),a.normalize();var c=new cc.math.Vec3(a);return c.cross(n),a.normalize(),this.identity(),o[0]=a.x,o[4]=a.y,o[8]=a.z,o[1]=c.x,o[5]=c.y,o[9]=c.z,o[2]=-n.x,o[6]=-n.y,o[10]=-n.z,s=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,s),this.multiply(s),this},cc.math.mat4RotationAxisAngle=function(t,e,i){var n=Math.cos(i),r=Math.sin(i),s=new cc.math.Vec3(e);return s.normalize(),t.mat[0]=n+s.x*s.x*(1-n),t.mat[1]=s.z*r+s.y*s.x*(1-n),t.mat[2]=-s.y*r+s.z*s.x*(1-n),t.mat[3]=0,t.mat[4]=-s.z*r+s.x*s.y*(1-n),t.mat[5]=n+s.y*s.y*(1-n),t.mat[6]=s.x*r+s.z*s.y*(1-n),t.mat[7]=0,t.mat[8]=s.y*r+s.x*s.z*(1-n),t.mat[9]=-s.x*r+s.y*s.z*(1-n),t.mat[10]=n+s.z*s.z*(1-n),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,i){i=i||new cc.math.Matrix4;var n=this.mat,r=Math.cos(e),s=Math.sin(e),o=new cc.math.Vec3(t);return o.normalize(),n[0]=r+o.x*o.x*(1-r),n[1]=o.z*s+o.y*o.x*(1-r),n[2]=-o.y*s+o.z*o.x*(1-r),n[3]=0,n[4]=-o.z*s+o.x*o.y*(1-r),n[5]=r+o.y*o.y*(1-r),n[6]=o.x*s+o.z*o.y*(1-r),n[7]=0,n[8]=o.y*s+o.x*o.z*(1-r),n[9]=-o.x*s+o.y*o.z*(1-r),n[10]=r+o.z*o.z*(1-r),n[11]=0,n[12]=n[13]=n[14]=0,n[15]=1,i},n.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,i=t.mat;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},n.extractPlane=function(t){var e=new cc.math.Plane,i=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=i[3]-i[0],e.b=i[7]-i[4],e.c=i[11]-i[8],e.d=i[15]-i[12];break;case cc.math.Plane.LEFT:e.a=i[3]+i[0],e.b=i[7]+i[4],e.c=i[11]+i[8],e.d=i[15]+i[12];break;case cc.math.Plane.BOTTOM:e.a=i[3]+i[1],e.b=i[7]+i[5],e.c=i[11]+i[9],e.d=i[15]+i[13];break;case cc.math.Plane.TOP:e.a=i[3]-i[1],e.b=i[7]-i[5],e.c=i[11]-i[9],e.d=i[15]-i[13];break;case cc.math.Plane.FAR:e.a=i[3]-i[2],e.b=i[7]-i[6],e.c=i[11]-i[10],e.d=i[15]-i[14];break;case cc.math.Plane.NEAR:e.a=i[3]+i[2],e.b=i[7]+i[6],e.c=i[11]+i[10],e.d=i[15]+i[14];break;default:cc.log("cc.math.Matrix4.extractPlane: Invalid plane index")}var n=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=n,e.b/=n,e.c/=n,e.d/=n,e},n.toAxisAndAngle=function(){var t=this.extractRotation(),e=cc.math.Quaternion.rotationMatrix(t);return e.toAxisAndAngle()}},{}],188:[function(t,e,i){cc.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)};var n=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,n.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},n.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},n.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,e){return new cc.math.Plane(e.x,e.y,e.z,(-e.dot(t)))},cc.math.Plane.fromPoints=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),s=new cc.math.Plane;return n.subtract(t),r.subtract(t),n.cross(r),n.normalize(),s.a=n.x,s.b=n.y,s.c=n.z,s.d=n.scale(-1).dot(t),s},n.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),e=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*e,this},n.classifyPoint=function(t){var e=this.a*t.x+this.b*t.y+this.c*t.z+this.d;return e>.001?cc.math.Plane.POINT_INFRONT_OF_PLANE:e<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}},{}],189:[function(t,e,i){cc.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Quaternion.prototype;n.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},n.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.exponential=function(){return this},n.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},n.inverse=function(){var t=this.length();return Math.abs(t)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/t),this)},n.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},n.length=function(){return Math.sqrt(this.lengthSq())},n.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},n.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},n.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var e,i,n,r,s=[],o=t.mat,a=0;s[0]=o[0],s[1]=o[3],s[2]=o[6],s[4]=o[1],s[5]=o[4],s[6]=o[7],s[8]=o[2],s[9]=o[5],s[10]=o[8],s[15]=1;var c=s[0],h=c[0]+c[5]+c[10]+1;return h>cc.math.EPSILON?(a=2*Math.sqrt(h),e=(c[9]-c[6])/a,i=(c[2]-c[8])/a,n=(c[4]-c[1])/a,r=.25*a):c[0]>c[5]&&c[0]>c[10]?(a=2*Math.sqrt(1+c[0]-c[5]-c[10]),e=.25*a,i=(c[4]+c[1])/a,n=(c[2]+c[8])/a,r=(c[9]-c[6])/a):c[5]>c[10]?(a=2*Math.sqrt(1+c[5]-c[0]-c[10]),e=(c[4]+c[1])/a,i=.25*a,n=(c[9]+c[6])/a,r=(c[2]-c[8])/a):(a=2*Math.sqrt(1+c[10]-c[0]-c[5]),e=(c[2]+c[8])/a,i=(c[9]+c[6])/a,n=.25*a,r=(c[4]-c[1])/a),new cc.math.Quaternion(e,i,n,r)},cc.math.Quaternion.rotationYawPitchRoll=function(t,e,i){var n,r,s,o,a,c,h,l,u,d,_;n=cc.degreesToRadians(e)/2,r=cc.degreesToRadians(t)/2,s=cc.degreesToRadians(i)/2,o=Math.cos(n),a=Math.cos(r),c=Math.cos(s),h=Math.sin(n),l=Math.sin(r),u=Math.sin(s),d=a*c,_=l*u;var f=new cc.math.Quaternion;return f.w=o*d+h*_,f.x=h*d-o*_,f.y=o*l*c+h*a*u,f.z=o*a*u-h*l*c,f.normalize(),f},n.slerp=function(t,e){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var i=this.dot(t),n=Math.acos(i),r=Math.sqrt(1-cc.math.square(i)),s=Math.sin(e*n)/r,o=Math.sin((1-e)*n)/r,a=new cc.math.Quaternion(t);return this.scale(o),a.scale(s),this.add(a),this},n.toAxisAndAngle=function(){var t,e,i,n=new cc.math.Vec3;return t=Math.acos(this.w),e=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)),e>-cc.math.EPSILON&&e<cc.math.EPSILON||e<2*Math.PI+cc.math.EPSILON&&e>2*Math.PI-cc.math.EPSILON?(i=0,n.x=0,n.y=0,n.z=1):(i=2*t,n.x=this.x/e,n.y=this.y/e,n.z=this.z/e,n.normalize()),{axis:n,angle:i}},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,e,i){var n=new cc.math.Vec3(t),r=new cc.math.Vec3(e);n.normalize(),r.normalize();var s=n.dot(r),o=new cc.math.Quaternion;if(s>=1)return o.identity(),o;if(s<1e-6-1)if(Math.abs(i.lengthSq())<cc.math.EPSILON)o.rotationAxis(i,Math.PI);else{var a=new cc.math.Vec3(1,0,0);a.cross(t),Math.abs(a.lengthSq())<cc.math.EPSILON&&(a.fill(0,1,0),a.cross(t)),a.normalize(),o.rotationAxis(a,Math.PI)}else{var c=Math.sqrt(2*(1+s)),h=1/c;n.cross(r),o.x=n.x*h,o.y=n.y*h,o.z=n.z*h,o.w=.5*c,o.normalize()}return o},n.multiplyVec3=function(t){var e=this.x,i=this.y,n=this.z,r=new cc.math.Vec3(t),s=new cc.math.Vec3(e,i,n),o=new cc.math.Vec3(e,i,n);return s.cross(t),o.cross(s),s.scale(2*q.w),o.scale(2),r.add(s),r.add(o),r}},{}],190:[function(t,e,i){function n(t,e,i){var n=new cc.math.Vec2(e);n.subtract(t),i.x=-n.y,i.y=n.x,i.normalize()}cc.math.Ray2=function(t,e){this.start=t||new cc.math.Vec2,this.dir=e||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},cc.math.Ray2.prototype.intersectLineSegment=function(t,e,i){var n,r,s,o=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,h=this.start.y+this.dir.y,l=t.x,u=t.y,d=e.x,_=e.y,f=(_-u)*(c-o)-(d-l)*(h-a);return!(f>-cc.math.EPSILON&&f<cc.math.EPSILON)&&(n=((d-l)*(a-u)-(_-u)*(o-l))/f,r=o+n*(c-o),s=a+n*(h-a),!(r<Math.min(t.x,e.x)-cc.math.EPSILON||r>Math.max(t.x,e.x)+cc.math.EPSILON||s<Math.min(t.y,e.y)-cc.math.EPSILON||s>Math.max(t.y,e.y)+cc.math.EPSILON)&&(!(r<Math.min(o,c)-cc.math.EPSILON||r>Math.max(o,c)+cc.math.EPSILON||s<Math.min(a,h)-cc.math.EPSILON||s>Math.max(a,h)+cc.math.EPSILON)&&(i.x=r,i.y=s,!0)))},cc.math.Ray2.prototype.intersectTriangle=function(t,e,i,r,s){var o,a=new cc.math.Vec2,c=new cc.math.Vec2,h=new cc.math.Vec2,l=1e4,u=!1;return this.intersectLineSegment(t,e,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,n(t,e,h))),this.intersectLineSegment(e,i,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,n(e,i,h))),this.intersectLineSegment(i,t,a)&&(u=!0,o=a.subtract(this.start).length(),o<l&&(c.x=a.x,c.y=a.y,l=o,n(i,t,h))),u&&(r.x=c.x,r.y=c.y,s&&(s.x=h.x,s.y=h.y)),u}},{}],191:[function(t,e,i){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e}},{}],192:[function(t,e,i){cc.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var n=cc.math.Vec2.prototype;n.fill=function(t,e){this.x=t,this.y=e},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},n.scale=function(t){return this.x*=t,this.y*=t,this},n.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}},{}],193:[function(t,e,i){cc.math.Vec3=cc.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},cc.math.vec3=function(t,e,i){return new cc.math.Vec3(t,e,i)};var n=cc.math.Vec3.prototype;n.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},n.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},n.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},n.transformCoord=function(t){var e=new cc.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},n.inverseTransform=function(t){var e=t.mat,i=new cc.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},n.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},n.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},n.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}},{}],194:[function(t,e,i){cc.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Vec4.prototype;n.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},n.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},n.lerp=function(t,e){return this},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.mat;return this.x=e*s[0]+i*s[4]+n*s[8]+r*s[12],this.y=e*s[1]+i*s[5]+n*s[9]+r*s[13],this.z=e*s[2]+i*s[6]+n*s[10]+r*s[14],this.w=e*s[3]+i*s[7]+n*s[11]+r*s[15],this},cc.math.Vec4.transformArray=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=new cc.math.Vec4(t[n]);r.transform(e),i.push(r)}return i},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}},{}],195:[function(t,e,i){var n=cc.Class({name:"cc.MotionStreak","extends":cc.Component,editor:!1,ctor:function(){this._root=null,this._motionStreak=null},properties:{preview:{"default":!1,editorOnly:!0,notify:!1,animatable:!1},_fadeTime:1,fadeTime:{get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this._motionStreak&&this._motionStreak.setFadeTime(t)},animatable:!1,tooltip:"i18n:COMPONENT.motionStreak.fadeTime"},_minSeg:1,minSeg:{get:function(){return this._minSeg},set:function(t){this._minSeg=t,this._motionStreak&&this._motionStreak.setMinSeg(t)},animatable:!1,tooltip:"i18n:COMPONENT.motionStreak.minSeg"},_stroke:64,stroke:{get:function(){return this._stroke},set:function(t){this._stroke=t,this._motionStreak&&this._motionStreak.setStroke(t)},animatable:!1,tooltip:"i18n:COMPONENT.motionStreak.stroke"},_texture:{"default":"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._motionStreak&&(cc.js.isString(t)&&(t=cc.textureCache.addImage(t)),this._motionStreak.setTexture(t))},url:cc.Texture2D,animatable:!1,tooltip:"i18n:COMPONENT.motionStreak.texture"},_color:cc.Color.WHITE,color:{get:function(){return this._color},set:function(t){this._color=t,this._motionStreak&&this._motionStreak.tintWithColor(t)},tooltip:"i18n:COMPONENT.motionStreak.color"},_fastMode:!1,fastMode:{get:function(){return this._fastMode},set:function(t){this._fastMode=t,this._motionStreak&&this._motionStreak.setFastMode(t)},animatable:!1,tooltip:"i18n:COMPONENT.motionStreak.fastMode"}},onFocusInEditor:!1,onLostFocusInEditor:!1,reset:function(){this._motionStreak.reset()},__preload:function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)return void cc.warn("MotionStreak only support WebGL mode.");this._root=new _ccsg.Node;var t=new _ccsg.MotionStreak;t.initWithFade(this._fadeTime,this._minSeg,this._stroke,this.node.color,this._texture||null),t.setFastMode(this._fastMode),this._root.addChild(t);var e=this.node._sgNode;e&&e.addChild(this._root,-10),this._motionStreak=t},lateUpdate:function(t){if(this._motionStreak){var e=this.node,i=e.getNodeToWorldTransform(),n=i.tx-(e.width/2+e.anchorX*e.width),r=i.ty-(e.height/2+e.anchorY*e.height);this._root.setPosition(-n,-r),this._motionStreak.setPosition(n,r),this._motionStreak.update(t)}}});cc.MotionStreak=e.exports=n},{}],196:[function(t,e,i){var n=cc._Class.extend({ctor:function(t){var e,i,n,r,s,o,a,c,h,l,u,d,_,f;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;;){switch(e=this.readUInt32(),h=function(){var t,e;for(e=[],o=t=0;t<4;o=++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":s&&this.animation.frames.push(s),this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},r=this.readUInt16(),n=this.readUInt16()||100,s.delay=1e3*r/n,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":for("fdAT"===h&&(this.pos+=4,e-=4),t=(null!=s?s.data:void 0)||this.imgData,o=d=0;0<=e?d<e:d>e;o=0<=e?++d:--d)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),l=255-this.transparency.indexed.length,l>0)for(o=_=0;0<=l?_<l:_>l;o=0<=l?++_:--_)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":u=this.read(e),a=u.indexOf(0),c=String.fromCharCode.apply(String,u.slice(0,a)),this.text[c]=String.fromCharCode.apply(String,u.slice(a+1));break;case"IEND":return s&&this.animation.frames.push(s),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i,n;for(n=[],e=i=0;0<=t?i<t:i>t;e=0<=t?++i:--i)n.push(this.data[this.pos++]);return n},readUInt32:function(){var t,e,i,n;return t=this.data[this.pos++]<<24,e=this.data[this.pos++]<<16,i=this.data[this.pos++]<<8,n=this.data[this.pos++],t|e|i|n},readUInt16:function(){var t,e;return t=this.data[this.pos++]<<8,e=this.data[this.pos++],t|e},decodePixels:function(t){var e,i,n,r,s,o,a,c,h,l,u,d,_,f,p,g,m,v,y,T,C,b,x;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);var S=new Zlib.Inflate(t,{index:0,verify:!1});for(t=S.decompress(),d=this.pixelBitlength/8,g=d*this.width,_=new Uint8Array(g*this.height),o=t.length,p=0,f=0,i=0;f<o;){switch(t[f++]){case 0:for(r=y=0;y<g;r=y+=1)_[i++]=t[f++];break;case 1:for(r=T=0;T<g;r=T+=1)e=t[f++],s=r<d?0:_[i-d],_[i++]=(e+s)%256;break;case 2:for(r=C=0;C<g;r=C+=1)e=t[f++],n=(r-r%d)/d,m=p&&_[(p-1)*g+n*d+r%d],_[i++]=(m+e)%256;break;case 3:for(r=b=0;b<g;r=b+=1)e=t[f++],n=(r-r%d)/d,s=r<d?0:_[i-d],m=p&&_[(p-1)*g+n*d+r%d],_[i++]=(e+Math.floor((s+m)/2))%256;break;case 4:for(r=x=0;x<g;r=x+=1)e=t[f++],n=(r-r%d)/d,s=r<d?0:_[i-d],0===p?m=v=0:(m=_[(p-1)*g+n*d+r%d],v=n&&_[(p-1)*g+(n-1)*d+r%d]),a=s+m-v,c=Math.abs(a-s),l=Math.abs(a-m),u=Math.abs(a-v),h=c<=l&&c<=u?s:l<=u?m:v,_[i++]=(e+h)%256;break;default:throw new Error("Invalid filter algorithm: "+t[f-1])}p++}return _},copyToImageData:function(t,e){var i,n,r,s,o,a,c,h,l,u,d;if(n=this.colors,l=null,i=this.hasAlphaChannel,this.palette.length&&(l=null!=(d=this._decodedPalette)?d:this._decodedPalette=this.decodePalette(),n=4,i=!0),r=t.data||t,h=r.length,o=l||e,s=a=0,1===n)for(;s<h;)c=l?4*e[s/4]:a,u=o[c++],r[s++]=u,r[s++]=u,r[s++]=u,r[s++]=i?o[c++]:255,a=c;else for(;s<h;)c=l?4*e[s/4]:a,r[s++]=o[c++],r[s++]=o[c++],r[s++]=o[c++],r[s++]=i?o[c++]:255,a=c},decodePalette:function(){var t,e,i,n,r,s,o,a,c;for(i=this.palette,s=this.transparency.indexed||[],r=new Uint8Array((s.length||0)+i.length),n=0,t=0,e=o=0,a=i.length;o<a;e=o+=3)r[n++]=i[e],r[n++]=i[e+1],r[n++]=i[e+2],r[n++]=null!=(c=s[t++])?c:255;return r},render:function(t){var e,i;return t.width=this.width,t.height=this.height,e=t.getContext("2d"),i=e.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),e.putImageData(i,0,0)}});e.exports=n},{}],197:[function(t,e,i){var n=cc.Class({name:"cc.ParticleAsset","extends":cc.RawAsset});cc.ParticleAsset=e.exports=n},{}],198:[function(t,e,i){var n=cc.BlendFunc.BlendFactor,r=cc.Enum({GRAVITY:0,RADIUS:1}),s=cc.Enum({FREE:0,RELATIVE:1,GROUPED:2}),o={preview:{"default":!0,editorOnly:!0,notify:!1,animatable:!1},_custom:!1,custom:{get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,t?this._applyCustoms():this._applyFile())},animatable:!1},_file:{"default":"",url:cc.ParticleAsset},file:{get:function(){return this._file},set:function(t,e){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)},animatable:!1,url:cc.ParticleAsset},_texture:{"default":"",url:cc.Texture2D},texture:{get:function(){return this._texture},set:function(t){this._texture=t,this._sgNode.texture=t?cc.textureCache.addImage(t):null,!t&&this._file&&this._applyFile()},url:cc.Texture2D},particleCount:{get:function(){return this._sgNode.particleCount},set:function(t){this._sgNode.particleCount=t},visible:!1},_srcBlendFactor:n.SRC_ALPHA,srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n},_dstBlendFactor:n.ONE_MINUS_SRC_ALPHA,dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:n},playOnLoad:!0,_autoRemoveOnFinish:!1,autoRemoveOnFinish:{get:function(){return this._autoRemoveOnFinish},set:function(t){this._autoRemoveOnFinish!==t&&(this._autoRemoveOnFinish=t,this._applyAutoRemove())},animatable:!1},active:{get:function(){return!!this._sgNode&&this._sgNode.isActive()},visible:!1}},a=function(){for(var t={totalParticles:150,duration:-1,emissionRate:10,life:1,lifeVar:0,startColor:cc.Color.WHITE,startColorVar:cc.Color.BLACK,endColor:cc.color(255,255,255,0),endColorVar:cc.color(0,0,0,0),angle:90,angleVar:20,startSize:50,startSizeVar:0,endSize:0,endSizeVar:0,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,sourcePos:cc.p(0,0),posVar:cc.p(0,0),positionType:s.FREE,emitterMode:r.GRAVITY,gravity:cc.p(0,0),speed:180,speedVar:50,tangentialAccel:80,tangentialAccelVar:0,radialAccel:0,radialAccelVar:0,rotationIsDir:!1,startRadius:0,startRadiusVar:0,endRadius:0,endRadiusVar:0,rotatePerS:0,rotatePerSVar:0},e=Object.keys(t),i=0;i<e.length;++i){var n=e[i];!function(t,e){var i="_"+t;o[i]=e;var n=e.constructor,r=o[t]={};cc.isChildClassOf(n,cc.ValueType)?(r.get=function(){return new n(this[i])},r.type=n):r.get=function(){return this[i]},cc.isChildClassOf(n,cc.ValueType)?r.set=function(e){this[i]=new n(e),this._sgNode[t]=e}:r.set=function(e){this[i]=e,this._sgNode[t]=e}}(n,t[n])}return e}();o.positionType.type=s,o.emitterMode.type=r;var c=cc.Class({name:"cc.ParticleSystem","extends":cc._RendererUnderSG,editor:!1,ctor:function(){this._previewTimer=null,this._focused=!1,this._willStart=!1,this._blendFunc=new cc.BlendFunc(0,0)},properties:o,statics:{DURATION_INFINITY:-1,START_SIZE_EQUAL_TO_END_SIZE:-1,START_RADIUS_EQUAL_TO_END_RADIUS:-1,EmitterMode:r,PositionType:s},__preload:function(){this._super(),this.playOnLoad&&this.resetSystem(),this._applyAutoRemove()},onDestroy:function(){this._autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._super()},onFocusInEditor:!1,onLostFocusInEditor:!1,_createSgNode:function(){return new _ccsg.ParticleSystem},_initSgNode:function(){var t=this._sgNode;if(this._file)if(this._custom){var e=!this._texture;e?this._applyFile():this._applyCustoms()}else this._applyFile();else this._custom&&this._applyCustoms();t.stopSystem()},addParticle:function(){return this._sgNode.addParticle()},stopSystem:function(){this._sgNode.stopSystem()},resetSystem:function(){this._sgNode.resetSystem()},isFull:function(){return this.particleCount>=this._totalParticles},setDisplayFrame:function(t){if(t){var e=t.getTexture();e&&(this._texture=e.url),this._sgNode.setDisplayFrame(t)}},setTextureWithRect:function(t,e){t instanceof cc.Texture2D&&(this._texture=t.url),this._sgNode.setTextureWithRect(t,e)},_applyFile:function(){var t=this._sgNode,e=this._file;if(e){var i=this;cc.loader.load(e,function(n,r){if(n||!r)throw n||new Error("Unkown error");if(i.isValid){t.particleCount=0;var s=t.isActive();t.initWithFile(e),r.textureUuid&&cc.AssetLibrary.queryAssetInfo(r.textureUuid,function(t,e,n){i.texture=e}),r.emissionRate&&(i.emissionRate=r.emissionRate),t.setPosition(0,0),s||t.stopSystem(),i._applyAutoRemove(),i._custom&&i._applyCustoms()}})}},_applyCustoms:function(){
for(var t=this._sgNode,e=t.isActive(),i=0;i<a.length;i++){var n=a[i];t[n]=this["_"+n]}this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc),this._texture&&(t.texture=cc.textureCache.addImage(this._texture)),e||t.stopSystem(),this._applyAutoRemove()},_applyAutoRemove:function(){var t=this._sgNode,e=this._autoRemoveOnFinish;if(t.autoRemoveOnFinish=e,e){cc.assert(!t.onExit);var i=this;t.onExit=function(){_ccsg.Node.prototype.onExit.call(this),i.node.destroy()}}else t.hasOwnProperty("onExit")&&(t.onExit=_ccsg.Node.prototype.onExit)}});cc.ParticleSystem=e.exports=c},{}],199:[function(t,e,i){var n={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(18761===t)this.littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)!==-1?1:["SHORT","SSHORT"].indexOf(t)!==-1?2:["LONG","SLONG","FLOAT"].indexOf(t)!==-1?4:["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)!==-1?8:null},getFieldValues:function(t,e,i,n){var r=[],s=this.getFieldTypeLength(e),o=s*i;if(o<=4)this.littleEndian===!1?r.push(n>>>8*(4-s)):r.push(n);else for(var a=0;a<i;a++){var c=s*a;s>=8?["RATIONAL","SRATIONAL"].indexOf(e)!==-1?(r.push(this.getUint32(n+c)),r.push(this.getUint32(n+c+4))):cc.log("Can't handle this field type or size"):r.push(this.getBytes(s,n+c))}return"ASCII"===e&&r.forEach(function(t,e,i){i[e]=String.fromCharCode(t)}),r},getBytes:function(t,e){if(t<=0)cc.log("No bytes requested");else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);cc.log("Too many bytes requested")}},getBits:function(t,e,i){i=i||0;var n,r,s=Math.floor(i/8),o=e+s,a=i+t,c=32-t;return a<=0?console.log("No bits requested"):a<=8?(n=24+i,r=this.getUint8(o)):a<=16?(n=16+i,r=this.getUint16(o)):a<=32?(n=i,r=this.getUint32(o)):console.log("Too many bits requested"),{bits:r<<n>>>c,byteOffset:o+Math.floor(a/8),bitOffset:a%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),i=[],n=t+2,r=0;r<e;n+=12,r++){var s=this.getUint16(n),o=this.getUint16(n+2),a=this.getUint32(n+4),c=this.getUint32(n+8),h=this.getFieldTagName(s),l=this.getFieldTypeName(o),u=this.getFieldValues(h,l,a,c);i[h]={type:l,values:u}}this._fileDirectories.push(i);var d=this.getUint32(n);0!==d&&this.parseFileDirectory(d)},clampColorSample:function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var n=this._fileDirectories[0],r=n.ImageWidth.values[0],s=n.ImageLength.values[0];this.canvas.width=r,this.canvas.height=s;var o=[],a=n.Compression?n.Compression.values[0]:1,c=n.SamplesPerPixel.values[0],h=[],l=0,u=!1;if(n.BitsPerSample.values.forEach(function(t,e,i){h[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8===0&&(h[e].hasBytesPerSample=!0,h[e].bytesPerSample=t/8),l+=t},this),l%8===0){u=!0;var d=l/8}var _=n.StripOffsets.values,f=_.length;if(n.StripByteCounts)var p=n.StripByteCounts.values;else{if(cc.log("Missing StripByteCounts!"),1!==f)throw Error("Cannot recover from missing StripByteCounts");var p=[Math.ceil(r*s*l/8)]}for(var g=0;g<f;g++){var m=_[g];o[g]=[];for(var v=p[g],y=0,T=0,C=1,b=!0,x=[],S=0,E=0,A=0;y<v;y+=C)switch(a){case 1:for(var O=0,x=[];O<c;O++){if(!h[O].hasBytesPerSample){var w=this.getBits(h[O].bitsPerSample,m+y,T);throw x.push(w.bits),y=w.byteOffset-m,T=w.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var R=h[O].bytesPerSample*O;x.push(this.getBytes(h[O].bytesPerSample,m+y+R))}if(o[g].push(x),!u)throw C=0,RangeError("Cannot handle sub-byte bits per pixel");C=d;break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(b){b=!1;var I=1,P=1,N=this.getInt8(m+y);N>=0&&N<=127?I=N+1:N>=-127&&N<=-1?P=-N+1:b=!0}else{for(var L=this.getUint8(m+y),O=0;O<P;O++){if(!h[E].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");A=A<<8*S|L,S++,S===h[E].bytesPerSample&&(x.push(A),A=S=0,E++),E===c&&(o[g].push(x),x=[],E=0)}I--,0===I&&(b=!0)}C=1}}if(e.getContext){var F=this.canvas.getContext("2d");F.fillStyle="rgba(255, 255, 255, 0)";var D=n.RowsPerStrip?n.RowsPerStrip.values[0]:s,M=o.length,B=s%D,k=0===B?D:B,z=D,V=0,W=n.PhotometricInterpretation.values[0],U=[],G=0;if(n.ExtraSamples&&(U=n.ExtraSamples.values,G=U.length),n.ColorMap)var X=n.ColorMap.values,j=Math.pow(2,h[0].bitsPerSample);for(var g=0;g<M;g++){g+1===M&&(z=k);for(var Y=o[g].length,H=V*g,Q=0,q=0;q<Y;Q++)for(var Z=0;Z<r;Z++,q++){var K=o[g][q],J=0,$=0,tt=0,et=1;if(G>0)for(var it=0;it<G;it++)if(1===U[it]||2===U[it]){et=K[3+it]/256;break}switch(W){case 0:if(h[0].hasBytesPerSample)var nt=Math.pow(16,2*h[0].bytesPerSample);K.forEach(function(t,e,i){i[e]=nt-t});case 1:J=$=tt=this.clampColorSample(K[0],h[0].bitsPerSample);break;case 2:J=this.clampColorSample(K[0],h[0].bitsPerSample),$=this.clampColorSample(K[1],h[1].bitsPerSample),tt=this.clampColorSample(K[2],h[2].bitsPerSample);break;case 3:if(void 0===X)throw Error("Palette image missing color map");var rt=K[0];J=this.clampColorSample(X[rt],16),$=this.clampColorSample(X[j+rt],16),tt=this.clampColorSample(X[2*j+rt],16);break;default:throw RangeError("Unknown Photometric Interpretation:",W)}F.fillStyle="rgba("+J+", "+$+", "+tt+", "+et+")",F.fillRect(Z,H+Q,1,1)}V=z}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};e.exports=n},{}],200:[function(t,e,i){var n=cc.macro,r=cc.math;cc.GLProgram=cc._Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t){if(!t)return!1;var e,i=this._hashForUniforms[t];if(i){e=!1;for(var n=arguments.length-1,r=0;r<n;++r)arguments[r+1]!==i[r]&&(i[r]=arguments[r+1],e=!0)}else i=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=i,e=!0;return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;var n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n";i=n+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var r=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return r||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),r===!0},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;this._programObj=i.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&i.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&i.attachShader(this._programObj,this._fragShader);for(var n in this._hashForUniforms)delete this._hashForUniforms[n];return cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[n.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_PMATRIX_S),this._uniforms[n.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVMATRIX_S),this._uniforms[n.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVPMATRIX_S),this._uniforms[n.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_TIME_S),this._uniforms[n.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SINTIME_S),this._uniforms[n.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[n.UNIFORM_TIME]||null!=this._uniforms[n.UNIFORM_SINTIME]||null!=this._uniforms[n.UNIFORM_COSTIME],this._uniforms[n.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_RANDOM01_S),this._uniforms[n.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[n.UNIFORM_SAMPLER],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");var e=this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t);return e},getUniformMVPMatrix:function(){return this._uniforms[n.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[n.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e);if(n){var r=this.getUniformLocationForName(t);i.uniform1i(r,e)}}else i.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e,i);if(r){var s=this.getUniformLocationForName(t);n.uniform2i(s,e,i)}}else n.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){var s=this._updateUniformLocation(t,e,i,n);if(s){var o=this.getUniformLocationForName(t);r.uniform3i(o,e,i,n)}}else r.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var s=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,n,r);if(o){var a=this.getUniformLocationForName(t);s.uniform4i(a,e,i,n,r)}}else s.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(i,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(i,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(i,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i=this._glContext;if("string"==typeof t){var n=this._updateUniformLocation(t,e);if(n){var r=this.getUniformLocationForName(t);i.uniform1f(r,e)}}else i.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=this._glContext;if("string"==typeof t){var r=this._updateUniformLocation(t,e,i);if(r){var s=this.getUniformLocationForName(t);n.uniform2f(s,e,i)}}else n.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){var s=this._updateUniformLocation(t,e,i,n);if(s){var o=this.getUniformLocationForName(t);r.uniform3f(o,e,i,n)}}else r.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var s=this._glContext;if("string"==typeof t){var o=this._updateUniformLocation(t,e,i,n,r);if(o){var a=this.getUniformLocationForName(t);s.uniform4f(a,e,i,n,r)}}else s.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(i,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(i,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(i,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(i,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var t=new r.Matrix4,e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,t),r.glGetMatrix(r.KM_GL_MODELVIEW,e),r.mat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}this._uniforms[n.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,e),r.mat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}this._uniforms[n.UNIFORM_RANDOM01]!==-1&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,r.getMat4MultiplyValue(r.projection_matrix_stack.top,r.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){r.mat4Multiply(t,r.projection_matrix_stack.top,r.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,r.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var t=cc._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported}},{}],201:[function(t,e,i){var n=-1,r=cc.macro,s=r.ENABLE_GL_STATE_CACHE,o=0,a=0,c=null,h=0,l=0,u=0,d=0;s&&(o=16,a=-1,c=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],h=-1,l=-1,u=0,r.TEXTURE_ATLAS_USE_VAO&&(d=0)),cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),n=-1,s){a=-1;for(var t=0;t<o;t++)c[t]=-1;h=-1,l=-1,u=0}},cc.gl.useProgram=s?function(t){t!==a&&(a=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){s&&t===a&&(a=-1),gl.deleteProgram(t)},cc.gl.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.gl.blendFunc=s?function(t,e){t===h&&e===l||(h=t,l=e,cc.gl.setBlending(t,e))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(t,e){if(t!==h||e!==l){h=t,l=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),s?cc.gl.setBlending(h,l):cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){n=-1},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=s?function(t,e){if(c[t]!==e){c[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,e){s&&e===c[t]&&(c[t]=-1),cc._renderContext.deleteTexture(e._webTextureObj)},cc.gl.bindVAO=function(t){r.TEXTURE_ATLAS_USE_VAO&&s&&d!==t&&(d=t)},cc.gl.enable=function(t){}},{}],202:[function(t,e,i){var n=cc.PresetShaders,r=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case this.TYPE_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_VERT,n.POSITION_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_UCOLOR_VERT,n.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_A8COLOR_VERT,n.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_UCOLOR_VERT,n.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",r.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_LENGTH_TEXTURE_VERT,n.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[r.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),this._programs[r.SHADER_SPRITE_POSITION_TEXTURECOLOR]=t,this._programs.ShaderSpritePositionTextureColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[r.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderSpritePositionTextureColorAlphaTest=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[r.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_COLOR),this._programs[r.SHADER_SPRITE_POSITION_COLOR]=t,this._programs.ShaderSpritePositionColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[r.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[r.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[r.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[r.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[r.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(r.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(r.SHADER_SPRITE_POSITION_TEXTURECOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),t=this.programForKey(r.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(r.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(r.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(r.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(r.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(r.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}}},{}],203:[function(t,e,i){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",POSITION_COLOR_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",SPRITE_POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color;             \n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",
POSITION_TEXTURE_FRAG:"precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",SPRITE_POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",EX_SWITCHMASK_FRAG:"precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}"}},{}],204:[function(t,e,i){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")},{"./CCGLProgram":200,"./CCGLStateCache":201,"./CCShaderCache":202,"./CCShaders":203}],205:[function(t,e,i){var n=cc.Class({name:"cc.TiledLayer","extends":cc._SGComponent,onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null)},_initSgNode:function(){var t=this._sgNode;if(t){this.enabledInHierarchy||t.setVisible(!1),this._registSizeProvider();var e=this.node;t.setAnchorPoint(e.getAnchorPoint())}},_replaceSgNode:function(t){t!==this._sgNode&&(this._removeSgNode(),this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),t&&t instanceof _ccsg.TMXLayer?(this._sgNode=t,this._initSgNode()):this._sgNode=null)},getLayerName:function(){return this._sgNode?this._sgNode.getLayerName():""},setLayerName:function(t){this._sgNode&&this._sgNode.setLayerName(t)},getProperty:function(t){return this._sgNode?this._sgNode.getProperty(t):null},getPositionAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getPositionAt(t)):null},removeTileAt:function(t,e){this._sgNode&&(void 0!==e&&(t=cc.p(t,e)),this._sgNode.removeTileAt(t))},setTileGID:function(t,e,i,n){if(this._sgNode){if(void 0===e)throw new Error("_ccsg.TMXLayer.setTileGID(): pos should be non-null");var r;void 0===n&&e instanceof cc.Vec2?(r=e,n=i):r=cc.p(e,i),this._sgNode.setTileGID(t,r,n)}},getTileGIDAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getTileGIDAt(t)):0},getTileAt:function(t,e){return this._sgNode?(void 0!==e&&(t=cc.p(t,e)),this._sgNode.getTileAt(t)):null},releaseMap:function(){this._sgNode&&this._sgNode.releaseMap()},setContentSize:function(t,e){this._sgNode&&(void 0!==e&&(t=cc.size(t,e)),this._sgNode.setContentSize(t))},getTexture:function(){return this._sgNode?this._sgNode.getTexture():null},setTexture:function(t){this._sgNode&&this._sgNode.setTexture(t)},setTileOpacity:function(t){this._sgNode&&(this._sgNode._opacity=t)},getLayerSize:function(){return this._sgNode?this._sgNode.getLayerSize():cc.size(0,0)},setLayerSize:function(t){this._sgNode&&this._sgNode.setLayerSize(t)},getMapTileSize:function(){return this._sgNode?this._sgNode.getMapTileSize():cc.size(0,0)},setMapTileSize:function(t){this._sgNode&&this._sgNode.setMapTileSize(t)},getTiles:function(){return this._sgNode?this._sgNode.getTiles():null},setTiles:function(t){this._sgNode&&this._sgNode.setTiles(t)},getTileSet:function(){return this._sgNode?this._sgNode.getTileSet():null},setTileSet:function(t){this._sgNode&&this._sgNode.setTileSet(t)},getLayerOrientation:function(){return this._sgNode?this._sgNode.getLayerOrientation():0},setLayerOrientation:function(t){this._sgNode&&this._sgNode.setLayerOrientation(t)},getProperties:function(){return this._sgNode?this._sgNode.getProperties():null},setProperties:function(t){this._sgNode&&this._sgNode.setProperties(t)},_tryRemoveNode:function(){this.node.removeComponent(cc.TiledLayer),1===this.node._components.length&&0===this.node.getChildren().length&&this.node.removeFromParent()}});cc.TiledLayer=e.exports=n},{}],206:[function(t,e,i){var n=cc.Enum({ORTHO:0,HEX:1,ISO:2}),r=cc.Enum({NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5}),s=cc.Enum({HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:3758096384,FLIPPED_MASK:536870911}),o=cc.Enum({STAGGERAXIS_X:0,STAGGERAXIS_Y:1}),a=cc.Enum({STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1}),c=cc.Enum({RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4}),h=cc.Class({name:"cc.TiledMap","extends":cc._RendererInSG,editor:!1,statics:{Orientation:n,Property:r,TileFlag:s,StaggerAxis:o,StaggerIndex:a,TMXObjectType:c},properties:{_detachedChildren:{"default":[],serializable:!1},_tmxFile:{"default":null,type:cc.TiledMapAsset},tmxAsset:{get:function(){return this._tmxFile},set:function(t,e){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile())},type:cc.TiledMapAsset}},getMapSize:function(){return this._sgNode.getMapSize()},setMapSize:function(t){this._sgNode.setMapSize(t)},getTileSize:function(){return this._sgNode.getTileSize()},setTileSize:function(t){this._sgNode.setTileSize(t)},getMapOrientation:function(){return this._sgNode.getMapOrientation()},setMapOrientation:function(t){this._sgNode.setMapOrientation(t)},getObjectGroups:function(){for(var t=this.node.children,e=[],i=0,n=t.length;i<n;i++){var r=t[i],s=r.getComponent(cc.TiledObjectGroup);s&&e.push(s)}return e},getProperties:function(){return this._sgNode.getProperties()},setProperties:function(t){this._sgNode.setProperties(t)},initWithTMXFile:function(t){cc.error('Method "initWithTMXFile" is no effect now, please set property "tmxAsset" instead.')},initWithXML:function(t,e){cc.error('Method "initWithXML" is no effect now, please set property "tmxAsset" instead.')},allLayers:function(){for(var t=this.node.children,e=[],i=0,n=t.length;i<n;i++){var r=t[i],s=r.getComponent(cc.TiledLayer);s&&e.push(s)}return e},getLayer:function(t){for(var e=this.node.children,i=0,n=e.length;i<n;i++){var r=e[i],s=r.getComponent(cc.TiledLayer);if(s&&s.getLayerName()===t)return s}return null},getObjectGroup:function(t){for(var e=this.node.children,i=0,n=e.length;i<n;i++){var r=e[i],s=r.getComponent(cc.TiledObjectGroup);if(s&&s.getGroupName()===t)return s}return null},getProperty:function(t){return this._sgNode.getProperty(t)},getPropertiesForGID:function(t){return this._sgNode.getPropertiesForGID(t)},onEnable:function(){0===this._detachedChildren.length&&this._moveLayersInSgNode(this._sgNode),this._super(),this._tmxFile&&this._refreshLayerEntities(),this.node.on("anchor-changed",this._anchorChanged,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-reorder",this._syncChildrenOrder,this)},onDisable:function(){this._super(),this._setLayersEnabled(!1);var t=this._plainNode;this._moveLayersInSgNode(t),this.node.off("anchor-changed",this._anchorChanged,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-reorder",this._syncChildrenOrder,this)},onDestroy:function(){this._super(),this._removeLayerEntities()},_createSgNode:function(){return new _ccsg.TMXTiledMap},_initSgNode:function(){this._applyFile()},_resetSgSize:function(){this.node.setContentSize(this._sgNode.getContentSize()),this._sgNode.setContentSize(0,0)},_onMapLoaded:function(){this._refreshLayerEntities(),this._enabled?this._anchorChanged():this._moveLayersInSgNode(this._sgNode),this._setLayersEnabled(this._enabled),this._resetSgSize()},_setLayersEnabled:function(t){for(var e=this.node.getChildren(),i=e.length-1;i>=0;i--){var n=e[i],r=n.getComponent(cc.TiledLayer);r&&(r.enabled=t)}},_moveLayersInSgNode:function(t){this._detachedChildren.length=0;for(var e=t.getChildren(),i=e.length-1;i>=0;i--){var n=e[i];if(n instanceof _ccsg.TMXLayer||n instanceof _ccsg.TMXObjectGroup){t.removeChild(n);var r=n.getLocalZOrder();this._detachedChildren.push({sgNode:n,zorder:r})}}},_removeLayerEntities:function(){for(var t=this.node.getChildren(),e=t.length-1;e>=0;e--){var i=t[e];if(i.isValid){var n=i.getComponent(cc.TiledLayer);n&&n._tryRemoveNode();var r=i.getComponent(cc.TiledObjectGroup);r&&r._tryRemoveNode()}}},_refreshLayerEntities:function(){var t,e,i=this.node.getChildren(),n=[],r=[],s=[];for(t=0;t<this._detachedChildren.length;t++){var o=this._detachedChildren[t];this._sgNode.addChild(o.sgNode,o.zorder,o.zorder)}this._detachedChildren.length=0;var a=this._sgNode.allLayers().map(function(t){return t.getLayerName()}),c=this._sgNode.getObjectGroups().map(function(t){return t.getGroupName()});for(t=i.length-1;t>=0;t--){var h=i[t],l=h.getComponent(cc.TiledLayer),u=h.getComponent(cc.TiledObjectGroup);if(l){var d=l.getLayerName();if(d||(d=h._name),a.indexOf(d)<0)l._tryRemoveNode();else{n.push(h);var _=this._sgNode.getLayer(d);l._replaceSgNode(_),l.enabled=!0}}else if(u){var f=u.getGroupName();if(f||(f=h._name),c.indexOf(f)<0)u._tryRemoveNode();else{r.push(h);var p=this._sgNode.getObjectGroup(f);u._replaceSgNode(p),u.enabled=p.isVisible()}}else s.push({child:h,index:h.getSiblingIndex()})}var g=n.map(function(t){var e=t.getComponent(cc.TiledLayer);return e.getLayerName()});for(t=0,e=a.length;t<e;t++){var m=a[t],v=this._sgNode.getLayer(m),y=g.indexOf(m);if(y<0){var T=this.node.getChildByName(m),C=null;T&&!T.getComponent(cc._SGComponent)?C=T.addComponent(cc.TiledLayer):(T=new cc.Node(m),this.node.addChild(T),C=T.addComponent(cc.TiledLayer)),T&&C||cc.error("Add component TiledLayer into node failed."),C._replaceSgNode(v),T.setSiblingIndex(v.getLocalZOrder()),T.setAnchorPoint(this.node.getAnchorPoint())}else n[y].setSiblingIndex(v.getLocalZOrder())}var b=r.map(function(t){var e=t.getComponent(cc.TiledObjectGroup);return e.getGroupName()});for(t=0,e=c.length;t<e;t++){m=c[t];var x=this._sgNode.getObjectGroup(m);if(y=b.indexOf(m),y<0){T=this.node.getChildByName(m);var S=null;T&&!T.getComponent(cc._SGComponent)?S=T.addComponent(cc.TiledObjectGroup):(T=new cc.Node(m),this.node.addChild(T),S=T.addComponent(cc.TiledObjectGroup)),T&&S||cc.error("Add component TiledLayer into node failed."),S._replaceSgNode(x),T.setSiblingIndex(x.getLocalZOrder()),T.setAnchorPoint(this.node.getAnchorPoint()),S.enabled=x.isVisible()}else r[y].setSiblingIndex(x.getLocalZOrder())}for(t=0,e=s.length;t<e;t++)o=s[t],o.child.setSiblingIndex(o.index);this._syncChildrenOrder()},_anchorChanged:function(){for(var t=this.node.children,e=this.node.getAnchorPoint(),i=0,n=t.length;i<n;i++){var r=t[i],s=r.getComponent(cc.TiledLayer);s&&r.setAnchorPoint(e)}},_childAdded:function(t){var e=t.detail;if(e){var i=e.getComponent(cc.TiledLayer),n=e.getComponent(cc.TiledObjectGroup);if(!i&&!n){var r=this.node.getChildrenCount();e.setSiblingIndex(r),e._sgNode&&e._sgNode.setLocalZOrder(r)}}},_syncChildrenOrder:function(){for(var t=this.node.children,e=0,i=t.length;e<i;e++){var n=t[e],r=n.getComponent(cc.TiledLayer),s=n.getComponent(cc.TiledObjectGroup),o=n.getSiblingIndex();r&&r._sgNode&&r._sgNode.setLocalZOrder(o),s&&s._sgNode&&s._sgNode.setLocalZOrder(o),n._sgNode&&n._sgNode.setLocalZOrder(o)}},_applyFile:function(){var t=this._sgNode,e=this._tmxFile,i=this;if(e){var n=cc.url._rawAssets+e.tmxFolderPath;n=cc.path._setEndWithSep(n,!1);var r=t.initWithXML(e.tmxXmlStr,n);r&&(i._detachedChildren.length=0,i._onMapLoaded())}else{for(var s=t.allLayers(),o=0,a=s.length;o<a;o++)t.removeChild(s[o]);var c=t.getObjectGroups();for(o=0,a=c.length;o<a;o++)t.removeChild(c[o]);this._detachedChildren.length=0,i._removeLayerEntities()}}});cc.TiledMap=e.exports=h,cc.js.obsolete(cc.TiledMap.prototype,"cc.TiledMap.tmxFile","tmxAsset",!0),cc.js.get(cc.TiledMap.prototype,"mapLoaded",function(){return cc.error('Property "mapLoaded" is unused now. Please write the logic to the callback "start".'),[]},!1)},{}],207:[function(t,e,i){var n=cc.Class({name:"cc.TiledMapAsset","extends":cc.Asset,properties:{tmxXmlStr:{"default":""},tmxFolderPath:{"default":""},textures:{"default":[],url:[cc.Texture2D]},tsxFiles:{"default":[],url:[cc.RawAsset]}},statics:{preventDeferredLoadDependents:!0},createNode:!1});cc.TiledMapAsset=n,e.exports=n},{}],208:[function(t,e,i){var n=cc.Class({name:"cc.TiledObjectGroup","extends":cc._SGComponent,onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null)},_initSgNode:function(){var t=this._sgNode;t&&(this._registSizeProvider(),t.setAnchorPoint(this.node.getAnchorPoint()))},_replaceSgNode:function(t){t!==this._sgNode&&(this._removeSgNode(),this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),t&&t instanceof _ccsg.TMXObjectGroup?(this._sgNode=t,this._initSgNode()):this._sgNode=null)},getPositionOffset:function(){return this._sgNode?this._sgNode.getPositionOffset():cc.p(0,0)},setPositionOffset:function(t){this._sgNode&&this._sgNode.setPositionOffset(t)},getProperties:function(){return this._sgNode?this._sgNode.getProperties():null},setProperties:function(t){this._sgNode&&this._sgNode.setProperties(t)},getGroupName:function(){return this._sgNode?this._sgNode.getGroupName():""},setGroupName:function(t){this._sgNode&&this._sgNode.setGroupName(t)},getProperty:function(t){return this._sgNode?this._sgNode.propertyNamed(t):null},getObject:function(t){return this._sgNode?this._sgNode.getObject(t):null},getObjects:function(){return this._sgNode?this._sgNode.getObjects():[]},_tryRemoveNode:function(){this.node.removeComponent(cc.TiledObjectGroup),1===this.node._components.length&&0===this.node.getChildren().length&&this.node.removeFromParent()}});cc.TiledObjectGroup=e.exports=n},{}],209:[function(t,e,i){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleAsset"),t("./cocos2d/particle/CCParticleSystem"),t("./cocos2d/motion-streak/CCMotionStreak"),t("./cocos2d/tilemap/CCTiledMapAsset"),cc.runtime||(t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/tilemap/CCTiledLayer"),t("./cocos2d/tilemap/CCTiledObjectGroup")),t("./extensions/cocostudio/CCStudioComponent"),t("./extensions/spine"),cc.runtime||t("./extensions/dragonbones"),t("./cocos2d/actions"),t("./external/chipmunk/chipmunk.js"),t("./extensions/ccpool/CCNodePool.js"),t("./extensions/ccpool/CCPool.js"),t("./cocos2d/deprecated")},{"./cocos2d/actions":10,"./cocos2d/animation":20,"./cocos2d/core":110,"./cocos2d/deprecated":181,"./cocos2d/motion-streak/CCMotionStreak":195,"./cocos2d/particle/CCParticleAsset":197,"./cocos2d/particle/CCParticleSystem":198,"./cocos2d/tilemap/CCTiledLayer":205,"./cocos2d/tilemap/CCTiledMap":206,"./cocos2d/tilemap/CCTiledMapAsset":207,"./cocos2d/tilemap/CCTiledObjectGroup":208,"./extensions/ccpool/CCNodePool.js":210,"./extensions/ccpool/CCPool.js":211,"./extensions/cocostudio/CCStudioComponent":212,"./extensions/dragonbones":220,"./extensions/spine":228,"./external/chipmunk/chipmunk.js":230}],210:[function(t,e,i){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&this._pool.indexOf(t)===-1){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var i=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse.apply(i,arguments),e}},e.exports=cc.NodePool},{}],211:[function(t,e,i){cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=cc.js._getClassId(t.constructor);e&&(this._pool[e]||(this._pool[e]=[]),t.unuse&&t.unuse(),this._pool[e].push(t))},hasObject:function(t){var e=cc.js._getClassId(t),i=this._pool[e];return!(!i||0===i.length)},removeObject:function(t){var e=cc.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var n=0;n<i.length;n++)t===i[n]&&i.splice(n,1)}},getFromPool:function(t){if(this.hasObject(t)){var e=cc.js._getClassId(t),i=this._pool[e],n=Array.prototype.slice.call(arguments);n.shift();var r=i.pop();return r.reuse&&r.reuse.apply(r,n),r}},drainAllPools:function(){this._pool={}}}},{}],212:[function(t,e,i){var n=cc.Enum({NONE:0,CHECKBOX:1,TEXT_ATLAS:2,SLIDER_BAR:3,LIST_VIEW:4,PAGE_VIEW:5}),r=cc.Enum({VERTICAL:0,HORIZONTAL:1}),s=cc.Enum({TOP:0,CENTER:1,BOTTOM:2}),o=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),a=cc.Class({name:"cc.StudioComponent","extends":cc.Component,editor:!1,properties:!1,statics:{ComponentType:n,ListDirection:r,VerticalAlign:s,HorizontalAlign:o}});cc.StudioComponent=e.exports=a},{}],213:[function(t,e,i){var n=cc.Enum({"default":-1}),r=cc.Enum({"<None>":0});dragonBones.ArmatureDisplay=cc.Class({name:"dragonBones.ArmatureDisplay","extends":cc._RendererUnderSG,editor:!1,properties:{_factory:{"default":null,type:dragonBones.CCFactory,serializable:!1},_dragonBonesData:{"default":null,type:dragonBones.DragonBonesData,serializable:!1},dragonAsset:{"default":null,type:dragonBones.DragonBonesAsset,notify:function(){this._parseDragonAsset(),this._refresh()},tooltip:"i18n:COMPONENT.dragon_bones.dragon_bones_asset"},dragonAtlasAsset:{"default":null,type:dragonBones.DragonBonesAtlasAsset,notify:function(){this._parseDragonAtlasAsset(),this._refreshSgNode()},tooltip:"i18n:COMPONENT.dragon_bones.dragon_bones_atlas_asset"},_armatureName:"",armatureName:{get:function(){return this._armatureName},set:function(t){this._armatureName=t;var e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._refresh()},visible:!1},_animationName:"",animationName:{get:function(){return this._animationName},set:function(t){this._animationName=t},visible:!1},_defaultArmatureIndex:{"default":0,notify:function(){var t="";if(this.dragonAsset){var e;if(this.dragonAsset&&(e=this.dragonAsset.getArmatureEnum()),!e)return cc.error('Failed to set _defaultArmatureIndex for "%s" because its dragonAsset is invalid.',this.name);t=e[this._defaultArmatureIndex]}void 0!==t?this.armatureName=t:cc.error('Failed to set _defaultArmatureIndex for "%s" because the index is out of range.',this.name)},type:n,visible:!0,editorOnly:!0,displayName:"Armature",tooltip:"i18n:COMPONENT.dragon_bones.armature_name"},_animationIndex:{"default":0,notify:function(){if(0===this._animationIndex)return void(this.animationName="");var t;if(this.dragonAsset&&(t=this.dragonAsset.getAnimsEnum(this.armatureName)),t){var e=t[this._animationIndex];void 0!==e?this.animationName=e:cc.error('Failed to set _animationIndex for "%s" because the index is out of range.',this.name)}},type:r,visible:!0,editorOnly:!0,displayName:"Animation",tooltip:"i18n:COMPONENT.dragon_bones.animation_name"},timeScale:{"default":1,notify:function(){this._sgNode&&(this._sgNode.animation().timeScale=this.timeScale)},tooltip:"i18n:COMPONENT.dragon_bones.time_scale"},playTimes:{"default":-1,tooltip:"i18n:COMPONENT.dragon_bones.play_times"},debugBones:{"default":!1,notify:function(){this._sgNode&&this._sgNode.setDebugBones(this.debugBones)},editorOnly:!0,tooltip:"i18n:COMPONENT.dragon_bones.debug_bones"}},ctor:function(){this._factory=new dragonBones.CCFactory},__preload:function(){this._parseDragonAsset(),this._parseDragonAtlasAsset(),this._refresh()},_createSgNode:function(){return this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName?this._factory.buildArmatureDisplay(this.armatureName):null},_initSgNode:function(){var t=this._sgNode;t.animation().timeScale=this.timeScale,this.animationName&&this.playAnimation(this.animationName,this.playTimes)},_parseDragonAsset:function(){if(this.dragonAsset){var t=JSON.parse(this.dragonAsset.dragonBonesJson);this._dragonBonesData=this._factory.parseDragonBonesData(t)}},_parseDragonAtlasAsset:function(){if(this.dragonAtlasAsset){var t=JSON.parse(this.dragonAtlasAsset.atlasJson),e=cc.textureCache.getTextureForKey(this.dragonAtlasAsset.texture);this._factory.parseTextureAtlasData(t,e)}},_refreshSgNode:function(){var t=this;t._sgNode&&(t.node._sizeProvider===t._sgNode&&(t.node._sizeProvider=null),t._removeSgNode(),t._sgNode=null);var e=t._sgNode=t._createSgNode();e&&(t.enabledInHierarchy||e.setVisible(!1),t._initSgNode(),t._appendSgNode(e),t._registSizeProvider())},_refresh:function(){this._refreshSgNode()},_updateAnimEnum:!1,_updateArmatureEnum:!1,playAnimation:function(t,e){return this._sgNode?(this.animationName=t,this._sgNode.animation().play(t,e)):null},getArmatureNames:function(){return this._dragonBonesData?this._dragonBonesData.armatureNames:[]},getAnimationNames:function(t){var e=[];if(this._dragonBonesData){var i=this._dragonBonesData.getArmature(t);if(i)for(var n in i.animations)i.animations.hasOwnProperty(n)&&e.push(n)}return e},addEventListener:function(t,e,i){this._sgNode&&this._sgNode.addEvent(t,e,i)},removeEventListener:function(t,e,i){this._sgNode&&this._sgNode.removeEvent(t,e,i)},buildArmature:function(t){return this._factory?this._factory.buildArmature(t):null},armature:function(){return this._sgNode?this._sgNode.armature():null}})},{}],214:[function(t,e,i){var n=t("../../cocos2d/core/event/event-target");dragonBones.CCArmatureDisplay=cc.Class({name:"dragonBones.CCArmatureDisplay","extends":_ccsg.Node,mixins:[n],_armature:null,_debugDrawer:null,_onClear:function(){this._armature=null},_dispatchEvent:function(t){this.emit(t.type,t)},_debugDraw:function(){if(this._armature){this._debugDrawer||(this._debugDrawer=new cc.DrawNode,this.addChild(this._debugDrawer),this._debugDrawer.setDrawColor(cc.color(255,0,0,255)),this._debugDrawer.setLineWidth(1)),this._debugDrawer.clear();for(var t=this._armature.getBones(),e=0,i=t.length;e<i;++e){var n=t[e],r=Math.max(n.length,5),s=n.globalTransformMatrix.tx,o=-n.globalTransformMatrix.ty,a=s+n.globalTransformMatrix.a*r,c=o-n.globalTransformMatrix.b*r;this._debugDrawer.drawSegment(cc.p(s,o),cc.p(a,c))}}},update:function(t){this._armature&&this._armature.advanceTime(t)},advanceTimeBySelf:function(t){t?this.scheduleUpdate():this.unscheduleUpdate()},hasEvent:function(t){return this.hasEventListener(t,!1)},addEvent:function(t,e,i){this.on(t,e,i)},removeEvent:function(t,e,i){this.off(t,e,i)},armature:function(){return this._armature},animation:function(){return this._armature.animation},setDebugBones:function(t){dragonBones.DragonBones.debugDraw=t,t?this.armature().advanceTime(0):this._debugDrawer&&this._debugDrawer.clear()}})},{"../../cocos2d/core/event/event-target":98}],215:[function(t,e,i){var n=dragonBones.BaseObject;dragonBones.CCFactory=cc.Class({name:"dragonBones.CCFactory","extends":dragonBones.BaseFactory,buildArmatureDisplay:function(t,e,i){var n=this.buildArmature(t,e,i),r=n?n._display:null;return r&&r.advanceTimeBySelf(!0),r},_generateTextureAtlasData:function(t,e){return t||(t=n.borrowObject(dragonBones.CCTextureAtlasData)),t.texture=e,t},_generateArmature:function(t){var e=n.borrowObject(dragonBones.Armature),i=new dragonBones.CCArmatureDisplay;return e._armatureData=t.armature,e._skinData=t.skin,e._animation=n.borrowObject(dragonBones.Animation),e._display=i,i._armature=e,e._animation._armature=e,e.animation.animations=t.armature.animations,e},_generateSlot:function(t,e){var i=n.borrowObject(dragonBones.CCSlot),r=e.slot,s=[];i.name=r.name,i._rawDisplay=new _ccsg.Sprite;for(var o=0,a=e.displays.length;o<a;++o){var c=e.displays[o];switch(c.type){case dragonBones.DisplayType.Image:c.texture||(c.texture=this._getTextureData(t.dataName,c.name)),s.push(i._rawDisplay);break;case dragonBones.DisplayType.Mesh:cc.warn("WARN: Now mesh display is not supported in web!"),s.push(i._rawDisplay);break;case dragonBones.DisplayType.Armature:var h=this.buildArmature(c.name,t.dataName);if(h){if(!i.inheritAnimation){var l=r.actions.length>0?r.actions:h.armatureData.actions;if(l.length>0)for(var u=0,d=l.length;u<d;++u)h._bufferAction(l[u]);else h.animation.play()}c.armature=h.armatureData}s.push(h);break;default:s.push(null)}}return i._setDisplayList(s),i}})},{}],216:[function(t,e,i){dragonBones.CCSlot=cc.Class({name:"dragonBones.CCSlot","extends":dragonBones.Slot,_renderDisplay:null,statics:{toString:function(){return"[class dragonBones.CCSlot]"}},_onClear:function(){dragonBones.Slot.prototype._onClear.call(this),this._renderDisplay=null},_onUpdateDisplay:function(){this._rawDisplay||(this._rawDisplay=new _ccsg.Sprite),this._renderDisplay=this._display||this._rawDisplay},_initDisplay:function(t){},_addDisplay:function(){var t=this._armature._display;t.addChild(this._renderDisplay)},_replaceDisplay:function(t){var e=this._armature._display,i=t;e.addChild(this._renderDisplay,i.getLocalZOrder()),e.removeChild(i)},_removeDisplay:function(){this._renderDisplay.removeFromParent()},_disposeDisplay:function(t){},_updateVisible:function(){this._renderDisplay.setVisible(this._parent.visible)},_updateBlendMode:function(){if(this._renderDisplay instanceof _ccsg.Sprite)switch(this._blendMode){case 0:break;case 1:var t=this._renderDisplay.getTexture();t&&t.hasPremultipliedAlpha()?this._renderDisplay.setBlendFunc(cc.BlendFunc.BlendFactor.ONE,cc.BlendFunc.BlendFactor.ONE):this._renderDisplay.setBlendFunc(cc.BlendFunc.BlendFactor.SRC_ALPHA,cc.BlendFunc.BlendFactor.ONE)}else if(this._childArmature)for(var e=this._childArmature.getSlots(),i=0,n=e.length;i<n;i++){var r=e[i];r._blendMode=this._blendMode,r._updateBlendMode()}},_updateColor:function(){this._renderDisplay.setOpacity(255*this._colorTransform.alphaMultiplier);var t=255*this._colorTransform.redMultiplier,e=255*this._colorTransform.greenMultiplier,i=255*this._colorTransform.blueMultiplier;this._renderDisplay.setColor(cc.color(t,e,i))},_updateFilters:function(){},_updateFrame:function(){if(this._display&&this._displayIndex>=0){var t=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,e=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,i=e||t,n=i.texture;if(n){var r=n.parent.texture;if(!n.texture&&r){var s=cc.rect(n.region.x,n.region.y,n.region.width,n.region.height),o=cc.p(0,0),a=cc.size(n.region.width,n.region.height);n.texture=new cc.SpriteFrame,n.texture.setTexture(r,s,!1,o,a)}var c=this._armature._replacedTexture||(n.texture?n.texture.getTexture():null);if(c){if(this._meshData&&this._display===this._meshDisplay);else{var h=cc.p(i.pivot.x,i.pivot.y),l=n.frame||n.region,u=l.width,d=l.height;!n.frame&&n.rotated&&(u=l.height,d=l.width),i.isRelativePivot&&(h.x*=u,h.y*=d),n.frame&&(h.x+=n.frame.x,h.y+=n.frame.y),t&&t!==i&&(h.x+=t.transform.x-i.transform.x,h.y+=t.transform.y-i.transform.y),h.x=h.x/n.region.width,h.y=1-h.y/n.region.height,this._rawDisplay.setSpriteFrame(n.texture),c!==n.texture.getTexture()&&this._rawDisplay.setTexture(c),this._rawDisplay.setAnchorPoint(h)}return void this._updateVisible()}}}this._rawDisplay.setTexture(null),this._rawDisplay.setTextureRect(cc.rect(0,0,0,0)),this._rawDisplay.setAnchorPoint(cc.p(0,0)),this._rawDisplay.setVisible(!1)},_updateMesh:function(){},_updateTransform:function(){this._renderDisplay&&(this.global.fromMatrix(this.globalTransformMatrix),this._renderDisplay.setScale(this.global.scaleX,this.global.scaleY),this._renderDisplay.setRotationX(this.global.skewX*dragonBones.DragonBones.RADIAN_TO_ANGLE),this._renderDisplay.setRotationY(this.global.skewY*dragonBones.DragonBones.RADIAN_TO_ANGLE),this._renderDisplay.setPosition(this.global.x,-this.global.y))}})},{}],217:[function(t,e,i){dragonBones.CCTextureAtlasData=cc.Class({name:"dragonBones.CCTextureAtlasData","extends":dragonBones.TextureAtlasData,texture:null,statics:{toString:function(){return"[class dragonBones.CCTextureAtlasData]"}},_onClear:function(){dragonBones.TextureAtlasData.prototype._onClear.call(this),this.texture=null},generateTextureData:function(){return dragonBones.BaseObject.borrowObject(dragonBones.CCTextureData)}}),dragonBones.CCTextureData=cc.Class({name:"dragonBones.CCTextureData","extends":dragonBones.TextureData,texture:null,statics:{toString:function(){return"[class dragonBones.CCTextureData]"}},_onClear:function(){dragonBones.TextureData.prototype._onClear.call(this),this.texture&&(this.texture.dispose(),this.texture=null)}})},{}],218:[function(t,e,i){var n=cc.Class({name:"dragonBones.DragonBonesAsset","extends":cc.Asset,properties:{_dragonBonesJson:"",dragonBonesJson:{get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this.reset()}}},statics:{preventDeferredLoadDependents:!0},createNode:!1,reset:function(){},getRuntimeData:!1,getArmatureEnum:!1,getAnimsEnum:!1});dragonBones.DragonBonesAsset=e.exports=n},{}],219:[function(t,e,i){var n=cc.Class({name:"dragonBones.DragonBonesAtlasAsset","extends":cc.Asset,properties:{_atlasJson:"",atlasJson:{get:function(){return this._atlasJson},set:function(t){this._atlasJson=t}},texture:{"default":"",url:cc.Texture2D}},statics:{preventDeferredLoadDependents:!0},createNode:!1});dragonBones.DragonBonesAtlasAsset=e.exports=n},{}],220:[function(t,e,i){dragonBones=t("./lib/dragonBones"),dragonBones.DisplayType={Image:0,Armature:1,Mesh:2},dragonBones.ArmatureType={Armature:0,MovieClip:1,Stage:2},dragonBones.ExtensionType={FFD:0,AdjustColor:10,BevelFilter:11,BlurFilter:12,DropShadowFilter:13,GlowFilter:14,GradientBevelFilter:15,GradientGlowFilter:16},dragonBones.EventType={Frame:0,Sound:1},dragonBones.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5},dragonBones.AnimationFadeOutMode={None:0,SameLayer:1,SameGroup:2,SameLayerAndGroup:3,All:4},t("./CCFactory"),
t("./CCSlot"),t("./CCTextureData"),t("./CCArmatureDisplay"),t("./DragonBonesAsset"),t("./DragonBonesAtlasAsset"),t("./ArmatureDisplay")},{"./ArmatureDisplay":213,"./CCArmatureDisplay":214,"./CCFactory":215,"./CCSlot":216,"./CCTextureData":217,"./DragonBonesAsset":218,"./DragonBonesAtlasAsset":219,"./lib/dragonBones":221}],221:[function(t,e,i){var n,r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){var e=function(){function t(){}return t.hasArmature=function(e){return t._armatures.indexOf(e)>=0},t.addArmature=function(e){e&&t._armatures.indexOf(e)<0&&t._armatures.push(e)},t.removeArmature=function(e){if(e){var i=t._armatures.indexOf(e);i>=0&&t._armatures.splice(i,1)}},t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.ANGLE_TO_RADIAN=Math.PI/180,t.RADIAN_TO_ANGLE=180/Math.PI,t.SECOND_TO_MILLISECOND=1e3,t.NO_TWEEN=100,t.VERSION="4.7.2",t.debug=!1,t.debugDraw=!1,t._armatures=[],t}();t.DragonBones=e}(n||(n={}));var n;!function(t){var e=function(){function t(){this.hashCode=t._hashCode++}return t._returnObject=function(e){var i=String(e.constructor),n=null==t._maxCountMap[i]?t._defaultMaxCount:t._maxCountMap[i],r=t._poolsMap[i]=t._poolsMap[i]||[];if(r.length<n){if(!(r.indexOf(e)<0))throw new Error;r.push(e)}},t.toString=function(){throw new Error},t.setMaxCount=function(e,i){if((i<0||i!=i)&&(i=0),e){var n=String(e);t._maxCountMap[n]=i;var r=t._poolsMap[n];r&&r.length>i&&(r.length=i)}else{t._defaultMaxCount=i;for(var n in t._poolsMap)if(null!=t._maxCountMap[n]){var r=t._poolsMap[n];r.length>i&&(r.length=i)}}},t.clearPool=function(e){if(void 0===e&&(e=null),e){var i=t._poolsMap[String(e)];i&&i.length&&(i.length=0)}else for(var n in t._poolsMap){var i=t._poolsMap[n];i.length=0}},t.borrowObject=function(e){var i=t._poolsMap[String(e)];if(i&&i.length)return i.pop();var n=new e;return n._onClear(),n},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=5e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this)}return r(e,t),e.prototype._onClear=function(){this._isCompleted=!1,this._currentPlayTimes=0,this._currentTime=0,this._timeline=null,this._isReverse=!1,this._hasAsynchronyTimeline=!1,this._frameRate=0,this._keyFrameCount=0,this._frameCount=0,this._position=0,this._duration=0,this._animationDutation=0,this._timeScale=1,this._timeOffset=0,this._currentFrame=null,this._armature=null,this._animationState=null},e.prototype._onFadeIn=function(){},e.prototype._onUpdateFrame=function(t){},e.prototype._onArriveAtFrame=function(t){},e.prototype._setCurrentTime=function(t){var e=this,i=0;if(e._hasAsynchronyTimeline){var n=e._animationState.playTimes,r=n*e._duration;t*=e._timeScale,0!=e._timeOffset&&(t+=e._timeOffset*e._animationDutation),n>0&&(t>=r||t<=-r)?(e._isCompleted=!0,i=n,t=t<0?0:e._duration):(e._isCompleted=!1,t<0?(i=Math.floor(-t/e._duration),t=e._duration- -t%e._duration):(i=Math.floor(t/e._duration),t%=e._duration),n>0&&i>n&&(i=n)),t+=e._position}else e._isCompleted=e._animationState._timeline._isCompleted,i=e._animationState._timeline._currentPlayTimes;return e._currentTime!=t&&(1==e._keyFrameCount&&t>e._position&&this!=e._animationState._timeline&&(e._isCompleted=!0),e._isReverse=e._currentTime>t&&e._currentPlayTimes==i,e._currentTime=t,e._currentPlayTimes=i,!0)},e.prototype.setCurrentTime=function(t){switch(this._setCurrentTime(t),this._keyFrameCount){case 0:break;case 1:this._currentFrame=this._timeline.frames[0],this._onArriveAtFrame(!1),this._onUpdateFrame(!1);break;default:this._currentFrame=this._timeline.frames[Math.floor(this._currentTime*this._frameRate)],this._onArriveAtFrame(!1),this._onUpdateFrame(!1)}this._currentFrame=null},e.prototype.fadeIn=function(t,e,i,n){this._armature=t,this._animationState=e,this._timeline=i;var r=this==this._animationState._timeline;this._hasAsynchronyTimeline=r||this._animationState.animationData.hasAsynchronyTimeline,this._frameRate=this._armature.armatureData.frameRate,this._keyFrameCount=this._timeline.frames.length,this._frameCount=this._animationState.animationData.frameCount,this._position=this._animationState._position,this._duration=this._animationState._duration,this._animationDutation=this._animationState.animationData.duration,this._timeScale=r?1:1/this._timeline.scale,this._timeOffset=r?0:this._timeline.offset,this._onFadeIn(),this.setCurrentTime(n)},e.prototype.fadeOut=function(){},e.prototype.update=function(t){var e=this;if(!e._isCompleted&&e._setCurrentTime(t)&&e._keyFrameCount){var i=e._keyFrameCount>1?Math.floor(e._currentTime*e._frameRate):0,n=e._timeline.frames[i];e._currentFrame!=n&&(e._currentFrame=n,e._onArriveAtFrame(!0)),e._onUpdateFrame(!0)}},e}(t.BaseObject);t.TimelineState=e;var i=function(e){function i(){e.call(this)}return r(i,e),i._getEasingValue=function(t,e){var i=1;if(e>2)return t;if(e>1)i=.5*(1-Math.cos(t*Math.PI)),e-=1;else if(e>0)i=1-Math.pow(1-t,2);else if(e>=-1)e*=-1,i=Math.pow(t,2);else{if(!(e>=-2))return t;e*=-1,i=Math.acos(1-2*t)/Math.PI,e-=1}return(i-t)*e+t},i._getCurveEasingValue=function(t,e){if(t<=0)return 0;if(t>=1)return 1;for(var i=0,n=0,r=0,s=e.length;r<s;r+=2)if(i=e[r],n=e[r+1],i>=t){if(0==r)return n*t/i;var o=e[r-2],a=e[r-1];return a+(n-a)*(t-o)/(i-o)}return n+(1-n)*(t-i)/(1-i)},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._tweenProgress=0,this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null},i.prototype._onArriveAtFrame=function(e){var i=this;i._tweenEasing=i._currentFrame.tweenEasing,i._curve=i._currentFrame.curve,(i._keyFrameCount<=1||i._currentFrame.next==i._timeline.frames[0]&&(i._tweenEasing!=t.DragonBones.NO_TWEEN||i._curve)&&i._animationState.playTimes>0&&i._animationState.currentPlayTimes==i._animationState.playTimes-1)&&(i._tweenEasing=t.DragonBones.NO_TWEEN,i._curve=null)},i.prototype._onUpdateFrame=function(e){var n=this;n._tweenEasing!=t.DragonBones.NO_TWEEN?(n._tweenProgress=(n._currentTime-n._currentFrame.position+n._position)/n._currentFrame.duration,0!=n._tweenEasing&&(n._tweenProgress=i._getEasingValue(n._tweenProgress,n._tweenEasing))):n._curve?(n._tweenProgress=(n._currentTime-n._currentFrame.position+n._position)/n._currentFrame.duration,n._tweenProgress=i._getCurveEasingValue(n._tweenProgress,n._curve)):n._tweenProgress=0},i.prototype._updateExtensionKeyFrame=function(t,e,i){var n=0;if(t.type==e.type)for(var r=0,s=t.tweens.length;r<s;++r){var o=e.tweens[r]-t.tweens[r];i.tweens[r]=o,0!=o&&(n=2)}if(0==n){i.type!=t.type&&(n=1,i.type=t.type),i.tweens.length!=t.tweens.length&&(n=1,i.tweens.length=t.tweens.length),i.keys.length!=t.keys.length&&(n=1,i.keys.length=t.keys.length);for(var r=0,s=t.keys.length;r<s;++r){var a=t.keys[r];i.keys[r]!=a&&(n=1,i.keys[r]=a)}}return n},i}(e);t.TweenTimelineState=i}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._animations={},this._animationNames=[],this._animationStates=[]}return r(i,e),i._sortAnimationState=function(t,e){return t.layer>e.layer?1:-1},i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t in this._animations)delete this._animations[t];for(var t=0,e=this._animationStates.length;t<e;++t)this._animationStates[t].returnToPool();this.timeScale=1,this._animationStateDirty=!1,this._timelineStateDirty=!1,this._armature=null,this._isPlaying=!1,this._time=0,this._lastAnimationState=null,this._animationNames.length&&(this._animationNames.length=0),this._animationStates.length=0},i.prototype._fadeOut=function(t,e,i,n,r){var s=0,o=this._animationStates.length,a=null;switch(n){case 1:for(;s<o;++s)a=this._animationStates[s],a.layer==e&&a.fadeOut(t,r);break;case 2:for(;s<o;++s)a=this._animationStates[s],a.group==i&&a.fadeOut(t,r);break;case 4:for(;s<o;++s)a=this._animationStates[s],a.fadeOut(t,r);break;case 3:for(;s<o;++s)a=this._animationStates[s],a.layer==e&&a.group==i&&a.fadeOut(t,r);break;case 0:}},i.prototype._updateFFDTimelineStates=function(){for(var t=0,e=this._animationStates.length;t<e;++t)this._animationStates[t]._updateFFDTimelineStates()},i.prototype._advanceTime=function(t){var e=this;if(e._isPlaying){t<0&&(t=-t);var i=e._animationStates.length;if(1==i){var n=e._animationStates[0];n._isFadeOutComplete?(n.returnToPool(),e._animationStates.length=0,e._animationStateDirty=!0,e._lastAnimationState=null):(e._timelineStateDirty&&n._updateTimelineStates(),n._advanceTime(t,1,0))}else if(i>1)for(var r=e._animationStates[0]._layer,s=1,o=0,a=1,c=0,h=0;c<i;++c){var n=e._animationStates[c];n._isFadeOutComplete?(h++,n.returnToPool(),e._animationStateDirty=!0,e._lastAnimationState==n&&(c-h>=0?e._lastAnimationState=e._animationStates[c-h]:e._lastAnimationState=null)):(h>0&&(e._animationStates[c-h]=n),r!=n._layer&&(r=n._layer,o>=s?s=0:s-=o,o=0),e._timelineStateDirty&&n._updateTimelineStates(),n._advanceTime(t,s,a),0!=n._weightResult&&(o+=n._weightResult,a++)),c==i-1&&h>0&&(e._animationStates.length-=h)}e._timelineStateDirty=!1}},i.prototype.reset=function(){for(var t=0,e=this._animationStates.length;t<e;++t)this._animationStates[t].returnToPool();this._isPlaying=!1,this._lastAnimationState=null,this._animationStates.length=0},i.prototype.stop=function(t){if(void 0===t&&(t=null),t){var e=this.getState(t);e&&e.stop()}else this._isPlaying=!1},i.prototype.play=function(t,e){void 0===t&&(t=null),void 0===e&&(e=-1);var i=null;if(t)i=this.fadeIn(t,0,e,0,null,4);else if(this._lastAnimationState)this._isPlaying?i=this.fadeIn(this._lastAnimationState.name,0,e,0,null,4):this._isPlaying=!0;else{var n=this._armature.armatureData.defaultAnimation;n&&(i=this.fadeIn(n.name,0,e,0,null,4))}return i},i.prototype.fadeIn=function(e,n,r,s,o,a,c,h,l,u){void 0===n&&(n=-1),void 0===r&&(r=-1),void 0===s&&(s=0),void 0===o&&(o=null),void 0===a&&(a=3),void 0===c&&(c=!1),void 0===h&&(h=!0),void 0===l&&(l=!0),void 0===u&&(u=!0);var d=this._animations[e];if(!d)return this._time=0,console.warn("Non-existent animation.","DragonBones: "+this._armature.armatureData.parent.name,"Armature: "+this._armature.name,"Animation: "+e),null;this._time!=this._time&&(this._time=0),this._isPlaying=!0,(n!=n||n<0)&&(n=this._lastAnimationState?d.fadeInTime:0),r<0&&(r=d.playTimes),this._fadeOut(n,s,o,a,l),this._lastAnimationState=t.BaseObject.borrowObject(t.AnimationState),this._lastAnimationState._layer=s,this._lastAnimationState._group=o,this._lastAnimationState.additiveBlending=c,this._lastAnimationState.displayControl=h,this._lastAnimationState._fadeIn(this._armature,d.animation||d,e,r,d.position,d.duration,this._time,1/d.scale,n,u),this._animationStates.push(this._lastAnimationState),this._animationStateDirty=!0,this._time=0,this._animationStates.length>1&&this._animationStates.sort(i._sortAnimationState);for(var _=this._armature.getSlots(),f=0,p=_.length;f<p;++f){var g=_[f];if(g.inheritAnimation){var m=g.childArmature;m&&m.animation.hasAnimation(e)&&!m.animation.getState(e)&&m.animation.fadeIn(e)}}return this._armature.advanceTime(0),this._lastAnimationState},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._time=e,this.fadeIn(t,0,i,0,null,4)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1);var n=this._animations[t];return n&&(this._time=n.duration*e/n.frameCount),this.fadeIn(t,0,i,0,null,4)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1);var n=this._animations[t];return n&&(this._time=n.duration*Math.max(e,0)),this.fadeIn(t,0,i,0,null,4)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return i&&(i.stop(),this._advanceTime(0),this._isPlaying=!1),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return i&&(i.stop(),this._advanceTime(0),this._isPlaying=!1),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return i&&(i.stop(),this._advanceTime(0),this._isPlaying=!1),i},i.prototype.getState=function(t){for(var e=0,i=this._animationStates.length;e<i;++e){var n=this._animationStates[e];if(n.name==t)return n}return null},i.prototype.hasAnimation=function(t){return null!=this._animations[t]},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this.isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){if(this._lastAnimationState){if(!this._lastAnimationState.isCompleted)return!1;for(var t=0,e=this._animationStates.length;t<e;++t)if(!this._animationStates[t].isCompleted)return!1;return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return this._lastAnimationState?this._lastAnimationState.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!=t){for(var e in this._animations)delete this._animations[e];if(this._animationNames.length=0,t)for(var e in t)this._animations[e]=t[e],this._animationNames.push(e)}},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,n,r,s,o,a,c){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=-1),void 0===r&&(r=0),void 0===s&&(s=null),void 0===o&&(o=3),void 0===a&&(a=!0),void 0===c&&(c=!0);var h=this.fadeIn(t,e,n,r,s,o,!1,!0,a,c);return h&&i&&i>0&&(h.timeScale=h.totalTime/i),h},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){for(var t=[],e=0,i=this._animationNames.length;e<i;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._boneMask=[],this._boneTimelines=[],this._slotTimelines=[],this._ffdTimelines=[],this.autoTween=!1}return r(i,e),i.toString=function(){return"[class dragonBones.AnimationState]"},i.prototype._onClear=function(){for(var t=0,e=this._boneTimelines.length;t<e;++t)this._boneTimelines[t].returnToPool();for(var t=0,e=this._slotTimelines.length;t<e;++t)this._slotTimelines[t].returnToPool();for(var t=0,e=this._ffdTimelines.length;t<e;++t)this._ffdTimelines[t].returnToPool();this.displayControl=!0,this.additiveBlending=!1,this.actionEnabled=!1,this.playTimes=1,this.timeScale=1,this.weight=1,this.autoFadeOutTime=-1,this.fadeTotalTime=0,this._isFadeOutComplete=!1,this._layer=0,this._position=0,this._duration=0,this._weightResult=0,this._fadeProgress=0,this._group=null,this._timeline&&(this._timeline.returnToPool(),this._timeline=null),this._isPlaying=!0,this._isPausePlayhead=!1,this._isFadeOut=!1,this._currentPlayTimes=0,this._fadeTime=0,this._time=0,this._name=null,this._armature=null,this._animationData=null,this._boneMask.length&&(this._boneMask.length=0),this._boneTimelines.length=0,this._slotTimelines.length=0,this._ffdTimelines.length=0},i.prototype._advanceFadeTime=function(e){var i=this;e<0&&(e=-e),i._fadeTime+=e;var n=0;if(n=i._fadeTime>=i.fadeTotalTime?i._isFadeOut?0:1:i._fadeTime>0?i._isFadeOut?1-i._fadeTime/i.fadeTotalTime:i._fadeTime/i.fadeTotalTime:i._isFadeOut?1:0,i._fadeProgress!=n){i._fadeProgress=n;var r=i._armature._display;if(i._fadeTime<=e)if(i._isFadeOut){if(r.hasEvent(t.EventObject.FADE_OUT)){var s=t.BaseObject.borrowObject(t.EventObject);s.animationState=this,i._armature._bufferEvent(s,t.EventObject.FADE_OUT)}}else if(r.hasEvent(t.EventObject.FADE_IN)){var o=t.BaseObject.borrowObject(t.EventObject);o.animationState=this,i._armature._bufferEvent(o,t.EventObject.FADE_IN)}if(i._fadeTime>=i.fadeTotalTime)if(i._isFadeOut){if(i._isFadeOutComplete=!0,r.hasEvent(t.EventObject.FADE_OUT_COMPLETE)){var a=t.BaseObject.borrowObject(t.EventObject);a.animationState=this,i._armature._bufferEvent(a,t.EventObject.FADE_OUT_COMPLETE)}}else if(i._isPausePlayhead=!1,r.hasEvent(t.EventObject.FADE_IN_COMPLETE)){var c=t.BaseObject.borrowObject(t.EventObject);c.animationState=this,i._armature._bufferEvent(c,t.EventObject.FADE_IN_COMPLETE)}}},i.prototype._isDisabled=function(t){return!(this.displayControl&&(!t.displayController||t.displayController==this._name||t.displayController==this._group))},i.prototype._fadeIn=function(e,n,r,s,o,a,c,h,l,u){this._armature=e,this._animationData=n,this._name=r,this.actionEnabled=i.actionEnabled,this.playTimes=s,this.timeScale=h,this.fadeTotalTime=l,this._position=o,this._duration=a,this._time=c,this._isPausePlayhead=u,0==this.fadeTotalTime&&(this._fadeProgress=.999999),this._timeline=t.BaseObject.borrowObject(t.AnimationTimelineState),this._timeline.fadeIn(this._armature,this,this._animationData,this._time),this._updateTimelineStates()},i.prototype._updateTimelineStates=function(){var e=this._time;this._animationData.hasAsynchronyTimeline||(e=this._timeline._currentTime);for(var i={},n={},r=0,s=this._boneTimelines.length;r<s;++r){var o=this._boneTimelines[r];i[o.bone.name]=o}for(var a=this._armature.getBones(),r=0,s=a.length;r<s;++r){var c=a[r],h=c.name,l=this._animationData.getBoneTimeline(h);if(l&&this.containsBoneMask(h)){var o=i[h];o?delete i[h]:(o=t.BaseObject.borrowObject(t.BoneTimelineState),o.bone=c,o.fadeIn(this._armature,this,l,e),this._boneTimelines.push(o))}}for(var r in i){var o=i[r];o.bone.invalidUpdate(),this._boneTimelines.splice(this._boneTimelines.indexOf(o),1),o.returnToPool()}for(var r=0,s=this._slotTimelines.length;r<s;++r){var u=this._slotTimelines[r];n[u.slot.name]=u}for(var d=this._armature.getSlots(),r=0,s=d.length;r<s;++r){var _=d[r],f=_.name,p=_.parent.name,g=this._animationData.getSlotTimeline(f);if(g&&this.containsBoneMask(p)&&!this._isFadeOut){var u=n[f];u?delete n[f]:(u=t.BaseObject.borrowObject(t.SlotTimelineState),u.slot=_,u.fadeIn(this._armature,this,g,e),this._slotTimelines.push(u))}}for(var r in n){var u=n[r];this._slotTimelines.splice(this._slotTimelines.indexOf(u),1),u.returnToPool()}this._updateFFDTimelineStates()},i.prototype._updateFFDTimelineStates=function(){var e=this._time;this._animationData.hasAsynchronyTimeline||(e=this._timeline._currentTime);for(var i={},n=0,r=this._ffdTimelines.length;n<r;++n){var s=this._ffdTimelines[n];i[s.slot.name]=s}for(var o=this._armature.getSlots(),n=0,r=o.length;n<r;++n){var a=o[n],c=a.name,h=a.parent.name;if(a._meshData){var l=a.displayIndex,u=l<a._displayDataSet.displays.length?a._displayDataSet.displays[l].mesh:null;if(a._meshData==u){var d=this._animationData.getFFDTimeline(this._armature._skinData.name,c,l);if(d&&this.containsBoneMask(h)){var s=i[c];s&&s._timeline==d?delete i[c]:(s=t.BaseObject.borrowObject(t.FFDTimelineState),s.slot=a,s.fadeIn(this._armature,this,d,e),this._ffdTimelines.push(s))}else{for(var _=0,f=a._ffdVertices.length;_<f;++_)a._ffdVertices[_]=0;a._ffdDirty=!0}}}}for(var n in i){var s=i[n];this._ffdTimelines.splice(this._ffdTimelines.indexOf(s),1),s.returnToPool()}},i.prototype._advanceTime=function(t,e,i){var n=this;if(0!=t&&n._advanceFadeTime(t),t*=n.timeScale,0!=t&&n._isPlaying&&!n._isPausePlayhead&&(n._time+=t),n._weightResult=n.weight*n._fadeProgress*e,0!=n._weightResult){var r=n._fadeProgress>=1&&0==i&&n._armature.cacheFrameRate>0,s=n._animationData.cacheTimeToFrameScale,o=!0,a=!0,c=2*s;if(c=r?Math.floor(n._time*c)/c:n._time,n._timeline.update(c),n._animationData.hasAsynchronyTimeline||(c=n._timeline._currentTime),r){var h=Math.floor(n._timeline._currentTime*s);if(n._armature._cacheFrameIndex==h)o=!1,a=!1;else{if(n._armature._cacheFrameIndex=h,n._armature._animation._animationStateDirty){n._armature._animation._animationStateDirty=!1;for(var l=0,u=n._boneTimelines.length;l<u;++l){var d=n._boneTimelines[l];d.bone._cacheFrames=d._timeline.cachedFrames}for(var l=0,u=n._slotTimelines.length;l<u;++l){var _=n._slotTimelines[l];_.slot._cacheFrames=_._timeline.cachedFrames}}n._animationData.cachedFrames[h]?a=!1:n._animationData.cachedFrames[h]=!0}}else n._armature._cacheFrameIndex=-1;if(o){if(a)for(var l=0,u=n._boneTimelines.length;l<u;++l)n._boneTimelines[l].update(c);for(var l=0,u=n._slotTimelines.length;l<u;++l)n._slotTimelines[l].update(c);for(var l=0,u=n._ffdTimelines.length;l<u;++l)n._ffdTimelines[l].update(c)}}n.autoFadeOutTime>=0&&n._fadeProgress>=1&&n._timeline._isCompleted&&n.fadeOut(n.autoFadeOutTime)},i.prototype.play=function(){this._isPlaying=!0},i.prototype.stop=function(){this._isPlaying=!1},i.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),(t<0||t!=t)&&(t=0),this._isPausePlayhead=e,this._isFadeOut){if(t>t-this._fadeTime)return}else{this._isFadeOut=!0,(0==t||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,n=this._boneTimelines.length;i<n;++i)this._boneTimelines[i].fadeOut();for(var i=0,n=this._slotTimelines.length;i<n;++i)this._slotTimelines[i].fadeOut()}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},i.prototype.containsBoneMask=function(t){return!this._boneMask.length||this._boneMask.indexOf(t)>=0},i.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(i){if(this._boneMask.indexOf(t)<0&&this._animationData.getBoneTimeline(t)&&this._boneMask.push(t),e)for(var n=this._armature.getBones(),r=0,s=n.length;r<s;++r){var o=n[r],a=o.name;this._boneMask.indexOf(a)<0&&this._animationData.getBoneTimeline(a)&&i.contains(o)&&this._boneMask.push(a)}this._updateTimelineStates()}},i.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var n=this._armature.getBone(t);if(n)for(var r=this._armature.getBones(),s=0,o=r.length;s<o;++s){var a=r[s],c=a.name,h=this._boneMask.indexOf(c);h>=0&&n.contains(a)&&this._boneMask.splice(h,1)}}this._updateTimelineStates()},i.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._updateTimelineStates()},Object.defineProperty(i.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group",{get:function(){return this._group},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){return this._timeline._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._timeline._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._timeline._currentTime},set:function(t){if((t<0||t!=t)&&(t=0),this._time=t,this._timeline.setCurrentTime(this._time),0!=this._weightResult){var e=this._time;this._animationData.hasAsynchronyTimeline||(e=this._timeline._currentTime);for(var i=0,n=this._boneTimelines.length;i<n;++i)this._boneTimelines[i].setCurrentTime(e);for(var i=0,n=this._slotTimelines.length;i<n;++i)this._slotTimelines[i].setCurrentTime(e);for(var i=0,n=this._ffdTimelines.length;i<n;++i)this._ffdTimelines[i].setCurrentTime(e)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clip",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),i.actionEnabled=!0,i}(t.BaseObject);t.AnimationState=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this)}return r(i,e),i.toString=function(){return"[class dragonBones.AnimationTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._isStarted=!1},i.prototype._onCrossFrame=function(e){var i=this;if(this._animationState.actionEnabled)for(var n=e.actions,r=0,s=n.length;r<s;++r)i._armature._bufferAction(n[r]);for(var o=i._armature._display,a=e.events,r=0,s=a.length;r<s;++r){var c=a[r],h="";switch(c.type){case 10:h=t.EventObject.FRAME_EVENT;break;case 11:h=t.EventObject.SOUND_EVENT}if((11==c.type?t.EventObject._soundEventManager||o:o).hasEvent(h)){var l=t.BaseObject.borrowObject(t.EventObject);l.animationState=i._animationState,l.frame=e,c.bone&&(l.bone=i._armature.getBone(c.bone.name)),c.slot&&(l.slot=i._armature.getSlot(c.slot.name)),l.name=c.name,l.data=c.data,i._armature._bufferEvent(l,h)}}},i.prototype.update=function(e){var i=this,n=i._currentTime,r=i._currentPlayTimes;if(!i._isCompleted&&i._setCurrentTime(e)){var s=i._armature._display;if(!i._isStarted&&0!=e&&(i._isStarted=!0,s.hasEvent(t.EventObject.START))){var o=t.BaseObject.borrowObject(t.EventObject);o.animationState=i._animationState,i._armature._bufferEvent(o,t.EventObject.START)}if(i._keyFrameCount){var a=i._keyFrameCount>1?Math.floor(i._currentTime*i._frameRate):0,c=i._timeline.frames[a];if(i._currentFrame!=c)if(i._keyFrameCount>1){var h=i._currentFrame;if(i._currentFrame=c,!h){var l=Math.floor(n*i._frameRate);h=i._timeline.frames[l],i._isReverse||(n<=h.position||r!=i._currentPlayTimes)&&(h=h.prev)}if(i._isReverse)for(;h!=c;)i._onCrossFrame(h),h=h.prev;else for(;h!=c;)h=h.next,i._onCrossFrame(h)}else i._currentFrame=c,i._onCrossFrame(i._currentFrame)}if(r!=i._currentPlayTimes){var u=i._isCompleted?t.EventObject.COMPLETE:t.EventObject.LOOP_COMPLETE;if(s.hasEvent(u)){var o=t.BaseObject.borrowObject(t.EventObject);o.animationState=i._animationState,i._armature._bufferEvent(o,u)}i._currentFrame=null}}},i}(t.TimelineState);t.AnimationTimelineState=e;var i=function(e){function i(){e.call(this),this._transform=new t.Transform,this._currentTransform=new t.Transform,this._durationTransform=new t.Transform}return r(i,e),i.toString=function(){return"[class dragonBones.BoneTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.bone=null,this._tweenTransform=0,this._tweenRotate=0,this._tweenScale=0,this._boneTransform=null,this._originTransform=null,this._transform.identity(),this._currentTransform.identity(),this._durationTransform.identity()},i.prototype._onFadeIn=function(){this._originTransform=this._timeline.originTransform,this._boneTransform=this.bone._animationPose},i.prototype._onArriveAtFrame=function(i){var n=this;if(e.prototype._onArriveAtFrame.call(this,i),n._currentTransform.copyFrom(n._currentFrame.transform),n._tweenTransform=1,n._tweenRotate=1,n._tweenScale=1,n._keyFrameCount>1&&(n._tweenEasing!=t.DragonBones.NO_TWEEN||n._curve)){var r=n._currentFrame.next,s=r.transform;n._durationTransform.x=s.x-n._currentTransform.x,n._durationTransform.y=s.y-n._currentTransform.y,0==n._durationTransform.x&&0==n._durationTransform.y||(n._tweenTransform=2);var o=n._currentFrame.tweenRotate;if(o==o){if(o)if(o>0?s.skewY>=n._currentTransform.skewY:s.skewY<=n._currentTransform.skewY){var a=o>0?o-1:o+1;n._durationTransform.skewX=s.skewX-n._currentTransform.skewX+t.DragonBones.PI_D*a,n._durationTransform.skewY=s.skewY-n._currentTransform.skewY+t.DragonBones.PI_D*a}else n._durationTransform.skewX=s.skewX-n._currentTransform.skewX+t.DragonBones.PI_D*o,n._durationTransform.skewY=s.skewY-n._currentTransform.skewY+t.DragonBones.PI_D*o;else n._durationTransform.skewX=t.Transform.normalizeRadian(s.skewX-n._currentTransform.skewX),n._durationTransform.skewY=t.Transform.normalizeRadian(s.skewY-n._currentTransform.skewY);0==n._durationTransform.skewX&&0==n._durationTransform.skewY||(n._tweenRotate=2)}else n._durationTransform.skewX=0,n._durationTransform.skewY=0;n._currentFrame.tweenScale?(n._durationTransform.scaleX=s.scaleX-n._currentTransform.scaleX,n._durationTransform.scaleY=s.scaleY-n._currentTransform.scaleY,0==n._durationTransform.scaleX&&0==n._durationTransform.scaleY||(n._tweenScale=2)):(n._durationTransform.scaleX=0,n._durationTransform.scaleY=0)}else n._durationTransform.x=0,n._durationTransform.y=0,n._durationTransform.skewX=0,n._durationTransform.skewY=0,n._durationTransform.scaleX=0,n._durationTransform.scaleY=0},i.prototype._onUpdateFrame=function(t){var i=this;if(i._tweenTransform||i._tweenRotate||i._tweenScale){e.prototype._onUpdateFrame.call(this,t);var n=0;i._tweenTransform&&(1==i._tweenTransform?(i._tweenTransform=0,n=0):n=i._tweenProgress,i._animationState.additiveBlending?(i._transform.x=i._currentTransform.x+i._durationTransform.x*n,i._transform.y=i._currentTransform.y+i._durationTransform.y*n):(i._transform.x=i._originTransform.x+i._currentTransform.x+i._durationTransform.x*n,i._transform.y=i._originTransform.y+i._currentTransform.y+i._durationTransform.y*n)),i._tweenRotate&&(1==i._tweenRotate?(i._tweenRotate=0,n=0):n=i._tweenProgress,i._animationState.additiveBlending?(i._transform.skewX=i._currentTransform.skewX+i._durationTransform.skewX*n,i._transform.skewY=i._currentTransform.skewY+i._durationTransform.skewY*n):(i._transform.skewX=i._originTransform.skewX+i._currentTransform.skewX+i._durationTransform.skewX*n,i._transform.skewY=i._originTransform.skewY+i._currentTransform.skewY+i._durationTransform.skewY*n)),i._tweenScale&&(1==i._tweenScale?(i._tweenScale=0,n=0):n=i._tweenProgress,i._animationState.additiveBlending?(i._transform.scaleX=i._currentTransform.scaleX+i._durationTransform.scaleX*n,i._transform.scaleY=i._currentTransform.scaleY+i._durationTransform.scaleY*n):(i._transform.scaleX=i._originTransform.scaleX*(i._currentTransform.scaleX+i._durationTransform.scaleX*n),i._transform.scaleY=i._originTransform.scaleY*(i._currentTransform.scaleY+i._durationTransform.scaleY*n))),i.bone.invalidUpdate()}},i.prototype.fadeOut=function(){this._transform.skewX=t.Transform.normalizeRadian(this._transform.skewX),this._transform.skewY=t.Transform.normalizeRadian(this._transform.skewY)},i.prototype.update=function(t){var i=this;e.prototype.update.call(this,t);var n=i._animationState._weightResult;if(n>0){0==i.bone._blendIndex?(i._boneTransform.x=i._transform.x*n,i._boneTransform.y=i._transform.y*n,i._boneTransform.skewX=i._transform.skewX*n,i._boneTransform.skewY=i._transform.skewY*n,i._boneTransform.scaleX=(i._transform.scaleX-1)*n+1,i._boneTransform.scaleY=(i._transform.scaleY-1)*n+1):(i._boneTransform.x+=i._transform.x*n,i._boneTransform.y+=i._transform.y*n,i._boneTransform.skewX+=i._transform.skewX*n,i._boneTransform.skewY+=i._transform.skewY*n,i._boneTransform.scaleX+=(i._transform.scaleX-1)*n,i._boneTransform.scaleY+=(i._transform.scaleY-1)*n),i.bone._blendIndex++;var r=i._animationState._fadeProgress;r<1&&i.bone.invalidUpdate()}},i}(t.TweenTimelineState);t.BoneTimelineState=i;var n=function(e){function i(){e.call(this),this._color=new t.ColorTransform,this._durationColor=new t.ColorTransform}return r(i,e),i.toString=function(){return"[class dragonBones.SlotTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.slot=null,this._colorDirty=!1,this._tweenColor=0,this._slotColor=null,this._color.identity(),this._durationColor.identity()},i.prototype._onFadeIn=function(){this._slotColor=this.slot._colorTransform},i.prototype._onArriveAtFrame=function(i){var n=this;if(e.prototype._onArriveAtFrame.call(this,i),n._animationState._isDisabled(n.slot))return n._tweenEasing=t.DragonBones.NO_TWEEN,n._curve=null,void(n._tweenColor=0);if(n.slot._displayDataSet){var r=n._currentFrame.displayIndex;n.slot.displayIndex>=0&&r>=0?n.slot._displayDataSet.displays.length>1&&n.slot._setDisplayIndex(r):n.slot._setDisplayIndex(r),
n.slot._updateMeshData(!0)}if(n._currentFrame.displayIndex>=0){n._tweenColor=0;var s=n._currentFrame.color;if(n._keyFrameCount>1&&(n._tweenEasing!=t.DragonBones.NO_TWEEN||n._curve)){var o=n._currentFrame.next,a=o.color;s!=a&&o.displayIndex>=0&&(n._durationColor.alphaMultiplier=a.alphaMultiplier-s.alphaMultiplier,n._durationColor.redMultiplier=a.redMultiplier-s.redMultiplier,n._durationColor.greenMultiplier=a.greenMultiplier-s.greenMultiplier,n._durationColor.blueMultiplier=a.blueMultiplier-s.blueMultiplier,n._durationColor.alphaOffset=a.alphaOffset-s.alphaOffset,n._durationColor.redOffset=a.redOffset-s.redOffset,n._durationColor.greenOffset=a.greenOffset-s.greenOffset,n._durationColor.blueOffset=a.blueOffset-s.blueOffset,0==n._durationColor.alphaMultiplier&&0==n._durationColor.redMultiplier&&0==n._durationColor.greenMultiplier&&0==n._durationColor.blueMultiplier&&0==n._durationColor.alphaOffset&&0==n._durationColor.redOffset&&0==n._durationColor.greenOffset&&0==n._durationColor.blueOffset||(n._tweenColor=2))}0==n._tweenColor&&(n._slotColor.alphaMultiplier==s.alphaMultiplier&&n._slotColor.redMultiplier==s.redMultiplier&&n._slotColor.greenMultiplier==s.greenMultiplier&&n._slotColor.blueMultiplier==s.blueMultiplier&&n._slotColor.alphaOffset==s.alphaOffset&&n._slotColor.redOffset==s.redOffset&&n._slotColor.greenOffset==s.greenOffset&&n._slotColor.blueOffset==s.blueOffset||(n._tweenColor=1))}else n._tweenEasing=t.DragonBones.NO_TWEEN,n._curve=null,n._tweenColor=0},i.prototype._onUpdateFrame=function(t){var i=this;e.prototype._onUpdateFrame.call(this,t);var n=0;if(i._tweenColor){1==i._tweenColor?(i._tweenColor=0,n=0):n=i._tweenProgress;var r=i._currentFrame.color;i._color.alphaMultiplier=r.alphaMultiplier+i._durationColor.alphaMultiplier*n,i._color.redMultiplier=r.redMultiplier+i._durationColor.redMultiplier*n,i._color.greenMultiplier=r.greenMultiplier+i._durationColor.greenMultiplier*n,i._color.blueMultiplier=r.blueMultiplier+i._durationColor.blueMultiplier*n,i._color.alphaOffset=r.alphaOffset+i._durationColor.alphaOffset*n,i._color.redOffset=r.redOffset+i._durationColor.redOffset*n,i._color.greenOffset=r.greenOffset+i._durationColor.greenOffset*n,i._color.blueOffset=r.blueOffset+i._durationColor.blueOffset*n,i._colorDirty=!0}},i.prototype.fadeOut=function(){this._tweenColor=0},i.prototype.update=function(t){var i=this;if(e.prototype.update.call(this,t),0!=i._tweenColor||i._colorDirty){var n=i._animationState._weightResult;if(n>0){var r=i._animationState._fadeProgress;r<1?(i._slotColor.alphaMultiplier+=(i._color.alphaMultiplier-i._slotColor.alphaMultiplier)*r,i._slotColor.redMultiplier+=(i._color.redMultiplier-i._slotColor.redMultiplier)*r,i._slotColor.greenMultiplier+=(i._color.greenMultiplier-i._slotColor.greenMultiplier)*r,i._slotColor.blueMultiplier+=(i._color.blueMultiplier-i._slotColor.blueMultiplier)*r,i._slotColor.alphaOffset+=(i._color.alphaOffset-i._slotColor.alphaOffset)*r,i._slotColor.redOffset+=(i._color.redOffset-i._slotColor.redOffset)*r,i._slotColor.greenOffset+=(i._color.greenOffset-i._slotColor.greenOffset)*r,i._slotColor.blueOffset+=(i._color.blueOffset-i._slotColor.blueOffset)*r,i.slot._colorDirty=!0):i._colorDirty&&(i._colorDirty=!1,i._slotColor.alphaMultiplier=i._color.alphaMultiplier,i._slotColor.redMultiplier=i._color.redMultiplier,i._slotColor.greenMultiplier=i._color.greenMultiplier,i._slotColor.blueMultiplier=i._color.blueMultiplier,i._slotColor.alphaOffset=i._color.alphaOffset,i._slotColor.redOffset=i._color.redOffset,i._slotColor.greenOffset=i._color.greenOffset,i._slotColor.blueOffset=i._color.blueOffset,i.slot._colorDirty=!0)}}},i}(t.TweenTimelineState);t.SlotTimelineState=n;var s=function(e){function i(){e.call(this),this._ffdVertices=[]}return r(i,e),i.toString=function(){return"[class dragonBones.FFDTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.slot=null,this._tweenFFD=0,this._slotFFDVertices=null,this._durationFFDFrame&&(this._durationFFDFrame.returnToPool(),this._durationFFDFrame=null),this._ffdVertices.length&&(this._ffdVertices.length=0)},i.prototype._onFadeIn=function(){this._slotFFDVertices=this.slot._ffdVertices,this._durationFFDFrame=t.BaseObject.borrowObject(t.ExtensionFrameData),this._durationFFDFrame.tweens.length=this._slotFFDVertices.length,this._ffdVertices.length=this._slotFFDVertices.length;for(var e=0,i=this._durationFFDFrame.tweens.length;e<i;++e)this._durationFFDFrame.tweens[e]=0;for(var e=0,i=this._ffdVertices.length;e<i;++e)this._ffdVertices[e]=0},i.prototype._onArriveAtFrame=function(i){var n=this;if(e.prototype._onArriveAtFrame.call(this,i),n._tweenFFD=0,(n._tweenEasing!=t.DragonBones.NO_TWEEN||n._curve)&&(n._tweenFFD=n._updateExtensionKeyFrame(n._currentFrame,n._currentFrame.next,n._durationFFDFrame)),0==n._tweenFFD)for(var r=n._currentFrame.tweens,s=0,o=r.length;s<o;++s)if(n._slotFFDVertices[s]!=r[s]){n._tweenFFD=1;break}},i.prototype._onUpdateFrame=function(t){var i=this;e.prototype._onUpdateFrame.call(this,t);var n=0;if(0!=i._tweenFFD){1==i._tweenFFD?(i._tweenFFD=0,n=0):n=i._tweenProgress;for(var r=i._currentFrame.tweens,s=i._durationFFDFrame.tweens,o=0,a=r.length;o<a;++o)i._ffdVertices[o]=r[o]+s[o]*n;i.slot._ffdDirty=!0}},i.prototype.update=function(t){var i=this;e.prototype.update.call(this,t);var n=i._animationState._weightResult;if(n>0){if(0==i.slot._blendIndex)for(var r=0,s=i._ffdVertices.length;r<s;++r)i._slotFFDVertices[r]=i._ffdVertices[r]*n;else for(var r=0,s=i._ffdVertices.length;r<s;++r)i._slotFFDVertices[r]+=i._ffdVertices[r]*n;i.slot._blendIndex++;var o=i._animationState._fadeProgress;o<1&&(i.slot._ffdDirty=!0)}},i}(t.TweenTimelineState);t.FFDTimelineState=s}(n||(n={}));var n;!function(t){var e=function(){function e(){this.time=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND,this.timeScale=1,this._animatebles=[]}return Object.defineProperty(e,"clock",{get:function(){return e._clock||(e._clock=new e),e._clock},enumerable:!0,configurable:!0}),e.prototype.advanceTime=function(e){if(e!=e&&(e=0),e<0&&(e=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND-this.time),e*=this.timeScale,e<0?this.time-=e:this.time+=e,e){for(var i=0,n=0,r=this._animatebles.length;i<r;++i){var s=this._animatebles[i];s?(n>0&&(this._animatebles[i-n]=s,this._animatebles[i]=null),s.advanceTime(e)):n++}if(n>0){for(r=this._animatebles.length;i<r;++i){var s=this._animatebles[i];s?this._animatebles[i-n]=s:n++}this._animatebles.length-=n}}},e.prototype.contains=function(t){return this._animatebles.indexOf(t)>=0},e.prototype.add=function(e){e&&this._animatebles.indexOf(e)<0&&(this._animatebles.push(e),t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.addArmature(e))},e.prototype.remove=function(e){var i=this._animatebles.indexOf(e);i>=0&&(this._animatebles[i]=null,t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.removeArmature(e))},e.prototype.clear=function(){for(var t=0,e=this._animatebles.length;t<e;++t)this._animatebles[t]=null},e._clock=null,e}();t.WorldClock=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this.global=new t.Transform,this.origin=new t.Transform,this.offset=new t.Transform,this._globalTransformMatrix=new t.Matrix}return r(i,e),i.prototype._onClear=function(){this.userData=null,this.name=null,this.globalTransformMatrix=this._globalTransformMatrix,this.global.identity(),this.origin.identity(),this.offset.identity(),this._armature=null,this._parent=null,this._globalTransformMatrix.identity()},i.prototype._setArmature=function(t){this._armature=t},i.prototype._setParent=function(t){this._parent=t},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.TransformObject=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._bones=[],this._slots=[],this._actions=[],this._events=[],this.enableCache=!1}return r(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i.prototype._onClear=function(){if(this._bones.length){for(var t=0,e=this._bones.length;t<e;++t)this._bones[t].returnToPool();this._bones.length=0}if(this._slots.length){for(var t=0,e=this._slots.length;t<e;++t)this._slots[t].returnToPool();this._slots.length=0}if(this._actions.length){for(var t=0,e=this._actions.length;t<e;++t)this._actions[t].returnToPool();this._actions.length=0}if(this._events.length){for(var t=0,e=this._events.length;t<e;++t)this._events[t].returnToPool();this._events.length=0}this.userData=null,this._bonesDirty=!1,this._cacheFrameIndex=-1,this._armatureData=null,this._skinData=null,this._animation&&(this._animation.returnToPool(),this._animation=null),this._display&&(this._display._onClear(),this._display=null),this._parent=null,this._replacedTexture=null,this._delayDispose=!1,this._lockDispose=!1,this._slotsDirty=!1},i.prototype._sortBones=function(){var t=this._bones.length;if(t){var e=this._bones.concat(),i=0,n=0;for(this._bones.length=0;n<t;){var r=e[i++];i>=t&&(i=0),this._bones.indexOf(r)>=0||r.parent&&this._bones.indexOf(r.parent)<0||r.ik&&this._bones.indexOf(r.ik)<0||(r.ik&&r.ikChain>0&&r.ikChainIndex==r.ikChain?this._bones.splice(this._bones.indexOf(r.parent)+1,0,r):this._bones.push(r),n++)}}},i.prototype._sortSlots=function(){},i.prototype._doAction=function(t){switch(t.type){case 0:this._animation.play(t.data[0],t.data[1]);break;case 1:this._animation.stop(t.data[0]);break;case 2:this._animation.gotoAndPlayByTime(t.data[0],t.data[1],t.data[2]);break;case 3:this._animation.gotoAndStopByTime(t.data[0],t.data[1]);break;case 4:this._animation.fadeIn(t.data[0],t.data[1],t.data[2]);break;case 5:}},i.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones[this._bones.length]=t,this._animation._timelineStateDirty=!0)},i.prototype._removeBoneFromBoneList=function(t){var e=this._bones.indexOf(t);e>=0&&(this._bones.splice(e,1),this._animation._timelineStateDirty=!0)},i.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots[this._slots.length]=t,this._animation._timelineStateDirty=!0)},i.prototype._removeSlotFromSlotList=function(t){var e=this._slots.indexOf(t);e>=0&&(this._slots.splice(e,1),this._animation._timelineStateDirty=!0)},i.prototype._bufferAction=function(t){this._actions.push(t)},i.prototype._bufferEvent=function(t,e){t.type=e,t.armature=this,this._events.push(t)},i.prototype.dispose=function(){this._delayDispose=!0,!this._lockDispose&&this._animation&&this.returnToPool()},i.prototype.advanceTime=function(e){var i=this;if(!i._lockDispose){if(i._lockDispose=!0,!i._animation)throw new Error("The armature has been disposed.");var n=e*i._animation.timeScale;i._animation._advanceTime(n),i._bonesDirty&&(i._bonesDirty=!1,i._sortBones()),i._slotsDirty&&(i._slotsDirty=!1,i._sortSlots());for(var r=0,s=i._bones.length;r<s;++r)i._bones[r]._update(i._cacheFrameIndex);for(var r=0,s=i._slots.length;r<s;++r){var o=i._slots[r];o._update(i._cacheFrameIndex);var a=o._childArmature;a&&(o.inheritAnimation?a.advanceTime(n):a.advanceTime(e))}if(t.DragonBones.debugDraw&&i._display._debugDraw(),i._events.length>0){for(var r=0,s=i._events.length;r<s;++r){var c=i._events[r];t.EventObject._soundEventManager&&c.type==t.EventObject.SOUND_EVENT?t.EventObject._soundEventManager._dispatchEvent(c):i._display._dispatchEvent(c),c.returnToPool()}i._events.length=0}if(i._actions.length>0){for(var r=0,s=i._actions.length;r<s;++r){var h=i._actions[r];if(h.slot){var o=i.getSlot(h.slot.name);if(o){var a=o._childArmature;a&&a._doAction(h)}}else if(h.bone)for(var l=0,u=i._slots.length;l<u;++l){var a=i._slots[l]._childArmature;a&&a._doAction(h)}else this._doAction(h)}i._actions.length=0}i._lockDispose=!1}i._delayDispose&&i.returnToPool()},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),t){var i=this.getBone(t);if(i&&(i.invalidUpdate(),e))for(var n=0,r=this._slots.length;n<r;++n){var s=this._slots[n];s.parent==i&&s.invalidUpdate()}}else{for(var n=0,r=this._bones.length;n<r;++n)this._bones[n].invalidUpdate();if(e)for(var n=0,r=this._slots.length;n<r;++n)this._slots[n].invalidUpdate()}},i.prototype.getSlot=function(t){for(var e=0,i=this._slots.length;e<i;++e){var n=this._slots[e];if(n.name==t)return n}return null},i.prototype.getSlotByDisplay=function(t){if(t)for(var e=0,i=this._slots.length;e<i;++e){var n=this._slots[e];if(n.display==t)return n}return null},i.prototype.addSlot=function(t,e){var i=this.getBone(e);if(!i)throw new Error;t._setArmature(this),t._setParent(i)},i.prototype.removeSlot=function(t){if(!t||t.armature!=this)throw new Error;t._setParent(null),t._setArmature(null)},i.prototype.getBone=function(t){for(var e=0,i=this._bones.length;e<i;++e){var n=this._bones[e];if(n.name==t)return n}return null},i.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null},i.prototype.addBone=function(t,e){if(void 0===e&&(e=null),!t)throw new Error;t._setArmature(this),t._setParent(e?this.getBone(e):null)},i.prototype.removeBone=function(t){if(!t||t.armature!=this)throw new Error;t._setParent(null),t._setArmature(null)},i.prototype.replaceTexture=function(t){this._replacedTexture=t;for(var e=0,i=this._slots.length;e<i;++e)this._slots[e].invalidUpdate()},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"name",{get:function(){return this._armatureData?this._armatureData.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!=t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots.length;e<i;++e){var n=this._slots[e],r=n.childArmature;r&&(r.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),i.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},i.prototype.hasEventListener=function(t){this._display.hasEvent(t)},i.prototype.addEventListener=function(t,e,i){this._display.addEvent(t,e,i)},i.prototype.removeEventListener=function(t,e,i){this._display.removeEvent(t,e,i)},i.prototype.getDisplay=function(){return this._display},i}(t.BaseObject);t.Armature=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._animationPose=new t.Transform,this._bones=[],this._slots=[]}return r(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.ikBendPositive=!1,this.ikWeight=0,this.length=0,this._transformDirty=2,this._blendIndex=0,this._cacheFrames=null,this._animationPose.identity(),this._visible=!0,this._ikChain=0,this._ikChainIndex=0,this._ik=null,this._bones.length&&(this._bones.length=0),this._slots.length&&(this._slots.length=0)},i.prototype._updateGlobalTransformMatrix=function(){if(this._parent){var t=this._parent.global.skewY,e=this._parent.globalTransformMatrix;if(this.inheritScale)this.inheritRotation||(this.global.skewX-=t,this.global.skewY-=t),this.global.toMatrix(this.globalTransformMatrix),this.globalTransformMatrix.concat(e),this.inheritTranslation||(this.globalTransformMatrix.tx=this.global.x,this.globalTransformMatrix.ty=this.global.y),this.global.fromMatrix(this.globalTransformMatrix);else{if(this.inheritTranslation){var i=this.global.x,n=this.global.y;this.global.x=e.a*i+e.c*n+e.tx,this.global.y=e.d*n+e.b*i+e.ty}this.inheritRotation&&(this.global.skewX+=t,this.global.skewY+=t),this.global.toMatrix(this.globalTransformMatrix)}}else this.global.toMatrix(this.globalTransformMatrix)},i.prototype._computeIKA=function(){var t=this._ik.global,e=this.globalTransformMatrix.a*this.length,i=this.globalTransformMatrix.b*this.length,n=(Math.atan2(t.y-this.global.y,t.x-this.global.x)+this.offset.skewY-2*this.global.skewY+Math.atan2(i,e))*this.ikWeight;this.global.skewX+=n,this.global.skewY+=n,this.global.toMatrix(this.globalTransformMatrix)},i.prototype._computeIKB=function(){var t=this._parent.global,e=this._ik.global,i=this.globalTransformMatrix.a*this.length,n=this.globalTransformMatrix.b*this.length,r=i*i+n*n,s=Math.sqrt(r),o=this.global.x-t.x,a=this.global.y-t.y,c=o*o+a*a,h=Math.sqrt(c);o=e.x-t.x,a=e.y-t.y;var l=o*o+a*a,u=Math.sqrt(l),d=0;if(s+h<=u||u+s<=h||u+h<=s)d=Math.atan2(e.y-t.y,e.x-t.x)+this._parent.offset.skewY,s+h<=u||h<s&&(d+=Math.PI);else{var _=(c-r+l)/(2*l),f=Math.sqrt(c-_*_*l)/u,p=t.x+o*_,g=t.y+a*_,m=-a*f,v=o*f;this.ikBendPositive?(this.global.x=p-m,this.global.y=g-v):(this.global.x=p+m,this.global.y=g+v),d=Math.atan2(this.global.y-t.y,this.global.x-t.x)+this._parent.offset.skewY}d=(d-t.skewY)*this.ikWeight,t.skewX+=d,t.skewY+=d,t.toMatrix(this._parent.globalTransformMatrix),this._parent._transformDirty=1,this.global.x=t.x+Math.cos(t.skewY)*h,this.global.y=t.y+Math.sin(t.skewY)*h;var y=(Math.atan2(e.y-this.global.y,e.x-this.global.x)+this.offset.skewY-2*this.global.skewY+Math.atan2(n,i))*this.ikWeight;this.global.skewX+=y,this.global.skewY+=y,this.global.toMatrix(this.globalTransformMatrix)},i.prototype._setArmature=function(t){if(this._armature!=t){this._ik=null;var e=null,i=null;if(this._armature&&(e=this.getSlots(),i=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,this._armature&&this._armature._addBoneToBoneList(this),e)for(var n=0,r=e.length;n<r;++n){var s=e[n];s.parent==this&&s._setArmature(this._armature)}if(i)for(var n=0,r=i.length;n<r;++n){var o=i[n];o.parent==this&&o._setArmature(this._armature)}}},i.prototype._setIK=function(t,e,i){if(t){if(e==i){var n=this._parent;if(e&&n?e=1:(e=0,i=0,n=this),n==t||n.contains(t))t=null,e=0,i=0;else for(var r=t;r.ik&&r.ikChain;){if(n.contains(r.ik)){t=null,e=0,i=0;break}r=r.parent}}}else e=0,i=0;this._ik=t,this._ikChain=e,this._ikChainIndex=i,this._armature&&(this._armature._bonesDirty=!0)},i.prototype._update=function(e){var i=this;if(i._blendIndex=0,e>=0){var n=i._cacheFrames[e];i.globalTransformMatrix==n?i._transformDirty=0:n?(i._transformDirty=2,i.globalTransformMatrix=n):2==i._transformDirty||i._parent&&0!=i._parent._transformDirty||i._ik&&i.ikWeight>0&&0!=i._ik._transformDirty?(i._transformDirty=2,i.globalTransformMatrix=i._globalTransformMatrix):i.globalTransformMatrix!=i._globalTransformMatrix?(i._transformDirty=0,i._cacheFrames[e]=i.globalTransformMatrix):(i._transformDirty=2,i.globalTransformMatrix=i._globalTransformMatrix)}else(2==i._transformDirty||i._parent&&0!=i._parent._transformDirty||i._ik&&i.ikWeight>0&&0!=i._ik._transformDirty)&&(i._transformDirty=2,i.globalTransformMatrix=i._globalTransformMatrix);0!=i._transformDirty&&(2==i._transformDirty?(i._transformDirty=1,i.globalTransformMatrix==i._globalTransformMatrix&&(i.global.x=i.origin.x+i.offset.x+i._animationPose.x,i.global.y=i.origin.y+i.offset.y+i._animationPose.y,i.global.skewX=i.origin.skewX+i.offset.skewX+i._animationPose.skewX,i.global.skewY=i.origin.skewY+i.offset.skewY+i._animationPose.skewY,i.global.scaleX=i.origin.scaleX*i.offset.scaleX*i._animationPose.scaleX,i.global.scaleY=i.origin.scaleY*i.offset.scaleY*i._animationPose.scaleY,i._updateGlobalTransformMatrix(),i._ik&&i._ikChainIndex==i._ikChain&&i.ikWeight>0&&(i.inheritTranslation&&i._ikChain>0&&i._parent?i._computeIKB():i._computeIKA()),e>=0&&!i._cacheFrames[e]&&(i.globalTransformMatrix=t.BoneTimelineData.cacheFrame(i._cacheFrames,e,i._globalTransformMatrix)))):i._transformDirty=0)},i.prototype.invalidUpdate=function(){this._transformDirty=2},i.prototype.contains=function(t){if(t){if(t==this)return!1;for(var e=t;e!=this&&e;)e=e.parent;return e==this}return!1},i.prototype.getBones=function(){this._bones.length=0;for(var t=this._armature.getBones(),e=0,i=t.length;e<i;++e){var n=t[e];n.parent==this&&this._bones.push(n)}return this._bones},i.prototype.getSlots=function(){this._slots.length=0;for(var t=this._armature.getSlots(),e=0,i=t.length;e<i;++e){var n=t[e];n.parent==this&&this._slots.push(n)}return this._slots},Object.defineProperty(i.prototype,"ikChain",{get:function(){return this._ikChain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ikChainIndex",{get:function(){return this._ikChainIndex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ik",{get:function(){return this._ik},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!=t){this._visible=t;for(var e=this._armature.getSlots(),i=0,n=e.length;i<n;++i){var r=e[i];r._parent==this&&r._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slot",{get:function(){for(var t=this._armature.getSlots(),e=0,i=t.length;e<i;++e){var n=t[e];if(n.parent==this)return n}return null},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this._colorTransform=new t.ColorTransform,this._ffdVertices=[],this._replacedDisplayDataSet=[],this._localMatrix=new t.Matrix,this._displayList=[],this._meshBones=[]}return r(i,e),i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var i=[],n=0,r=this._displayList.length;n<r;++n){var s=this._displayList[n];s!=this._rawDisplay&&s!=this._meshDisplay&&i.indexOf(s)<0&&i.push(s)}for(var n=0,r=i.length;n<r;++n){var s=i[n];s instanceof t.Armature?s.dispose():this._disposeDisplay(s)}this._meshDisplay&&this._meshDisplay!=this._rawDisplay&&this._disposeDisplay(this._meshDisplay),this._rawDisplay&&this._disposeDisplay(this._rawDisplay),this.inheritAnimation=!0,this.displayController=null,this._colorDirty=!1,this._ffdDirty=!1,this._blendIndex=0,this._zOrder=0,this._pivotX=0,this._pivotY=0,this._displayDataSet=null,this._meshData=null,this._childArmature=null,this._rawDisplay=null,this._meshDisplay=null,this._cacheFrames=null,this._colorTransform.identity(),this._ffdVertices.length&&(this._ffdVertices.length=0),this._replacedDisplayDataSet.length&&(this._replacedDisplayDataSet.length=0),this._displayDirty=!1,this._blendModeDirty=!1,this._originDirty=!1,this._transformDirty=!1,this._displayIndex=0,this._blendMode=0,this._display=null,this._localMatrix.identity(),this._displayList.length&&(this._displayList.length=0),this._meshBones.length&&(this._meshBones.length=0)},i.prototype._isMeshBonesUpdate=function(){for(var t=0,e=this._meshBones.length;t<e;++t)if(0!=this._meshBones[t]._transformDirty)return!0;return!1},i.prototype._updateDisplay=function(){var e=this._display||this._rawDisplay,i=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature._display):this._childArmature=null):(this._display=null,this._childArmature=null);var n=this._display||this._rawDisplay;if(n!=e&&(this._onUpdateDisplay(),e?this._replaceDisplay(e):this._addDisplay(),this._blendModeDirty=!0,this._colorDirty=!0),this._displayDataSet&&this._displayIndex>=0&&this._displayIndex<this._displayDataSet.displays.length&&(this.origin.copyFrom(this._displayDataSet.displays[this._displayIndex].transform),this._originDirty=!0),this._updateMeshData(!1),n!=this._rawDisplay&&n!=this._meshDisplay||this._updateFrame(),this._childArmature!=i&&(i&&(i._parent=null,this.inheritAnimation&&i.animation.reset()),this._childArmature&&(this._childArmature._parent=this,this.inheritAnimation))){if(0==this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;r&&(this._childArmature.cacheFrameRate=r)}var s=this._armature.armatureData.getSlot(this.name),o=s.actions.length>0?s.actions:this._childArmature.armatureData.actions;if(o.length>0)for(var a=0,c=o.length;a<c;++a)this._childArmature._bufferAction(o[a]);else this._childArmature.animation.play()}},i.prototype._updateLocalTransformMatrix=function(){this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix)},i.prototype._updateGlobalTransformMatrix=function(){this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(this._parent.globalTransformMatrix),this.global.fromMatrix(this.globalTransformMatrix)},i.prototype._setArmature=function(t){this._armature!=t&&(this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},i.prototype._updateMeshData=function(t){var e=this._meshData,i=null;if(this._meshDisplay&&this._displayIndex>=0){i=this._displayDataSet&&this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex].mesh:null;var n=this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null,r=n?n.mesh:null;this._meshData=r||i}else this._meshData=null;if(this._meshData!=e){if(this._meshData&&this._meshData==i){if(this._meshData.skinned){this._meshBones.length=this._meshData.bones.length;for(var s=0,o=this._meshBones.length;s<o;++s)this._meshBones[s]=this._armature.getBone(this._meshData.bones[s].name);for(var a=0,s=0,o=this._meshData.boneIndices.length;s<o;++s)a+=this._meshData.boneIndices[s].length;this._ffdVertices.length=2*a}else this._meshBones.length=0,this._ffdVertices.length=this._meshData.vertices.length;for(var s=0,o=this._ffdVertices.length;s<o;++s)this._ffdVertices[s]=0;this._ffdDirty=!0}else this._meshBones.length=0,this._ffdVertices.length=0;t&&this._armature.animation._updateFFDTimelineStates()}},i.prototype._update=function(e){var i=this;if(i._blendIndex=0,i._displayDirty&&(i._displayDirty=!1,i._updateDisplay()),i._display&&(i._blendModeDirty&&(i._blendModeDirty=!1,i._updateBlendMode()),i._colorDirty&&(i._colorDirty=!1,i._updateColor()),!i._meshData||((i._ffdDirty||i._meshData.skinned&&i._isMeshBonesUpdate())&&(i._ffdDirty=!1,i._updateMesh()),!i._meshData.skinned))){if(i._originDirty&&(i._originDirty=!1,i._transformDirty=!0,i._updateLocalTransformMatrix()),e>=0){var n=i._cacheFrames[e];i.globalTransformMatrix==n?i._transformDirty=!1:n?(i._transformDirty=!0,i.globalTransformMatrix=n):i._transformDirty||0!=i._parent._transformDirty?(i._transformDirty=!0,i.globalTransformMatrix=i._globalTransformMatrix):i.globalTransformMatrix!=i._globalTransformMatrix?(i._transformDirty=!1,i._cacheFrames[e]=i.globalTransformMatrix):(i._transformDirty=!0,i.globalTransformMatrix=i._globalTransformMatrix)}else(i._transformDirty||0!=i._parent._transformDirty)&&(i._transformDirty=!0,i.globalTransformMatrix=i._globalTransformMatrix);i._transformDirty&&(i._transformDirty=!1,i.globalTransformMatrix==i._globalTransformMatrix&&(i._updateGlobalTransformMatrix(),e>=0&&!i._cacheFrames[e]&&(i.globalTransformMatrix=t.SlotTimelineData.cacheFrame(i._cacheFrames,e,i._globalTransformMatrix))),i._updateTransform())}},i.prototype._setDisplayList=function(e){if(e&&e.length){this._displayList.length!=e.length&&(this._displayList.length=e.length);for(var i=0,n=this._displayList.length;i<n;++i){var r=e[i];r&&r!=this._rawDisplay&&r!=this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r),this._displayList[i]=r}}else this._displayList.length&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!=this._displayList[this._displayIndex]:this._displayDirty=null!=this._display,this._displayDirty},i.prototype._setDisplayIndex=function(t){return this._displayIndex!=t&&(this._displayIndex=t,this._displayDirty=!0,this._displayDirty)},i.prototype._setBlendMode=function(t){return this._blendMode!=t&&(this._blendMode=t,this._blendModeDirty=!0,!0)},i.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,!0},i.prototype.invalidUpdate=function(){this._originDirty=!0},Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MeshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this._update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var i=this._displayList.concat(),n=[];this._setDisplayList(e)&&this._update(-1);for(var r=0,s=i.length;r<s;++r){var o=i[r];o!=this._rawDisplay&&o!=this._meshDisplay&&this._displayList.indexOf(o)<0&&n.indexOf(o)<0&&n.push(o)}for(var r=0,s=n.length;r<s;++r){var o=n[r];o instanceof t.Armature?o.dispose():this._disposeDisplay(o)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!=t){var e=this._displayList.length;if(this._displayIndex<0&&0==e&&(this._displayIndex=0),!(this._displayIndex<0)){var i=this.displayList;e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!=t&&(t&&t.display.advanceTimeBySelf(!1),this.display=t)},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(t){this.display=t},i}(t.TransformObject);t.Slot=e}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this)}return r(e,t),e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.type=null,this.name=null,this.data=null,this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.frame=null,this.userData=null},Object.defineProperty(e.prototype,"animationName",{get:function(){return this.animationState.name},enumerable:!0,configurable:!0}),e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e._soundEventManager=null,e}(t.BaseObject);t.EventObject=e}(n||(n={}));var n;!function(t){var e=function(){function t(t,e,i,n,r,s,o,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),void 0===a&&(a=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=n,this.alphaOffset=r,this.redOffset=s,this.greenOffset=o,this.blueOffset=a}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.redOffset=t.redOffset,this.greenOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(n||(n={}));var n;!function(t){var e=function(){function t(t,e,i,n,r,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=n,
this.tx=r,this.ty=s}return t.prototype.copyFrom=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},t.prototype.identity=function(){this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0},t.prototype.concat=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,o=this.ty,a=t.a,c=t.b,h=t.c,l=t.d,u=t.tx,d=t.ty;this.a=e*a+i*h,this.b=e*c+i*l,this.c=n*a+r*h,this.d=n*c+r*l,this.tx=a*s+h*o+u,this.ty=l*o+c*s+d},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=this.ty,o=t*n-e*i;this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*s-n*r)/o,this.ty=-(t*s-e*r)/o},t.prototype.transformPoint=function(t,e,i,n){void 0===n&&(n=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,n||(i.x+=this.tx,i.y+=this.ty)},t}();t.Matrix=e}(n||(n={}));var n;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(n||(n={}));var n;!function(t){var e=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(n||(n={}));var n;!function(t){var e=function(){function t(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),this.x=t,this.y=e,this.skewX=i,this.skewY=n,this.scaleX=r,this.scaleY=s}return t.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skewX/Math.PI+" skewY:"+180*this.skewY/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skewX=t.skewX,this.skewY=t.skewY,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.clone=function(){var e=new t;return e.copyFrom(this),e},t.prototype.identity=function(){return this.x=this.y=this.skewX=this.skewY=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skewX+=t.skewX,this.skewY+=t.skewY,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(e){return this.x-=e.x,this.y-=e.y,this.skewX=t.normalizeRadian(this.skewX-e.skewX),this.skewY=t.normalizeRadian(this.skewY-e.skewY),this.scaleX/=e.scaleX,this.scaleY/=e.scaleY,this},t.prototype.fromMatrix=function(t){var e=.25*Math.PI,i=this.scaleX,n=this.scaleY;return this.x=t.tx,this.y=t.ty,this.skewX=Math.atan(-t.c/t.d),this.skewY=Math.atan(t.b/t.a),this.skewX!=this.skewX&&(this.skewX=0),this.skewY!=this.skewY&&(this.skewY=0),this.scaleY=this.skewX>-e&&this.skewX<e?t.d/Math.cos(this.skewX):-t.c/Math.sin(this.skewX),this.scaleX=this.skewY>-e&&this.skewY<e?t.a/Math.cos(this.skewY):t.b/Math.sin(this.skewY),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.skewY=this.skewY-Math.PI),n>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.skewX=this.skewX-Math.PI),this},t.prototype.toMatrix=function(t){return t.a=this.scaleX*Math.cos(this.skewY),t.b=this.scaleX*Math.sin(this.skewY),t.c=-this.scaleY*Math.sin(this.skewX),t.d=this.scaleY*Math.cos(this.skewX),t.tx=this.x,t.ty=this.y,this},Object.defineProperty(t.prototype,"rotation",{get:function(){return this.skewY},set:function(t){var e=t-this.skewY;this.skewX+=e,this.skewY+=e},enumerable:!0,configurable:!0}),t}();t.Transform=e}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this),this.frames=[]}return r(e,t),e.prototype._onClear=function(){if(this.scale=1,this.offset=0,this.frames.length){for(var t=null,e=0,i=this.frames.length;e<i;++e){var n=this.frames[e];t&&n!=t&&t.returnToPool(),t=n}this.frames.length=0}},e}(t.BaseObject);t.TimelineData=e;var i=function(e){function i(){e.call(this),this.bone=null,this.originTransform=new t.Transform,this.cachedFrames=[]}return r(i,e),i.cacheFrame=function(e,i,n){var r=e[i]=new t.Matrix;return r.copyFrom(n),r},i.toString=function(){return"[class dragonBones.BoneTimelineData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.bone=null,this.originTransform.identity(),this.cachedFrames.length&&(this.cachedFrames.length=0)},i.prototype.cacheFrames=function(t){this.cachedFrames.length=0,this.cachedFrames.length=t},i}(e);t.BoneTimelineData=i;var n=function(e){function i(){e.call(this),this.slot=null,this.cachedFrames=[]}return r(i,e),i.cacheFrame=function(e,i,n){var r=e[i]=new t.Matrix;return r.copyFrom(n),r},i.toString=function(){return"[class dragonBones.SlotTimelineData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.slot=null,this.cachedFrames.length&&(this.cachedFrames.length=0)},i.prototype.cacheFrames=function(t){this.cachedFrames.length=0,this.cachedFrames.length=t},i}(e);t.SlotTimelineData=n;var s=function(t){function e(){t.call(this),this.displayIndex=0,this.skin=null,this.slot=null}return r(e,t),e.toString=function(){return"[class dragonBones.FFDTimelineData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.displayIndex=0,this.skin=null,this.slot=null},e}(e);t.FFDTimelineData=s}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this),this.boneTimelines={},this.slotTimelines={},this.ffdTimelines={},this.cachedFrames=[]}return r(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.hasAsynchronyTimeline=!1,this.cacheTimeToFrameScale=0,this.position=0,this.duration=0,this.playTimes=0,this.fadeInTime=0,this.name=null,this.animation=null;for(var e in this.boneTimelines)this.boneTimelines[e].returnToPool(),delete this.boneTimelines[e];for(var e in this.slotTimelines)this.slotTimelines[e].returnToPool(),delete this.slotTimelines[e];for(var e in this.ffdTimelines){for(var i in this.ffdTimelines[e])for(var n in this.ffdTimelines[e][i])this.ffdTimelines[e][i][n].returnToPool();delete this.ffdTimelines[e]}this.cachedFrames.length&&(this.cachedFrames.length=0)},e.prototype.cacheFrames=function(t){if(!this.animation){var e=Math.max(Math.floor((this.frameCount+1)*this.scale*t),1);this.cacheTimeToFrameScale=e/(this.duration+1e-6),this.cachedFrames.length=0,this.cachedFrames.length=e;for(var i in this.boneTimelines)this.boneTimelines[i].cacheFrames(e);for(var i in this.slotTimelines)this.slotTimelines[i].cacheFrames(e)}},e.prototype.addBoneTimeline=function(t){if(!t||!t.bone||this.boneTimelines[t.bone.name])throw new Error;this.boneTimelines[t.bone.name]=t},e.prototype.addSlotTimeline=function(t){if(!t||!t.slot||this.slotTimelines[t.slot.name])throw new Error;this.slotTimelines[t.slot.name]=t},e.prototype.addFFDTimeline=function(t){if(!(t&&t.skin&&t.slot))throw new Error;var e=this.ffdTimelines[t.skin.name]=this.ffdTimelines[t.skin.name]||{},i=e[t.slot.slot.name]=e[t.slot.slot.name]||{};if(i[t.displayIndex])throw new Error;i[t.displayIndex]=t},e.prototype.getBoneTimeline=function(t){return this.boneTimelines[t]},e.prototype.getSlotTimeline=function(t){return this.slotTimelines[t]},e.prototype.getFFDTimeline=function(t,e,i){var n=this.ffdTimelines[t];if(n){var r=n[e];if(r)return r[i]}return null},e}(t.TimelineData);t.AnimationData=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this),this.aabb=new t.Rectangle,this.bones={},this.slots={},this.skins={},this.animations={},this.actions=[],this._sortedBones=[],this._sortedSlots=[],this._bonesChildren={}}return r(i,e),i._onSortSlots=function(t,e){return t.zOrder>e.zOrder?1:-1},i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){this.frameRate=0,this.cacheFrameRate=0,this.type=0,this.name=null,this.parent=null,this.userData=null,this.aabb.clear();for(var t in this.bones)this.bones[t].returnToPool(),delete this.bones[t];for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t];for(var t in this.skins)this.skins[t].returnToPool(),delete this.skins[t];for(var t in this.animations)this.animations[t].returnToPool(),delete this.animations[t];if(this.actions.length){for(var t=0,e=this.actions.length;t<e;++t)this.actions[t].returnToPool();this.actions.length=0}this._boneDirty=!1,this._slotDirty=!1,this._defaultSkin=null,this._defaultAnimation=null,this._sortedBones.length&&(this._sortedBones.length=0),this._sortedSlots.length&&(this._sortedSlots.length=0);for(var t in this._bonesChildren)delete this._bonesChildren[t]},i.prototype._sortBones=function(){var t=this._sortedBones.length;if(t){var e=this._sortedBones.concat(),i=0,n=0;for(this._sortedBones.length=0;n<t;){var r=e[i++];i>=t&&(i=0),this._sortedBones.indexOf(r)>=0||r.parent&&this._sortedBones.indexOf(r.parent)<0||r.ik&&this._sortedBones.indexOf(r.ik)<0||(r.ik&&r.chain>0&&r.chainIndex==r.chain?this._sortedBones.splice(this._sortedBones.indexOf(r.parent)+1,0,r):this._sortedBones.push(r),n++)}}},i.prototype._sortSlots=function(){this._sortedSlots.sort(i._onSortSlots)},i.prototype.cacheFrames=function(t){if(this.cacheFrameRate!=t){this.cacheFrameRate=t;var e=this.cacheFrameRate/this.frameRate;for(var i in this.animations)this.animations[i].cacheFrames(e)}},i.prototype.addBone=function(t,e){if(!t||!t.name||this.bones[t.name])throw new Error;if(e){var i=this.getBone(e);i?t.parent=i:(this._bonesChildren[e]=this._bonesChildren[e]||[]).push(t)}var n=this._bonesChildren[t.name];if(n){for(var r=0,s=n.length;r<s;++r)n[r].parent=t;delete this._bonesChildren[t.name]}this.bones[t.name]=t,this._sortedBones.push(t),this._boneDirty=!0},i.prototype.addSlot=function(t){if(!t||!t.name||this.slots[t.name])throw new Error;this.slots[t.name]=t,this._sortedSlots.push(t),this._slotDirty=!0},i.prototype.addSkin=function(t){if(!t||!t.name||this.skins[t.name])throw new Error;this.skins[t.name]=t,this._defaultSkin||(this._defaultSkin=t)},i.prototype.addAnimation=function(t){if(!t||!t.name||this.animations[t.name])throw new Error;this.animations[t.name]=t,this._defaultAnimation||(this._defaultAnimation=t)},i.prototype.getBone=function(t){return this.bones[t]},i.prototype.getSlot=function(t){return this.slots[t]},i.prototype.getSkin=function(t){return t?this.skins[t]:this._defaultSkin},i.prototype.getAnimation=function(t){return t?this.animations[t]:this._defaultAnimation},Object.defineProperty(i.prototype,"sortedBones",{get:function(){return this._boneDirty&&(this._boneDirty=!1,this._sortBones()),this._sortedBones},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortedSlots",{get:function(){return this._slotDirty&&(this._slotDirty=!1,this._sortSlots()),this._sortedSlots},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultSkin",{get:function(){return this._defaultSkin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultAnimation",{get:function(){return this._defaultAnimation},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.ArmatureData=e;var i=function(e){function i(){e.call(this),this.transform=new t.Transform}return r(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.bendPositive=!1,this.chain=0,this.chainIndex=0,this.weight=0,this.length=0,this.name=null,this.parent=null,this.ik=null,this.transform.identity()},i}(t.BaseObject);t.BoneData=i;var n=function(e){function i(){e.call(this),this.actions=[]}return r(i,e),i.generateColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){if(this.displayIndex=0,this.zOrder=0,this.blendMode=0,this.name=null,this.parent=null,this.color=null,this.actions.length){for(var t=0,e=this.actions.length;t<e;++t)this.actions[t].returnToPool();this.actions.length=0}},i.DEFAULT_COLOR=new t.ColorTransform,i}(t.BaseObject);t.SlotData=n;var s=function(t){function e(){t.call(this),this.name=null,this.slots={}}return r(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){this.name=null;for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t]},e.prototype.addSlot=function(t){if(!t||!t.slot||this.slots[t.slot.name])throw new Error;this.slots[t.slot.name]=t},e.prototype.getSlot=function(t){return this.slots[t]},e}(t.BaseObject);t.SkinData=s;var o=function(t){function e(){t.call(this),this.displays=[]}return r(e,t),e.toString=function(){return"[class dragonBones.SlotDisplayDataSet]"},e.prototype._onClear=function(){if(this.slot=null,this.displays.length){for(var t=0,e=this.displays.length;t<e;++t)this.displays[t].returnToPool();this.displays.length=0}},e}(t.BaseObject);t.SlotDisplayDataSet=o;var a=function(e){function i(){e.call(this),this.pivot=new t.Point,this.transform=new t.Transform}return r(i,e),i.toString=function(){return"[class dragonBones.DisplayData]"},i.prototype._onClear=function(){this.isRelativePivot=!1,this.type=0,this.name=null,this.texture=null,this.armature=null,this.mesh&&(this.mesh.returnToPool(),this.mesh=null),this.pivot.clear(),this.transform.identity()},i}(t.BaseObject);t.DisplayData=a;var c=function(e){function i(){e.call(this),this.slotPose=new t.Matrix,this.uvs=[],this.vertices=[],this.vertexIndices=[],this.boneIndices=[],this.weights=[],this.boneVertices=[],this.bones=[],this.inverseBindPose=[]}return r(i,e),i.toString=function(){return"[class dragonBones.MeshData]"},i.prototype._onClear=function(){this.skinned=!1,this.slotPose.identity(),this.uvs.length&&(this.uvs.length=0),this.vertices.length&&(this.vertices.length=0),this.vertexIndices.length&&(this.vertexIndices.length=0),this.boneIndices.length&&(this.boneIndices.length=0),this.weights.length&&(this.weights.length=0),this.boneVertices.length&&(this.boneVertices.length=0),this.bones.length&&(this.bones.length=0),this.inverseBindPose.length&&(this.inverseBindPose.length=0)},i}(t.BaseObject);t.MeshData=c}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this),this.armatures={},this._armatureNames=[]}return r(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){this.autoSearch=!1,this.frameRate=0,this.name=null,this.userData=null;for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];this._armatureNames.length&&(this._armatureNames.length=0)},e.prototype.getArmature=function(t){return this.armatures[t]},e.prototype.addArmature=function(t){if(!t||!t.name||this.armatures[t.name])throw new Error;this.armatures[t.name]=t,this._armatureNames.push(t.name),t.parent=this},Object.defineProperty(e.prototype,"armatureNames",{get:function(){return this._armatureNames},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this)}return r(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){this.type=0,this.data=null,this.bone=null,this.slot=null},e}(t.BaseObject);t.ActionData=e;var i=function(t){function e(){t.call(this)}return r(e,t),e.toString=function(){return"[class dragonBones.EventData]"},e.prototype._onClear=function(){this.type=10,this.name=null,this.data=null,this.bone=null,this.slot=null},e}(t.BaseObject);t.EventData=i;var n=function(t){function e(){t.call(this)}return r(e,t),e.prototype._onClear=function(){this.position=0,this.duration=0,this.prev=null,this.next=null},e}(t.BaseObject);t.FrameData=n;var s=function(t){function e(){t.call(this)}return r(e,t),e.samplingCurve=function(t,e){if(0==t.length||0==e)return null;var i=e+2,n=1/i,r=new Array(2*(i-1));t=t.concat(),t.unshift(0,0),t.push(1,1);for(var s=0,o=0;o<i-1;++o){for(var a=n*(o+1);t[s+6]<a;)s+=6;var c=t[s],h=t[s+6],l=(a-c)/(h-c),u=1-l,d=u*u,_=l*l,f=u*d,p=3*l*d,g=3*u*_,m=l*_;r[2*o]=f*c+p*t[s+2]+g*t[s+4]+m*h,r[2*o+1]=f*t[s+1]+p*t[s+3]+g*t[s+5]+m*t[s+7]}return r},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.tweenEasing=0,this.curve=null},e}(n);t.TweenFrameData=s;var o=function(t){function e(){t.call(this),this.actions=[],this.events=[]}return r(e,t),e.toString=function(){return"[class dragonBones.AnimationFrameData]"},e.prototype._onClear=function(){if(t.prototype._onClear.call(this),this.actions.length){for(var e=0,i=this.actions.length;e<i;++e)this.actions[e].returnToPool();this.actions.length=0}if(this.events.length){for(var e=0,i=this.events.length;e<i;++e)this.events[e].returnToPool();this.events.length=0}},e}(n);t.AnimationFrameData=o;var a=function(e){function i(){e.call(this),this.transform=new t.Transform}return r(i,e),i.toString=function(){return"[class dragonBones.BoneFrameData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.tweenScale=!1,this.tweenRotate=0,this.transform.identity()},i}(s);t.BoneFrameData=a;var c=function(e){function i(){e.call(this)}return r(i,e),i.generateColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotFrameData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.displayIndex=0,this.zOrder=0,this.color=null},i.DEFAULT_COLOR=new t.ColorTransform,i}(s);t.SlotFrameData=c;var h=function(t){function e(){t.call(this),this.tweens=[],this.keys=[]}return r(e,t),e.toString=function(){return"[class dragonBones.ExtensionFrameData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0,this.tweens.length&&(this.tweens.length=0),this.keys.length&&(this.keys.length=0)},e}(s);t.ExtensionFrameData=h}(n||(n={}));var n;!function(t){var e=function(){function e(){this._data=null,this._armature=null,this._skin=null,this._slotDisplayDataSet=null,this._mesh=null,this._animation=null,this._timeline=null,this._isOldData=!1,this._isGlobalTransform=!1,this._isAutoTween=!1,this._animationTweenEasing=0,this._timelinePivot=new t.Point,this._armatureScale=1,this._helpPoint=new t.Point,this._helpTransformA=new t.Transform,this._helpTransformB=new t.Transform,this._helpMatrix=new t.Matrix,this._rawBones=[]}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 0;case"armature":return 0;case"movieclip":return 1;default:return 0}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"armature":return 1;case"mesh":return 2;default:return 0}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"stop":return 1;case"gotoandplay":return 2;case"gotoandstop":return 3;case"fadein":return 4;case"fadeout":return 5;default:return 4}},e.prototype._getTimelineFrameMatrix=function(e,i,n,r){var s=Math.floor(n*e.frameCount/e.duration);if(1==i.frames.length||s>=i.frames.length)r.copyFrom(i.frames[0].transform);else{var o=i.frames[s],a=0;o.tweenEasing!=t.DragonBones.NO_TWEEN?(a=(n-o.position)/o.duration,0!=o.tweenEasing&&(a=t.TweenTimelineState._getEasingValue(a,o.tweenEasing))):o.curve&&(a=(n-o.position)/o.duration,a=t.TweenTimelineState._getCurveEasingValue(a,o.curve));var c=o.next;r.x=c.transform.x-o.transform.x,r.y=c.transform.y-o.transform.y,r.skewX=t.Transform.normalizeRadian(c.transform.skewX-o.transform.skewX),r.skewY=t.Transform.normalizeRadian(c.transform.skewY-o.transform.skewY),r.scaleX=c.transform.scaleX-o.transform.scaleX,r.scaleY=c.transform.scaleY-o.transform.scaleY,r.x=o.transform.x+r.x*a,r.y=o.transform.y+r.y*a,r.skewX=o.transform.skewX+r.skewX*a,r.skewY=o.transform.skewY+r.skewY*a,r.scaleX=o.transform.scaleX+r.scaleX*a,r.scaleY=o.transform.scaleY+r.scaleY*a}r.add(i.originTransform)},e.prototype._globalToLocal=function(t){for(var e=[],i=t.sortedBones.concat().reverse(),n=0,r=i.length;n<r;++n){var s=i[n];s.parent&&(s.parent.transform.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(s.transform.x,s.transform.y,s.transform),s.transform.rotation-=s.parent.transform.rotation);for(var o in t.animations){var a=t.animations[o],c=a.getBoneTimeline(s.name);if(c){var h=s.parent?a.getBoneTimeline(s.parent.name):null;this._helpTransformB.copyFrom(c.originTransform),e.length=0;for(var l=0,u=c.frames.length;l<u;++l){var d=c.frames[l];e.indexOf(d)>=0||(e.push(d),h?(this._getTimelineFrameMatrix(a,h,d.position,this._helpTransformA),d.transform.add(this._helpTransformB),this._helpTransformA.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(d.transform.x,d.transform.y,d.transform),d.transform.rotation-=this._helpTransformA.rotation):d.transform.add(this._helpTransformB),d.transform.minus(s.transform),0==l?(c.originTransform.copyFrom(d.transform),d.transform.identity()):d.transform.minus(c.originTransform))}}}}},e.prototype._mergeFrameToAnimationTimeline=function(e,i,n){var r=Math.floor(e.position*this._armature.frameRate),s=this._animation.frames;if(0==s.length){var o=t.BaseObject.borrowObject(t.AnimationFrameData);if(o.position=0,this._animation.frameCount>1){s.length=this._animation.frameCount+1;var a=t.BaseObject.borrowObject(t.AnimationFrameData);a.position=this._animation.frameCount/this._armature.frameRate,s[0]=o,s[this._animation.frameCount]=a}}var c=null,h=s[r];if(!h||0!=r&&s[r-1]!=h.prev){c=t.BaseObject.borrowObject(t.AnimationFrameData),c.position=r/this._armature.frameRate,s[r]=c;for(var l=r+1,u=s.length;l<u;++l)h&&s[l]==h&&(s[l]=null)}else c=h;if(i)for(var l=0,u=i.length;l<u;++l)c.actions.push(i[l]);if(n)for(var l=0,u=n.length;l<u;++l)c.events.push(n[l]);for(var d=null,_=null,l=0,u=s.length;l<u;++l){var f=s[l];f&&_!=f?(_=f,d&&(_.prev=d,d.next=_,d.duration=_.position-d.position),d=_):s[l]=d}_.duration=this._animation.duration-_.position,_=s[0],d.next=_,_.prev=d},e.parseDragonBonesData=function(e){return t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(i,n){void 0===n&&(n=1);for(var r={},s=i[e.SUB_TEXTURE],o=0,a=s.length;o<a;o++){var c=s[o],h=c[e.NAME],l=new t.Rectangle,u=null;l.x=c[e.X]/n,l.y=c[e.Y]/n,l.width=c[e.WIDTH]/n,l.height=c[e.HEIGHT]/n,e.FRAME_WIDTH in c&&(u=new t.Rectangle,u.x=c[e.FRAME_X]/n,u.y=c[e.FRAME_Y]/n,u.width=c[e.FRAME_WIDTH]/n,u.height=c[e.FRAME_HEIGHT]/n),r[h]={region:l,frame:u,rotated:!1}}return r},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION="4.5",e.TEXTURE_ATLAS="TextureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.ARMATURE="armature",e.BONE="bone",e.IK="ik",e.SLOT="slot",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.FFD="ffd",e.FRAME="frame",e.PIVOT="pivot",e.TRANSFORM="transform",e.AABB="aabb",e.COLOR="color",e.FILTER="filter",e.VERSION="version",e.IS_GLOBAL="isGlobal",e.FRAME_RATE="frameRate",e.TYPE="type",e.NAME="name",e.PARENT="parent",e.LENGTH="length",e.DATA="data",e.DISPLAY_INDEX="displayIndex",e.Z_ORDER="z",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.TARGET="target",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CURVE="curve",e.EVENT="event",e.SOUND="sound",e.ACTION="action",e.ACTIONS="actions",e.DEFAULT_ACTIONS="defaultActions",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.TWEEN="tween",e.KEY="key",e.COLOR_TRANSFORM="colorTransform",e.TIMELINE="timeline",e.PIVOT_X="pX",e.PIVOT_Y="pY",e.LOOP="loop",e.AUTO_TWEEN="autoTween",e.HIDE="hide",e.RECTANGLE="rectangle",e.ELLIPSE="ellipse",e}();t.DataParser=e}(n||(n={}));var n;!function(t){var e=function(e){function i(){e.call(this)}return r(i,e),i._getBoolean=function(t,e,i){if(e in t){var n=t[e],r=typeof n;if("boolean"==r)return n;if("string"!=r)return!!n;switch(n){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},i._getNumber=function(t,e,i){if(e in t){var n=t[e];return null==n||"NaN"==n?i:+n||0}return i},i._getString=function(t,e,i){return e in t?String(t[e]):i},i._getParameter=function(t,e,i){return t&&t.length>e?t[e]:i},i.prototype._parseArmature=function(e){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.name=i._getString(e,i.NAME,null),n.frameRate=i._getNumber(e,i.FRAME_RATE,this._data.frameRate)||this._data.frameRate,i.TYPE in e&&"string"==typeof e[i.TYPE]?n.type=i._getArmatureType(e[i.TYPE]):n.type=i._getNumber(e,i.TYPE,0),this._armature=n,this._rawBones.length=0,i.AABB in e){var r=e[i.AABB];n.aabb.x=i._getNumber(r,i.X,0),n.aabb.y=i._getNumber(r,i.Y,0),n.aabb.width=i._getNumber(r,i.WIDTH,0),n.aabb.height=i._getNumber(r,i.HEIGHT,0)}if(i.BONE in e)for(var s=e[i.BONE],o=0,a=s.length;o<a;++o){var c=s[o],h=this._parseBone(c);n.addBone(h,i._getString(c,i.PARENT,null)),this._rawBones.push(h)}if(i.IK in e)for(var l=e[i.IK],o=0,a=l.length;o<a;++o)this._parseIK(l[o]);if(i.SLOT in e)for(var u=e[i.SLOT],d=0,o=0,a=u.length;o<a;++o)n.addSlot(this._parseSlot(u[o],d++));if(i.SKIN in e)for(var _=e[i.SKIN],o=0,a=_.length;o<a;++o)n.addSkin(this._parseSkin(_[o]));if(i.ANIMATION in e)for(var f=e[i.ANIMATION],o=0,a=f.length;o<a;++o)n.addAnimation(this._parseAnimation(f[o]));return(i.ACTIONS in e||i.DEFAULT_ACTIONS in e)&&this._parseActionData(e,n.actions,null,null),this._isOldData&&this._isGlobalTransform&&this._globalToLocal(n),this._armature=null,this._rawBones.length=0,n},i.prototype._parseBone=function(e){var n=t.BaseObject.borrowObject(t.BoneData);return n.name=i._getString(e,i.NAME,null),n.inheritTranslation=i._getBoolean(e,i.INHERIT_TRANSLATION,!0),n.inheritRotation=i._getBoolean(e,i.INHERIT_ROTATION,!0),n.inheritScale=i._getBoolean(e,i.INHERIT_SCALE,!0),n.length=i._getNumber(e,i.LENGTH,0)*this._armatureScale,i.TRANSFORM in e&&this._parseTransform(e[i.TRANSFORM],n.transform),this._isOldData&&(n.inheritRotation=!0,n.inheritScale=!1),n},i.prototype._parseIK=function(t){var e=this._armature.getBone(i._getString(t,i.BONE in t?i.BONE:i.NAME,null));e&&(e.ik=this._armature.getBone(i._getString(t,i.TARGET,null)),e.bendPositive=i._getBoolean(t,i.BEND_POSITIVE,!0),e.chain=i._getNumber(t,i.CHAIN,0),e.weight=i._getNumber(t,i.WEIGHT,1),e.chain>0&&e.parent&&!e.parent.ik?(e.parent.ik=e.ik,e.parent.chainIndex=0,e.parent.chain=0,e.chainIndex=1):(e.chain=0,e.chainIndex=0))},i.prototype._parseSlot=function(e,n){var r=t.BaseObject.borrowObject(t.SlotData);return r.name=i._getString(e,i.NAME,null),r.parent=this._armature.getBone(i._getString(e,i.PARENT,null)),r.displayIndex=i._getNumber(e,i.DISPLAY_INDEX,0),r.zOrder=i._getNumber(e,i.Z_ORDER,n),i.COLOR in e||i.COLOR_TRANSFORM in e?(r.color=t.SlotData.generateColor(),this._parseColorTransform(e[i.COLOR]||e[i.COLOR_TRANSFORM],r.color)):r.color=t.SlotData.DEFAULT_COLOR,i.BLEND_MODE in e&&"string"==typeof e[i.BLEND_MODE]?r.blendMode=i._getBlendMode(e[i.BLEND_MODE]):r.blendMode=i._getNumber(e,i.BLEND_MODE,0),(i.ACTIONS in e||i.DEFAULT_ACTIONS in e)&&this._parseActionData(e,r.actions,null,null),this._isOldData&&(i.COLOR_TRANSFORM in e?(r.color=t.SlotData.generateColor(),this._parseColorTransform(e[i.COLOR_TRANSFORM],r.color)):r.color=t.SlotData.DEFAULT_COLOR),r},i.prototype._parseSkin=function(e){var n=t.BaseObject.borrowObject(t.SkinData);if(n.name=i._getString(e,i.NAME,"__default")||"__default",i.SLOT in e){this._skin=n;for(var r=e[i.SLOT],s=0,o=0,a=r.length;o<a;++o)this._isOldData&&this._armature.addSlot(this._parseSlot(r[o],s++)),n.addSlot(this._parseSlotDisplaySet(r[o]));this._skin=null}return n},i.prototype._parseSlotDisplaySet=function(e){var n=t.BaseObject.borrowObject(t.SlotDisplayDataSet);if(n.slot=this._armature.getSlot(i._getString(e,i.NAME,null)),i.DISPLAY in e){var r=e[i.DISPLAY],s=n.displays;this._slotDisplayDataSet=n;for(var o=0,a=r.length;o<a;++o)s.push(this._parseDisplay(r[o]));this._slotDisplayDataSet=null}return n},i.prototype._parseDisplay=function(e){var n=t.BaseObject.borrowObject(t.DisplayData);if(n.name=i._getString(e,i.NAME,null),i.TYPE in e&&"string"==typeof e[i.TYPE]?n.type=i._getDisplayType(e[i.TYPE]):n.type=i._getNumber(e,i.TYPE,0),n.isRelativePivot=!0,i.PIVOT in e){var r=e[i.PIVOT];n.pivot.x=i._getNumber(r,i.X,0),n.pivot.y=i._getNumber(r,i.Y,0)}else if(this._isOldData){var s=e[i.TRANSFORM];n.isRelativePivot=!1,n.pivot.x=i._getNumber(s,i.PIVOT_X,0)*this._armatureScale,n.pivot.y=i._getNumber(s,i.PIVOT_Y,0)*this._armatureScale}else n.pivot.x=.5,n.pivot.y=.5;switch(i.TRANSFORM in e&&this._parseTransform(e[i.TRANSFORM],n.transform),n.type){case 0:break;case 1:break;case 2:n.mesh=this._parseMesh(e)}return n},i.prototype._parseMesh=function(e){var n=t.BaseObject.borrowObject(t.MeshData),r=e[i.VERTICES],s=e[i.UVS],o=e[i.TRIANGLES],a=Math.floor(r.length/2),c=Math.floor(o.length/3),h=new Array(this._armature.sortedBones.length);if(n.skinned=i.WEIGHTS in e&&e[i.WEIGHTS].length>0,n.uvs.length=2*a,n.vertices.length=2*a,n.vertexIndices.length=3*c,n.skinned){if(n.boneIndices.length=a,n.weights.length=a,n.boneVertices.length=a,i.SLOT_POSE in e){var l=e[i.SLOT_POSE];n.slotPose.a=l[0],n.slotPose.b=l[1],n.slotPose.c=l[2],n.slotPose.d=l[3],n.slotPose.tx=l[4],n.slotPose.ty=l[5]}if(i.BONE_POSE in e)for(var u=e[i.BONE_POSE],d=0,_=u.length;d<_;d+=7){var f=u[d],p=h[f]=new t.Matrix;p.a=u[d+1],p.b=u[d+2],p.c=u[d+3],p.d=u[d+4],p.tx=u[d+5],p.ty=u[d+6],p.invert()}}for(var d=0,g=0,_=r.length;d<_;d+=2){var m=d+1,v=d/2,y=n.vertices[d]=r[d]*this._armatureScale,T=n.vertices[m]=r[m]*this._armatureScale;if(n.uvs[d]=s[d],n.uvs[m]=s[m],n.skinned){var C=e[i.WEIGHTS],b=C[g],x=n.boneIndices[v]=new Array(b),S=n.weights[v]=new Array(b),E=n.boneVertices[v]=new Array(2*b);n.slotPose.transformPoint(y,T,this._helpPoint),y=n.vertices[d]=this._helpPoint.x,T=n.vertices[m]=this._helpPoint.y;for(var A=0;A<b;++A){var O=g+1+2*A,f=C[O],w=this._rawBones[f],R=n.bones.indexOf(w);R<0&&(R=n.bones.length,n.bones[R]=w,n.inverseBindPose[R]=h[f]),n.inverseBindPose[R].transformPoint(y,T,this._helpPoint),x[A]=R,S[A]=C[O+1],E[2*A]=this._helpPoint.x,E[2*A+1]=this._helpPoint.y}g+=2*b+1}}for(var d=0,_=o.length;d<_;++d)n.vertexIndices[d]=o[d];return n},i.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);n.name=i._getString(e,i.NAME,"__default")||"__default",n.frameCount=Math.max(i._getNumber(e,i.DURATION,1),1),n.position=i._getNumber(e,i.POSITION,0)/this._armature.frameRate,n.duration=n.frameCount/this._armature.frameRate,n.playTimes=i._getNumber(e,i.PLAY_TIMES,1),n.fadeInTime=i._getNumber(e,i.FADE_IN_TIME,0),this._animation=n;var r=i._getString(e,i.ANIMATION,null);if(r)return n.animation=this._armature.getAnimation(r),!n.animation,n;if(this._parseTimeline(e,n,this._parseAnimationFrame),i.BONE in e)for(var s=e[i.BONE],o=0,a=s.length;o<a;++o)n.addBoneTimeline(this._parseBoneTimeline(s[o]));if(i.SLOT in e)for(var c=e[i.SLOT],o=0,a=c.length;o<a;++o)n.addSlotTimeline(this._parseSlotTimeline(c[o]));if(i.FFD in e)for(var h=e[i.FFD],o=0,a=h.length;o<a;++o)n.addFFDTimeline(this._parseFFDTimeline(h[o]));
if(this._isOldData){if(this._isAutoTween=i._getBoolean(e,i.AUTO_TWEEN,!0),this._animationTweenEasing=i._getNumber(e,i.TWEEN_EASING,0)||0,n.playTimes=i._getNumber(e,i.LOOP,1),i.TIMELINE in e){for(var l=e[i.TIMELINE],o=0,a=l.length;o<a;++o)n.addBoneTimeline(this._parseBoneTimeline(l[o]));for(var o=0,a=l.length;o<a;++o)n.addSlotTimeline(this._parseSlotTimeline(l[o]))}}else this._isAutoTween=!1,this._animationTweenEasing=0;for(var o in this._armature.bones){var u=this._armature.bones[o];if(!n.getBoneTimeline(u.name)){var d=t.BaseObject.borrowObject(t.BoneTimelineData),_=t.BaseObject.borrowObject(t.BoneFrameData);d.bone=u,d.frames[0]=_,n.addBoneTimeline(d)}}for(var o in this._armature.slots){var f=this._armature.slots[o];if(!n.getSlotTimeline(f.name)){var p=t.BaseObject.borrowObject(t.SlotTimelineData),g=t.BaseObject.borrowObject(t.SlotFrameData);p.slot=f,g.displayIndex=f.displayIndex,f.color==t.SlotData.DEFAULT_COLOR?g.color=t.SlotFrameData.DEFAULT_COLOR:(g.color=t.SlotFrameData.generateColor(),g.color.copyFrom(f.color)),p.frames[0]=g,n.addSlotTimeline(p),this._isOldData&&(g.displayIndex=-1)}}return this._animation=null,n},i.prototype._parseBoneTimeline=function(e){var n=t.BaseObject.borrowObject(t.BoneTimelineData);n.bone=this._armature.getBone(i._getString(e,i.NAME,null)),this._parseTimeline(e,n,this._parseBoneFrame);for(var r=n.originTransform,s=null,o=0,a=n.frames.length;o<a;++o){var c=n.frames[o];s?s!=c&&c.transform.minus(r):(r.copyFrom(c.transform),c.transform.identity(),0==r.scaleX&&(r.scaleX=.001),0==r.scaleY&&(r.scaleY=.001)),s=c}return 1==n.scale&&0==n.offset||(this._animation.hasAsynchronyTimeline=!0),this._isOldData&&(i.PIVOT_X in e||i.PIVOT_Y in e)?(this._timelinePivot.x=i._getNumber(e,i.PIVOT_X,0),this._timelinePivot.y=i._getNumber(e,i.PIVOT_Y,0)):this._timelinePivot.clear(),n},i.prototype._parseSlotTimeline=function(e){var n=t.BaseObject.borrowObject(t.SlotTimelineData);return n.slot=this._armature.getSlot(i._getString(e,i.NAME,null)),this._parseTimeline(e,n,this._parseSlotFrame),1==n.scale&&0==n.offset||(this._animation.hasAsynchronyTimeline=!0),n},i.prototype._parseFFDTimeline=function(e){var n=t.BaseObject.borrowObject(t.FFDTimelineData);n.skin=this._armature.getSkin(i._getString(e,i.SKIN,null)),n.slot=n.skin.getSlot(i._getString(e,i.SLOT,null));for(var r=i._getString(e,i.NAME,null),s=0,o=n.slot.displays.length;s<o;++s){var a=n.slot.displays[s];if(a.mesh&&a.name==r){n.displayIndex=s,this._mesh=a.mesh;break}}return this._parseTimeline(e,n,this._parseFFDFrame),this._mesh=null,n},i.prototype._parseAnimationFrame=function(e,n,r){var s=t.BaseObject.borrowObject(t.AnimationFrameData);return this._parseFrame(e,s,n,r),(i.ACTION in e||i.ACTIONS in e)&&this._parseActionData(e,s.actions,null,null),(i.EVENT in e||i.SOUND in e)&&this._parseEventData(e,s.events,null,null),s},i.prototype._parseBoneFrame=function(e,n,r){var s=t.BaseObject.borrowObject(t.BoneFrameData);if(s.tweenRotate=i._getNumber(e,i.TWEEN_ROTATE,0),s.tweenScale=i._getBoolean(e,i.TWEEN_SCALE,!0),this._parseTweenFrame(e,s,n,r),i.TRANSFORM in e){var o=e[i.TRANSFORM];this._parseTransform(o,s.transform),this._isOldData&&(this._helpPoint.x=this._timelinePivot.x+i._getNumber(o,i.PIVOT_X,0),this._helpPoint.y=this._timelinePivot.y+i._getNumber(o,i.PIVOT_Y,0),s.transform.toMatrix(this._helpMatrix),this._helpMatrix.transformPoint(this._helpPoint.x,this._helpPoint.y,this._helpPoint,!0),s.transform.x+=this._helpPoint.x,s.transform.y+=this._helpPoint.y)}var a=this._timeline.bone;if(i.ACTION in e||i.ACTIONS in e){var c=this._armature.getSlot(a.name),h=[];this._parseActionData(e,h,a,c),this._mergeFrameToAnimationTimeline(s,h,null)}if(i.EVENT in e||i.SOUND in e){var l=[];this._parseEventData(e,l,a,null),this._mergeFrameToAnimationTimeline(s,null,l)}return s},i.prototype._parseSlotFrame=function(e,n,r){var s=t.BaseObject.borrowObject(t.SlotFrameData);if(s.displayIndex=i._getNumber(e,i.DISPLAY_INDEX,0),this._parseTweenFrame(e,s,n,r),i.COLOR in e||i.COLOR_TRANSFORM in e?(s.color=t.SlotFrameData.generateColor(),this._parseColorTransform(e[i.COLOR]||e[i.COLOR_TRANSFORM],s.color)):s.color=t.SlotFrameData.DEFAULT_COLOR,this._isOldData)i._getBoolean(e,i.HIDE,!1)&&(s.displayIndex=-1);else if(i.ACTION in e||i.ACTIONS in e){var o=this._timeline.slot,a=[];this._parseActionData(e,a,o.parent,o),this._mergeFrameToAnimationTimeline(s,a,null)}return s},i.prototype._parseFFDFrame=function(e,n,r){var s=t.BaseObject.borrowObject(t.ExtensionFrameData);s.type=i._getNumber(e,i.TYPE,0),this._parseTweenFrame(e,s,n,r);for(var o=e[i.VERTICES],a=i._getNumber(e,i.OFFSET,0),c=0,h=0,l=0,u=this._mesh.vertices.length;l<u;l+=2)if(!o||l<a||l-a>=o.length?(c=0,h=0):(c=o[l-a]*this._armatureScale,h=o[l+1-a]*this._armatureScale),this._mesh.skinned){this._mesh.slotPose.transformPoint(c,h,this._helpPoint,!0),c=this._helpPoint.x,h=this._helpPoint.y;for(var d=this._mesh.boneIndices[l/2],_=0,f=d.length;_<f;++_){var p=d[_];this._mesh.inverseBindPose[p].transformPoint(c,h,this._helpPoint,!0),s.tweens.push(this._helpPoint.x,this._helpPoint.y)}}else s.tweens.push(c,h);return s},i.prototype._parseTweenFrame=function(e,n,r,s){this._parseFrame(e,n,r,s),n.duration>0?(i.TWEEN_EASING in e?n.tweenEasing=i._getNumber(e,i.TWEEN_EASING,t.DragonBones.NO_TWEEN):this._isOldData?n.tweenEasing=this._isAutoTween?this._animationTweenEasing:t.DragonBones.NO_TWEEN:n.tweenEasing=t.DragonBones.NO_TWEEN,this._isOldData&&1==this._animation.scale&&1==this._timeline.scale&&n.duration*this._armature.frameRate<2&&(n.tweenEasing=t.DragonBones.NO_TWEEN),i.CURVE in e&&(n.curve=t.TweenFrameData.samplingCurve(e[i.CURVE],s))):(n.tweenEasing=t.DragonBones.NO_TWEEN,n.curve=null)},i.prototype._parseFrame=function(t,e,i,n){e.position=i/this._armature.frameRate,e.duration=n/this._armature.frameRate},i.prototype._parseTimeline=function(e,n,r){if(n.scale=i._getNumber(e,i.SCALE,1),n.offset=i._getNumber(e,i.OFFSET,0),this._timeline=n,i.FRAME in e){var s=e[i.FRAME];if(s.length)if(1==s.length)n.frames.length=1,n.frames[0]=r.call(this,s[0],0,i._getNumber(s[0],i.DURATION,1));else{n.frames.length=this._animation.frameCount+1;for(var o=0,a=0,c=null,h=null,l=0,u=0,d=n.frames.length;l<d;++l){if(o+a<=l&&u<s.length){var _=s[u++];o=l,a=i._getNumber(_,i.DURATION,1),c=r.call(this,_,o,a),h&&(h.next=c,c.prev=h,this._isOldData&&h instanceof t.TweenFrameData&&_[i.DISPLAY_INDEX]==-1&&(h.tweenEasing=t.DragonBones.NO_TWEEN)),h=c}n.frames[l]=c}c.duration=this._animation.duration-c.position,c=n.frames[0],h.next=c,c.prev=h,this._isOldData&&h instanceof t.TweenFrameData&&s[0][i.DISPLAY_INDEX]==-1&&(h.tweenEasing=t.DragonBones.NO_TWEEN)}}this._timeline=null},i.prototype._parseActionData=function(e,n,r,s){var o=e[i.ACTION]||e[i.ACTIONS]||e[i.DEFAULT_ACTIONS];if("string"==typeof o){var a=t.BaseObject.borrowObject(t.ActionData);a.type=4,a.data=[o,-1,-1],a.bone=r,a.slot=s,n.push(a)}else if(o instanceof Array)for(var c=0,h=o.length;c<h;++c){var l=o[c]instanceof Array?o[c]:null,a=t.BaseObject.borrowObject(t.ActionData),u=l?null:o[c].gotoAndPlay;if(l){var d=l[0];"string"==typeof d?a.type=i._getActionType(d):a.type=i._getParameter(l,0,4)}else a.type=2;switch(a.type){case 0:a.data=[l?i._getParameter(l,1,null):u,i._getParameter(l,2,-1)];break;case 1:a.data=[l?i._getParameter(l,1,null):u];break;case 2:a.data=[l?i._getParameter(l,1,null):u,i._getParameter(l,2,0),i._getParameter(l,3,-1)];break;case 3:a.data=[l?i._getParameter(l,1,null):u,i._getParameter(l,2,0)];break;case 4:a.data=[l?i._getParameter(l,1,null):u,i._getParameter(l,2,-1),i._getParameter(l,3,-1)];break;case 5:a.data=[l?i._getParameter(l,1,null):u,i._getParameter(l,2,0)]}a.bone=r,a.slot=s,n.push(a)}},i.prototype._parseEventData=function(e,n,r,s){if(i.SOUND in e){var o=t.BaseObject.borrowObject(t.EventData);o.type=11,o.name=e[i.SOUND],o.bone=r,o.slot=s,n.push(o)}if(i.EVENT in e){var a=t.BaseObject.borrowObject(t.EventData);a.type=10,a.name=e[i.EVENT],a.bone=r,a.slot=s,i.DATA in e&&(a.data=e[i.DATA]),n.push(a)}},i.prototype._parseTransform=function(e,n){n.x=i._getNumber(e,i.X,0)*this._armatureScale,n.y=i._getNumber(e,i.Y,0)*this._armatureScale,n.skewX=i._getNumber(e,i.SKEW_X,0)*t.DragonBones.ANGLE_TO_RADIAN,n.skewY=i._getNumber(e,i.SKEW_Y,0)*t.DragonBones.ANGLE_TO_RADIAN,n.scaleX=i._getNumber(e,i.SCALE_X,1),n.scaleY=i._getNumber(e,i.SCALE_Y,1)},i.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*i._getNumber(t,i.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*i._getNumber(t,i.RED_MULTIPLIER,100),e.greenMultiplier=.01*i._getNumber(t,i.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*i._getNumber(t,i.BLUE_MULTIPLIER,100),e.alphaOffset=i._getNumber(t,i.ALPHA_OFFSET,0),e.redOffset=i._getNumber(t,i.RED_OFFSET,0),e.greenOffset=i._getNumber(t,i.GREEN_OFFSET,0),e.blueOffset=i._getNumber(t,i.BLUE_OFFSET,0)},i.prototype.parseDragonBonesData=function(e,n){if(void 0===n&&(n=1),e){var r=i._getString(e,i.VERSION,null);if(this._isOldData=r==i.DATA_VERSION_2_3||r==i.DATA_VERSION_3_0,this._isOldData?this._isGlobalTransform=i._getBoolean(e,i.IS_GLOBAL,!0):this._isGlobalTransform=!1,this._armatureScale=n,r==i.DATA_VERSION||r==i.DATA_VERSION_4_0||this._isOldData){var s=t.BaseObject.borrowObject(t.DragonBonesData);if(s.name=i._getString(e,i.NAME,null),s.frameRate=i._getNumber(e,i.FRAME_RATE,24)||24,i.ARMATURE in e){this._data=s;for(var o=e[i.ARMATURE],a=0,c=o.length;a<c;++a)s.addArmature(this._parseArmature(o[a]));this._data=null}return s}throw new Error("Nonsupport data version.")}throw new Error},i.prototype.parseTextureAtlasData=function(e,n,r){if(void 0===r&&(r=0),e){if(n.name=i._getString(e,i.NAME,null),n.imagePath=i._getString(e,i.IMAGE_PATH,null),r>0?n.scale=r:r=n.scale=i._getNumber(e,i.SCALE,n.scale),r=1/r,i.SUB_TEXTURE in e)for(var s=e[i.SUB_TEXTURE],o=0,a=s.length;o<a;++o){var c=s[o],h=n.generateTextureData();h.name=i._getString(c,i.NAME,null),h.rotated=i._getBoolean(c,i.ROTATED,!1),h.region.x=i._getNumber(c,i.X,0)*r,h.region.y=i._getNumber(c,i.Y,0)*r,h.region.width=i._getNumber(c,i.WIDTH,0)*r,h.region.height=i._getNumber(c,i.HEIGHT,0)*r;var l=i._getNumber(c,i.FRAME_WIDTH,-1),u=i._getNumber(c,i.FRAME_HEIGHT,-1);l>0&&u>0&&(h.frame=t.TextureData.generateRectangle(),h.frame.x=i._getNumber(c,i.FRAME_X,0)*r,h.frame.y=i._getNumber(c,i.FRAME_Y,0)*r,h.frame.width=l*r,h.frame.height=u*r),n.addTexture(h)}return n}throw new Error},i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i._instance=null,i}(t.DataParser);t.ObjectDataParser=e}(n||(n={}));var n;!function(t){var e=function(t){function e(){t.call(this),this.textures={}}return r(e,t),e.prototype._onClear=function(){this.autoSearch=!1,this.scale=1,this.name=null,this.imagePath=null;for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t]},e.prototype.addTexture=function(t){if(!t||!t.name||this.textures[t.name])throw new Error;this.textures[t.name]=t,t.parent=this},e.prototype.getTexture=function(t){return this.textures[t]},e.prototype.dispose=function(){this.returnToPool()},e}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function i(){e.call(this),this.region=new t.Rectangle}return r(i,e),i.generateRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name=null,this.frame=null,this.parent=null,this.region.clear()},i}(t.BaseObject);t.TextureData=i}(n||(n={}));var n;!function(t){var e=function(){function e(e){void 0===e&&(e=null),this.autoSearch=!1,this._dataParser=null,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dataParser=e||t.ObjectDataParser.getInstance()}return e.prototype._getTextureData=function(t,e){var i=this._textureAtlasDataMap[t];if(i)for(var n=0,r=i.length;n<r;++n){var s=i[n].getTexture(e);if(s)return s}if(this.autoSearch)for(var n in this._textureAtlasDataMap){i=this._textureAtlasDataMap[n];for(var o=0,a=i.length;o<a;++o){var c=i[o];if(c.autoSearch){var s=c.getTexture(e);if(s)return s}}}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,n){if(t){var r=this._dragonBonesDataMap[t];if(r){var s=r.getArmature(e);if(s)return n.dataName=t,n.data=r,n.armature=s,n.skin=s.getSkin(i),n.skin||(n.skin=s.defaultSkin),!0}}if(!t||this.autoSearch)for(var o in this._dragonBonesDataMap){var r=this._dragonBonesDataMap[o];if(!t||r.autoSearch){var s=r.getArmature(e);if(s)return n.dataName=o,n.data=r,n.armature=s,n.skin=s.getSkin(i),n.skin||(n.skin=s.defaultSkin),!0}}return!1},e.prototype._buildBones=function(e,i){for(var n=e.armature.sortedBones,r=0,s=n.length;r<s;++r){var o=n[r],a=t.BaseObject.borrowObject(t.Bone);a.name=o.name,a.inheritTranslation=o.inheritTranslation,a.inheritRotation=o.inheritRotation,a.inheritScale=o.inheritScale,a.length=o.length,a.origin.copyFrom(o.transform),i.addBone(a,o.parent?o.parent.name:null),o.ik&&(a.ikBendPositive=o.bendPositive,a.ikWeight=o.weight,a._setIK(i.getBone(o.ik.name),o.chain,o.chainIndex))}},e.prototype._buildSlots=function(t,e){var i=t.skin,n=t.armature.defaultSkin,r={};for(var s in n.slots){var o=n.slots[s];r[o.slot.name]=o}if(i!=n)for(var s in i.slots){var o=i.slots[s];r[o.slot.name]=o}for(var a=t.armature.sortedSlots,s=0,c=a.length;s<c;++s){var h=a[s],o=r[h.name];if(o){var l=this._generateSlot(t,o);l&&(l._displayDataSet=o,l._setDisplayIndex(h.displayIndex),l._setBlendMode(h.blendMode),l._setColor(h.color),l._replacedDisplayDataSet.length=l._displayDataSet.displays.length,e.addSlot(l,h.parent.name))}}},e.prototype._replaceSlotDisplay=function(t,e,i,n){if(n<0&&(n=i.displayIndex),n>=0){var r=i.displayList;if(r.length<=n&&(r.length=n+1),e.texture||(e.texture=this._getTextureData(t.dataName,e.name)),i._replacedDisplayDataSet.length<=n&&(i._replacedDisplayDataSet.length=n+1),i._replacedDisplayDataSet[n]=e,1==e.type){var s=this.buildArmature(e.name,t.dataName);r[n]=s}else e.mesh||n<i._displayDataSet.displays.length&&i._displayDataSet.displays[n].mesh?r[n]=i.MeshDisplay:r[n]=i.rawDisplay;i.displayList=r,i.invalidUpdate()}},e.prototype.parseDragonBonesData=function(t,e){void 0===e&&(e=null);var i=this._dataParser.parseDragonBonesData(t,1);return this.addDragonBonesData(i,e),i},e.prototype.parseTextureAtlasData=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=0);var r=this._generateTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,n),this._generateTextureAtlasData(r,e),this.addTextureAtlasData(r,i),r},e.prototype.getDragonBonesData=function(t){return this._dragonBonesDataMap[t]},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),!t)throw new Error;e=e||t.name,e?this._dragonBonesDataMap[e]?console.warn("Same name data."):this._dragonBonesDataMap[e]=t:console.warn("Unnamed data.")},e.prototype.removeDragonBonesData=function(e,i){void 0===i&&(i=!0);var n=this._dragonBonesDataMap[e];if(n){if(i){if(t.DragonBones.debug)for(var r=0,s=t.DragonBones._armatures.length;r<s;++r){var o=t.DragonBones._armatures[r];if(o.armatureData.parent==n)throw new Error("ArmatureData: "+o.armatureData.name+" DragonBonesData: "+e)}n.returnToPool()}delete this._dragonBonesDataMap[e]}},e.prototype.getTextureAtlasData=function(t){return this._textureAtlasDataMap[t]},e.prototype.addTextureAtlasData=function(t,e){if(void 0===e&&(e=null),!t)throw new Error;if(e=e||t.name){var i=this._textureAtlasDataMap[e]=this._textureAtlasDataMap[e]||[];i.indexOf(t)<0&&i.push(t)}else console.warn("Unnamed data.")},e.prototype.removeTextureAtlasData=function(t,e){void 0===e&&(e=!0);var i=this._textureAtlasDataMap[t];if(i){if(e)for(var n=0,r=i.length;n<r;++n)i[n].returnToPool();delete this._textureAtlasDataMap[t]}},e.prototype.clear=function(t){void 0===t&&(t=!0);for(var e in this._dragonBonesDataMap)t&&this._dragonBonesDataMap[e].returnToPool(),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=this._textureAtlasDataMap[e],n=0,r=i.length;n<r;++n)i[n].returnToPool();delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);var n={};if(this._fillBuildArmaturePackage(e,t,i,n)){var r=this._generateArmature(n);return this._buildBones(n,r),this._buildSlots(n,r),r.advanceTime(0),r}return null},e.prototype.copyAnimationsToArmature=function(e,i,n,r,s){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=!0);var o={};if(this._fillBuildArmaturePackage(r,i,n,o)){var a=o.armature;if(s)e.animation.animations=a.animations;else{var c={};for(var h in e.animation.animations)c[h]=e.animation.animations[h];for(var h in a.animations)c[h]=a.animations[h];e.animation.animations=c}if(o.skin){for(var l=e.getSlots(),u=0,d=l.length;u<d;++u)for(var _=l[u],f=_.displayList,p=0,g=f.length;p<g;++p){var m=f[p];if(m instanceof t.Armature){var v=o.skin.getSlot(_.name).displays;if(p<v.length){var y=v[p];1==y.type&&this.copyAnimationsToArmature(m,y.name,n,r,s)}}}return!0}}return!1},e.prototype.replaceSlotDisplay=function(t,e,i,n,r,s){void 0===s&&(s=-1);var o={};if(this._fillBuildArmaturePackage(t,e,null,o)){var a=o.skin.getSlot(i);if(a)for(var c=0,h=a.displays.length;c<h;++c){var l=a.displays[c];if(l.name==n){this._replaceSlotDisplay(o,l,r,s);break}}}},e.prototype.replaceSlotDisplayList=function(t,e,i,n){var r={};if(this._fillBuildArmaturePackage(t,e,null,r)){var s=r.skin.getSlot(i);if(s)for(var o=0,a=0,c=s.displays.length;a<c;++a){var h=s.displays[a];this._replaceSlotDisplay(r,h,n,o++)}}},e}();t.BaseFactory=e}(n||(n={})),e.exports=n},{}],222:[function(t,e,i){var n=sp.spine;sp._SGSkeleton=_ccsg.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,i){_ccsg.Node.prototype.ctor.call(this),0===arguments.length?this.init():this.initWithArgs(t,e,i)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new sp._SGSkeleton.CanvasRenderCmd(this):new sp._SGSkeleton.WebGLRenderCmd(this)},init:function(){_ccsg.Node.prototype.init.call(this),this._premultipliedAlpha=cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this.scheduleUpdate()},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,i){var r,s,o,a=t,c=e;if(cc.js.isString(a)){if(cc.js.isString(c)){var h=cc.loader.getRes(c);sp._atlasLoader.setAtlasFile(c),s=new n.Atlas(h,sp._atlasLoader)}else s=e;i=i||1/cc.director.getContentScaleFactor();var l=new n.AtlasAttachmentLoader(s),u=new n.SkeletonJson(l);u.scale=i;var d=cc.loader.getRes(a);r=u.readSkeletonData(d),s.dispose(u),o=!0}else r=t,o=e;this.setSkeletonData(r,o),this.init()},getBoundingBox:function(){for(var t=cc.macro.FLT_MAX,e=cc.macro.FLT_MAX,i=cc.macro.FLT_MIN,n=cc.macro.FLT_MIN,r=this.getScaleX(),s=this.getScaleY(),o=[],a=this._skeleton.slots,c=sp.VERTEX_INDEX,h=0,l=a.length;h<l;++h){var u=a[h],d=u.attachment;d&&d.type==sp.ATTACHMENT_TYPE.REGION&&(this._computeRegionAttachmentWorldVertices(d,u.bone.skeleton.x,u.bone.skeleton.y,u.bone,o),t=Math.min(t,o[c.X1]*r,o[c.X4]*r,o[c.X2]*r,o[c.X3]*r),e=Math.min(e,o[c.Y1]*s,o[c.Y4]*s,o[c.Y2]*s,o[c.Y3]*s),i=Math.max(i,o[c.X1]*r,o[c.X4]*r,o[c.X2]*r,o[c.X3]*r),n=Math.max(n,o[c.Y1]*s,o[c.Y4]*s,o[c.Y2]*s,o[c.Y3]*s))}var _=this.getPosition();return cc.rect(_.x+t,_.y+e,i-t,n-e)},_computeRegionAttachmentWorldVertices:function(t,e,i,n,r){var s=t.offset,o=sp.VERTEX_INDEX;e+=n.worldX,i+=n.worldY,r[o.X1]=s[o.X1]*n.m00+s[o.Y1]*n.m01+e,r[o.Y1]=s[o.X1]*n.m10+s[o.Y1]*n.m11+i,r[o.X2]=s[o.X2]*n.m00+s[o.Y2]*n.m01+e,r[o.Y2]=s[o.X2]*n.m10+s[o.Y2]*n.m11+i,r[o.X3]=s[o.X3]*n.m00+s[o.Y3]*n.m01+e,r[o.Y3]=s[o.X3]*n.m10+s[o.Y3]*n.m11+i,r[o.X4]=s[o.X4]*n.m00+s[o.Y4]*n.m01+e,r[o.Y4]=s[o.X4]*n.m10+s[o.Y4]*n.m11+i},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setPremultipliedAlpha:function(t){this._premultipliedAlpha=t},isPremultipliedAlpha:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){null!=t.width&&null!=t.height&&this.setContentSize(t.width/cc.director.getContentScaleFactor(),t.height/cc.director.getContentScaleFactor()),this._skeleton=new n.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},update:function(t){this._skeleton.update(t)}}),Object.defineProperty(sp._SGSkeleton.prototype,"opacityModifyRGB",{get:sp._SGSkeleton.prototype.isOpacityModifyRGB})},{}],223:[function(t,e,i){var n=sp.spine,r=sp.AnimationEventType;sp._atlasPage_createTexture_webGL=function(t,e){var i=cc.textureCache.addImage(e);t.rendererObject=new cc.TextureAtlas(i,128),t.width=i.getPixelWidth(),t.height=i.getPixelHeight()},sp._atlasPage_createTexture_canvas=function(t,e){t._texture=cc.textureCache.addImage(e)},sp._atlasPage_disposeTexture=function(t){t.rendererObject.release()},sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e,i){var n=cc.path.join(cc.path.dirname(this.spAtlasFile),e);cc._renderType===cc.game.RENDER_TYPE_WEBGL?sp._atlasPage_createTexture_webGL(t,n):sp._atlasPage_createTexture_canvas(t,n)},unload:function(t){}},sp.TrackEntryListeners=function(t,e,i,n){this.startListener=t||null,this.endListener=e||null,this.completeListener=i||null,this.eventListener=n||null},sp.TrackEntryListeners.getListeners=function(t){return t.rendererObject||(t.rendererObject=new sp.TrackEntryListeners,t.listener=sp.trackEntryCallback),t.rendererObject},sp.trackEntryCallback=function(t,e,i,n,r){t.rendererObject.onTrackEntryEvent(e,i,n,r)},sp._SGSkeletonAnimation=sp._SGSkeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:!1,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){sp._SGSkeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new n.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var e=new n.AnimationState(t);e.rendererObject=this,e.onStart=this._onAnimationStateStart.bind(this),e.onComplete=this._onAnimationStateComplete.bind(this),e.onEnd=this._onAnimationStateEnd.bind(this),e.onEvent=this._onAnimationStateEvent.bind(this),this._state=e},setMix:function(t,e,i){this._state.data.setMixByName(t,e,i)},setAnimationListener:function(t,e){this._target=t,this._callback=e},setAnimation:function(t,e,i){var n=this._skeleton.data.findAnimation(e);return n?this._state.setAnimation(t,n,i):(cc.log("Spine: Animation not found: "+e),null)},addAnimation:function(t,e,i,n){n=null==n?0:n;var r=this._skeleton.data.findAnimation(e);return r?this._state.addAnimation(t,r,i,n):(cc.log("Spine: Animation not found:"+e),null)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty),this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,i,n){var s=this._state.getCurrent(t);if(s.rendererObject){var o=s.rendererObject;switch(e){case r.START:o.startListener&&o.startListener(t);break;case r.END:o.endListener&&o.endListener(t);break;case r.COMPLETE:o.completeListener&&o.completeListener(t,n);break;case r.EVENT:o.eventListener&&o.eventListener(t,i)}}},onAnimationStateEvent:function(t,e,i,n){switch(e){case r.START:this._startListener&&this._startListener(t);break;case r.END:this._endListener&&this._endListener(t);break;case r.COMPLETE:this._completeListener&&this._completeListener(t,n);break;case r.EVENT:this._eventListener&&this._eventListener(t,i)}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,r.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,r.END,null,0)},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,r.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,r.EVENT,e,0)},_animationStateCallback:function(t,e,i,n){this.onAnimationStateEvent(t,e,i,n),this._target&&this._callback&&this._callback.call(this._target,this,t,e,i,n)}})},{}],224:[function(t,e,i){var n=sp.spine;sp._SGSkeleton.CanvasRenderCmd=function(t){_ccsg.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0};var r=sp._SGSkeleton.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);r.constructor=sp._SGSkeleton.CanvasRenderCmd,r.rendering=function(t,e,i){var n,r,s,o,a=this._node;t=t||cc._renderContext;var c=a._skeleton,h=c.drawOrder;for(n=0,r=h.length;n<r;n++)s=h[n],o=s._slotNode,o._visible&&o._renderCmd&&s.currentSprite&&(o._renderCmd.transform(this,!0),s.currentSprite._renderCmd.rendering(t,e,i),o._renderCmd._dirtyFlag=s.currentSprite._renderCmd._dirtyFlag=0);if(a._debugSlots||a._debugBones){t.setTransform(this._worldTransform,e,i),t.setGlobalAlpha(1);var l,u=cc._drawingUtil;if(a._debugSlots){u.setDrawColor(0,0,255,255),u.setLineWidth(1);var d=[];for(n=0,r=c.slots.length;n<r;n++)s=c.drawOrder[n],s.attachment&&s.attachment.type==sp.ATTACHMENT_TYPE.REGION&&(l=s.attachment,this._updateRegionAttachmentSlot(l,s,d),u.drawPoly(d,4,!0))}if(a._debugBones){var _;for(u.setLineWidth(2),u.setDrawColor(255,0,0,255),n=0,r=c.bones.length;n<r;n++){_=c.bones[n];var f=_.data.length*_.m00+_.worldX,p=_.data.length*_.m10+_.worldY;u.drawLine({x:_.worldX,y:_.worldY},{x:f,y:p})}for(u.setPointSize(4),u.setDrawColor(0,0,255,255),n=0,r=c.bones.length;n<r;n++)_=c.bones[n],u.drawPoint({x:_.worldX,y:_.worldY}),0===n&&u.setDrawColor(0,255,0,255)}}},r.updateStatus=function(){_ccsg.Node.CanvasRenderCmd.prototype.updateStatus.call(this),this._updateCurrentRegions(),this._regionFlag=_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble,this._dirtyFlag&=~_ccsg.Node._dirtyFlags.contentDirty},r.getLocalBB=function(){return this._node.getBoundingBox()},r._updateRegionAttachmentSlot=function(t,e,i){if(i){var n={},r=sp.VERTEX_INDEX,s=e.bone;t.computeVertices(s.skeleton.x,s.skeleton.y,s,n),i.length=0,i.push(cc.p(n[r.X1],n[r.Y1])),i.push(cc.p(n[r.X4],n[r.Y4])),i.push(cc.p(n[r.X3],n[r.Y3])),i.push(cc.p(n[r.X2],n[r.Y2]))}},r._createChildFormSkeletonData=function(){for(var t,e,i=this._node,r=i._skeleton,s=0,o=r.slots.length;s<o;s++){var a=r.slots[s],c=a.attachment,h=new _ccsg.Node;a._slotNode=h,c instanceof n.RegionAttachment?(t=c.rendererObject.name,e=this._createSprite(a,c),a.currentSprite=e,a.currentSpriteName=t,h.addChild(e)):c instanceof n.MeshAttachment}},r._createSprite=function(t,e){var i=e.rendererObject,n=i.page._texture,r=new cc.Rect(i.x,i.y,i.width,i.height),s=new _ccsg.Sprite;return s.initWithTexture(n,r,i.rotate,!1),s._rect.width=e.width,s._rect.height=e.height,s.setContentSize(e.width,e.height),s.setRotation(-e.rotation),s.setScale(i.width/i.originalWidth*e.scaleX,i.height/i.originalHeight*e.scaleY),t.sprites=t.sprites||{},t.sprites[i.name]=s,s},r._updateChild=function(){var t,e,i,r,s,o,a,c,h=this._node._skeleton,l=h.slots,u=this._displayedColor,d=this._displayedOpacity;for(t=0,e=l.length;t<e;t++)if(o=l[t],a=o.attachment,c=o._slotNode,a){var _=a.type;if(_===n.AttachmentType.region){if(a.rendererObject&&(!o.currentSpriteName||o.currentSpriteName!==a.name)){var f=a.rendererObject.name;if(void 0!==o.currentSprite&&o.currentSprite.setVisible(!1),o.sprites=o.sprites||{},void 0!==o.sprites[f])o.sprites[f].setVisible(!0);else{var p=this._createSprite(o,a);c.addChild(p)}o.currentSprite=o.sprites[f],o.currentSpriteName=f}var g=o.bone;0===a.regionOffsetX&&0===a.regionOffsetY?(r=a.x,s=a.y):(r=.5*(a.offset[0]+a.offset[4]),s=.5*(a.offset[1]+a.offset[5])),c.setPosition(g.worldX+r*g.m00+s*g.m01,g.worldY+r*g.m10+s*g.m11),c.setScale(g.worldScaleX,g.worldScaleY),i=o.currentSprite,i._flippedX=g.worldFlipX,i._flippedY=g.worldFlipY,i._flippedY||i._flippedX?(c.setRotation(g.worldRotation),i.setRotation(a.rotation)):(c.setRotation(-g.worldRotation),i.setRotation(-a.rotation)),i._renderCmd._displayedOpacity=0|d*o.a;var m=0|u.r*o.r,v=0|u.g*o.g,y=0|u.b*o.b;i.setColor(cc.color(m,v,y)),i._renderCmd._updateColor()}else if(_!==n.AttachmentType.skinnedmesh){c.setVisible(!1);continue}c.setVisible(!0)}else c.setVisible(!1)}},{}],225:[function(t,e,i){var n=sp.spine;sp._SGSkeleton.WebGLRenderCmd=function(t){_ccsg.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._tmpQuad=new cc.V3F_C4B_T2F_Quad,this.setShaderProgram(cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLOR))};var r=sp._SGSkeleton.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);r.constructor=sp._SGSkeleton.WebGLRenderCmd,r.rendering=function(t){var e,i,r,s,o,a=this._node,c=this._tmpQuad,h=this._displayedColor,l=a._skeleton,u=a._blendFunc,d=a._premultipliedAlpha,_=-1,f=this._worldTransform,p=this._matrix.mat;for(p[0]=f.a,p[4]=f.c,p[12]=f.tx,p[1]=f.b,p[5]=f.d,p[13]=f.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),l.r=h.r/255,l.g=h.g/255,l.b=h.b/255,l.a=this._displayedOpacity/255,d&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),s=0,o=l.drawOrder.length;s<o;s++)if(r=l.drawOrder[s],r.attachment){switch(i=r.attachment,r.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(i,r,c,d);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(i,r,c,d);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var g=a.getTextureAtlas(i);if(r.data.blendMode!==_)switch(e&&(e.drawQuads(),e.removeAllQuads()),_=r.data.blendMode){case n.BlendMode.normal:cc.gl.blendFunc(d?cc.macro.ONE:cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA);break;case n.BlendMode.additive:cc.gl.blendFunc(d?cc.macro.ONE:cc.macro.SRC_ALPHA,cc.macro.ONE);break;case n.BlendMode.multiply:cc.gl.blendFunc(cc.macro.DST_COLOR,cc.macro.ONE_MINUS_SRC_ALPHA);break;case n.BlendMode.screen:cc.gl.blendFunc(cc.macro.ONE,cc.macro.ONE_MINUS_SRC_COLOR);break;default:cc.gl.blendFunc(u.src,u.dst)}else g!==e&&e&&(e.drawQuads(),e.removeAllQuads());e=g;var m=e.getTotalQuads();if(e.getCapacity()==m&&(e.drawQuads(),e.removeAllQuads(),!e.resizeCapacity(2*e.getCapacity())))return;e.updateQuad(c,m)}if(e&&(e.drawQuads(),e.removeAllQuads()),a._debugBones||a._debugSlots){cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.current_stack.stack.push(cc.current_stack.top),cc.current_stack.top=this._matrix;var v=cc._drawingUtil;if(a._debugSlots)for(v.setDrawColor(0,0,255,255),v.setLineWidth(1),
s=0,o=l.slots.length;s<o;s++)if(r=l.drawOrder[s],r.attachment&&r.attachment.type==sp.ATTACHMENT_TYPE.REGION){i=r.attachment,this._updateRegionAttachmentQuad(i,r,c);var y=[];y.push(cc.p(c.bl.vertices.x,c.bl.vertices.y)),y.push(cc.p(c.br.vertices.x,c.br.vertices.y)),y.push(cc.p(c.tr.vertices.x,c.tr.vertices.y)),y.push(cc.p(c.tl.vertices.x,c.tl.vertices.y)),v.drawPoly(y,4,!0)}if(a._debugBones){var T;for(v.setLineWidth(2),v.setDrawColor(255,0,0,255),s=0,o=l.bones.length;s<o;s++){T=l.bones[s];var C=T.data.length*T.m00+T.worldX,b=T.data.length*T.m10+T.worldY;v.drawLine(cc.p(T.worldX,T.worldY),cc.p(C,b))}for(v.setPointSize(4),v.setDrawColor(0,0,255,255),s=0,o=l.bones.length;s<o;s++)T=l.bones[s],v.drawPoint(cc.p(T.worldX,T.worldY)),0==s&&v.setDrawColor(0,255,0,255)}cc.math.glPopMatrix()}},r._createChildFormSkeletonData=function(){},r._updateChild=function(){},r._updateRegionAttachmentQuad=function(t,e,i,n){var r=new Array(8);t.computeVertices(e.bone.skeleton.x,e.bone.skeleton.y,e.bone,r);var s=e.bone.skeleton.a*e.a*t.a*255,o=n?s:255,a=e.bone.skeleton.r*e.r*t.r*o,c=e.bone.skeleton.g*e.g*t.g*o,h=e.bone.skeleton.b*e.b*t.b*o;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=a,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=c,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=h,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=s;var l=sp.VERTEX_INDEX;i.bl.vertices.x=r[l.X1],i.bl.vertices.y=r[l.Y1],i.tl.vertices.x=r[l.X2],i.tl.vertices.y=r[l.Y2],i.tr.vertices.x=r[l.X3],i.tr.vertices.y=r[l.Y3],i.br.vertices.x=r[l.X4],i.br.vertices.y=r[l.Y4],i.bl.texCoords.u=t.uvs[l.X1],i.bl.texCoords.v=t.uvs[l.Y1],i.tl.texCoords.u=t.uvs[l.X2],i.tl.texCoords.v=t.uvs[l.Y2],i.tr.texCoords.u=t.uvs[l.X3],i.tr.texCoords.v=t.uvs[l.Y3],i.br.texCoords.u=t.uvs[l.X4],i.br.texCoords.v=t.uvs[l.Y4]},r._updateMeshAttachmentQuad=function(t,e,i,n){var r={};t.computeWorldVertices(e.bone.x,e.bone.y,e,r);var s=e.bone.skeleton.r*e.r*255,o=e.bone.skeleton.g*e.g*255,a=e.bone.skeleton.b*e.b*255,c=e.bone.skeleton.a*e.a;n&&(s*=c,o*=c,a*=c);var h=255*c;i.bl.colors.r=i.tl.colors.r=i.tr.colors.r=i.br.colors.r=s,i.bl.colors.g=i.tl.colors.g=i.tr.colors.g=i.br.colors.g=o,i.bl.colors.b=i.tl.colors.b=i.tr.colors.b=i.br.colors.b=a,i.bl.colors.a=i.tl.colors.a=i.tr.colors.a=i.br.colors.a=h;var l=sp.VERTEX_INDEX;i.bl.vertices.x=r[l.X1],i.bl.vertices.y=r[l.Y1],i.tl.vertices.x=r[l.X2],i.tl.vertices.y=r[l.Y2],i.tr.vertices.x=r[l.X3],i.tr.vertices.y=r[l.Y3],i.br.vertices.x=r[l.X4],i.br.vertices.y=r[l.Y4],i.bl.texCoords.u=t.uvs[l.X1],i.bl.texCoords.v=t.uvs[l.Y1],i.tl.texCoords.u=t.uvs[l.X2],i.tl.texCoords.v=t.uvs[l.Y2],i.tr.texCoords.u=t.uvs[l.X3],i.tr.texCoords.v=t.uvs[l.Y3],i.br.texCoords.u=t.uvs[l.X4],i.br.texCoords.v=t.uvs[l.Y4]}},{}],226:[function(t,e,i){var n=cc.Enum({"default":-1}),r=cc.Enum({"<None>":0});sp.Skeleton=cc.Class({name:"sp.Skeleton","extends":cc._RendererUnderSG,editor:!1,properties:{_paused:!1,paused:{get:function(){return this._paused},set:function(t){this._paused=t,this._sgNode&&(t?this._sgNode.pause():this._sgNode.resume())},visible:!1},skeletonData:{"default":null,type:sp.SkeletonData,notify:function(){this.defaultSkin="",this.defaultAnimation="",this._refresh()},tooltip:"i18n:COMPONENT.skeleton.skeleton_data"},defaultSkin:{"default":"",visible:!1},defaultAnimation:{"default":"",visible:!1},animation:{get:function(){var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){this.defaultAnimation=t,t?this.setAnimation(0,t,this.loop):(this.clearTrack(0),this.setToSetupPose())},visible:!1},_defaultSkinIndex:{get:function(){if(this.skeletonData&&this.defaultSkin){var t=this.skeletonData.getSkinsEnum();if(t){var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),!e)return cc.error('Failed to set _defaultSkinIndex for "%s" because its skeletonData is invalid.',this.name);var i=e[t];void 0!==i?this.defaultSkin=i:cc.error('Failed to set _defaultSkinIndex for "%s" because the index is out of range.',this.name)},type:n,visible:!0,displayName:"Default Skin",tooltip:"i18n:COMPONENT.skeleton.default_skin"},_animationIndex:{get:function(){var t=this.animation;if(this.skeletonData&&t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}return 0},set:function(t){if(0===t)return void(this.animation="");var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),!e)return cc.error('Failed to set _animationIndex for "%s" because its skeletonData is invalid.',this.name);var i=e[t];void 0!==i?this.animation=i:cc.error('Failed to set _animationIndex for "%s" because the index is out of range.',this.name)},type:r,visible:!0,displayName:"Animation",tooltip:"i18n:COMPONENT.skeleton.animation"},loop:{"default":!0,tooltip:"i18n:COMPONENT.skeleton.loop"},_premultipliedAlpha:!0,premultipliedAlpha:{get:function(){return this._premultipliedAlpha},set:function(t){this._premultipliedAlpha=t,this._sgNode&&this._sgNode.setPremultipliedAlpha(t)},tooltip:"i18n:COMPONENT.skeleton.premultipliedAlpha"},timeScale:{"default":1,notify:function(){this._sgNode&&this._sgNode.setTimeScale(this.timeScale)},tooltip:"i18n:COMPONENT.skeleton.time_scale"},debugSlots:{"default":!1,notify:function(){this._sgNode&&this._sgNode.setDebugSlotsEnabled(this.debugSlots)},editorOnly:!0,tooltip:"i18n:COMPONENT.skeleton.debug_slots"},debugBones:{"default":!1,notify:function(){this._sgNode&&this._sgNode.setDebugBonesEnabled(this.debugBones)},editorOnly:!0,tooltip:"i18n:COMPONENT.skeleton.debug_bones"}},__preload:function(){this.node.setContentSize(0,0),this._refresh()},_createSgNode:function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t)return new sp._SGSkeletonAnimation(t,null,this.skeletonData.scale)}return null},_initSgNode:function(){var t=this._sgNode;t.setTimeScale(this.timeScale);var e=this;if(t.onEnter=function(){_ccsg.Node.prototype.onEnter.call(this),e._paused&&this.pause()},this.defaultSkin)try{t.setSkin(this.defaultSkin)}catch(i){cc._throw(i)}t.setPremultipliedAlpha(this._premultipliedAlpha),this.animation=this.defaultAnimation},_getLocalBounds:!1,updateWorldTransform:function(){this._sgNode&&this._sgNode.updateWorldTransform()},setToSetupPose:function(){this._sgNode&&this._sgNode.setToSetupPose()},setBonesToSetupPose:function(){this._sgNode&&this._sgNode.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._sgNode&&this._sgNode.setSlotsToSetupPose()},findBone:function(t){return this._sgNode?this._sgNode.findBone(t):null},findSlot:function(t){return this._sgNode?this._sgNode.findSlot(t):null},setSkin:function(t){return this._sgNode?this._sgNode.setSkin(t):null},getAttachment:function(t,e){return this._sgNode?this._sgNode.getAttachment(t,e):null},setAttachment:function(t,e){this._sgNode&&this._sgNode.setAttachment(t,e)},setSkeletonData:function(t,e){this._sgNode&&this._sgNode.setSkeletonData(t,e)},setAnimationStateData:function(t){if(this._sgNode)return this._sgNode.setAnimationStateData(t)},setMix:function(t,e,i){this._sgNode&&this._sgNode.setMix(t,e,i)},setAnimationListener:function(t,e){this._sgNode&&this._sgNode.setAnimationListener(t,e)},setAnimation:function(t,e,i){if(this._sgNode){var n=this._sgNode.setAnimation(t,e,i);return n}return null},_sample:function(){this._sgNode&&this._sgNode.update(0)},addAnimation:function(t,e,i,n){return this._sgNode?this._sgNode.addAnimation(t,e,i,n):null},getCurrent:function(t){return this._sgNode?this._sgNode.getCurrent(t):null},clearTracks:function(){this._sgNode&&this._sgNode.clearTracks()},clearTrack:function(t){this._sgNode&&this._sgNode.clearTrack(t)},_updateAnimEnum:!1,_updateSkinEnum:!1,setStartListener:function(t){this._sgNode&&this._sgNode.setStartListener(t)},setEndListener:function(t){this._sgNode&&this._sgNode.setEndListener(t)},setCompleteListener:function(t){this._sgNode&&this._sgNode.setCompleteListener(t)},setEventListener:function(t){this._sgNode&&this._sgNode.setEventListener(t)},setTrackStartListener:function(t,e){this._sgNode&&this._sgNode.setTrackStartListener(t,e)},setTrackEndListener:function(t,e){this._sgNode&&this._sgNode.setTrackEndListener(t,e)},setTrackCompleteListener:function(t,e){this._sgNode&&this._sgNode.setTrackCompleteListener(t,e)},setTrackEventListener:function(t,e){this._sgNode&&this._sgNode.setTrackEventListener(t,e)},getState:function(){if(this._sgNode)return this._sgNode.getState()},_refresh:function(){var t=this;t._sgNode&&(t.node._sizeProvider===t._sgNode&&(t.node._sizeProvider=null),t._removeSgNode(),t._sgNode=null);var e=t._sgNode=t._createSgNode();e&&(t.enabledInHierarchy||e.setVisible(!1),e.setContentSize(0,0),t._initSgNode(),t._appendSgNode(e),t._registSizeProvider())}})},{}],227:[function(t,e,i){var n=cc.Class({ctor:function(){this.asset=arguments[0]},getTexture:function(t){for(var e=this.asset.textures,i=0;i<e.length;i++){var n=e[i];if(n.endsWith(t))return cc.textureCache.addImage(n)}return null},load:function(t,e,i){var n=this.getTexture(e);n?cc._renderType===cc.game.RENDER_TYPE_WEBGL?(t.rendererObject=new cc.TextureAtlas(n,128),t.width=n.getPixelWidth(),t.height=n.getPixelHeight()):t._texture=n:cc.error('Failed to load spine atlas "$s"',e)},unload:function(t){}}),r=cc.Class({name:"sp.SkeletonData","extends":cc.Asset,ctor:function(){this.reset()},properties:{_skeletonJson:null,skeletonJson:{get:function(){return this._skeletonJson},set:function(t){this._skeletonJson=t,this.reset()}},_atlasText:"",atlasText:{get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},atlasUrl:{"default":"",url:cc.RawAsset},textures:{"default":[],url:[cc.Texture2D]},scale:1},statics:{preventDeferredLoadDependents:!0},createNode:function(t){var e=new cc.Node(this.name),i=e.addComponent(sp.Skeleton);return i.skeletonData=this,t(null,e)},reset:function(){this._skeletonCache=null,this._atlasCache=null},getRuntimeData:function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0))return t||cc.error('Please re-import "%s" because its textures is not initialized! (This workflow will be improved in the future.)',this.name),null;var e=this._getAtlas(t);if(!e)return null;var i=new sp.spine.AtlasAttachmentLoader(e),n=new sp.spine.SkeletonJson(i);n.scale=this.scale;var r=this.skeletonJson;return this._skeletonCache=n.readSkeletonData(r),e.dispose(n),this._skeletonCache},getSkinsEnum:!1,getAnimsEnum:!1,_getAtlas:function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new sp.spine.Atlas(this.atlasText,new n(this)):(t||cc.error('The atlas asset of "%s" is not exists!',this.name),null)}});sp.SkeletonData=e.exports=r},{}],228:[function(t,e,i){sp={},sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7},sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3},sp.AnimationEventType=cc.Enum({START:0,END:1,COMPLETE:2,EVENT:3}),sp.spine=t("./lib/spine"),t("./SGSkeleton"),t("./SGSkeletonCanvasRenderCmd"),t("./SGSkeletonWebGLRenderCmd"),t("./SGSkeletonAnimation"),t("./SkeletonData"),t("./Skeleton")},{"./SGSkeleton":222,"./SGSkeletonAnimation":223,"./SGSkeletonCanvasRenderCmd":224,"./SGSkeletonWebGLRenderCmd":225,"./Skeleton":226,"./SkeletonData":227,"./lib/spine":229}],229:[function(t,e,i){var n={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};n.BoneData=function(t,e){this.name=t,this.parent=e},n.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},n.BlendMode={normal:0,additive:1,multiply:2,screen:3},n.SlotData=function(t,e){this.name=t,this.boneData=e},n.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:n.BlendMode.normal},n.IkConstraintData=function(t){this.name=t,this.bones=[]},n.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},n.Bone=function(t,e,i){this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()},n.Bone.yDown=!1,n.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var e=this.skeleton.flipX,i=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=i!=n.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=i!=this.flipY}var r=this.worldRotation*n.degRad,s=Math.cos(r),o=Math.sin(r);this.worldFlipX?(this.m00=-s*this.worldScaleX,this.m01=o*this.worldScaleY):(this.m00=s*this.worldScaleX,this.m01=-o*this.worldScaleY),this.worldFlipY!=n.Bone.yDown?(this.m10=-o*this.worldScaleX,this.m11=-s*this.worldScaleY):(this.m10=o*this.worldScaleX,this.m11=s*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,i=t[1]-this.worldY,r=this.m00,s=this.m10,o=this.m01,a=this.m11;this.worldFlipX!=(this.worldFlipY!=n.Bone.yDown)&&(r=-r,a=-a);var c=1/(r*a-o*s);t[0]=e*r*c-i*o*c,t[1]=i*a*c-e*s*c},localToWorld:function(t){var e=t[0],i=t[1];t[0]=e*this.m00+i*this.m01+this.worldX,t[1]=e*this.m10+i*this.m11+this.worldY}},n.Slot=function(t,e){this.data=t,this.bone=e,this.setToSetupPose()},n.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment!=t&&(this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;if(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,t.attachmentName){for(var e=this.bone.skeleton.data.slots,i=0,n=e.length;i<n;i++)if(e[i]==t){this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachmentBySlotIndex(i,t.attachmentName));break}}else this.setAttachment(null)}},n.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var i=0,n=t.bones.length;i<n;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)},n.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:n.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:n.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix)}}},n.IkConstraint.apply1=function(t,e,i,r){var s=t.data.inheritRotation&&t.parent?t.parent.worldRotation:0,o=t.rotation,a=Math.atan2(i-t.worldY,e-t.worldX)*n.radDeg;t.worldFlipX!=(t.worldFlipY!=n.Bone.yDown)&&(a=-a),a-=s,t.rotationIK=o+(a-o)*r},n.IkConstraint.apply2=function(t,e,i,r,s,o){var a=e.rotation,c=t.rotation;if(!o)return e.rotationIK=a,void(t.rotationIK=c);var h,l,u=n.temp,d=t.parent;d?(u[0]=i,u[1]=r,d.worldToLocal(u),i=(u[0]-t.x)*d.worldScaleX,r=(u[1]-t.y)*d.worldScaleY):(i-=t.x,r-=t.y),e.parent==t?(h=e.x,l=e.y):(u[0]=e.x,u[1]=e.y,e.parent.localToWorld(u),t.worldToLocal(u),h=u[0],l=u[1]);var _=h*t.worldScaleX,f=l*t.worldScaleY,p=Math.atan2(f,_),g=Math.sqrt(_*_+f*f),m=e.data.length*e.worldScaleX,v=2*g*m;if(v<1e-4)return void(e.rotationIK=a+(Math.atan2(r,i)*n.radDeg-c-a)*o);var y=(i*i+r*r-g*g-m*m)/v;y<-1?y=-1:y>1&&(y=1);var T=Math.acos(y)*s,C=g+m*y,b=m*Math.sin(T),x=Math.atan2(r*C-i*b,i*C+r*b),S=(x-p)*n.radDeg-c;S>180?S-=360:S<-180&&(S+=360),t.rotationIK=c+S*o,S=(T+p)*n.radDeg-a,S>180?S-=360:S<-180&&(S+=360),e.rotationIK=a+(S+t.worldRotation-e.parent.worldRotation)*o},n.Skin=function(t){this.name=t,this.attachments={}},n.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),s=i.substring(n+1),o=t.slots[r];if(o.attachment&&o.attachment.name==s){var a=this.getAttachment(r,s);a&&o.setAttachment(a)}}}},n.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},n.Animation.prototype={apply:function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=this.timelines,o=0,a=s.length;o<a;o++)s[o].apply(t,e,i,r,1)},mix:function(t,e,i,n,r,s){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var o=this.timelines,a=0,c=o.length;a<c;a++)o[a].apply(t,e,i,r,s)}},n.Animation.binarySearch=function(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(!r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}},n.Animation.binarySearch1=function(t,e){var i=0,n=t.length-2;if(!n)return 1;for(var r=n>>>1;;){if(t[r+1]<=e?i=r+1:n=r,i==n)return i+1;r=i+n>>>1}},n.Animation.linearSearch=function(t,e,i){for(var n=0,r=t.length-i;n<=r;n+=i)if(t[n]>e)return n;return-1},n.Curves=function(t){this.curves=[]},n.Curves.prototype={setLinear:function(t){this.curves[19*t]=0},setStepped:function(t){this.curves[19*t]=1},setCurve:function(t,e,i,n,r){var s=.1,o=s*s,a=o*s,c=3*s,h=3*o,l=6*o,u=6*a,d=2*-e+n,_=2*-i+r,f=3*(e-n)+1,p=3*(i-r)+1,g=e*c+d*h+f*a,m=i*c+_*h+p*a,v=d*l+f*u,y=_*l+p*u,T=f*u,C=p*u,b=19*t,x=this.curves;x[b++]=2;for(var S=g,E=m,A=b+19-1;b<A;b+=2)x[b]=S,x[b+1]=E,g+=v,m+=y,v+=T,y+=C,S+=g,E+=m},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var i=this.curves,n=19*t,r=i[n];if(0===r)return e;if(1==r)return 0;n++;for(var s=0,o=n,a=n+19-1;n<a;n+=2)if(s=i[n],s>=e){var c,h;return n==o?(c=0,h=0):(c=i[n-2],h=i[n-1]),h+(i[n+1]-h)*(e-c)/(s-c)}var l=i[n-1];return l+(1-l)*(e-s)/(1-s)}},n.RotateTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-2]){for(var c=a.data.rotation+o[o.length-1]-a.rotation;c>180;)c-=360;for(;c<-180;)c+=360;return void(a.rotation+=c*s)}var h=n.Animation.binarySearch(o,i,2),l=o[h-1],u=o[h],d=1-(i-u)/(o[h-2]-u);d=this.curves.getCurvePercent(h/2-1,d);for(var c=o[h+1]-l;c>180;)c-=360;for(;c<-180;)c+=360;for(c=a.data.rotation+(l+c*d)-a.rotation;c>180;)c-=360;for(;c<-180;)c+=360;a.rotation+=c*s}}},n.TranslateTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-3])return a.x+=(a.data.x+o[o.length-2]-a.x)*s,void(a.y+=(a.data.y+o[o.length-1]-a.y)*s);var c=n.Animation.binarySearch(o,i,3),h=o[c-2],l=o[c-1],u=o[c],d=1-(i-u)/(o[c+-3]-u);d=this.curves.getCurvePercent(c/3-1,d),a.x+=(a.data.x+h+(o[c+1]-h)*d-a.x)*s,a.y+=(a.data.y+l+(o[c+2]-l)*d-a.y)*s}}},n.ScaleTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.bones[this.boneIndex];if(i>=o[o.length-3])return a.scaleX+=(a.data.scaleX*o[o.length-2]-a.scaleX)*s,void(a.scaleY+=(a.data.scaleY*o[o.length-1]-a.scaleY)*s);var c=n.Animation.binarySearch(o,i,3),h=o[c-2],l=o[c-1],u=o[c],d=1-(i-u)/(o[c+-3]-u);d=this.curves.getCurvePercent(c/3-1,d),a.scaleX+=(a.data.scaleX*(h+(o[c+1]-h)*d)-a.scaleX)*s,a.scaleY+=(a.data.scaleY*(l+(o[c+2]-l)*d)-a.scaleY)*s}}},n.ColorTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=5*t},n.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=s},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a,c,h,l;if(i>=o[o.length-5]){var u=o.length-1;a=o[u-3],c=o[u-2],h=o[u-1],l=o[u]}else{var d=n.Animation.binarySearch(o,i,5),_=o[d-4],f=o[d-3],p=o[d-2],g=o[d-1],m=o[d],v=1-(i-m)/(o[d-5]-m);v=this.curves.getCurvePercent(d/5-1,v),a=_+(o[d+1]-_)*v,c=f+(o[d+2]-f)*v,h=p+(o[d+3]-p)*v,l=g+(o[d+4]-g)*v}var y=t.slots[this.slotIndex];s<1?(y.r+=(a-y.r)*s,y.g+=(c-y.g)*s,y.b+=(h-y.b)*s,y.a+=(l-y.a)*s):(y.r=a,y.g=c,y.b=h,y.a=l)}}},n.AttachmentTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},n.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,i,r,s){var o=this.frames;if(i<o[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var a=i>=o[o.length-1]?o.length-1:n.Animation.binarySearch1(o,i)-1;if(!(o[a]<e)){var c=this.attachmentNames[a];t.slots[this.slotIndex].setAttachment(c?t.getAttachmentBySlotIndex(this.slotIndex,c):null)}}},n.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t},n.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.events[t]=i},apply:function(t,e,i,r,s){if(r){var o=this.frames,a=o.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,s),e=-1;else if(e>=o[a-1])return;if(!(i<o[0])){var c;if(e<o[0])c=0;else{c=n.Animation.binarySearch1(o,e);for(var h=o[c];c>0&&o[c-1]==h;)c--}for(var l=this.events;c<a&&i>=o[c];c++)r.push(l[c])}}}},n.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t},n.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a;a=i>=o[o.length-1]?o.length-1:n.Animation.binarySearch1(o,i)-1;var c=t.drawOrder,h=t.slots,l=this.drawOrders[a];if(l)for(var u=0,d=l.length;u<d;u++)c[u]=t.slots[l[u]];else for(var u=0,d=h.length;u<d;u++)c[u]=h[u]}}},n.FfdTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t},n.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},apply:function(t,e,i,r,s){var o=t.slots[this.slotIndex];if(o.attachment==this.attachment){var a=this.frames;if(!(i<a[0])){var c=this.frameVertices,h=c[0].length,l=o.attachmentVertices;if(l.length!=h&&(s=1),l.length=h,i>=a[a.length-1]){var u=c[a.length-1];if(s<1)for(var d=0;d<h;d++)l[d]+=(u[d]-l[d])*s;else for(var d=0;d<h;d++)l[d]=u[d]}else{var _=n.Animation.binarySearch1(a,i),f=a[_],p=1-(i-f)/(a[_-1]-f);p=this.curves.getCurvePercent(_-1,p<0?0:p>1?1:p);var g=c[_-1],m=c[_];if(s<1)for(var d=0;d<h;d++){var v=g[d];l[d]+=(v+(m[d]-v)*p-l[d])*s}else for(var d=0;d<h;d++){var v=g[d];l[d]=v+(m[d]-v)*p}}}}}},n.IkConstraintTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=3*t},n.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i,r,s){var o=this.frames;if(!(i<o[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(i>=o[o.length-3])return a.mix+=(o[o.length-2]-a.mix)*s,void(a.bendDirection=o[o.length-1]);var c=n.Animation.binarySearch(o,i,3),h=o[c+-2],l=o[c],u=1-(i-l)/(o[c+-3]-l);u=this.curves.getCurvePercent(c/3-1,u);var d=h+(o[c+1]-h)*u;a.mix+=(d-a.mix)*s,a.bendDirection=o[c+-1]}}},n.FlipXTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,r,s){var o=this.frames;if(i<o[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var a=(i>=o[o.length-2]?o.length:n.Animation.binarySearch(o,i,2))-2;o[a]<e||(t.bones[this.boneIndex].flipX=0!=o[a+1])}},n.FlipYTimeline=function(t){this.curves=new n.Curves(t),this.frames=[],this.frames.length=2*t},n.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i?1:0},apply:function(t,e,i,r,s){var o=this.frames;if(i<o[0])return void(e>i&&this.apply(t,e,Number.MAX_VALUE,null,0));e>i&&(e=-1);var a=(i>=o[o.length-2]?o.length:n.Animation.binarySearch(o,i,2))-2;o[a]<e||(t.bones[this.boneIndex].flipY=0!=o[a+1])}},n.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},n.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findEvent:function(t){for(var e=this.events,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null}},n.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;e<i;e++){var r=t.bones[e],s=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new n.Bone(r,this,s))}this.slots=[],this.drawOrder=[];for(var e=0,i=t.slots.length;e<i;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],c=new n.Slot(o,a);this.slots.push(c),this.drawOrder.push(c)}this.ikConstraints=[];for(var e=0,i=t.ikConstraints.length;e<i;e++)this.ikConstraints.push(new n.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()},n.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,i=e+1,n=this.boneCache;n.length>i&&(n.length=i);for(var r=0,s=n.length;r<s;r++)n[r].length=0;for(;n.length<i;)n[n.length]=[];var o=n[0],a=this.bones;t:for(var r=0,s=a.length;r<s;r++){var c=a[r],h=c;do{for(var l=0;l<e;l++)for(var u=t[l],d=u.bones[0],_=u.bones[u.bones.length-1];;){if(h==_){n[l].push(c),n[l+1].push(c);continue t}if(_==d)break;_=_.parent}h=h.parent}while(h);o[o.length]=c}},updateWorldTransform:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++){var n=t[e];n.rotationIK=n.rotation}for(var e=0,r=this.boneCache.length-1;;){for(var s=this.boneCache[e],o=0,a=s.length;o<a;o++)s[o].updateWorldTransform();if(e==r)break;this.ikConstraints[e].apply(),e++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,i=n.length;e<i;e++){var r=n[e];r.bendDirection=r.data.bendDirection,r.mix=r.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,i=0,n=t.length;i<n;i++)e[i]=t[i],t[i].setToSetupPose(i)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,i=0,n=e.length;i<n;i++){var r=e[i],s=r.data.attachmentName;if(s){var o=t.getAttachment(i,s);o&&r.setAttachment(o)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,r=i.length;n<r;n++){var s=i[n];if(s.data.name==t){var o=null;if(e&&(o=this.getAttachmentBySlotIndex(n,e),!o))throw"Attachment not found: "+e+", for slot: "+t;return void s.setAttachment(o)}}throw"Slot not found: "+t},findIkConstraint:function(t){for(var e=this.ikConstraints,i=0,n=e.length;i<n;i++)if(e[i].data.name==t)return e[i];return null},update:function(t){this.time+=t}},n.EventData=function(t){this.name=t},n.EventData.prototype={intValue:0,floatValue:0,stringValue:null},n.Event=function(t){this.data=t},n.Event.prototype={intValue:0,floatValue:0,stringValue:null},n.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},n.RegionAttachment=function(t){this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},n.RegionAttachment.prototype={type:n.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,r){var s=this.uvs;r?(s[2]=t,s[3]=n,s[4]=t,s[5]=e,s[6]=i,s[7]=e,s[0]=i,s[1]=n):(s[0]=t,s[1]=n,s[2]=t,s[3]=e,s[4]=i,s[5]=e,s[6]=i,s[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*e,s=i+this.regionWidth*t,o=r+this.regionHeight*e,a=this.rotation*n.degRad,c=Math.cos(a),h=Math.sin(a),l=i*c+this.x,u=i*h,d=r*c+this.y,_=r*h,f=s*c+this.x,p=s*h,g=o*c+this.y,m=o*h,v=this.offset;v[0]=l-_,v[1]=d+u,v[2]=l-m,v[3]=g+u,v[4]=f-m,v[5]=g+p,v[6]=f-_,v[7]=d+p},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.offset;n[0]=c[0]*r+c[1]*s+t,n[1]=c[0]*o+c[1]*a+e,n[2]=c[2]*r+c[3]*s+t,n[3]=c[2]*o+c[3]*a+e,n[4]=c[4]*r+c[5]*s+t,n[5]=c[4]*o+c[5]*a+e,n[6]=c[6]*r+c[7]*s+t,n[7]=c[6]*o+c[7]*a+e}},n.MeshAttachment=function(t){this.name=t},n.MeshAttachment.prototype={type:n.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,i=this.regionUVs.length;if(this.uvs&&this.uvs.length==i||(this.uvs=new n.Float32Array(i)),
this.regionRotate)for(var r=0;r<i;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r+1]*t,this.uvs[r+1]=this.regionV+e-this.regionUVs[r]*e;else for(var r=0;r<i;r+=2)this.uvs[r]=this.regionU+this.regionUVs[r]*t,this.uvs[r+1]=this.regionV+this.regionUVs[r+1]*e},computeWorldVertices:function(t,e,i,n){var r=i.bone;t+=r.worldX,e+=r.worldY;var s=r.m00,o=r.m01,a=r.m10,c=r.m11,h=this.vertices,l=h.length;i.attachmentVertices.length==l&&(h=i.attachmentVertices);for(var u=0;u<l;u+=2){var d=h[u],_=h[u+1];n[u]=d*s+_*o+t,n[u+1]=d*a+_*c+e}}},n.SkinnedMeshAttachment=function(t){this.name=t},n.SkinnedMeshAttachment.prototype={type:n.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,i,r,s){var o=this.regionU2-this.regionU,a=this.regionV2-this.regionV,c=this.regionUVs.length;if(this.uvs&&this.uvs.length==c||(this.uvs=new n.Float32Array(c)),this.regionRotate)for(var h=0;h<c;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h+1]*o,this.uvs[h+1]=this.regionV+a-this.regionUVs[h]*a;else for(var h=0;h<c;h+=2)this.uvs[h]=this.regionU+this.regionUVs[h]*o,this.uvs[h+1]=this.regionV+this.regionUVs[h+1]*a},computeWorldVertices:function(t,e,i,n){var r,s,o,a,c,h,l,u=i.bone.skeleton.bones,d=this.weights,_=this.bones,f=0,p=0,g=0,m=0,v=_.length;if(i.attachmentVertices.length)for(var y=i.attachmentVertices;p<v;f+=2){for(s=0,o=0,r=_[p++]+p;p<r;p++,g+=3,m+=2)a=u[_[p]],c=d[g]+y[m],h=d[g+1]+y[m+1],l=d[g+2],s+=(c*a.m00+h*a.m01+a.worldX)*l,o+=(c*a.m10+h*a.m11+a.worldY)*l;n[f]=s+t,n[f+1]=o+e}else for(;p<v;f+=2){for(s=0,o=0,r=_[p++]+p;p<r;p++,g+=3)a=u[_[p]],c=d[g],h=d[g+1],l=d[g+2],s+=(c*a.m00+h*a.m01+a.worldX)*l,o+=(c*a.m10+h*a.m11+a.worldY)*l;n[f]=s+t,n[f+1]=o+e}}},n.BoundingBoxAttachment=function(t){this.name=t,this.vertices=[]},n.BoundingBoxAttachment.prototype={type:n.AttachmentType.boundingbox,computeWorldVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;for(var r=i.m00,s=i.m01,o=i.m10,a=i.m11,c=this.vertices,h=0,l=c.length;h<l;h+=2){var u=c[h],d=c[h+1];n[h]=u*r+d*s+t,n[h+1]=u*o+d*a+e}}},n.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},n.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.setMix(n,r,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(i)?this.animationToMixTime[i]:this.defaultMix}},n.TrackEntry=function(){},n.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},n.AnimationState=function(t){this.data=t,this.tracks=[],this.events=[]},n.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,s=i.endTime,o=i.loop;!o&&n>s&&(n=s);var a=i.previous;if(a){var c=a.time;!a.loop&&c>a.endTime&&(c=a.endTime),a.animation.apply(t,c,c,a.loop,null);var h=i.mixTime/i.mixDuration*i.mix;h>=1&&(h=1,i.previous=null),i.animation.mix(t,i.lastTime,n,o,this.events,h)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,o,this.events):i.animation.mix(t,i.lastTime,n,o,this.events,i.mix);for(var l=0,u=this.events.length;l<u;l++){var d=this.events[l];i.onEvent&&i.onEvent(e,d),this.onEvent&&this.onEvent(e,d)}if(o?r%s>n%s:r<s&&n>=s){var _=Math.floor(n/s);i.onComplete&&i.onComplete(e,_),this.onComplete&&this.onComplete(e,_)}i.lastTime=i.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,i.onEnd&&i.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5?e.previous=n:e.previous=i)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;return this.setAnimation(t,n,i)},setAnimation:function(t,e,i){var r=new n.TrackEntry;return r.animation=e,r.loop=i,r.endTime=e.duration,this.setCurrent(t,r),r},addAnimationByName:function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;return this.addAnimation(t,r,i,n)},addAnimation:function(t,e,i,r){var s=new n.TrackEntry;s.animation=e,s.loop=i,s.endTime=e.duration;var o=this._expandToIndex(t);if(o){for(;o.next;)o=o.next;o.next=s}else this.tracks[t]=s;return r<=0&&(o?r+=o.endTime-this.data.getMix(o.animation,e):r=0),s.delay=r,s},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}},n.SkeletonJson=function(t){this.attachmentLoader=t},n.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var i=new n.SkeletonData;i.name=e;var r=t.skeleton;r&&(i.hash=r.hash,i.version=r.spine,i.width=r.width||0,i.height=r.height||0);for(var s=t.bones,o=0,a=s.length;o<a;o++){var c=s[o],h=null;if(c.parent&&(h=i.findBone(c.parent),!h))throw"Parent bone not found: "+c.parent;var l=new n.BoneData(c.name,h);l.length=(c.length||0)*this.scale,l.x=(c.x||0)*this.scale,l.y=(c.y||0)*this.scale,l.rotation=c.rotation||0,l.scaleX=c.hasOwnProperty("scaleX")?c.scaleX:1,l.scaleY=c.hasOwnProperty("scaleY")?c.scaleY:1,l.inheritScale=!c.hasOwnProperty("inheritScale")||c.inheritScale,l.inheritRotation=!c.hasOwnProperty("inheritRotation")||c.inheritRotation,i.bones.push(l)}var u=t.ik;if(u)for(var o=0,a=u.length;o<a;o++){for(var d=u[o],_=new n.IkConstraintData(d.name),s=d.bones,f=0,p=s.length;f<p;f++){var g=i.findBone(s[f]);if(!g)throw"IK bone not found: "+s[f];_.bones.push(g)}if(_.target=i.findBone(d.target),!_.target)throw"Target bone not found: "+d.target;_.bendDirection=!d.hasOwnProperty("bendPositive")||d.bendPositive?1:-1,_.mix=d.hasOwnProperty("mix")?d.mix:1,i.ikConstraints.push(_)}for(var m=t.slots,o=0,a=m.length;o<a;o++){var v=m[o],l=i.findBone(v.bone);if(!l)throw"Slot bone not found: "+v.bone;var y=new n.SlotData(v.name,l),T=v.color;T&&(y.r=this.toColor(T,0),y.g=this.toColor(T,1),y.b=this.toColor(T,2),y.a=this.toColor(T,3)),y.attachmentName=v.attachment,y.blendMode=n.BlendMode[v.blend||"normal"],i.slots.push(y)}var C=t.skins;for(var b in C)if(C.hasOwnProperty(b)){var x=C[b],S=new n.Skin(b);for(var E in x)if(x.hasOwnProperty(E)){var A=i.findSlotIndex(E),O=x[E];for(var w in O)if(O.hasOwnProperty(w)){var R=this.readAttachment(S,w,O[w]);R&&S.addAttachment(A,w,R)}}i.skins.push(S),"default"==S.name&&(i.defaultSkin=S)}var I=t.events;for(var P in I)if(I.hasOwnProperty(P)){var N=I[P],L=new n.EventData(P);L.intValue=N["int"]||0,L.floatValue=N["float"]||0,L.stringValue=N.string||null,i.events.push(L)}var F=t.animations;for(var D in F)F.hasOwnProperty(D)&&this.readAnimation(D,F[D],i);return i},readAttachment:function(t,e,i){e=i.name||e;var r=n.AttachmentType[i.type||"region"],s=i.path||e,o=this.scale;if(r==n.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,s);if(!a)return null;a.path=s,a.x=(i.x||0)*o,a.y=(i.y||0)*o,a.scaleX=i.hasOwnProperty("scaleX")?i.scaleX:1,a.scaleY=i.hasOwnProperty("scaleY")?i.scaleY:1,a.rotation=i.rotation||0,a.width=(i.width||0)*o,a.height=(i.height||0)*o;var c=i.color;return c&&(a.r=this.toColor(c,0),a.g=this.toColor(c,1),a.b=this.toColor(c,2),a.a=this.toColor(c,3)),a.updateOffset(),a}if(r==n.AttachmentType.mesh){var h=this.attachmentLoader.newMeshAttachment(t,e,s);return h?(h.path=s,h.vertices=this.getFloatArray(i,"vertices",o),h.triangles=this.getIntArray(i,"triangles"),h.regionUVs=this.getFloatArray(i,"uvs",1),h.updateUVs(),c=i.color,c&&(h.r=this.toColor(c,0),h.g=this.toColor(c,1),h.b=this.toColor(c,2),h.a=this.toColor(c,3)),h.hullLength=2*(i.hull||0),i.edges&&(h.edges=this.getIntArray(i,"edges")),h.width=(i.width||0)*o,h.height=(i.height||0)*o,h):null}if(r==n.AttachmentType.skinnedmesh){var h=this.attachmentLoader.newSkinnedMeshAttachment(t,e,s);if(!h)return null;h.path=s;for(var l=this.getFloatArray(i,"uvs",1),u=this.getFloatArray(i,"vertices",1),d=[],_=[],f=0,p=u.length;f<p;){var g=0|u[f++];_[_.length]=g;for(var m=f+4*g;f<m;)_[_.length]=u[f],d[d.length]=u[f+1]*o,d[d.length]=u[f+2]*o,d[d.length]=u[f+3],f+=4}return h.bones=_,h.weights=d,h.triangles=this.getIntArray(i,"triangles"),h.regionUVs=l,h.updateUVs(),c=i.color,c&&(h.r=this.toColor(c,0),h.g=this.toColor(c,1),h.b=this.toColor(c,2),h.a=this.toColor(c,3)),h.hullLength=2*(i.hull||0),i.edges&&(h.edges=this.getIntArray(i,"edges")),h.width=(i.width||0)*o,h.height=(i.height||0)*o,h}if(r==n.AttachmentType.boundingbox){for(var v=this.attachmentLoader.newBoundingBoxAttachment(t,e),u=i.vertices,f=0,p=u.length;f<p;f++)v.vertices.push(u[f]*o);return v}throw"Unknown attachment type: "+r},readAnimation:function(t,e,i){var r=[],s=0,o=e.slots;for(var a in o)if(o.hasOwnProperty(a)){var c=o[a],h=i.findSlotIndex(a);for(var l in c)if(c.hasOwnProperty(l)){var u=c[l];if("color"==l){var d=new n.ColorTimeline(u.length);d.slotIndex=h;for(var _=0,f=0,p=u.length;f<p;f++){var g=u[f],m=g.color,v=this.toColor(m,0),y=this.toColor(m,1),T=this.toColor(m,2),C=this.toColor(m,3);d.setFrame(_,g.time,v,y,T,C),this.readCurve(d,_,g),_++}r.push(d),s=Math.max(s,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=l)throw"Invalid timeline type for a slot: "+l+" ("+a+")";var d=new n.AttachmentTimeline(u.length);d.slotIndex=h;for(var _=0,f=0,p=u.length;f<p;f++){var g=u[f];d.setFrame(_++,g.time,g.name)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}}}var b=e.bones;for(var x in b)if(b.hasOwnProperty(x)){var S=i.findBoneIndex(x);if(S==-1)throw"Bone not found: "+x;var E=b[x];for(var l in E)if(E.hasOwnProperty(l)){var u=E[l];if("rotate"==l){var d=new n.RotateTimeline(u.length);d.boneIndex=S;for(var _=0,f=0,p=u.length;f<p;f++){var g=u[f];d.setFrame(_,g.time,g.angle),this.readCurve(d,_,g),_++}r.push(d),s=Math.max(s,d.frames[2*d.getFrameCount()-2])}else if("translate"==l||"scale"==l){var d,A=1;"scale"==l?d=new n.ScaleTimeline(u.length):(d=new n.TranslateTimeline(u.length),A=this.scale),d.boneIndex=S;for(var _=0,f=0,p=u.length;f<p;f++){var g=u[f],O=(g.x||0)*A,w=(g.y||0)*A;d.setFrame(_,g.time,O,w),this.readCurve(d,_,g),_++}r.push(d),s=Math.max(s,d.frames[3*d.getFrameCount()-3])}else{if("flipX"!=l&&"flipY"!=l)throw"Invalid timeline type for a bone: "+l+" ("+x+")";var O="flipX"==l,d=O?new n.FlipXTimeline(u.length):new n.FlipYTimeline(u.length);d.boneIndex=S;for(var R=O?"x":"y",_=0,f=0,p=u.length;f<p;f++){var g=u[f];d.setFrame(_,g.time,g[R]||!1),_++}r.push(d),s=Math.max(s,d.frames[2*d.getFrameCount()-2])}}}var I=e.ik;for(var P in I)if(I.hasOwnProperty(P)){var N=i.findIkConstraint(P),u=I[P],d=new n.IkConstraintTimeline(u.length);d.ikConstraintIndex=i.ikConstraints.indexOf(N);for(var _=0,f=0,p=u.length;f<p;f++){var g=u[f],L=g.hasOwnProperty("mix")?g.mix:1,F=!g.hasOwnProperty("bendPositive")||g.bendPositive?1:-1;d.setFrame(_,g.time,L,F),this.readCurve(d,_,g),_++}r.push(d),s=Math.max(s,d.frames[3*d.frameCount-3])}var D=e.ffd;for(var M in D){var B=i.findSkin(M),c=D[M];for(a in c){var h=i.findSlotIndex(a),k=c[a];for(var z in k){var u=k[z],d=new n.FfdTimeline(u.length),V=B.getAttachment(h,z);if(!V)throw"FFD attachment not found: "+z;d.slotIndex=h,d.attachment=V;var W,U=V.type==n.AttachmentType.mesh;W=U?V.vertices.length:V.weights.length/3*2;for(var _=0,f=0,p=u.length;f<p;f++){var G,g=u[f];if(g.vertices){var X=g.vertices,G=[];G.length=W;var j=g.offset||0,Y=X.length;if(1==this.scale)for(var H=0;H<Y;H++)G[H+j]=X[H];else for(var H=0;H<Y;H++)G[H+j]=X[H]*this.scale;if(U)for(var Q=V.vertices,H=0,Y=G.length;H<Y;H++)G[H]+=Q[H]}else U?G=V.vertices:(G=[],G.length=W);d.setFrame(_,g.time,G),this.readCurve(d,_,g),_++}r[r.length]=d,s=Math.max(s,d.frames[d.frameCount-1])}}}var q=e.drawOrder;if(q||(q=e.draworder),q){for(var d=new n.DrawOrderTimeline(q.length),Z=i.slots.length,_=0,f=0,p=q.length;f<p;f++){var K=q[f],J=null;if(K.offsets){J=[],J.length=Z;for(var H=Z-1;H>=0;H--)J[H]=-1;var $=K.offsets,tt=[];tt.length=Z-$.length;for(var et=0,it=0,H=0,Y=$.length;H<Y;H++){var nt=$[H],h=i.findSlotIndex(nt.slot);if(h==-1)throw"Slot not found: "+nt.slot;for(;et!=h;)tt[it++]=et++;J[et+nt.offset]=et++}for(;et<Z;)tt[it++]=et++;for(var H=Z-1;H>=0;H--)J[H]==-1&&(J[H]=tt[--it])}d.setFrame(_++,K.time,J)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}var rt=e.events;if(rt){for(var d=new n.EventTimeline(rt.length),_=0,f=0,p=rt.length;f<p;f++){var st=rt[f],ot=i.findEvent(st.name);if(!ot)throw"Event not found: "+st.name;var at=new n.Event(ot);at.intValue=st.hasOwnProperty("int")?st["int"]:ot.intValue,at.floatValue=st.hasOwnProperty("float")?st["float"]:ot.floatValue,at.stringValue=st.hasOwnProperty("string")?st.string:ot.stringValue,d.setFrame(_++,st.time,at)}r.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}i.animations.push(new n.Animation(t,r,s))},readCurve:function(t,e,i){var n=i.curve;n?"stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2*e+2),16)/255},getFloatArray:function(t,e,i){var r=t[e],s=new n.Float32Array(r.length),o=0,a=r.length;if(1==i)for(;o<a;o++)s[o]=r[o];else for(;o<a;o++)s[o]=r[o]*i;return s},getIntArray:function(t,e){for(var i=t[e],r=new n.Uint16Array(i.length),s=0,o=i.length;s<o;s++)r[s]=0|i[s];return r}},n.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new n.AtlasReader(t),r=[];r.length=4;for(var s=null;;){var o=i.readLine();if(null===o)break;if(o=i.trim(o),o.length)if(s){var a=new n.AtlasRegion;a.name=o,a.page=s,a.rotate="true"==i.readValue(),i.readTuple(r);var c=parseInt(r[0]),h=parseInt(r[1]);i.readTuple(r);var l=parseInt(r[0]),u=parseInt(r[1]);a.u=c/s.width,a.v=h/s.height,a.rotate?(a.u2=(c+u)/s.width,a.v2=(h+l)/s.height):(a.u2=(c+l)/s.width,a.v2=(h+u)/s.height),a.x=c,a.y=h,a.width=Math.abs(l),a.height=Math.abs(u),4==i.readTuple(r)&&(a.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==i.readTuple(r)&&(a.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],i.readTuple(r))),a.originalWidth=parseInt(r[0]),a.originalHeight=parseInt(r[1]),i.readTuple(r),a.offsetX=parseInt(r[0]),a.offsetY=parseInt(r[1]),a.index=parseInt(i.readValue()),this.regions.push(a)}else{s=new n.AtlasPage,s.name=o,2==i.readTuple(r)&&(s.width=parseInt(r[0]),s.height=parseInt(r[1]),i.readTuple(r)),s.format=n.Atlas.Format[r[0]],i.readTuple(r),s.minFilter=n.Atlas.TextureFilter[r[0]],s.magFilter=n.Atlas.TextureFilter[r[1]];var d=i.readValue();s.uWrap=n.Atlas.TextureWrap.clampToEdge,s.vWrap=n.Atlas.TextureWrap.clampToEdge,"x"==d?s.uWrap=n.Atlas.TextureWrap.repeat:"y"==d?s.vWrap=n.Atlas.TextureWrap.repeat:"xy"==d&&(s.uWrap=s.vWrap=n.Atlas.TextureWrap.repeat),e.load(s,o,this),this.pages.push(s)}else s=null}},n.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;e<i;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;i<n;i++){var r=e[i];r.page==t&&(r.u=r.x/t.width,r.v=r.y/t.height,r.rotate?(r.u2=(r.x+r.height)/t.width,r.v2=(r.y+r.width)/t.height):(r.u2=(r.x+r.width)/t.width,r.v2=(r.y+r.height)/t.height))}}},n.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},n.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},n.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},n.AtlasPage=function(){},n.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},n.AtlasRegion=function(){},n.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},n.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},n.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(e==-1)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(i==-1)throw"Invalid line: "+e;for(var n=0,r=i+1;n<3;n++){var s=e.indexOf(",",r);if(s==-1)break;t[n]=this.trim(e.substr(r,s-r)),r=s+1}return t[n]=this.trim(e.substring(r)),n+1}},n.AtlasAttachmentLoader=function(t){this.atlas=t},n.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (region attachment: "+e+")";var s=new n.RegionAttachment(e);return s.rendererObject=r,s.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (mesh attachment: "+e+")";var s=new n.MeshAttachment(e);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newSkinnedMeshAttachment:function(t,e,i){var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" (skinned mesh attachment: "+e+")";var s=new n.SkinnedMeshAttachment(e);return s.rendererObject=r,s.regionU=r.u,s.regionV=r.v,s.regionU2=r.u2,s.regionV2=r.v2,s.regionRotate=r.rotate,s.regionOffsetX=r.offsetX,s.regionOffsetY=r.offsetY,s.regionWidth=r.width,s.regionHeight=r.height,s.regionOriginalWidth=r.originalWidth,s.regionOriginalHeight=r.originalHeight,s},newBoundingBoxAttachment:function(t,e){return new n.BoundingBoxAttachment(e)}},n.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},n.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var i=t.slots,r=i.length,s=t.x,o=t.y,a=this.boundingBoxes,c=this.polygonPool,h=this.polygons;a.length=0;for(var l=0,u=h.length;l<u;l++)c.push(h[l]);h.length=0;for(var l=0;l<r;l++){var d=i[l],_=d.attachment;if(_.type==n.AttachmentType.boundingbox){a.push(_);var f,p=c.length;p>0?(f=c[p-1],c.splice(p-1,1)):f=[],h.push(f),f.length=_.vertices.length,_.computeWorldVertices(s,o,d.bone,f)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MIN_VALUE,s=0,o=t.length;s<o;s++)for(var a=t[s],c=0,h=a.length;c<h;c+=2){var l=a[c],u=a[c+1];e=Math.min(e,l),i=Math.min(i,u),n=Math.max(n,l),r=Math.max(r,u)}this.minX=e,this.minY=i,this.maxX=n,this.maxY=r},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,i,n){var r=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(t<=r&&i<=r||e<=s&&n<=s||t>=o&&i>=o||e>=a&&n>=a)return!1;var c=(n-e)/(i-t),h=c*(r-t)+e;if(h>s&&h<a)return!0;if(h=c*(o-t)+e,h>s&&h<a)return!0;var l=(s-e)/c+t;return l>r&&l<o||(l=(a-e)/c+t,l>r&&l<o)},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var i=this.polygons,n=0,r=i.length;n<r;n++)if(this.polygonContainsPoint(i[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,i,n){for(var r=this.polygons,s=0,o=r.length;s<o;s++)if(r[s].intersectsSegment(t,e,i,n))return this.boundingBoxes[s];return null},polygonContainsPoint:function(t,e,i){for(var n=t.length,r=n-2,s=!1,o=0;o<n;o+=2){var a=t[o+1],c=t[r+1];if(a<i&&c>=i||c<i&&a>=i){var h=t[o];h+(i-a)/(c-a)*(t[r]-h)<e&&(s=!s)}r=o}return s},polygonIntersectsSegment:function(t,e,i,n,r){for(var s=t.length,o=e-n,a=i-r,c=e*r-i*n,h=t[s-2],l=t[s-1],u=0;u<s;u+=2){var d=t[u],_=t[u+1],f=h*_-l*d,p=h-d,g=l-_,m=o*g-a*p,v=(c*p-o*f)/m;if((v>=h&&v<=d||v>=d&&v<=h)&&(v>=e&&v<=n||v>=n&&v<=e)){var y=(c*g-a*f)/m;if((y>=l&&y<=_||y>=_&&y<=l)&&(y>=i&&y<=r||y>=r&&y<=i))return!0}h=d,l=_}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return e==-1?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},e.exports=n},{}],230:[function(t,e,i){Object.create=Object.create||function(t){function e(){}return e.prototype=t,new e};var n,r,s=function(t,e){if(!t)throw new Error("Assertion failed: "+e)},o=function(t,e){!t&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},a=function(t,e){return t<e?t:e},c=function(t,e){return t>e?t:e};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(n=Math.min,r=Math.max):(n=a,r=c);var h=function(t,e){return t<e?t+" "+e:e+" "+t},l=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return t[i]=t[t.length-1],void t.length--},u=function(t,e,i){var n=A(e,i),r=v(C(n,A(t,i))/D(n));return E(i,w(n,r))},d=function(t,e,i,n,r,s){var o=i-r,a=n-s,c=v(b(o,a,t-r,e-s)/M(o,a));return new y(r+o*c,s+a*c)};cp.momentForCircle=function(t,e,i,n){return t*(.5*(e*e+i*i)+D(n))},cp.areaForCircle=function(t,e){return Math.PI*Math.abs(t*t-e*e)},cp.momentForSegment=function(t,e,i){var n=w(E(e,i),.5);return t*(U(i,e)/12+D(n))},cp.areaForSegment=function(t,e,i){return i*(Math.PI*i+2*W(t,e))},cp.momentForPoly=function(t,e,i){for(var n=0,r=0,s=e.length,o=0;o<s;o+=2){var a=e[o]+i.x,c=e[o+1]+i.y,h=e[(o+2)%s]+i.x,l=e[(o+3)%s]+i.y,u=I(h,l,a,c),d=b(a,c,a,c)+b(a,c,h,l)+b(h,l,h,l);n+=u*d,r+=u}return t*n/(6*r)},cp.areaForPoly=function(t){for(var e=0,i=0,n=t.length;i<n;i+=2)e+=R(new y(t[i],t[i+1]),new y(t[(i+2)%n],t[(i+3)%n]));return-e/2},cp.centroidForPoly=function(t){for(var e=0,i=new y(0,0),n=0,r=t.length;n<r;n+=2){var s=new y(t[n],t[n+1]),o=new y(t[(n+2)%r],t[(n+3)%r]),a=R(s,o);e+=a,i=E(i,w(E(s,o),a))}return w(i,1/(3*e))},cp.recenterPoly=function(t){for(var e=cp.centroidForPoly(t),i=0;i<t.length;i+=2)t[i]-=e.x,t[i+1]-=e.y},cp.momentForBox=function(t,e,i){return t*(e*e+i*i)/12},cp.momentForBox2=function(t,e){var i=e.r-e.l,n=e.t-e.b,r=w([e.l+e.r,e.b+e.t],.5);return cp.momentForBox(t,i,n)+t*D(r)};var _=cp.loopIndexes=function(t){var e,i,n,r,s=0,o=0;e=n=t[0],i=r=t[1];for(var a=t.length>>1,c=1;c<a;c++){var h=t[2*c],l=t[2*c+1];h<e||h==e&&l<i?(e=h,i=l,s=c):(h>n||h==n&&l>r)&&(n=h,r=l,o=c)}return[s,o]},f=function(t,e,i){var n=t[2*e];t[2*e]=t[2*i],t[2*i]=n,n=t[2*e+1],t[2*e+1]=t[2*i+1],t[2*i+1]=n},p=function(t,e,i,n,r,s){if(0===i)return 0;for(var o=0,a=e,c=A(r,n),h=s*x(c),l=e,u=e+i-1;l<=u;){var d=new y(t[2*l],t[2*l+1]),_=R(c,A(d,n));_>h?(_>o&&(o=_,a=l),l++):(f(t,l,u),u--)}return a!=e&&f(t,e,a),l-e},g=function(t,e,i,n,r,s,o,a){if(n<0)return 0;if(0==n)return e[2*a]=s.x,e[2*a+1]=s.y,1;var c=p(e,i,n,r,s,t),h=new y(e[2*i],e[2*i+1]),l=g(t,e,i+1,c-1,r,h,s,a),u=a+l++;e[2*u]=s.x,e[2*u+1]=s.y;var d=p(e,i+c,n-c,s,o,t),_=new y(e[2*(i+c)],e[2*(i+c)+1]);return l+g(t,e,i+c+1,d-1,s,_,o,a+l)};cp.convexHull=function(t,e,i){if(e)for(var n=0;n<t.length;n++)e[n]=t[n];else e=t;var r=_(t),s=r[0],a=r[1];if(s==a)return e.length=2,e;f(e,0,s),f(e,1,0==a?s:a);var c=new y(e[0],e[1]),h=new y(e[2],e[3]),l=t.length>>1,u=g(i,e,2,l-2,c,h,c,1)+1;return e.length=2*u,o(it(e),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),e};var m=function(t,e,i){return n(r(t,e),i)},v=function(t){return r(0,n(t,1))},y=cp.Vect=function(t,e){this.x=t,this.y=e};cp.v=function(t,e){return new y(t,e)};var T=cp.vzero=new y(0,0),C=cp.v.dot=function(t,e){return t.x*e.x+t.y*e.y},b=function(t,e,i,n){return t*i+e*n},x=cp.v.len=function(t){return Math.sqrt(C(t,t))},S=cp.v.len2=function(t,e){return Math.sqrt(t*t+e*e)},E=(cp.v.eql=function(t,e){return t.x===e.x&&t.y===e.y},cp.v.add=function(t,e){return new y(t.x+e.x,t.y+e.y)});y.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this};var A=cp.v.sub=function(t,e){return new y(t.x-e.x,t.y-e.y)};y.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this};var O=cp.v.neg=function(t){return new y((-t.x),(-t.y))};y.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var w=cp.v.mult=function(t,e){return new y(t.x*e,t.y*e)};y.prototype.mult=function(t){return this.x*=t,this.y*=t,this};var R=cp.v.cross=function(t,e){return t.x*e.y-t.y*e.x},I=function(t,e,i,n){return t*n-e*i},P=cp.v.perp=function(t){return new y((-t.y),t.x)},N=(cp.v.pvrperp=function(t){return new y(t.y,(-t.x))},cp.v.project=function(t,e){return w(e,C(t,e)/D(e))});y.prototype.project=function(t){return this.mult(C(this,t)/D(t)),this};var L=cp.v.rotate=function(t,e){return new y(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};y.prototype.rotate=function(t){return this.x=this.x*t.x-this.y*t.y,this.y=this.x*t.y+this.y*t.x,this};var F=cp.v.unrotate=function(t,e){return new y(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},D=cp.v.lengthsq=function(t){return C(t,t)},M=cp.v.lengthsq2=function(t,e){return t*t+e*e},B=cp.v.lerp=function(t,e,i){return E(w(t,1-i),w(e,i))},k=cp.v.normalize=function(t){return w(t,1/x(t))},z=cp.v.normalize_safe=function(t){return 0===t.x&&0===t.y?T:k(t)},V=cp.v.clamp=function(t,e){return C(t,t)>e*e?w(k(t),e):t},W=(cp.v.lerpconst=function(t,e,i){return E(t,V(A(e,t),i))},cp.v.dist=function(t,e){return x(A(t,e))}),U=cp.v.distsq=function(t,e){return D(A(t,e))},G=(cp.v.near=function(t,e,i){return U(t,e)<i*i},cp.v.slerp=function(t,e,i){var n=Math.acos(C(t,e));if(n){var r=1/Math.sin(n);return E(w(t,Math.sin((1-i)*n)*r),w(e,Math.sin(i*n)*r))}return t}),X=(cp.v.slerpconst=function(t,e,i){var r=Math.acos(C(t,e));return G(t,e,n(i,r)/r)},cp.v.forangle=function(t){return new y(Math.cos(t),Math.sin(t))},cp.v.toangle=function(t){return Math.atan2(t.y,t.x)},cp.v.str=function(t){return"("+t.x.toFixed(3)+", "+t.y.toFixed(3)+")"},0),j=cp.BB=function(t,e,i,n){this.l=t,this.b=e,this.r=i,this.t=n,X++};cp.bb=function(t,e,i,n){return new j(t,e,i,n)};var Y=function(t,e){return new j(t.x-e,t.y-e,t.x+e,t.y+e)},H=function(t,e,i,n,r){return t.l<=n&&e<=t.r&&t.b<=r&&i<=t.t},Q=0,q=(cp.NO_GROUP=0,cp.ALL_LAYERS=-1);cp.resetShapeIdCounter=function(){Q=0};var Z=cp.Shape=function(t){this.body=t,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=Q++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=T,this.collision_type=0,this.group=0,this.layers=q,this.space=null,this.collisionCode=this.collisionCode};Z.prototype.setElasticity=function(t){this.e=t},Z.prototype.setFriction=function(t){this.body.activate(),this.u=t},Z.prototype.setLayers=function(t){this.body.activate(),this.layers=t},Z.prototype.setSensor=function(t){this.body.activate(),this.sensor=t},Z.prototype.setCollisionType=function(t){this.body.activate(),this.collision_type=t},Z.prototype.getBody=function(){return this.body},Z.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},Z.prototype.setBody=function(t){s(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=t},Z.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Z.prototype.update=function(t,e){s(!isNaN(e.x),"Rotation is NaN"),s(!isNaN(t.x),"Position is NaN"),this.cacheData(t,e)},Z.prototype.pointQuery=function(t){var e=this.nearestPointQuery(t);if(e.d<0)return e},Z.prototype.getBB=function(){return new j(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var K=function(t,e,i){this.shape=t,this.p=e,this.d=i},J=function(t,e,i){this.shape=t,this.t=e,this.n=i};J.prototype.hitPoint=function(t,e){return B(t,e,this.t)},J.prototype.hitDist=function(t,e){return W(t,e)*this.t};var $=cp.CircleShape=function(t,e,i){this.c=this.tc=i,this.r=e,this.type="circle",Z.call(this,t)};$.prototype=Object.create(Z.prototype),$.prototype.cacheData=function(t,e){var i=this.tc=L(this.c,e).add(t),n=this.r;this.bb_l=i.x-n,this.bb_b=i.y-n,this.bb_r=i.x+n,this.bb_t=i.y+n},$.prototype.nearestPointQuery=function(t){var e=t.x-this.tc.x,i=t.y-this.tc.y,n=S(e,i),r=this.r,s=new y(this.tc.x+e*r/n,this.tc.y+i*r/n);return new K(this,s,n-r)};var tt=function(t,e,i,n,r,s){n=A(n,e),r=A(r,e);var o=C(n,n)-2*C(n,r)+C(r,r),a=-2*C(n,n)+2*C(n,r),c=C(n,n)-i*i,h=a*a-4*o*c;if(h>=0){var l=(-a-Math.sqrt(h))/(2*o);if(0<=l&&l<=1)return new J(t,l,k(B(n,r,l)))}};$.prototype.segmentQuery=function(t,e){return tt(this,this.tc,this.r,t,e)};var et=cp.SegmentShape=function(t,e,i,n){this.a=e,this.b=i,this.n=P(k(A(i,e))),this.ta=this.tb=this.tn=null,this.r=n,this.a_tangent=T,this.b_tangent=T,this.type="segment",Z.call(this,t)};et.prototype=Object.create(Z.prototype),et.prototype.cacheData=function(t,e){this.ta=E(t,L(this.a,e)),this.tb=E(t,L(this.b,e)),this.tn=L(this.n,e);var i,n,r,s;this.ta.x<this.tb.x?(i=this.ta.x,n=this.tb.x):(i=this.tb.x,n=this.ta.x),this.ta.y<this.tb.y?(r=this.ta.y,s=this.tb.y):(r=this.tb.y,s=this.ta.y);var o=this.r;this.bb_l=i-o,this.bb_b=r-o,this.bb_r=n+o,this.bb_t=s+o},et.prototype.nearestPointQuery=function(t){var e=u(t,this.ta,this.tb),i=t.x-e.x,n=t.y-e.y,r=S(i,n),s=this.r,o=r?E(e,w(new y(i,n),s/r)):e;return new K(this,o,r-s)},et.prototype.segmentQuery=function(t,e){var i=this.tn,n=C(A(this.ta,t),i),r=this.r,s=n>0?O(i):i,o=A(w(s,r),t),a=E(this.ta,o),c=E(this.tb,o),h=A(e,t);if(R(h,a)*R(h,c)<=0){var l=n+(n>0?-r:r),u=-l,d=C(h,i)-l;if(u*d<0)return new J(this,u/(u-d),s)}else if(0!==r){var _=tt(this,this.ta,this.r,t,e),f=tt(this,this.tb,this.r,t,e);return _?f&&f.t<_.t?f:_:f}},et.prototype.setNeighbors=function(t,e){this.a_tangent=A(t,this.a),this.b_tangent=A(e,this.b)},et.prototype.setEndpoints=function(t,e){this.a=t,this.b=e,this.n=P(k(A(e,t)))};var it=function(t){for(var e=t.length,i=0;i<e;i+=2){var n=t[i],r=t[i+1],s=t[(i+2)%e],o=t[(i+3)%e],a=t[(i+4)%e],c=t[(i+5)%e];if(I(s-n,o-r,a-s,c-o)>0)return!1}return!0},nt=cp.PolyShape=function(t,e,i){this.setVerts(e,i),this.type="poly",Z.call(this,t)};nt.prototype=Object.create(Z.prototype);var rt=function(t,e){this.n=t,this.d=e};rt.prototype.compare=function(t){return C(this.n,t)-this.d},nt.prototype.setVerts=function(t,e){s(t.length>=4,"Polygons require some verts"),s("number"==typeof t[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),s(it(t),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var i=t.length,n=i>>1;this.verts=new Array(i),this.tVerts=new Array(i),this.planes=new Array(n),this.tPlanes=new Array(n);for(var r=0;r<i;r+=2){var o=t[r]+e.x,a=t[r+1]+e.y,c=t[(r+2)%i]+e.x,h=t[(r+3)%i]+e.y,l=k(P(new y(c-o,h-a)));this.verts[r]=o,this.verts[r+1]=a,this.planes[r>>1]=new rt(l,b(l.x,l.y,o,a)),this.tPlanes[r>>1]=new rt(new y(0,0),0)}};var st=(cp.BoxShape=function(t,e,i){
var n=e/2,r=i/2;return st(t,new j((-n),(-r),n,r))},cp.BoxShape2=function(t,e){var i=[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b];return new nt(t,i,T)});nt.prototype.transformVerts=function(t,e){for(var i=this.verts,s=this.tVerts,o=1/0,a=-(1/0),c=1/0,h=-(1/0),l=0;l<i.length;l+=2){var u=i[l],d=i[l+1],_=t.x+u*e.x-d*e.y,f=t.y+u*e.y+d*e.x;s[l]=_,s[l+1]=f,o=n(o,_),a=r(a,_),c=n(c,f),h=r(h,f)}this.bb_l=o,this.bb_b=c,this.bb_r=a,this.bb_t=h},nt.prototype.transformAxes=function(t,e){for(var i=this.planes,n=this.tPlanes,r=0;r<i.length;r++){var s=L(i[r].n,e);n[r].n=s,n[r].d=C(t,s)+i[r].d}},nt.prototype.cacheData=function(t,e){this.transformAxes(t,e),this.transformVerts(t,e)},nt.prototype.nearestPointQuery=function(t){for(var e=this.tPlanes,i=this.tVerts,n=i[i.length-2],r=i[i.length-1],s=1/0,o=T,a=!1,c=0;c<e.length;c++){e[c].compare(t)>0&&(a=!0);var h=i[2*c],l=i[2*c+1],u=d(t.x,t.y,n,r,h,l),_=W(t,u);_<s&&(s=_,o=u),n=h,r=l}return new K(this,o,a?s:-s)},nt.prototype.segmentQuery=function(t,e){for(var i=this.tPlanes,n=this.tVerts,r=i.length,s=2*r,o=0;o<r;o++){var a=i[o].n,c=C(t,a);if(!(i[o].d>c)){var h=C(e,a),l=(i[o].d-c)/(h-c);if(!(l<0||1<l)){var u=B(t,e,l),d=-R(a,u),_=-I(a.x,a.y,n[2*o],n[2*o+1]),f=-I(a.x,a.y,n[(2*o+2)%s],n[(2*o+3)%s]);if(_<=d&&d<=f)return new J(this,l,a)}}}},nt.prototype.valueOnAxis=function(t,e){for(var i=this.tVerts,r=b(t.x,t.y,i[0],i[1]),s=2;s<i.length;s+=2)r=n(r,b(t.x,t.y,i[s],i[s+1]));return r-e},nt.prototype.containsVert=function(t,e){for(var i=this.tPlanes,n=0;n<i.length;n++){var r=i[n].n,s=b(r.x,r.y,t,e)-i[n].d;if(s>0)return!1}return!0},nt.prototype.containsVertPartial=function(t,e,i){for(var n=this.tPlanes,r=0;r<n.length;r++){var s=n[r].n;if(!(C(s,i)<0)){var o=b(s.x,s.y,t,e)-n[r].d;if(o>0)return!1}}return!0},nt.prototype.getNumVerts=function(){return this.verts.length/2},nt.prototype.getVert=function(t){return new y(this.verts[2*t],this.verts[2*t+1])};var ot=cp.Body=function(t,e){this.p=new y(0,0),this.vx=this.vy=0,this.f=new y(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(t),this.setMoment(e),this.rot=new y(0,0),this.setAngle(0)},at=function(){var t=new ot(1/0,1/0);return t.nodeIdleTime=1/0,t};if(cp.StaticBody=at,"undefined"!=typeof DEBUG&&DEBUG){var ct=function(t,e){s(t.x==t.x&&t.y==t.y,e)},ht=function(t,e){s(Math.abs(t.x)!==1/0&&Math.abs(t.y)!==1/0,e)},lt=function(t,e){ct(t,e),ht(t,e)};ot.prototype.sanityCheck=function(){s(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),s(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),lt(this.p,"Body's position is invalid."),lt(this.f,"Body's force is invalid."),s(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),s(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),s(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),s(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),s(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),lt(this.rot,"Body's rotation vector is invalid."),s(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),s(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else ot.prototype.sanityCheck=function(){};ot.prototype.getPos=function(){return this.p},ot.prototype.getVel=function(){return new y(this.vx,this.vy)},ot.prototype.getAngVel=function(){return this.w},ot.prototype.isSleeping=function(){return null!==this.nodeRoot},ot.prototype.isStatic=function(){return this.nodeIdleTime===1/0},ot.prototype.isRogue=function(){return null===this.space},ot.prototype.setMass=function(t){s(t>0,"Mass must be positive and non-zero."),this.activate(),this.m=t,this.m_inv=1/t},ot.prototype.setMoment=function(t){s(t>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=t,this.i_inv=1/t},ot.prototype.addShape=function(t){this.shapeList.push(t)},ot.prototype.removeShape=function(t){l(this.shapeList,t)};var ut=function(t,e,i){return t===i?t.next(e):(t.a===e?t.next_a=ut(t.next_a,e,i):t.next_b=ut(t.next_b,e,i),t)};ot.prototype.removeConstraint=function(t){this.constraintList=ut(this.constraintList,this,t)},ot.prototype.setPos=function(t){this.activate(),this.sanityCheck(),t===T&&(t=cp.v(0,0)),this.p=t},ot.prototype.setVel=function(t){this.activate(),this.vx=t.x,this.vy=t.y},ot.prototype.setAngVel=function(t){this.activate(),this.w=t},ot.prototype.setAngleInternal=function(t){s(!isNaN(t),"Internal Error: Attempting to set body's angle to NaN"),this.a=t,this.rot.x=Math.cos(t),this.rot.y=Math.sin(t)},ot.prototype.setAngle=function(t){this.activate(),this.sanityCheck(),this.setAngleInternal(t)},ot.prototype.velocity_func=function(t,e,i){var n=this.vx*e+(t.x+this.f.x*this.m_inv)*i,r=this.vy*e+(t.y+this.f.y*this.m_inv)*i,s=this.v_limit,o=n*n+r*r,a=o>s*s?s/Math.sqrt(o):1;this.vx=n*a,this.vy=r*a;var c=this.w_limit;this.w=m(this.w*e+this.t*this.i_inv*i,-c,c),this.sanityCheck()},ot.prototype.position_func=function(t){this.p.x+=(this.vx+this.v_biasx)*t,this.p.y+=(this.vy+this.v_biasy)*t,this.setAngleInternal(this.a+(this.w+this.w_bias)*t),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},ot.prototype.resetForces=function(){this.activate(),this.f=new y(0,0),this.t=0},ot.prototype.applyForce=function(t,e){this.activate(),this.f=E(this.f,t),this.t+=R(e,t)},ot.prototype.applyImpulse=function(t,e){this.activate(),_e(this,t.x,t.y,e)},ot.prototype.getVelAtPoint=function(t){return E(new y(this.vx,this.vy),w(P(t),this.w))},ot.prototype.getVelAtWorldPoint=function(t){return this.getVelAtPoint(A(t,this.p))},ot.prototype.getVelAtLocalPoint=function(t){return this.getVelAtPoint(L(t,this.rot))},ot.prototype.eachShape=function(t){for(var e=0,i=this.shapeList.length;e<i;e++)t(this.shapeList[e])},ot.prototype.eachConstraint=function(t){for(var e=this.constraintList;e;){var i=e.next(this);t(e),e=i}},ot.prototype.eachArbiter=function(t){for(var e=this.arbiterList;e;){var i=e.next(this);e.swappedColl=this===e.body_b,t(e),e=i}},ot.prototype.local2World=function(t){return E(this.p,L(t,this.rot))},ot.prototype.world2Local=function(t){return F(A(t,this.p),this.rot)},ot.prototype.kineticEnergy=function(){var t=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(t?t*this.m:0)+(e?e*this.i:0)};var dt=cp.SpatialIndex=function(t){if(this.staticIndex=t,t){if(t.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");t.dynamicIndex=this}};dt.prototype.collideStatic=function(t,e){if(t.count>0){var i=t.query;this.each(function(t){i(t,new j(t.bb_l,t.bb_b,t.bb_r,t.bb_t),e)})}};var _t=cp.BBTree=function(t){dt.call(this,t),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};_t.prototype=Object.create(dt.prototype);var ft=0,pt=function(t,e,i){this.obj=null,this.bb_l=n(e.bb_l,i.bb_l),this.bb_b=n(e.bb_b,i.bb_b),this.bb_r=r(e.bb_r,i.bb_r),this.bb_t=r(e.bb_t,i.bb_t),this.parent=null,this.setA(e),this.setB(i)};_t.prototype.makeNode=function(t,e){var i=this.pooledNodes;return i?(this.pooledNodes=i.parent,i.constructor(this,t,e),i):(ft++,new pt(this,t,e))};var gt=0,mt=function(t,e){this.obj=e,t.getBB(e,this),this.parent=null,this.stamp=1,this.pairs=null,gt++};_t.prototype.getBB=function(t,e){var i=this.velocityFunc;if(i){var s=.1,o=(t.bb_r-t.bb_l)*s,a=(t.bb_t-t.bb_b)*s,c=w(i(t),.1);e.bb_l=t.bb_l+n(-o,c.x),e.bb_b=t.bb_b+n(-a,c.y),e.bb_r=t.bb_r+r(o,c.x),e.bb_t=t.bb_t+r(a,c.y)}else e.bb_l=t.bb_l,e.bb_b=t.bb_b,e.bb_r=t.bb_r,e.bb_t=t.bb_t},_t.prototype.getStamp=function(){var t=this.dynamicIndex;return t&&t.stamp?t.stamp:this.stamp},_t.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var vt=0,yt=function(t,e,i,n){this.prevA=null,this.leafA=t,this.nextA=e,this.prevB=null,this.leafB=i,this.nextB=n};_t.prototype.makePair=function(t,e,i,n){var r=this.pooledPairs;return r?(this.pooledPairs=r.prevA,r.prevA=null,r.leafA=t,r.nextA=e,r.prevB=null,r.leafB=i,r.nextB=n,r):(vt++,new yt(t,e,i,n))},yt.prototype.recycle=function(t){this.prevA=t.pooledPairs,t.pooledPairs=this};var Tt=function(t,e,i){i&&(i.leafA===e?i.prevA=t:i.prevB=t),t?t.leafA===e?t.nextA=i:t.nextB=i:e.pairs=i};mt.prototype.clearPairs=function(t){var e,i=this.pairs;for(this.pairs=null;i;)i.leafA===this?(e=i.nextA,Tt(i.prevB,i.leafB,i.nextB)):(e=i.nextB,Tt(i.prevA,i.leafA,i.nextA)),i.recycle(t),i=e};var Ct=function(t,e,i){var n=t.pairs,r=e.pairs,s=i.makePair(t,n,e,r);t.pairs=e.pairs=s,n&&(n.leafA===t?n.prevA=s:n.prevB=s),r&&(r.leafA===e?r.prevA=s:r.prevB=s)};pt.prototype.recycle=function(t){this.parent=t.pooledNodes,t.pooledNodes=this},mt.prototype.recycle=function(t){},pt.prototype.setA=function(t){this.A=t,t.parent=this},pt.prototype.setB=function(t){this.B=t,t.parent=this},mt.prototype.isLeaf=!0,pt.prototype.isLeaf=!1,pt.prototype.otherChild=function(t){return this.A==t?this.B:this.A},pt.prototype.replaceChild=function(t,e,i){o(t==this.A||t==this.B,"Node is not a child of parent."),this.A==t?(this.A.recycle(i),this.setA(e)):(this.B.recycle(i),this.setB(e));for(var s=this;s;s=s.parent){var a=s.A,c=s.B;s.bb_l=n(a.bb_l,c.bb_l),s.bb_b=n(a.bb_b,c.bb_b),s.bb_r=r(a.bb_r,c.bb_r),s.bb_t=r(a.bb_t,c.bb_t)}},pt.prototype.bbArea=mt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var bt=function(t,e){return(r(t.bb_r,e.bb_r)-n(t.bb_l,e.bb_l))*(r(t.bb_t,e.bb_t)-n(t.bb_b,e.bb_b))},xt=function(t,e){return Math.abs(t.bb_l+t.bb_r-e.bb_l-e.bb_r)+Math.abs(t.bb_b+t.bb_t-e.bb_b-e.bb_t)},St=function(t,e,i){if(null==t)return e;if(t.isLeaf)return i.makeNode(e,t);var s=t.B.bbArea()+bt(t.A,e),o=t.A.bbArea()+bt(t.B,e);return s===o&&(s=xt(t.A,e),o=xt(t.B,e)),o<s?t.setB(St(t.B,e,i)):t.setA(St(t.A,e,i)),t.bb_l=n(t.bb_l,e.bb_l),t.bb_b=n(t.bb_b,e.bb_b),t.bb_r=r(t.bb_r,e.bb_r),t.bb_t=r(t.bb_t,e.bb_t),t};pt.prototype.intersectsBB=mt.prototype.intersectsBB=function(t){return this.bb_l<=t.r&&t.l<=this.bb_r&&this.bb_b<=t.t&&t.b<=this.bb_t};var Et=function(t,e,i){t.intersectsBB(e)&&(t.isLeaf?i(t.obj):(Et(t.A,e,i),Et(t.B,e,i)))},At=function(t,e,i){var s=1/(i.x-e.x),o=t.bb_l==e.x?-(1/0):(t.bb_l-e.x)*s,a=t.bb_r==e.x?1/0:(t.bb_r-e.x)*s,c=n(o,a),h=r(o,a),l=1/(i.y-e.y),u=t.bb_b==e.y?-(1/0):(t.bb_b-e.y)*l,d=t.bb_t==e.y?1/0:(t.bb_t-e.y)*l,_=n(u,d),f=r(u,d);if(_<=h&&c<=f){var p=r(c,_),g=n(h,f);if(0<=g&&p<=1)return r(p,0)}return 1/0},Ot=function(t,e,i,r,s){if(t.isLeaf)return s(t.obj);var o=At(t.A,e,i),a=At(t.B,e,i);return o<a?(o<r&&(r=n(r,Ot(t.A,e,i,r,s))),a<r&&(r=n(r,Ot(t.B,e,i,r,s)))):(a<r&&(r=n(r,Ot(t.B,e,i,r,s))),o<r&&(r=n(r,Ot(t.A,e,i,r,s)))),r};_t.prototype.subtreeRecycle=function(t){t.isLeaf&&(this.subtreeRecycle(t.A),this.subtreeRecycle(t.B),t.recycle(this))};var wt=function(t,e,i){if(e==t)return null;var n=e.parent;if(n==t){var r=t.otherChild(e);return r.parent=t.parent,t.recycle(i),r}return n.parent.replaceChild(n,n.otherChild(e),i),t},Rt=function(t,e){return t.bb_l<=e.bb_r&&e.bb_l<=t.bb_r&&t.bb_b<=e.bb_t&&e.bb_b<=t.bb_t};mt.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(e?Ct(t,this,i):(this.stamp<t.stamp&&Ct(this,t,i),n&&n(t.obj,this.obj)))},pt.prototype.markLeafQuery=function(t,e,i,n){Rt(t,this)&&(this.A.markLeafQuery(t,e,i,n),this.B.markLeafQuery(t,e,i,n))},mt.prototype.markSubtree=function(t,e,i){if(this.stamp==t.getStamp()){e&&e.markLeafQuery(this,!1,t,i);for(var n=this;n.parent;n=n.parent)n==n.parent.A?n.parent.B.markLeafQuery(this,!0,t,i):n.parent.A.markLeafQuery(this,!1,t,i)}else for(var r=this.pairs;r;)this===r.leafB?(i&&i(r.leafA.obj,this.obj),r=r.nextB):r=r.nextA},pt.prototype.markSubtree=function(t,e,i){this.A.markSubtree(t,e,i),this.B.markSubtree(t,e,i)},mt.prototype.containsObj=function(t){return this.bb_l<=t.bb_l&&this.bb_r>=t.bb_r&&this.bb_b<=t.bb_b&&this.bb_t>=t.bb_t},mt.prototype.update=function(t){var e=t.root,i=this.obj;return!this.containsObj(i)&&(t.getBB(this.obj,this),e=wt(e,this,t),t.root=St(e,this,t),this.clearPairs(t),this.stamp=t.getStamp(),!0)},mt.prototype.addPairs=function(t){var e=t.dynamicIndex;if(e){var i=e.root;i&&i.markLeafQuery(this,!0,e,null)}else{var n=t.staticIndex.root;this.markSubtree(t,n,null)}},_t.prototype.insert=function(t,e){var i=new mt(this,t);this.leaves[e]=i,this.root=St(this.root,i,this),this.count++,i.stamp=this.getStamp(),i.addPairs(this),this.incrementStamp()},_t.prototype.remove=function(t,e){var i=this.leaves[e];delete this.leaves[e],this.root=wt(this.root,i,this),this.count--,i.clearPairs(this),i.recycle(this)},_t.prototype.contains=function(t,e){return null!=this.leaves[e]};var It=function(t,e){};_t.prototype.reindexQuery=function(t){if(this.root){var e,i=this.leaves;for(e in i)i[e].update(this);var n=this.staticIndex,r=n&&n.root;this.root.markSubtree(this,r,t),n&&!r&&this.collideStatic(this,n,t),this.incrementStamp()}},_t.prototype.reindex=function(){this.reindexQuery(It)},_t.prototype.reindexObject=function(t,e){var i=this.leaves[e];i&&(i.update(this)&&i.addPairs(this),this.incrementStamp())},_t.prototype.pointQuery=function(t,e){this.query(new j(t.x,t.y,t.x,t.y),e)},_t.prototype.segmentQuery=function(t,e,i,n){this.root&&Ot(this.root,t,e,i,n)},_t.prototype.query=function(t,e){this.root&&Et(this.root,t,e)},_t.prototype.count=function(){return this.count},_t.prototype.each=function(t){var e;for(e in this.leaves)t(this.leaves[e].obj)};var Pt=function(t,e,i,s,o){return(r(t.bb_r,s)-n(t.bb_l,e))*(r(t.bb_t,o)-n(t.bb_b,i))},Nt=function(t,e,i,s){if(1==s)return e[i];if(2==s)return t.makeNode(e[i],e[i+1]);for(var o=e[i],a=o.bb_l,c=o.bb_b,h=o.bb_r,l=o.bb_t,u=i+s,d=i+1;d<u;d++)o=e[d],a=n(a,o.bb_l),c=n(c,o.bb_b),h=r(h,o.bb_r),l=r(l,o.bb_t);var _=h-a>l-c,f=new Array(2*s);if(_)for(var d=i;d<u;d++)f[2*d+0]=e[d].bb_l,f[2*d+1]=e[d].bb_r;else for(var d=i;d<u;d++)f[2*d+0]=e[d].bb_b,f[2*d+1]=e[d].bb_t;f.sort(function(t,e){return t-e});var p=.5*(f[s-1]+f[s]),g=a,m=c,v=h,y=l,T=a,C=c,b=h,x=l;_?v=T=p:y=C=p;for(var S=u,E=i;E<S;){var o=e[E];Pt(o,T,C,b,x)<Pt(o,g,m,v,y)?(S--,e[E]=e[S],e[S]=o):E++}if(S==s){for(var o=null,d=i;d<u;d++)o=St(o,e[d],t);return o}return NodeNew(t,Nt(t,e,i,S-i),Nt(t,e,S,u-S))};_t.prototype.optimize=function(){var t=new Array(this.count),e=0;for(var i in this.leaves)t[e++]=this.nodes[i];tree.subtreeRecycle(root),this.root=Nt(tree,t,t.length)};var Lt=function(t,e){!t.isLeaf&&e<=10&&(Lt(t.A,e+1),Lt(t.B,e+1));for(var i="",n=0;n<e;n++)i+=" ";console.log(i+t.bb_b+" "+t.bb_t)};_t.prototype.log=function(){this.root&&Lt(this.root,0)};var Ft=cp.CollisionHandler=function(){this.a=this.b=0};Ft.prototype.begin=function(t,e){return!0},Ft.prototype.preSolve=function(t,e){return!0},Ft.prototype.postSolve=function(t,e){},Ft.prototype.separate=function(t,e){};var Dt=function(t,e){this.e=0,this.u=0,this.surface_vr=T,this.a=t,this.body_a=t.body,this.b=e,this.body_b=e.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Dt.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Dt.prototype.totalImpulse=function(){for(var t=this.contacts,e=new y(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(w(r.n,r.jnAcc))}return this.swappedColl?e:e.neg()},Dt.prototype.totalImpulseWithFriction=function(){for(var t=this.contacts,e=new y(0,0),i=0,n=t.length;i<n;i++){var r=t[i];e.add(new y(r.jnAcc,r.jtAcc).rotate(r.n))}return this.swappedColl?e:e.neg()},Dt.prototype.totalKE=function(){for(var t=(1-this.e)/(1+this.e),e=0,i=this.contacts,n=0,r=i.length;n<r;n++){var s=i[n],o=s.jnAcc,a=s.jtAcc;e+=t*o*o/s.nMass+a*a/s.tMass}return e},Dt.prototype.ignore=function(){this.state="ignore"},Dt.prototype.getA=function(){return this.swappedColl?this.b:this.a},Dt.prototype.getB=function(){return this.swappedColl?this.a:this.b},Dt.prototype.isFirstContact=function(){return"first coll"===this.state};var Mt=function(t,e,i){this.point=t,this.normal=e,this.dist=i};Dt.prototype.getContactPointSet=function(){var t,e=new Array(this.contacts.length);for(t=0;t<e.length;t++)e[t]=new Mt(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},Dt.prototype.getNormal=function(t){var e=this.contacts[t].n;return this.swappedColl?O(e):e},Dt.prototype.getPoint=function(t){return this.contacts[t].p},Dt.prototype.getDepth=function(t){return this.contacts[t].dist};var Bt=function(t,e,i,n){i?i.body_a===e?i.thread_a_next=n:i.thread_b_next=n:e.arbiterList=n,n&&(n.body_a===e?n.thread_a_prev=i:n.thread_b_prev=i)};Dt.prototype.unthread=function(){Bt(this,this.body_a,this.thread_a_prev,this.thread_a_next),Bt(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Dt.prototype.update=function(t,e,i,n){if(this.contacts)for(var r=0;r<this.contacts.length;r++)for(var s=this.contacts[r],o=0;o<t.length;o++){var a=t[o];a.hash===s.hash&&(a.jnAcc=s.jnAcc,a.jtAcc=s.jtAcc)}this.contacts=t,this.handler=e,this.swappedColl=i.collision_type!==e.a,this.e=i.e*n.e,this.u=i.u*n.u,this.surface_vr=A(i.surface_v,n.surface_v),this.a=i,this.body_a=i.body,this.b=n,this.body_b=n.body,"cached"==this.state&&(this.state="first coll")},Dt.prototype.preStep=function(t,e,i){for(var r=this.body_a,s=this.body_b,o=0;o<this.contacts.length;o++){var a=this.contacts[o];a.r1=A(a.p,r.p),a.r2=A(a.p,s.p),a.nMass=1/me(r,s,a.r1,a.r2,a.n),a.tMass=1/me(r,s,a.r1,a.r2,P(a.n)),a.bias=-i*n(0,a.dist+e)/t,a.jBias=0,a.bounce=de(r,s,a.r1,a.r2,a.n)*this.e}},Dt.prototype.applyCachedImpulse=function(t){if(!this.isFirstContact())for(var e=this.body_a,i=this.body_b,n=0;n<this.contacts.length;n++){var r=this.contacts[n],s=r.n.x,o=r.n.y,a=s*r.jnAcc-o*r.jtAcc,c=s*r.jtAcc+o*r.jnAcc;fe(e,i,r.r1,r.r2,a*t,c*t)}};var kt=0,zt=0;Dt.prototype.applyImpulse=function(){kt++;for(var t=this.body_a,e=this.body_b,i=this.surface_vr,n=this.u,s=0;s<this.contacts.length;s++){zt++;var o=this.contacts[s],a=o.nMass,c=o.n,h=o.r1,l=o.r2,u=e.vx-l.y*e.w-(t.vx-h.y*t.w),d=e.vy+l.x*e.w-(t.vy+h.x*t.w),_=c.x*(e.v_biasx-l.y*e.w_bias-t.v_biasx+h.y*t.w_bias)+c.y*(l.x*e.w_bias+e.v_biasy-h.x*t.w_bias-t.v_biasy),f=b(u,d,c.x,c.y),p=b(u+i.x,d+i.y,-c.y,c.x),g=(o.bias-_)*a,v=o.jBias;o.jBias=r(v+g,0);var y=-(o.bounce+f)*a,T=o.jnAcc;o.jnAcc=r(T+y,0);var C=n*o.jnAcc,x=-p*o.tMass,S=o.jtAcc;o.jtAcc=m(S+x,-C,C);var E=c.x*(o.jBias-v),A=c.y*(o.jBias-v);pe(t,-E,-A,h),pe(e,E,A,l);var O=o.jnAcc-T,w=o.jtAcc-S;fe(t,e,h,l,c.x*O-c.y*w,c.x*w+c.y*O)}},Dt.prototype.callSeparate=function(t){var e=t.lookupHandler(this.a.collision_type,this.b.collision_type);e.separate(this,t)},Dt.prototype.next=function(t){return this.body_a==t?this.thread_a_next:this.thread_b_next};var Vt=0,Wt=function(t,e,i,n){this.p=t,this.n=e,this.dist=i,this.r1=this.r2=T,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=n,Vt++},Ut=[],Gt=function(t,e,i,n){var r=i+n,s=A(e,t),o=D(s);if(!(o>=r*r)){var a=Math.sqrt(o);return new Wt(E(t,w(s,.5+(i-.5*r)/(a?a:1/0))),a?w(s,1/a):new y(1,0),a-r,0)}},Xt=function(t,e){var i=Gt(t.tc,e.tc,t.r,e.r);return i?[i]:Ut},jt=function(t,e){var i=e.ta,n=e.tb,r=t.tc,s=A(n,i),o=v(C(s,A(r,i))/D(s)),a=E(i,w(s,o)),c=Gt(r,a,t.r,e.r);if(c){var h=c.n;return 0===o&&C(h,e.a_tangent)<0||1===o&&C(h,e.b_tangent)<0?Ut:[c]}return Ut},Yt=0,Ht=function(t,e){var i=0,n=t.valueOnAxis(e[0].n,e[0].d);if(n>0)return-1;for(var r=1;r<e.length;r++){var s=t.valueOnAxis(e[r].n,e[r].d);if(s>0)return-1;s>n&&(n=s,i=r)}return Yt=n,i},Qt=function(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];e.containsVertPartial(a,c,O(i))&&r.push(new Wt(new y(a,c),i,n,h(t.hashid,o)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],c=l[o+1];t.containsVertPartial(a,c,i)&&r.push(new Wt(new y(a,c),i,n,h(e.hashid,o)))}return r},qt=function(t,e,i,n){for(var r=[],s=t.tVerts,o=0;o<s.length;o+=2){var a=s[o],c=s[o+1];e.containsVert(a,c)&&r.push(new Wt(new y(a,c),i,n,h(t.hashid,o>>1)))}for(var l=e.tVerts,o=0;o<l.length;o+=2){var a=l[o],c=l[o+1];t.containsVert(a,c)&&r.push(new Wt(new y(a,c),i,n,h(e.hashid,o>>1)))}return r.length?r:Qt(t,e,i,n)},Zt=function(t,e){var i=Ht(e,t.tPlanes);if(i==-1)return Ut;var n=Yt,r=Ht(t,e.tPlanes);if(r==-1)return Ut;var s=Yt;return n>s?qt(t,e,t.tPlanes[i].n,n):qt(t,e,O(e.tPlanes[r].n),s)},Kt=function(t,e,i){var r=C(e,t.ta)-t.r,s=C(e,t.tb)-t.r;return n(r,s)-i},Jt=function(t,e,i,n,r){for(var s=R(e.tn,e.ta),o=R(e.tn,e.tb),a=w(e.tn,r),c=i.tVerts,l=0;l<c.length;l+=2){var u=c[l],d=c[l+1];if(b(u,d,a.x,a.y)<C(e.tn,e.ta)*r+e.r){var _=I(e.tn.x,e.tn.y,u,d);s>=_&&_>=o&&t.push(new Wt(new y(u,d),a,n,h(i.hashid,l)))}}},$t=function(t,e){var i=[],n=e.tPlanes,r=n.length,s=C(t.tn,t.ta),o=e.valueOnAxis(t.tn,s)-t.r,a=e.valueOnAxis(O(t.tn),-s)-t.r;if(a>0||o>0)return Ut;var c=0,l=Kt(t,n[0].n,n[0].d);if(l>0)return Ut;for(var u=0;u<r;u++){var d=Kt(t,n[u].n,n[u].d);if(d>0)return Ut;d>l&&(l=d,c=u)}var _=O(n[c].n),f=E(t.ta,w(_,t.r)),p=E(t.tb,w(_,t.r));if(e.containsVert(f.x,f.y)&&i.push(new Wt(f,_,l,h(t.hashid,0))),e.containsVert(p.x,p.y)&&i.push(new Wt(p,_,l,h(t.hashid,1))),(o>=l||a>=l)&&(o>a?Jt(i,t,e,o,1):Jt(i,t,e,a,-1)),0===i.length){var g,m=2*c,v=e.tVerts,T=new y(v[m],v[m+1]);if(g=Gt(t.ta,T,t.r,0,i))return[g];if(g=Gt(t.tb,T,t.r,0,i))return[g];var b=2*r,x=new y(v[(m+2)%b],v[(m+3)%b]);if(g=Gt(t.ta,x,t.r,0,i))return[g];if(g=Gt(t.tb,x,t.r,0,i))return[g]}return i},te=function(t,e){for(var i=e.tPlanes,n=0,r=C(i[0].n,t.tc)-i[0].d-t.r,s=0;s<i.length;s++){var o=C(i[s].n,t.tc)-i[s].d-t.r;if(o>0)return Ut;o>r&&(r=o,n=s)}var a=i[n].n,c=e.tVerts,h=c.length,l=n<<1,u=c[l],d=c[l+1],_=c[(l+2)%h],f=c[(l+3)%h],p=I(a.x,a.y,u,d),g=I(a.x,a.y,_,f),m=R(a,t.tc);if(m<g){var v=Gt(t.tc,new y(_,f),t.r,0,v);return v?[v]:Ut}if(m<p)return[new Wt(A(t.tc,w(a,t.r+r/2)),O(a),r,0)];var v=Gt(t.tc,new y(u,d),t.r,0,v);return v?[v]:Ut};$.prototype.collisionCode=0,et.prototype.collisionCode=1,nt.prototype.collisionCode=2,$.prototype.collisionTable=[Xt,jt,te],et.prototype.collisionTable=[null,function(t,e){return Ut},$t],nt.prototype.collisionTable=[null,null,Zt];var ee=cp.collideShapes=function(t,e){return s(t.collisionCode<=e.collisionCode,"Collided shapes must be sorted by type"),t.collisionTable[e.collisionCode](t,e)},ie=new Ft,ne=cp.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new _t(null),this.activeShapes=new _t(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=ie,this.postStepCallbacks=[],this.iterations=10,this.gravity=T,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new ot(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ne.prototype.getCurrentTimeStep=function(){return this.curr_dt},ne.prototype.setIterations=function(t){this.iterations=t},ne.prototype.isLocked=function(){return this.locked};var re=function(t){s(!t.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ne.prototype.addCollisionHandler=function(t,e,i,n,r,s){re(this),this.removeCollisionHandler(t,e);var o=new Ft;o.a=t,o.b=e,i&&(o.begin=i),n&&(o.preSolve=n),r&&(o.postSolve=r),s&&(o.separate=s),this.collisionHandlers[h(t,e)]=o},ne.prototype.removeCollisionHandler=function(t,e){re(this),delete this.collisionHandlers[h(t,e)]},ne.prototype.setDefaultCollisionHandler=function(t,e,i,n){re(this);var r=new Ft;t&&(r.begin=t),e&&(r.preSolve=e),i&&(r.postSolve=i),n&&(r.separate=n),this.defaultHandler=r},ne.prototype.lookupHandler=function(t,e){return this.collisionHandlers[h(t,e)]||this.defaultHandler},ne.prototype.addShape=function(t){var e=t.body;return e.isStatic()?this.addStaticShape(t):(s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this),e.activate(),e.addShape(t),t.update(e.p,e.rot),this.activeShapes.insert(t,t.hashid),t.space=this,t)},ne.prototype.addStaticShape=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.body;return e.addShape(t),t.update(e.p,e.rot),this.staticShapes.insert(t,t.hashid),t.space=this,t},ne.prototype.addBody=function(t){return s(!t.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),s(!t.space,"This body is already added to a space and cannot be added to another."),re(this),this.bodies.push(t),t.space=this,t},ne.prototype.addConstraint=function(t){s(!t.space,"This shape is already added to a space and cannot be added to another."),re(this);var e=t.a,i=t.b;return e.activate(),i.activate(),this.constraints.push(t),t.next_a=e.constraintList,e.constraintList=t,t.next_b=i.constraintList,i.constraintList=t,t.space=this,t},ne.prototype.filterArbiters=function(t,e){for(var i in this.cachedArbiters){var n=this.cachedArbiters[i];(t!==n.body_a||e!==n.a&&null!==e)&&(t!==n.body_b||e!==n.b&&null!==e)||(e&&"cached"!==n.state&&n.callSeparate(this),n.unthread(),l(this.arbiters,n),delete this.cachedArbiters[i])}},ne.prototype.removeShape=function(t){var e=t.body;e.isStatic()?this.removeStaticShape(t):(s(this.containsShape(t),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),re(this),e.activate(),e.removeShape(t),this.filterArbiters(e,t),this.activeShapes.remove(t,t.hashid),t.space=null)},ne.prototype.removeStaticShape=function(t){s(this.containsShape(t),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),re(this);var e=t.body;e.isStatic()&&e.activateStatic(t),e.removeShape(t),this.filterArbiters(e,t),this.staticShapes.remove(t,t.hashid),t.space=null},ne.prototype.removeBody=function(t){s(this.containsBody(t),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),re(this),t.activate(),l(this.bodies,t),t.space=null},ne.prototype.removeConstraint=function(t){s(this.containsConstraint(t),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),re(this),t.a.activate(),t.b.activate(),l(this.constraints,t),t.a.removeConstraint(t),t.b.removeConstraint(t),t.space=null},ne.prototype.containsShape=function(t){return t.space===this},ne.prototype.containsBody=function(t){return t.space==this},ne.prototype.containsConstraint=function(t){return t.space==this},ne.prototype.uncacheArbiter=function(t){delete this.cachedArbiters[h(t.a.hashid,t.b.hashid)],l(this.arbiters,t)},ne.prototype.eachBody=function(t){this.lock();for(var e=this.bodies,i=0;i<e.length;i++)t(e[i]);for(var n=this.sleepingComponents,i=0;i<n.length;i++)for(var r=n[i],s=r;s;){var o=s.nodeNext;t(s),s=o}this.unlock(!0)},ne.prototype.eachShape=function(t){this.lock(),this.activeShapes.each(t),this.staticShapes.each(t),this.unlock(!0)},ne.prototype.eachConstraint=function(t){this.lock();for(var e=this.constraints,i=0;i<e.length;i++)t(e[i]);this.unlock(!0)},ne.prototype.reindexStatic=function(){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(t){var e=t.body;t.update(e.p,e.rot)}),this.staticShapes.reindex()},ne.prototype.reindexShape=function(t){s(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var e=t.body;t.update(e.p,e.rot),this.activeShapes.reindexObject(t,t.hashid),this.staticShapes.reindexObject(t,t.hashid)},ne.prototype.reindexShapesForBody=function(t){for(var e=t.shapeList;e;e=e.next)this.reindexShape(e)},ne.prototype.useSpatialHash=function(t,e){throw new Error("Spatial Hash not implemented.")},ne.prototype.activateBody=function(t){if(s(!t.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)this.rousedBodies.indexOf(t)===-1&&this.rousedBodies.push(t);else{this.bodies.push(t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.staticShapes.remove(i,i.hashid),this.activeShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;if(t===r||r.isStatic()){var o=n.a,a=n.b;this.cachedArbiters[h(o.hashid,a.hashid)]=n,n.stamp=this.stamp,n.handler=this.lookupHandler(o.collision_type,a.collision_type),this.arbiters.push(n)}}for(var c=t.constraintList;c;c=c.nodeNext){var r=c.a;(t===r||r.isStatic())&&this.constraints.push(c)}}},ne.prototype.deactivateBody=function(t){s(!t.isRogue(),"Internal error: Attempting to deactivate a rogue body."),l(this.bodies,t);for(var e=0;e<t.shapeList.length;e++){var i=t.shapeList[e];this.activeShapes.remove(i,i.hashid),this.staticShapes.insert(i,i.hashid)}for(var n=t.arbiterList;n;n=n.next(t)){var r=n.body_a;(t===r||r.isStatic())&&this.uncacheArbiter(n)}for(var o=t.constraintList;o;o=o.nodeNext){var r=o.a;(t===r||r.isStatic())&&l(this.constraints,o)}};var se=function(t){return t?t.nodeRoot:null},oe=function(t){if(t&&t.isSleeping(t)){s(!t.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var e=t.space,i=t;i;){var n=i.nodeNext;i.nodeIdleTime=0,i.nodeRoot=null,i.nodeNext=null,e.activateBody(i),i=n}l(e.sleepingComponents,t)}};ot.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,oe(se(this)))},ot.prototype.activateStatic=function(t){s(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var e=this.arbiterList;e;e=e.next(this))t&&t!=e.a&&t!=e.b||(e.body_a==this?e.body_b:e.body_a).activate()},ot.prototype.pushArbiter=function(t){o(null===(t.body_a===this?t.thread_a_next:t.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),o(null===(t.body_a===this?t.thread_a_prev:t.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;o(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),t.body_a===this?t.thread_a_next=e:t.thread_b_next=e,e&&(e.body_a===this?e.thread_a_prev=t:e.thread_b_prev=t),this.arbiterList=t};var ae=function(t,e){e.nodeRoot=t,e!==t&&(e.nodeNext=t.nodeNext,t.nodeNext=e)},ce=function(t,e){if(!e.isRogue()){var i=se(e);if(null==i){ae(t,e);for(var n=e.arbiterList;n;n=n.next(e))ce(t,e==n.body_a?n.body_b:n.body_a);for(var r=e.constraintList;r;r=r.next(e))ce(t,e==r.a?r.b:r.a)}else o(i===t,"Internal Error: Inconsistency detected in the contact graph.")}},he=function(t,e){for(var i=t;i;i=i.nodeNext)if(i.nodeIdleTime<e)return!0;return!1};ne.prototype.processComponents=function(t){for(var e=this.sleepTimeThreshold!==1/0,i=this.bodies,n=0;n<i.length;n++){var r=i[n];o(null===r.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),o(null===r.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(e)for(var s=this.idleSpeedThreshold,a=s?s*s:D(this.gravity)*t*t,n=0;n<i.length;n++){var r=i[n],c=a?r.m*a:0;r.nodeIdleTime=r.kineticEnergy()>c?0:r.nodeIdleTime+t}for(var h=this.arbiters,n=0,l=h.length;n<l;n++){var u=h[n],d=u.body_a,_=u.body_b;e&&((_.isRogue()&&!_.isStatic()||d.isSleeping())&&d.activate(),(d.isRogue()&&!d.isStatic()||_.isSleeping())&&_.activate()),d.pushArbiter(u),_.pushArbiter(u)}if(e){for(var f=this.constraints,n=0;n<f.length;n++){var p=f[n],d=p.a,_=p.b;_.isRogue()&&!_.isStatic()&&d.activate(),d.isRogue()&&!d.isStatic()&&_.activate()}for(var n=0;n<i.length;){var r=i[n];if(null!==se(r)||(ce(r,r),he(r,this.sleepTimeThreshold)))n++,r.nodeRoot=null,r.nodeNext=null;else{this.sleepingComponents.push(r);for(var g=r;g;g=g.nodeNext)this.deactivateBody(g)}}}},ot.prototype.sleep=function(){this.sleepWithGroup(null)},ot.prototype.sleepWithGroup=function(t){s(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var e=this.space;if(s(e,"Cannot put a rogue body to sleep."),
s(!e.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),s(null===t||t.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void s(se(this)===se(t),"The body is already sleeping and it's group cannot be reassigned.");for(var i=0;i<this.shapeList.length;i++)this.shapeList[i].update(this.p,this.rot);if(e.deactivateBody(this),t){var n=se(t);this.nodeRoot=n,this.nodeNext=n.nodeNext,this.nodeIdleTime=0,n.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,e.sleepingComponents.push(this);l(e.bodies,this)},ne.prototype.activateShapesTouchingShape=function(t){this.sleepTimeThreshold!==1/0&&this.shapeQuery(t,function(t,e){t.body.activate()})},ne.prototype.pointQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&r.pointQuery(t)&&n(r)},s=new j(t.x,t.y,t.x,t.y);this.lock(),this.activeShapes.query(s,r),this.staticShapes.query(s,r),this.unlock(!0)},ne.prototype.pointQueryFirst=function(t,e,i){var n=null;return this.pointQuery(t,e,i,function(t){t.sensor||(n=t)}),n},ne.prototype.nearestPointQuery=function(t,e,i,n,r){var s=function(s){if((!s.group||n!==s.group)&&i&s.layers){var o=s.nearestPointQuery(t);o.d<e&&r(s,o.d,o.p)}},o=Y(t,e);this.lock(),this.activeShapes.query(o,s),this.staticShapes.query(o,s),this.unlock(!0)},ne.prototype.nearestPointQueryNearest=function(t,e,i,n){var r,s=function(s){if((!s.group||n!==s.group)&&i&s.layers&&!s.sensor){var o=s.nearestPointQuery(t);o.d<e&&(!r||o.d<r.d)&&(r=o)}},o=Y(t,e);return this.activeShapes.query(o,s),this.staticShapes.query(o,s),r},ne.prototype.segmentQuery=function(t,e,i,n,r){var s=function(s){var o;return(!s.group||n!==s.group)&&i&s.layers&&(o=s.segmentQuery(t,e))&&r(s,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,1,s),this.unlock(!0)},ne.prototype.segmentQueryFirst=function(t,e,i,n){var r=null,s=function(s){var o;return(!s.group||n!==s.group)&&i&s.layers&&!s.sensor&&(o=s.segmentQuery(t,e))&&(null===r||o.t<r.t)&&(r=o),r?r.t:1};return this.staticShapes.segmentQuery(t,e,1,s),this.activeShapes.segmentQuery(t,e,r?r.t:1,s),r},ne.prototype.bbQuery=function(t,e,i,n){var r=function(r){(!r.group||i!==r.group)&&e&r.layers&&H(t,r.bb_l,r.bb_b,r.bb_r,r.bb_t)&&n(r)};this.lock(),this.activeShapes.query(t,r),this.staticShapes.query(t,r),this.unlock(!0)},ne.prototype.shapeQuery=function(t,e){var i=t.body;i&&t.update(i.p,i.rot);var n=new j(t.bb_l,t.bb_b,t.bb_r,t.bb_t),r=!1,s=function(i){var n=t;if((!n.group||n.group!==i.group)&&n.layers&i.layers&&n!==i){var s;if(n.collisionCode<=i.collisionCode)s=ee(n,i);else{s=ee(i,n);for(var o=0;o<s.length;o++)s[o].n=O(s[o].n)}if(s.length&&(r=!(n.sensor||i.sensor),e)){for(var a=new Array(s.length),o=0;o<s.length;o++)a[o]=new Mt(s[o].p,s[o].n,s[o].dist);e(i,a)}}};return this.lock(),this.activeShapes.query(n,s),this.staticShapes.query(n,s),this.unlock(!0),r},ne.prototype.addPostStepCallback=function(t){o(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(t)},ne.prototype.runPostStepCallbacks=function(){for(var t=0;t<this.postStepCallbacks.length;t++)this.postStepCallbacks[t]();this.postStepCallbacks=[]},ne.prototype.lock=function(){this.locked++},ne.prototype.unlock=function(t){if(this.locked--,s(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&t){for(var e=this.rousedBodies,i=0;i<e.length;i++)this.activateBody(e[i]);e.length=0,this.runPostStepCallbacks()}},ne.prototype.makeCollideShapes=function(){var t=this;return function(e,i){var n=t;if(e.bb_l<=i.bb_r&&i.bb_l<=e.bb_r&&e.bb_b<=i.bb_t&&i.bb_b<=e.bb_t&&e.body!==i.body&&(!e.group||e.group!==i.group)&&e.layers&i.layers){var r=n.lookupHandler(e.collision_type,i.collision_type),s=e.sensor||i.sensor;if(!s||r!==ie){if(e.collisionCode>i.collisionCode){var o=e;e=i,i=o}var a=ee(e,i);if(0!==a.length){var c=h(e.hashid,i.hashid),l=n.cachedArbiters[c];l||(l=n.cachedArbiters[c]=new Dt(e,i)),l.update(a,r,e,i),"first coll"!=l.state||r.begin(l,n)||l.ignore(),"ignore"!==l.state&&r.preSolve(l,n)&&!s?n.arbiters.push(l):(l.contacts=null,"ignore"!==l.state&&(l.state="normal")),l.stamp=n.stamp}}}}},ne.prototype.arbiterSetFilter=function(t){var e=this.stamp-t.stamp,i=t.body_a,n=t.body_b;return!(!i.isStatic()&&!i.isSleeping()||!n.isStatic()&&!n.isSleeping())||(e>=1&&"cached"!=t.state&&(t.callSeparate(this),t.state="cached"),!(e>=this.collisionPersistence)||(t.contacts=null,!1))};var le=function(t){var e=t.body;t.update(e.p,e.rot)};ne.prototype.step=function(t){if(0!==t){s(0===T.x&&0===T.y,"vzero is invalid"),this.stamp++;var e=this.curr_dt;this.curr_dt=t;var i,n,r,o=this.bodies,a=this.constraints,c=this.arbiters;for(i=0;i<c.length;i++){var h=c[i];h.state="normal",h.body_a.isSleeping()||h.body_b.isSleeping()||h.unthread()}for(c.length=0,this.lock(),i=0;i<o.length;i++)o[i].position_func(t);this.activeShapes.each(le),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(t),this.lock();for(r in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[r])||delete this.cachedArbiters[r];var l=this.collisionSlop,u=1-Math.pow(this.collisionBias,t);for(i=0;i<c.length;i++)c[i].preStep(t,l,u);for(i=0;i<a.length;i++){var d=a[i];d.preSolve(this),d.preStep(t)}var _=Math.pow(this.damping,t),f=this.gravity;for(i=0;i<o.length;i++)o[i].velocity_func(f,_,t);var p=0===e?0:t/e;for(i=0;i<c.length;i++)c[i].applyCachedImpulse(p);for(i=0;i<a.length;i++)a[i].applyCachedImpulse(p);for(i=0;i<this.iterations;i++){for(n=0;n<c.length;n++)c[n].applyImpulse();for(n=0;n<a.length;n++)a[n].applyImpulse()}for(i=0;i<a.length;i++)a[i].postSolve(this);for(i=0;i<c.length;i++)c[i].handler.postSolve(c[i],this);this.unlock(!0)}};var ue=function(t,e,i,n){var r=t.vx+-i.y*t.w,s=t.vy+i.x*t.w,o=e.vx+-n.y*e.w,a=e.vy+n.x*e.w;return new y(o-r,a-s)},de=function(t,e,i,n,r){var s=t.vx+-i.y*t.w,o=t.vy+i.x*t.w,a=e.vx+-n.y*e.w,c=e.vy+n.x*e.w;return b(a-s,c-o,r.x,r.y)},_e=function(t,e,i,n){t.vx+=e*t.m_inv,t.vy+=i*t.m_inv,t.w+=t.i_inv*(n.x*i-n.y*e)},fe=function(t,e,i,n,r,s){_e(t,-r,-s,i),_e(e,r,s,n)},pe=function(t,e,i,n){t.v_biasx+=e*t.m_inv,t.v_biasy+=i*t.m_inv,t.w_bias+=t.i_inv*I(n.x,n.y,e,i)},ge=function(t,e,i){var n=R(e,i);return t.m_inv+t.i_inv*n*n},me=function(t,e,i,n,r){var s=ge(t,i,r)+ge(e,n,r);return o(0!==s,"Unsolvable collision or constraint."),s},ve=function(t,e,i,n,r,s){var a,c,h,l,u=t.m_inv+e.m_inv;a=u,c=0,h=0,l=u;var d=t.i_inv,_=i.x*i.x*d,f=i.y*i.y*d,p=-i.x*i.y*d;a+=f,c+=p,h+=p,l+=_;var g=e.i_inv,m=n.x*n.x*g,v=n.y*n.y*g,y=-n.x*n.y*g;a+=v,c+=y,h+=y,l+=m;var T=a*l-c*h;o(0!==T,"Unsolvable constraint.");var C=1/T;r.x=l*C,r.y=-c*C,s.x=-h*C,s.y=a*C},ye=function(t,e,i){return new y(C(t,e),C(t,i))},Te=function(t,e){return 1-Math.pow(t,e)},Ce=cp.Constraint=function(t,e){this.a=t,this.b=e,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};Ce.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Ce.prototype.preStep=function(t){},Ce.prototype.applyCachedImpulse=function(t){},Ce.prototype.applyImpulse=function(){},Ce.prototype.getImpulse=function(){return 0},Ce.prototype.preSolve=function(t){},Ce.prototype.postSolve=function(t){},Ce.prototype.next=function(t){return this.a===t?this.next_a:this.next_b};var be=cp.PinJoint=function(t,e,i,n){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n;var r=t?E(t.p,L(i,t.rot)):i,s=e?E(e.p,L(n,e.rot)):n;this.dist=x(A(s,r)),o(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};be.prototype=Object.create(Ce.prototype),be.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=x(n);this.n=w(n,1/(r?r:1/0)),this.nMass=1/me(e,i,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=m(-Te(this.errorBias,t)*(r-this.dist)/t,-s,s),this.jnMax=this.maxForce*t},be.prototype.applyCachedImpulse=function(t){var e=w(this.n,this.jnAcc*t);fe(this.a,this.b,this.r1,this.r2,e.x,e.y)},be.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=de(t,e,this.r1,this.r2,i),r=(this.bias-n)*this.nMass,s=this.jnAcc;this.jnAcc=m(s+r,-this.jnMax,this.jnMax),r=this.jnAcc-s,fe(t,e,this.r1,this.r2,i.x*r,i.y*r)},be.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var xe=cp.SlideJoint=function(t,e,i,n,r,s){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n,this.min=r,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};xe.prototype=Object.create(Ce.prototype),xe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=x(n),s=0;r>this.max?(s=r-this.max,this.n=z(n)):r<this.min?(s=this.min-r,this.n=O(z(n))):(this.n=T,this.jnAcc=0),this.nMass=1/me(e,i,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=m(-Te(this.errorBias,t)*s/t,-o,o),this.jnMax=this.maxForce*t},xe.prototype.applyCachedImpulse=function(t){var e=this.jnAcc*t;fe(this.a,this.b,this.r1,this.r2,this.n.x*e,this.n.y*e)},xe.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=ue(t,e,n,r),o=C(s,i),a=(this.bias-o)*this.nMass,c=this.jnAcc;this.jnAcc=m(c+a,-this.jnMax,0),a=this.jnAcc-c,fe(t,e,this.r1,this.r2,i.x*a,i.y*a)}},xe.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Se=cp.PivotJoint=function(t,e,i,n){if(Ce.call(this,t,e),"undefined"==typeof n){var r=i;i=t?t.world2Local(r):r,n=e?e.world2Local(r):r}this.anchr1=i,this.anchr2=n,this.r1=this.r2=T,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=T};Se.prototype=Object.create(Ce.prototype),Se.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot),ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var n=A(E(i.p,this.r2),E(e.p,this.r1));this.bias=V(w(n,-Te(this.errorBias,t)/t),this.maxBias)},Se.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Se.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=ue(t,e,i,n),s=ye(A(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=V(E(this.jAcc,s),this.jMaxLen),fe(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Se.prototype.getImpulse=function(){return x(this.jAcc)};var Ee=cp.GrooveJoint=function(t,e,i,n,r){Ce.call(this,t,e),this.grv_a=i,this.grv_b=n,this.grv_n=P(k(A(n,i))),this.anchr2=r,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new y(0,0),this.k2=new y(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=null};Ee.prototype=Object.create(Ce.prototype),Ee.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.local2World(this.grv_a),r=e.local2World(this.grv_b),s=L(this.grv_n,e.rot),o=C(n,s);this.grv_tn=s,this.r2=L(this.anchr2,i.rot);var a=R(E(i.p,this.r2),s);a<=R(n,s)?(this.clamp=1,this.r1=A(n,e.p)):a>=R(r,s)?(this.clamp=-1,this.r1=A(r,e.p)):(this.clamp=0,this.r1=A(E(w(P(s),-a),w(s,o)),e.p)),ve(e,i,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*t;var c=A(E(i.p,this.r2),E(e.p,this.r1));this.bias=V(w(c,-Te(this.errorBias,t)/t),this.maxBias)},Ee.prototype.applyCachedImpulse=function(t){fe(this.a,this.b,this.r1,this.r2,this.jAcc.x*t,this.jAcc.y*t)},Ee.prototype.grooveConstrain=function(t){var e=this.grv_tn,i=this.clamp*R(t,e)>0?t:N(t,e);return V(i,this.jMaxLen)},Ee.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.r1,n=this.r2,r=ue(t,e,i,n),s=ye(A(this.bias,r),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(E(o,s)),fe(t,e,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Ee.prototype.getImpulse=function(){return x(this.jAcc)},Ee.prototype.setGrooveA=function(t){this.grv_a=t,this.grv_n=P(k(A(this.grv_b,t))),this.activateBodies()},Ee.prototype.setGrooveB=function(t){this.grv_b=t,this.grv_n=P(k(A(t,this.grv_a))),this.activateBodies()};var Ae=function(t,e){return(t.restLength-e)*t.stiffness},Oe=cp.DampedSpring=function(t,e,i,n,r,s,o){Ce.call(this,t,e),this.anchr1=i,this.anchr2=n,this.restLength=r,this.stiffness=s,this.damping=o,this.springForceFunc=Ae,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Oe.prototype=Object.create(Ce.prototype),Oe.prototype.preStep=function(t){var e=this.a,i=this.b;this.r1=L(this.anchr1,e.rot),this.r2=L(this.anchr2,i.rot);var n=A(E(i.p,this.r2),E(e.p,this.r1)),r=x(n);this.n=w(n,1/(r?r:1/0));var s=me(e,i,this.r1,this.r2,this.n);o(0!==s,"Unsolvable this."),this.nMass=1/s,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*t*s);var a=this.springForceFunc(this,r);fe(e,i,this.r1,this.r2,this.n.x*a*t,this.n.y*a*t)},Oe.prototype.applyCachedImpulse=function(t){},Oe.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=this.n,n=this.r1,r=this.r2,s=de(t,e,n,r,i),o=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+o,o*=this.nMass,fe(t,e,this.r1,this.r2,this.n.x*o,this.n.y*o)},Oe.prototype.getImpulse=function(){return 0};var we=function(t,e){return(e-t.restAngle)*t.stiffness},Re=cp.DampedRotarySpring=function(t,e,i,n,r){Ce.call(this,t,e),this.restAngle=i,this.stiffness=n,this.damping=r,this.springTorqueFunc=we,this.target_wrn=0,this.w_coef=0,this.iSum=0};Re.prototype=Object.create(Ce.prototype),Re.prototype.preStep=function(t){var e=this.a,i=this.b,n=e.i_inv+i.i_inv;o(0!==n,"Unsolvable spring."),this.iSum=1/n,this.w_coef=1-Math.exp(-this.damping*t*n),this.target_wrn=0;var r=this.springTorqueFunc(this,e.a-i.a)*t;e.w-=r*e.i_inv,i.w+=r*i.i_inv},Re.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=t.w-e.w,n=(this.target_wrn-i)*this.w_coef;this.target_wrn=i+n;var r=n*this.iSum;t.w+=r*t.i_inv,e.w-=r*e.i_inv};var Ie=cp.RotaryLimitJoint=function(t,e,i,n){Ce.call(this,t,e),this.min=i,this.max=n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Ie.prototype=Object.create(Ce.prototype),Ie.prototype.preStep=function(t){var e=this.a,i=this.b,n=i.a-e.a,r=0;n>this.max?r=this.max-n:n<this.min&&(r=this.min-n),this.iSum=1/(1/e.i+1/i.i);var s=this.maxBias;this.bias=m(-Te(this.errorBias,t)*r/t,-s,s),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Ie.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Ie.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=-(this.bias+i)*this.iSum,r=this.jAcc;this.bias<0?this.jAcc=m(r+n,0,this.jMax):this.jAcc=m(r+n,-this.jMax,0),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv}},Ie.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Pe=cp.RatchetJoint=function(t,e,i,n){Ce.call(this,t,e),this.angle=0,this.phase=i,this.ratchet=n,this.angle=(e?e.a:0)-(t?t.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Pe.prototype=Object.create(Ce.prototype),Pe.prototype.preStep=function(t){var e=this.a,i=this.b,n=this.angle,r=this.phase,s=this.ratchet,o=i.a-e.a,a=n-o,c=0;a*s>0?c=a:this.angle=Math.floor((o-r)/s)*s+r,this.iSum=1/(e.i_inv+i.i_inv);var h=this.maxBias;this.bias=m(-Te(this.errorBias,t)*c/t,-h,h),this.jMax=this.maxForce*t,this.bias||(this.jAcc=0)},Pe.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Pe.prototype.applyImpulse=function(){if(this.bias){var t=this.a,e=this.b,i=e.w-t.w,n=this.ratchet,r=-(this.bias+i)*this.iSum,s=this.jAcc;this.jAcc=m((s+r)*n,0,this.jMax*Math.abs(n))/n,r=this.jAcc-s,t.w-=r*t.i_inv,e.w+=r*e.i_inv}},Pe.prototype.getImpulse=function(t){return Math.abs(t.jAcc)};var Ne=cp.GearJoint=function(t,e,i,n){Ce.call(this,t,e),this.phase=i,this.ratio=n,this.ratio_inv=1/n,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Ne.prototype=Object.create(Ce.prototype),Ne.prototype.preStep=function(t){var e=this.a,i=this.b;this.iSum=1/(e.i_inv*this.ratio_inv+this.ratio*i.i_inv);var n=this.maxBias;this.bias=m(-Te(this.errorBias,t)*(i.a*this.ratio-e.a-this.phase)/t,-n,n),this.jMax=this.maxForce*t},Ne.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv*this.ratio_inv,i.w+=n*i.i_inv},Ne.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w*this.ratio-t.w,n=(this.bias-i)*this.iSum,r=this.jAcc;this.jAcc=m(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv*this.ratio_inv,e.w+=n*e.i_inv},Ne.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Ne.prototype.setRatio=function(t){this.ratio=t,this.ratio_inv=1/t,this.activateBodies()};var Le=cp.SimpleMotor=function(t,e,i){Ce.call(this,t,e),this.rate=i,this.jAcc=0,this.iSum=this.jMax=0};Le.prototype=Object.create(Ce.prototype),Le.prototype.preStep=function(t){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*t},Le.prototype.applyCachedImpulse=function(t){var e=this.a,i=this.b,n=this.jAcc*t;e.w-=n*e.i_inv,i.w+=n*i.i_inv},Le.prototype.applyImpulse=function(){var t=this.a,e=this.b,i=e.w-t.w+this.rate,n=-i*this.iSum,r=this.jAcc;this.jAcc=m(r+n,-this.jMax,this.jMax),n=this.jAcc-r,t.w-=n*t.i_inv,e.w+=n*e.i_inv},Le.prototype.getImpulse=function(){return Math.abs(this.jAcc)}},{}],231:[function(require,module,exports){eval('if(typeof CC_TEST=="undefined")CC_TEST=typeof tap=="object"||typeof QUnit=="object";if(typeof CC_EDITOR=="undefined")CC_EDITOR=typeof Editor=="object"&&typeof process=="object"&&"electron" in process.versions;if(typeof CC_DEV=="undefined")CC_DEV=CC_EDITOR||CC_TEST;if(typeof CC_JSB=="undefined")CC_JSB=false;'),require("./predefine");var isMainProcess=!1;isMainProcess?cc._initDebugSetting(1):(require("./bin/modular-cocos2d"),require("./bin/modular-cocos2d-cut")),require("./extends"),isMainProcess&&(Editor.versions.cocos2d=require("./package.json").version),module.exports=cc},{"./bin/modular-cocos2d":1,"./bin/modular-cocos2d-cut":4,"./extends":209,"./package.json":void 0,"./predefine":235}],232:[function(t,e,i){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)})},{}],233:[function(t,e,i){Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1}},{}],234:[function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){("undefined"==typeof e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return i!==-1&&i===e})},{}],235:[function(t,e,i){cc={},_ccsg={},t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./polyfill/math"),t("./polyfill/array"),t("./cocos2d/core/platform/js"),t("./cocos2d/core/value-types"),t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCInputManager"),t("./cocos2d/core/platform/CCInputExtension"),t("./cocos2d/core/event"),t("./cocos2d/core/platform/CCSys"),t("./cocos2d/core/platform/CCMacro"),t("./cocos2d/core/load-pipeline"),t("./cocos2d/core/textures"),t("./cocos2d/kazmath"),t("./cocos2d/core/CCDirector"),t("./cocos2d/core/CCDirectorWebGL"),t("./cocos2d/core/CCDirectorCanvas"),t("./cocos2d/core/platform/CCSAXParser"),t("./cocos2d/core/platform/CCView"),t("./cocos2d/core/platform/CCScreen"),t("./cocos2d/core/CCActionManager"),t("./cocos2d/core/CCScheduler"),t("./cocos2d/core/event-manager"),t("./cocos2d/core/renderer"),t("./cocos2d/shaders"),t("./cocos2d/compression"),t("./CCBoot.js"),t("./cocos2d/core/CCGame"),ccui={},ccs={},cp={}},{"./CCBoot.js":2,"./CCDebugger":3,"./cocos2d/compression":30,"./cocos2d/core/CCActionManager":32,"./cocos2d/core/CCDirector":33,"./cocos2d/core/CCDirectorCanvas":34,"./cocos2d/core/CCDirectorWebGL":35,"./cocos2d/core/CCGame":36,"./cocos2d/core/CCScheduler":39,"./cocos2d/core/event":100,"./cocos2d/core/event-manager":96,"./cocos2d/core/load-pipeline":118,"./cocos2d/core/platform/CCInputExtension":129,"./cocos2d/core/platform/CCInputManager":130,"./cocos2d/core/platform/CCMacro":131,"./cocos2d/core/platform/CCSAXParser":133,"./cocos2d/core/platform/CCScreen":134,"./cocos2d/core/platform/CCSys":135,"./cocos2d/core/platform/CCView":136,"./cocos2d/core/platform/js":145,"./cocos2d/core/renderer":154,"./cocos2d/core/textures":160,"./cocos2d/core/utils":165,"./cocos2d/core/value-types":180,"./cocos2d/kazmath":185,"./cocos2d/shaders":204,"./polyfill/array":232,"./polyfill/math":233,"./polyfill/string":234}]},{},[231]);
//# sourceMappingURL=cocos2d-js-min.js.map